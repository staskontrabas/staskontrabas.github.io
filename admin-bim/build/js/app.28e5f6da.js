(function(e){function t(t){for(var a,n,r=t[0],l=t[1],c=t[2],m=0,p=[];m<r.length;m++)n=r[m],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&p.push(i[n][0]),i[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);d&&d(t);while(p.length)p.shift()();return o.push.apply(o,c||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],a=!0,n=1;n<s.length;n++){var l=s[n];0!==i[l]&&(a=!1)}a&&(o.splice(t--,1),e=r(r.s=s[0]))}return e}var a={},i={app:0},o=[];function n(e){return r.p+"js/"+({"noprefetch-78-EUC-H-bcmap":"noprefetch-78-EUC-H-bcmap","noprefetch-78-EUC-V-bcmap":"noprefetch-78-EUC-V-bcmap","noprefetch-78-H-bcmap":"noprefetch-78-H-bcmap","noprefetch-78-RKSJ-H-bcmap":"noprefetch-78-RKSJ-H-bcmap","noprefetch-78-RKSJ-V-bcmap":"noprefetch-78-RKSJ-V-bcmap","noprefetch-78-V-bcmap":"noprefetch-78-V-bcmap","noprefetch-78ms-RKSJ-H-bcmap":"noprefetch-78ms-RKSJ-H-bcmap","noprefetch-78ms-RKSJ-V-bcmap":"noprefetch-78ms-RKSJ-V-bcmap","noprefetch-83pv-RKSJ-H-bcmap":"noprefetch-83pv-RKSJ-H-bcmap","noprefetch-90ms-RKSJ-H-bcmap":"noprefetch-90ms-RKSJ-H-bcmap","noprefetch-90ms-RKSJ-V-bcmap":"noprefetch-90ms-RKSJ-V-bcmap","noprefetch-90msp-RKSJ-H-bcmap":"noprefetch-90msp-RKSJ-H-bcmap","noprefetch-90msp-RKSJ-V-bcmap":"noprefetch-90msp-RKSJ-V-bcmap","noprefetch-90pv-RKSJ-H-bcmap":"noprefetch-90pv-RKSJ-H-bcmap","noprefetch-90pv-RKSJ-V-bcmap":"noprefetch-90pv-RKSJ-V-bcmap","noprefetch-Add-H-bcmap":"noprefetch-Add-H-bcmap","noprefetch-Add-RKSJ-H-bcmap":"noprefetch-Add-RKSJ-H-bcmap","noprefetch-Add-RKSJ-V-bcmap":"noprefetch-Add-RKSJ-V-bcmap","noprefetch-Add-V-bcmap":"noprefetch-Add-V-bcmap","noprefetch-Adobe-CNS1-0-bcmap":"noprefetch-Adobe-CNS1-0-bcmap","noprefetch-Adobe-CNS1-1-bcmap":"noprefetch-Adobe-CNS1-1-bcmap","noprefetch-Adobe-CNS1-2-bcmap":"noprefetch-Adobe-CNS1-2-bcmap","noprefetch-Adobe-CNS1-3-bcmap":"noprefetch-Adobe-CNS1-3-bcmap","noprefetch-Adobe-CNS1-4-bcmap":"noprefetch-Adobe-CNS1-4-bcmap","noprefetch-Adobe-CNS1-5-bcmap":"noprefetch-Adobe-CNS1-5-bcmap","noprefetch-Adobe-CNS1-6-bcmap":"noprefetch-Adobe-CNS1-6-bcmap","noprefetch-Adobe-CNS1-UCS2-bcmap":"noprefetch-Adobe-CNS1-UCS2-bcmap","noprefetch-Adobe-GB1-0-bcmap":"noprefetch-Adobe-GB1-0-bcmap","noprefetch-Adobe-GB1-1-bcmap":"noprefetch-Adobe-GB1-1-bcmap","noprefetch-Adobe-GB1-2-bcmap":"noprefetch-Adobe-GB1-2-bcmap","noprefetch-Adobe-GB1-3-bcmap":"noprefetch-Adobe-GB1-3-bcmap","noprefetch-Adobe-GB1-4-bcmap":"noprefetch-Adobe-GB1-4-bcmap","noprefetch-Adobe-GB1-5-bcmap":"noprefetch-Adobe-GB1-5-bcmap","noprefetch-Adobe-GB1-UCS2-bcmap":"noprefetch-Adobe-GB1-UCS2-bcmap","noprefetch-Adobe-Japan1-0-bcmap":"noprefetch-Adobe-Japan1-0-bcmap","noprefetch-Adobe-Japan1-1-bcmap":"noprefetch-Adobe-Japan1-1-bcmap","noprefetch-Adobe-Japan1-2-bcmap":"noprefetch-Adobe-Japan1-2-bcmap","noprefetch-Adobe-Japan1-3-bcmap":"noprefetch-Adobe-Japan1-3-bcmap","noprefetch-Adobe-Japan1-4-bcmap":"noprefetch-Adobe-Japan1-4-bcmap","noprefetch-Adobe-Japan1-5-bcmap":"noprefetch-Adobe-Japan1-5-bcmap","noprefetch-Adobe-Japan1-6-bcmap":"noprefetch-Adobe-Japan1-6-bcmap","noprefetch-Adobe-Japan1-UCS2-bcmap":"noprefetch-Adobe-Japan1-UCS2-bcmap","noprefetch-Adobe-Korea1-0-bcmap":"noprefetch-Adobe-Korea1-0-bcmap","noprefetch-Adobe-Korea1-1-bcmap":"noprefetch-Adobe-Korea1-1-bcmap","noprefetch-Adobe-Korea1-2-bcmap":"noprefetch-Adobe-Korea1-2-bcmap","noprefetch-Adobe-Korea1-UCS2-bcmap":"noprefetch-Adobe-Korea1-UCS2-bcmap","noprefetch-B5-H-bcmap":"noprefetch-B5-H-bcmap","noprefetch-B5-V-bcmap":"noprefetch-B5-V-bcmap","noprefetch-B5pc-H-bcmap":"noprefetch-B5pc-H-bcmap","noprefetch-B5pc-V-bcmap":"noprefetch-B5pc-V-bcmap","noprefetch-CNS-EUC-H-bcmap":"noprefetch-CNS-EUC-H-bcmap","noprefetch-CNS-EUC-V-bcmap":"noprefetch-CNS-EUC-V-bcmap","noprefetch-CNS1-H-bcmap":"noprefetch-CNS1-H-bcmap","noprefetch-CNS1-V-bcmap":"noprefetch-CNS1-V-bcmap","noprefetch-CNS2-H-bcmap":"noprefetch-CNS2-H-bcmap","noprefetch-CNS2-V-bcmap":"noprefetch-CNS2-V-bcmap","noprefetch-ETHK-B5-H-bcmap":"noprefetch-ETHK-B5-H-bcmap","noprefetch-ETHK-B5-V-bcmap":"noprefetch-ETHK-B5-V-bcmap","noprefetch-ETen-B5-H-bcmap":"noprefetch-ETen-B5-H-bcmap","noprefetch-ETen-B5-V-bcmap":"noprefetch-ETen-B5-V-bcmap","noprefetch-ETenms-B5-H-bcmap":"noprefetch-ETenms-B5-H-bcmap","noprefetch-ETenms-B5-V-bcmap":"noprefetch-ETenms-B5-V-bcmap","noprefetch-EUC-H-bcmap":"noprefetch-EUC-H-bcmap","noprefetch-EUC-V-bcmap":"noprefetch-EUC-V-bcmap","noprefetch-Ext-H-bcmap":"noprefetch-Ext-H-bcmap","noprefetch-Ext-RKSJ-H-bcmap":"noprefetch-Ext-RKSJ-H-bcmap","noprefetch-Ext-RKSJ-V-bcmap":"noprefetch-Ext-RKSJ-V-bcmap","noprefetch-Ext-V-bcmap":"noprefetch-Ext-V-bcmap","noprefetch-GB-EUC-H-bcmap":"noprefetch-GB-EUC-H-bcmap","noprefetch-GB-EUC-V-bcmap":"noprefetch-GB-EUC-V-bcmap","noprefetch-GB-H-bcmap":"noprefetch-GB-H-bcmap","noprefetch-GB-V-bcmap":"noprefetch-GB-V-bcmap","noprefetch-GBK-EUC-H-bcmap":"noprefetch-GBK-EUC-H-bcmap","noprefetch-GBK-EUC-V-bcmap":"noprefetch-GBK-EUC-V-bcmap","noprefetch-GBK2K-H-bcmap":"noprefetch-GBK2K-H-bcmap","noprefetch-GBK2K-V-bcmap":"noprefetch-GBK2K-V-bcmap","noprefetch-GBKp-EUC-H-bcmap":"noprefetch-GBKp-EUC-H-bcmap","noprefetch-GBKp-EUC-V-bcmap":"noprefetch-GBKp-EUC-V-bcmap","noprefetch-GBT-EUC-H-bcmap":"noprefetch-GBT-EUC-H-bcmap","noprefetch-GBT-EUC-V-bcmap":"noprefetch-GBT-EUC-V-bcmap","noprefetch-GBT-H-bcmap":"noprefetch-GBT-H-bcmap","noprefetch-GBT-V-bcmap":"noprefetch-GBT-V-bcmap","noprefetch-GBTpc-EUC-H-bcmap":"noprefetch-GBTpc-EUC-H-bcmap","noprefetch-GBTpc-EUC-V-bcmap":"noprefetch-GBTpc-EUC-V-bcmap","noprefetch-GBpc-EUC-H-bcmap":"noprefetch-GBpc-EUC-H-bcmap","noprefetch-GBpc-EUC-V-bcmap":"noprefetch-GBpc-EUC-V-bcmap","noprefetch-H-bcmap":"noprefetch-H-bcmap","noprefetch-HKdla-B5-H-bcmap":"noprefetch-HKdla-B5-H-bcmap","noprefetch-HKdla-B5-V-bcmap":"noprefetch-HKdla-B5-V-bcmap","noprefetch-HKdlb-B5-H-bcmap":"noprefetch-HKdlb-B5-H-bcmap","noprefetch-HKdlb-B5-V-bcmap":"noprefetch-HKdlb-B5-V-bcmap","noprefetch-HKgccs-B5-H-bcmap":"noprefetch-HKgccs-B5-H-bcmap","noprefetch-HKgccs-B5-V-bcmap":"noprefetch-HKgccs-B5-V-bcmap","noprefetch-HKm314-B5-H-bcmap":"noprefetch-HKm314-B5-H-bcmap","noprefetch-HKm314-B5-V-bcmap":"noprefetch-HKm314-B5-V-bcmap","noprefetch-HKm471-B5-H-bcmap":"noprefetch-HKm471-B5-H-bcmap","noprefetch-HKm471-B5-V-bcmap":"noprefetch-HKm471-B5-V-bcmap","noprefetch-HKscs-B5-H-bcmap":"noprefetch-HKscs-B5-H-bcmap","noprefetch-HKscs-B5-V-bcmap":"noprefetch-HKscs-B5-V-bcmap","noprefetch-Hankaku-bcmap":"noprefetch-Hankaku-bcmap","noprefetch-Hiragana-bcmap":"noprefetch-Hiragana-bcmap","noprefetch-KSC-EUC-H-bcmap":"noprefetch-KSC-EUC-H-bcmap","noprefetch-KSC-EUC-V-bcmap":"noprefetch-KSC-EUC-V-bcmap","noprefetch-KSC-H-bcmap":"noprefetch-KSC-H-bcmap","noprefetch-KSC-Johab-H-bcmap":"noprefetch-KSC-Johab-H-bcmap","noprefetch-KSC-Johab-V-bcmap":"noprefetch-KSC-Johab-V-bcmap","noprefetch-KSC-V-bcmap":"noprefetch-KSC-V-bcmap","noprefetch-KSCms-UHC-H-bcmap":"noprefetch-KSCms-UHC-H-bcmap","noprefetch-KSCms-UHC-HW-H-bcmap":"noprefetch-KSCms-UHC-HW-H-bcmap","noprefetch-KSCms-UHC-HW-V-bcmap":"noprefetch-KSCms-UHC-HW-V-bcmap","noprefetch-KSCms-UHC-V-bcmap":"noprefetch-KSCms-UHC-V-bcmap","noprefetch-KSCpc-EUC-H-bcmap":"noprefetch-KSCpc-EUC-H-bcmap","noprefetch-KSCpc-EUC-V-bcmap":"noprefetch-KSCpc-EUC-V-bcmap","noprefetch-Katakana-bcmap":"noprefetch-Katakana-bcmap","noprefetch-NWP-H-bcmap":"noprefetch-NWP-H-bcmap","noprefetch-NWP-V-bcmap":"noprefetch-NWP-V-bcmap","noprefetch-RKSJ-H-bcmap":"noprefetch-RKSJ-H-bcmap","noprefetch-RKSJ-V-bcmap":"noprefetch-RKSJ-V-bcmap","noprefetch-Roman-bcmap":"noprefetch-Roman-bcmap","noprefetch-UniCNS-UCS2-H-bcmap":"noprefetch-UniCNS-UCS2-H-bcmap","noprefetch-UniCNS-UCS2-V-bcmap":"noprefetch-UniCNS-UCS2-V-bcmap","noprefetch-UniCNS-UTF16-H-bcmap":"noprefetch-UniCNS-UTF16-H-bcmap","noprefetch-UniCNS-UTF16-V-bcmap":"noprefetch-UniCNS-UTF16-V-bcmap","noprefetch-UniCNS-UTF32-H-bcmap":"noprefetch-UniCNS-UTF32-H-bcmap","noprefetch-UniCNS-UTF32-V-bcmap":"noprefetch-UniCNS-UTF32-V-bcmap","noprefetch-UniCNS-UTF8-H-bcmap":"noprefetch-UniCNS-UTF8-H-bcmap","noprefetch-UniCNS-UTF8-V-bcmap":"noprefetch-UniCNS-UTF8-V-bcmap","noprefetch-UniGB-UCS2-H-bcmap":"noprefetch-UniGB-UCS2-H-bcmap","noprefetch-UniGB-UCS2-V-bcmap":"noprefetch-UniGB-UCS2-V-bcmap","noprefetch-UniGB-UTF16-H-bcmap":"noprefetch-UniGB-UTF16-H-bcmap","noprefetch-UniGB-UTF16-V-bcmap":"noprefetch-UniGB-UTF16-V-bcmap","noprefetch-UniGB-UTF32-H-bcmap":"noprefetch-UniGB-UTF32-H-bcmap","noprefetch-UniGB-UTF32-V-bcmap":"noprefetch-UniGB-UTF32-V-bcmap","noprefetch-UniGB-UTF8-H-bcmap":"noprefetch-UniGB-UTF8-H-bcmap","noprefetch-UniGB-UTF8-V-bcmap":"noprefetch-UniGB-UTF8-V-bcmap","noprefetch-UniJIS-UCS2-H-bcmap":"noprefetch-UniJIS-UCS2-H-bcmap","noprefetch-UniJIS-UCS2-HW-H-bcmap":"noprefetch-UniJIS-UCS2-HW-H-bcmap","noprefetch-UniJIS-UCS2-HW-V-bcmap":"noprefetch-UniJIS-UCS2-HW-V-bcmap","noprefetch-UniJIS-UCS2-V-bcmap":"noprefetch-UniJIS-UCS2-V-bcmap","noprefetch-UniJIS-UTF16-H-bcmap":"noprefetch-UniJIS-UTF16-H-bcmap","noprefetch-UniJIS-UTF16-V-bcmap":"noprefetch-UniJIS-UTF16-V-bcmap","noprefetch-UniJIS-UTF32-H-bcmap":"noprefetch-UniJIS-UTF32-H-bcmap","noprefetch-UniJIS-UTF32-V-bcmap":"noprefetch-UniJIS-UTF32-V-bcmap","noprefetch-UniJIS-UTF8-H-bcmap":"noprefetch-UniJIS-UTF8-H-bcmap","noprefetch-UniJIS-UTF8-V-bcmap":"noprefetch-UniJIS-UTF8-V-bcmap","noprefetch-UniJIS2004-UTF16-H-bcmap":"noprefetch-UniJIS2004-UTF16-H-bcmap","noprefetch-UniJIS2004-UTF16-V-bcmap":"noprefetch-UniJIS2004-UTF16-V-bcmap","noprefetch-UniJIS2004-UTF32-H-bcmap":"noprefetch-UniJIS2004-UTF32-H-bcmap","noprefetch-UniJIS2004-UTF32-V-bcmap":"noprefetch-UniJIS2004-UTF32-V-bcmap","noprefetch-UniJIS2004-UTF8-H-bcmap":"noprefetch-UniJIS2004-UTF8-H-bcmap","noprefetch-UniJIS2004-UTF8-V-bcmap":"noprefetch-UniJIS2004-UTF8-V-bcmap","noprefetch-UniJISPro-UCS2-HW-V-bcmap":"noprefetch-UniJISPro-UCS2-HW-V-bcmap","noprefetch-UniJISPro-UCS2-V-bcmap":"noprefetch-UniJISPro-UCS2-V-bcmap","noprefetch-UniJISPro-UTF8-V-bcmap":"noprefetch-UniJISPro-UTF8-V-bcmap","noprefetch-UniJISX0213-UTF32-H-bcmap":"noprefetch-UniJISX0213-UTF32-H-bcmap","noprefetch-UniJISX0213-UTF32-V-bcmap":"noprefetch-UniJISX0213-UTF32-V-bcmap","noprefetch-UniJISX02132004-UTF32-H-bcmap":"noprefetch-UniJISX02132004-UTF32-H-bcmap","noprefetch-UniJISX02132004-UTF32-V-bcmap":"noprefetch-UniJISX02132004-UTF32-V-bcmap","noprefetch-UniKS-UCS2-H-bcmap":"noprefetch-UniKS-UCS2-H-bcmap","noprefetch-UniKS-UCS2-V-bcmap":"noprefetch-UniKS-UCS2-V-bcmap","noprefetch-UniKS-UTF16-H-bcmap":"noprefetch-UniKS-UTF16-H-bcmap","noprefetch-UniKS-UTF16-V-bcmap":"noprefetch-UniKS-UTF16-V-bcmap","noprefetch-UniKS-UTF32-H-bcmap":"noprefetch-UniKS-UTF32-H-bcmap","noprefetch-UniKS-UTF32-V-bcmap":"noprefetch-UniKS-UTF32-V-bcmap","noprefetch-UniKS-UTF8-H-bcmap":"noprefetch-UniKS-UTF8-H-bcmap","noprefetch-UniKS-UTF8-V-bcmap":"noprefetch-UniKS-UTF8-V-bcmap","noprefetch-V-bcmap":"noprefetch-V-bcmap","noprefetch-WP-Symbol-bcmap":"noprefetch-WP-Symbol-bcmap",pdfjsWorker:"pdfjsWorker"}[e]||e)+"."+{"noprefetch-78-EUC-H-bcmap":"533d9d8a","noprefetch-78-EUC-V-bcmap":"009f613d","noprefetch-78-H-bcmap":"b1ce8e70","noprefetch-78-RKSJ-H-bcmap":"b43de06d","noprefetch-78-RKSJ-V-bcmap":"df712317","noprefetch-78-V-bcmap":"f57f8453","noprefetch-78ms-RKSJ-H-bcmap":"424790e1","noprefetch-78ms-RKSJ-V-bcmap":"32986144","noprefetch-83pv-RKSJ-H-bcmap":"9b4e4b60","noprefetch-90ms-RKSJ-H-bcmap":"613f9c4c","noprefetch-90ms-RKSJ-V-bcmap":"b8f0b90b","noprefetch-90msp-RKSJ-H-bcmap":"1e6851ba","noprefetch-90msp-RKSJ-V-bcmap":"a38dd812","noprefetch-90pv-RKSJ-H-bcmap":"3edd9f85","noprefetch-90pv-RKSJ-V-bcmap":"d9824497","noprefetch-Add-H-bcmap":"36bd5a29","noprefetch-Add-RKSJ-H-bcmap":"2e6ac4ea","noprefetch-Add-RKSJ-V-bcmap":"57ae082c","noprefetch-Add-V-bcmap":"1ec238dc","noprefetch-Adobe-CNS1-0-bcmap":"4737c943","noprefetch-Adobe-CNS1-1-bcmap":"0b625a99","noprefetch-Adobe-CNS1-2-bcmap":"dafa15a9","noprefetch-Adobe-CNS1-3-bcmap":"fe2bed12","noprefetch-Adobe-CNS1-4-bcmap":"fdb006f6","noprefetch-Adobe-CNS1-5-bcmap":"57aa4c6d","noprefetch-Adobe-CNS1-6-bcmap":"b52b6392","noprefetch-Adobe-CNS1-UCS2-bcmap":"39765898","noprefetch-Adobe-GB1-0-bcmap":"b471bf3b","noprefetch-Adobe-GB1-1-bcmap":"eaa886ae","noprefetch-Adobe-GB1-2-bcmap":"ec456f3e","noprefetch-Adobe-GB1-3-bcmap":"afe85633","noprefetch-Adobe-GB1-4-bcmap":"37a8a922","noprefetch-Adobe-GB1-5-bcmap":"49da6a39","noprefetch-Adobe-GB1-UCS2-bcmap":"bc4bf6c8","noprefetch-Adobe-Japan1-0-bcmap":"30ba64a1","noprefetch-Adobe-Japan1-1-bcmap":"ca95c1bf","noprefetch-Adobe-Japan1-2-bcmap":"7a0c2141","noprefetch-Adobe-Japan1-3-bcmap":"93685858","noprefetch-Adobe-Japan1-4-bcmap":"4829da08","noprefetch-Adobe-Japan1-5-bcmap":"c808b7bb","noprefetch-Adobe-Japan1-6-bcmap":"52e38198","noprefetch-Adobe-Japan1-UCS2-bcmap":"33558b1d","noprefetch-Adobe-Korea1-0-bcmap":"ab8e3af0","noprefetch-Adobe-Korea1-1-bcmap":"cb67904d","noprefetch-Adobe-Korea1-2-bcmap":"cbc47f6f","noprefetch-Adobe-Korea1-UCS2-bcmap":"8ed94fa9","noprefetch-B5-H-bcmap":"5f41891e","noprefetch-B5-V-bcmap":"7d6c466b","noprefetch-B5pc-H-bcmap":"f760658c","noprefetch-B5pc-V-bcmap":"07d404e6","noprefetch-CNS-EUC-H-bcmap":"1279aad4","noprefetch-CNS-EUC-V-bcmap":"52e4df97","noprefetch-CNS1-H-bcmap":"c0707244","noprefetch-CNS1-V-bcmap":"ae7fbc2d","noprefetch-CNS2-H-bcmap":"89af631d","noprefetch-CNS2-V-bcmap":"5c371bbe","noprefetch-ETHK-B5-H-bcmap":"7f5f5ea2","noprefetch-ETHK-B5-V-bcmap":"f2f94b61","noprefetch-ETen-B5-H-bcmap":"4383e8da","noprefetch-ETen-B5-V-bcmap":"eb71cae3","noprefetch-ETenms-B5-H-bcmap":"c51230b6","noprefetch-ETenms-B5-V-bcmap":"b4c01221","noprefetch-EUC-H-bcmap":"09e56175","noprefetch-EUC-V-bcmap":"f46aadd5","noprefetch-Ext-H-bcmap":"a51a11fa","noprefetch-Ext-RKSJ-H-bcmap":"3de69209","noprefetch-Ext-RKSJ-V-bcmap":"e0b5c9ae","noprefetch-Ext-V-bcmap":"9582ea0c","noprefetch-GB-EUC-H-bcmap":"405228da","noprefetch-GB-EUC-V-bcmap":"04aed0f1","noprefetch-GB-H-bcmap":"575af2d1","noprefetch-GB-V-bcmap":"5c7389b1","noprefetch-GBK-EUC-H-bcmap":"ea8a0752","noprefetch-GBK-EUC-V-bcmap":"abccd170","noprefetch-GBK2K-H-bcmap":"1c4441d5","noprefetch-GBK2K-V-bcmap":"f1277496","noprefetch-GBKp-EUC-H-bcmap":"1ed1c72e","noprefetch-GBKp-EUC-V-bcmap":"67d6dec0","noprefetch-GBT-EUC-H-bcmap":"640f5262","noprefetch-GBT-EUC-V-bcmap":"a09aeb1a","noprefetch-GBT-H-bcmap":"e0820629","noprefetch-GBT-V-bcmap":"57c46c88","noprefetch-GBTpc-EUC-H-bcmap":"ddf2dc3d","noprefetch-GBTpc-EUC-V-bcmap":"9ac0de69","noprefetch-GBpc-EUC-H-bcmap":"0351cde5","noprefetch-GBpc-EUC-V-bcmap":"c7aa5252","noprefetch-H-bcmap":"239ef066","noprefetch-HKdla-B5-H-bcmap":"80a798dd","noprefetch-HKdla-B5-V-bcmap":"3bbb899c","noprefetch-HKdlb-B5-H-bcmap":"b98c8e65","noprefetch-HKdlb-B5-V-bcmap":"bd8a0ec9","noprefetch-HKgccs-B5-H-bcmap":"e9951cc7","noprefetch-HKgccs-B5-V-bcmap":"796b2f2e","noprefetch-HKm314-B5-H-bcmap":"5ea194c8","noprefetch-HKm314-B5-V-bcmap":"3f7009e5","noprefetch-HKm471-B5-H-bcmap":"3d26c210","noprefetch-HKm471-B5-V-bcmap":"3138d658","noprefetch-HKscs-B5-H-bcmap":"f8a09c6c","noprefetch-HKscs-B5-V-bcmap":"4aa9e8f3","noprefetch-Hankaku-bcmap":"f7771e3d","noprefetch-Hiragana-bcmap":"3dcbd026","noprefetch-KSC-EUC-H-bcmap":"3fa3e023","noprefetch-KSC-EUC-V-bcmap":"53026cad","noprefetch-KSC-H-bcmap":"b07cc815","noprefetch-KSC-Johab-H-bcmap":"ce23c8e7","noprefetch-KSC-Johab-V-bcmap":"9ba4ed5f","noprefetch-KSC-V-bcmap":"5d9d8b29","noprefetch-KSCms-UHC-H-bcmap":"79afbd1d","noprefetch-KSCms-UHC-HW-H-bcmap":"7a162e78","noprefetch-KSCms-UHC-HW-V-bcmap":"2f16bcab","noprefetch-KSCms-UHC-V-bcmap":"6b1e9e67","noprefetch-KSCpc-EUC-H-bcmap":"ac56e118","noprefetch-KSCpc-EUC-V-bcmap":"ff0ff4bd","noprefetch-Katakana-bcmap":"ab1ffcef","noprefetch-NWP-H-bcmap":"dfdde2a6","noprefetch-NWP-V-bcmap":"5319e36c","noprefetch-RKSJ-H-bcmap":"eac79ffd","noprefetch-RKSJ-V-bcmap":"9048eaf6","noprefetch-Roman-bcmap":"42468574","noprefetch-UniCNS-UCS2-H-bcmap":"8fabc599","noprefetch-UniCNS-UCS2-V-bcmap":"5aea7743","noprefetch-UniCNS-UTF16-H-bcmap":"a9019bdb","noprefetch-UniCNS-UTF16-V-bcmap":"5fe3eb3a","noprefetch-UniCNS-UTF32-H-bcmap":"f0b2dec1","noprefetch-UniCNS-UTF32-V-bcmap":"02acaf9f","noprefetch-UniCNS-UTF8-H-bcmap":"523dec2e","noprefetch-UniCNS-UTF8-V-bcmap":"edc54254","noprefetch-UniGB-UCS2-H-bcmap":"a8b1cfe1","noprefetch-UniGB-UCS2-V-bcmap":"7f9d5600","noprefetch-UniGB-UTF16-H-bcmap":"9a2dc399","noprefetch-UniGB-UTF16-V-bcmap":"c900e10b","noprefetch-UniGB-UTF32-H-bcmap":"def0c3c2","noprefetch-UniGB-UTF32-V-bcmap":"7fad9462","noprefetch-UniGB-UTF8-H-bcmap":"14f85268","noprefetch-UniGB-UTF8-V-bcmap":"ce970e15","noprefetch-UniJIS-UCS2-H-bcmap":"6b92caf6","noprefetch-UniJIS-UCS2-HW-H-bcmap":"7cc7bdfa","noprefetch-UniJIS-UCS2-HW-V-bcmap":"fd57ede2","noprefetch-UniJIS-UCS2-V-bcmap":"d807a37c","noprefetch-UniJIS-UTF16-H-bcmap":"14f5d65e","noprefetch-UniJIS-UTF16-V-bcmap":"39ead5b8","noprefetch-UniJIS-UTF32-H-bcmap":"53697c32","noprefetch-UniJIS-UTF32-V-bcmap":"258c4e81","noprefetch-UniJIS-UTF8-H-bcmap":"f1c342ea","noprefetch-UniJIS-UTF8-V-bcmap":"cef1ade2","noprefetch-UniJIS2004-UTF16-H-bcmap":"dfbdfa54","noprefetch-UniJIS2004-UTF16-V-bcmap":"9070cfe8","noprefetch-UniJIS2004-UTF32-H-bcmap":"980b2d6f","noprefetch-UniJIS2004-UTF32-V-bcmap":"2c59c604","noprefetch-UniJIS2004-UTF8-H-bcmap":"f2ab1718","noprefetch-UniJIS2004-UTF8-V-bcmap":"b8df6b3e","noprefetch-UniJISPro-UCS2-HW-V-bcmap":"a77e3fd1","noprefetch-UniJISPro-UCS2-V-bcmap":"71eb60a1","noprefetch-UniJISPro-UTF8-V-bcmap":"d5654367","noprefetch-UniJISX0213-UTF32-H-bcmap":"73d22369","noprefetch-UniJISX0213-UTF32-V-bcmap":"73590147","noprefetch-UniJISX02132004-UTF32-H-bcmap":"60939f5d","noprefetch-UniJISX02132004-UTF32-V-bcmap":"29b6663b","noprefetch-UniKS-UCS2-H-bcmap":"9a4647e2","noprefetch-UniKS-UCS2-V-bcmap":"2702971a","noprefetch-UniKS-UTF16-H-bcmap":"1ada049c","noprefetch-UniKS-UTF16-V-bcmap":"e8642261","noprefetch-UniKS-UTF32-H-bcmap":"b89228ce","noprefetch-UniKS-UTF32-V-bcmap":"11bbaf4e","noprefetch-UniKS-UTF8-H-bcmap":"b1fb3c26","noprefetch-UniKS-UTF8-V-bcmap":"901bd04f","noprefetch-V-bcmap":"a1f96034","noprefetch-WP-Symbol-bcmap":"ef9f130d",pdfjsWorker:"e7b41cc9"}[e]+".js"}function r(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.e=function(e){var t=[],s=i[e];if(0!==s)if(s)t.push(s[2]);else{var a=new Promise((function(t,a){s=i[e]=[t,a]}));t.push(s[2]=a);var o,l=document.createElement("script");l.charset="utf-8",l.timeout=120,r.nc&&l.setAttribute("nonce",r.nc),l.src=n(e);var c=new Error;o=function(t){l.onerror=l.onload=null,clearTimeout(m);var s=i[e];if(0!==s){if(s){var a=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+a+": "+o+")",c.name="ChunkLoadError",c.type=a,c.request=o,s[1](c)}i[e]=void 0}};var m=setTimeout((function(){o({type:"timeout",target:l})}),12e4);l.onerror=l.onload=o,document.head.appendChild(l)}return Promise.all(t)},r.m=e,r.c=a,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(s,a,function(t){return e[t]}.bind(null,a));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var m=0;m<l.length;m++)t(l[m]);var d=c;o.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"0576":function(e,t,s){},"05c3":function(e,t,s){"use strict";s("7720")},"07c2":function(e,t,s){"use strict";s("f276")},1:function(e,t){},"13a3":function(e,t){function s(e){return"function"===typeof e.value||(console.warn("[Vue-click-outside:] provided expression",e.expression,"is not a function."),!1)}function a(e,t){if(!e||!t)return!1;for(var s=0,a=t.length;s<a;s++)try{if(e.contains(t[s]))return!0;if(t[s].contains(e))return!1}catch(i){return!1}return!1}function i(e){return"undefined"!==typeof e.componentInstance&&e.componentInstance.$isServer}e.exports={bind:function(e,t,o){function n(t){if(o.context){var s=t.path||t.composedPath&&t.composedPath();s&&s.length>0&&s.unshift(t.target),e.contains(t.target)||a(o.context.popupItem,s)||e.__vueClickOutside__.callback(t)}}s(t)&&(e.__vueClickOutside__={handler:n,callback:t.value},!i(o)&&document.addEventListener("click",n))},update:function(e,t){s(t)&&(e.__vueClickOutside__.callback=t.value)},unbind:function(e,t,s){!i(s)&&document.removeEventListener("click",e.__vueClickOutside__.handler),delete e.__vueClickOutside__}}},"181f":function(e,t,s){},2:function(e,t){},"210c":function(e,t,s){e.exports=s.p+"img/gear.1dbb5970.gif"},"23a0":function(e,t,s){"use strict";s("181f")},3:function(e,t){},"30a9":function(e,t,s){},"3acd":function(e,t,s){"use strict";s("b202")},"3edb":function(e,t,s){"use strict";s("64f8")},4:function(e,t){},4700:function(e,t,s){"use strict";s("5494")},"4a8c":function(e,t,s){e.exports=s.p+"img/screen.ae30335e.png"},"4d2a":function(e,t,s){e.exports=s.p+"img/Logo_icon.432bd5d4.svg"},"4d2b":function(e,t,s){},"4dc2":function(e,t,s){e.exports=s.p+"img/arrows.410bf8d0.svg"},"4e83":function(e,t,s){e.exports=s.p+"img/download.1b568fa9.gif"},5:function(e,t){},5494:function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);var a=s("2b0e"),i=s("7496"),o=s("132d"),n=function(){var e=this,t=e._self._c;return t(i["a"],{attrs:{id:"inspire"}},[t("router-view"),e.onLoadsCheck?e._e():t("div",{staticClass:"m-back m-back--fixed"},[t("div",{staticClass:"vm-progress"},[t("div",{staticClass:"loader"},[t("svg",{staticClass:"circular",attrs:{viewBox:"25 25 50 50"}},[t("circle",{staticClass:"path",attrs:{cx:"50",cy:"50",r:"20",fill:"none","stroke-width":"2","stroke-miterlimit":"10"}})])])])]),t("notifications",{attrs:{group:"note",id:"notification",classes:"vue-notification m-font--size14",width:"300",position:"top right",duration:5e3},scopedSlots:e._u([{key:"body",fn:function(s){return[t("div",{staticClass:"vue-notification-template vue-notification m-font--size14",class:s.item.type,on:{click:s.close}},[t("div",{staticClass:"notification-title"},[t(o["a"],{attrs:{size:"28",color:"#fff"}},[e._v(e._s(e.notifyIcon(s.item.type)))])],1),t("div",{staticClass:"notification-content",domProps:{innerHTML:e._s(s.item.text)}})])]}}])})],1)},r=[],l={name:"App",methods:{notifyIcon(e){let t={success:"mdi-check-circle-outline",error:"mdi-alert-outline"};return t[e]},checkToken(){let e=JSON.parse(localStorage.getItem("token"))||{expiry:!1},t=this.$store.state.auth.expiry||e.expiry;if(t){let e=new Date,s=new Date(1e3*t),a=parseInt((s.getTime()-e.getTime())/1e3/60);a<8&&this.$store.dispatch("auth/refresh")}else this.$store.dispatch("auth/getCodeForToken")},onLoadsCheck(){let e=!1,t=this.$store.state.administration.groupPermissions;return t&&t.length&&(e=!0),e}},mounted(){document.title="UnitBim";setInterval(this.checkToken,6e5)}},c=l,m=s("2877"),d=Object(m["a"])(c,n,r,!1,null,null,null),p=d.exports,u=s("8c4f"),h=s("2f62");const f={local:"http://localhost:8080",server:"https://prodoc.ubdev.ru",login:"https://login.ubdev.ru",account:"https://account.ubdev.ru",project:"https://cloud.ubdev.ru",cloud:"https://cloud.ubdev.ru",tasks:"https://cloud.ubdev.ru",socket_project:"wss://cloud.ubdev.ru",socket_files:"wss://cloud.ubdev.ru",doc_xml:"https://prodoc.ubdev.ru",api:"https://api.dev.sakhalin.ladcloud.ru"},v=function(e,t,s,a={},i="POST",o=!1,n=null){let r={method:i,headers:{"content-type":"application/json"},body:""};r.headers={...r.headers,...a};let l={};return"application/json"==r.headers["content-type"]?l=JSON.stringify(s):(r.headers["content-type"]||delete r.headers["content-type"],l=s),r.body=l,o&&(r={...r,signal:o}),r.credentials="include",null===n?fetch(e+t,r).then(g):fetch(e+t,r).then(_)},b=function(e,t,s={},a={},i=null,o={}){let n=Object.keys(s),r="";n.length&&(r="?",r+=n.map(e=>e+"="+s[e]).join("&"));let l={method:"GET"};return n=Object.keys(a),n.length&&(l.headers={},n.map(e=>{l.headers[e]=a[e]})),o.signal&&(l={...l,signal:o.signal}),l.credentials="include",i?"url"==i?fetch(e+t+r,l).then(y).catch(e=>e):fetch(e+t+r,l).then(_):fetch(e+t+r,l).then(g)};function g(e){return e.text().then(t=>{let s=t;if(s)try{s=JSON.parse(t||null)}catch(a){s={code:1e3,error:"error: No JSON format"}}if(!e.ok){e.status;const t={message:s&&s.message||e.statusText,status:e.status,data:s};return Promise.reject(t)}return s})}function y(e){return e.blob().then(t=>{if(e.ok){let e="";try{e=URL.createObjectURL(t)}catch(s){e={code:1e3,error:"error: No Image"}}return e}if(!e.ok){e.status;const t={message:data&&data.message||e.statusText,status:e.status,data:data,ok:e.ok};return Promise.reject(t)}})}function _(e){return e.blob().then(t=>{if(e.ok)return t;if(!e.ok){401===e.status&&console.log("status === 401");const t={message:data&&data.message||e.statusText,status:e.status,data:data};return Promise.reject(t)}})}const C={pretoken:"/api/v1/oauth2/auth/json",token:"/api/v1/oauth2/token",refresh:"/api/v1/oauth2/refresh",logout__:"/api/v1/oauth2/logout",logout:"/oauth2/sessions/logout",logcheck:"/api/v1/auth/check",restore:"/api/v1/restore",password:"/api/v1/password",open_projects:"/api/v3/projects/",account_user:"/api/v1/store/user",account_company:"/api/v1/store/company",countries:"/api/v1/store/countries",regions:"/api/v1/store/country",invite:"/api/v1/store/company/invite",invite_confirm:"/api/v1/store/company/invite/confirm",invite_redirect:"/api/v1/oauth2/auth/json",invited:"/api/v1/store/company/invites",invited_user:"/api/v1/store/company/user",history_limit:"/api/v1/cloud/company/history_limit",projects:"/api/v1/cloud/",project_size:"/api/v1/agg/",socket_files:"/api/v1/files/socket/",getfile:"/api/v1/files/",upload:"/api/v1/files/upload",getLoginChallenge:"/api/v1/signin/unitbim",comments:"/api/v1/workflow/socket",messages:"/api/v1/workflow/request/messages",permission:"/api/v1/permission",json_to_xlsx:"/api/v1/json_to/xlsx",create_xml:"/api/v1/pkg/export",upload_xml:"/api/v1/pkg/import",attr_error:"/api/v1/class/data/db",class_error:"/api/v1/class/data/db/info",templates:"/api/v1/cloud/company/collision/templates",template:"/api/v1/cloud/company/collision/template",license:"/api/v1/license",getjobs:"/unitbim/schedule/list",setjob:"/unitbim/schedule/external/data/set",post:v,get:b},w={traverseTree:I,createMap:O,createTreeForSidebar:S,getListPath:j},k=function(e,t=30,s=18){let a=e.slice(0,1);a=a.toUpperCase();let i=document.createElement("canvas");i.width=t,i.height=t;let o=i.getContext("2d");o.beginPath(),o.fillStyle="#e55d4a",o.fillRect(0,0,t,t),o.fillStyle="#ffffff",o.font="bold "+s+"px Arial",o.textAlign="center",o.fillText(a,t/2,t/2+.7*s/2);let n=i.toDataURL();return i=null,n},x=function(e,t){return e.sort((function(e,s){return e[t]>s[t]?1:e[t]<s[t]?-1:0}))};function S(e,t=0,s=2,a={}){let i=A(e,t,s,0,0,a),o=i.filter(e=>e.data.group),n=i.filter(e=>!e.data.group);return[...o,...n]}function A(e,t,s,a=0,i=0,o){let n=[],r=e.filter(e=>e.parent==a);return r.map(r=>{if(r.parent==a){let l={title:r.name,data:{...r,parent:a,group:!!r.group,list:r.group?r.folders||[]:null},isExpanded:r.isExpanded,isSelected:r.id==t,children:i==s?[]:A(e,t,s,r.id,i+1)};l={...l,...o},n.push(l)}}),x(n,"order")}function I(e,t=0){let s=[];return e.map(e=>{if(!e.is_deleted){let t="folders",{[t]:a,...i}=e;i.parent=i.parent==i.id?0:i.parent,i.group=!1,i.toGroup=!1,s.push(i),a&&a.length&&(a=I(a,i.id),s=[...s,...a])}}),s}function O(e){let t=I(e);return t}function j(e){let t=e.filter(e=>e.group),s=e.filter(e=>!e.group);return t=t.map(e=>({group:e.name,folders:F(s,e.id)})),s=F(s),{groups:t,folders:s}}function F(e,t=0,s=""){let a=[];return e.map(i=>{if(i.parent==t){let t=s+"/"+i.name;a.push(t);let o=F(e,i.id,t);a=[...a,...o]}}),a}const P=function(e){let t=document.createElement("div");return t.innerHTML=e,t.innerText},E=function(e){if(null===e)return!0;let t=Ae.state.administration.currentLicense;if(null===t)return!1;let s=Ae.state.administration.configLicense;return!s[e]||s[e].code<=t.pcode},U=function(e,t,s){let a="or"!=t;return s.map(s=>{"or"==t&&(a=a||e>>s&1),"and"==t&&(a=a&&e>>s&1)}),!0;//!!access
},B=function(e){let t=255;return t},T=function(e){let t=e.userID,s=0,a=(e.perms||[]).find(t=>t.id+""==e.itemID),i=a&&a.users?JSON.parse(JSON.stringify(a.users)):[],o=i.find(e=>e.id+""==t);if(a&&o)s=0|(o.can_open?1:0)|(o.can_edit?1:0)<<1|(o.can_download?1:0)<<2|(o.can_comment?1:0)<<3;else{let a=!1,i=e.adminPerms;i.map(e=>{"1"!=e.id&&"2"!=e.id||e.users.some(e=>e.id+""==t)&&(a=!0,s=15)}),a||t==e.created_by&&(s=15)}return 15},L={countries:[],regions:[],uploadFileNames:[],uploadFileMap:{},meta:{}},N={setCountries(e,t){e.countries=t},setRegions(e,t){e.regions=t},setUploadNote(e,t){e.uploadFileNames=[...t]},setUploadMap(e,t){e.uploadFileMap=t},setMeta(e,t){e.meta=t}},H={getFileMeta({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=e.workflow.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/attachment/"+a.id+"/meta";return new Promise(e=>{C.get(f["cloud"],C["projects"]+l,{},{authorization:"Bearer "+i}).then(t=>{let a=JSON.parse(t);a&&a.collisions&&s("setMeta",a),e(t)},t=>{e({...t,error:!0})}).catch(t=>{e({...t,error:!0})})})},setFileMeta({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=e.workflow.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/attachment/"+a.id+"/meta";return new Promise(e=>{C.post(f["cloud"],C["projects"]+l,a.body,{authorization:"Bearer "+i},"PUT").then(t=>{e(t)},t=>{e({...t,error:!0})}).catch(t=>{e({...t,error:!0})})})},getJsonXml({rootState:e,commit:t}){let s=e.auth.access_token;return new Promise((e,t)=>{C.get(f["doc_xml"],"/public/doc.json",{},{authorization:"Bearer "+s}).then(t=>{e(t)},e=>{t(e)})})},getFileInfo({rootState:e,commit:t},s){let a=e.auth.access_token;return new Promise((e,t)=>{C.get(f["cloud"],C["getfile"]+s.id,{},{authorization:"Bearer "+a}).then(t=>{e(t)},e=>{t(e)})})},getCountries({rootState:e,commit:t}){let s=e.auth.access_token;C.get(f["account"],C["countries"],{},{authorization:"Bearer "+s}).then(e=>{t("setCountries",x(e,"name"))})},getRegions({rootState:e,commit:t},s){if(s){let a=e.auth.access_token,i="/"+s.id+"/regions";C.get(f["account"],C["regions"]+i,{},{authorization:"Bearer "+a}).then(e=>{t("setRegions",x(e,"name"))})}else t("setRegions",[])},setUploadNote({state:e,commit:t},s){let a=JSON.parse(JSON.stringify(e.uploadFileNames)),i=e.uploadFileMap;return new Promise(e=>{s=s.map(e=>{if(e.pushin){a=[{name:e.name,uuid:e.uuid,action:e.action},...a];let t=new AbortController;i={...i,[e.uuid]:t}}else a=a.filter(t=>t.uuid!=e.uuid),i=Object.fromEntries(Object.entries(i).filter(([t,s])=>t!=e.uuid));return e}),e(t("setUploadNote",a),t("setUploadMap",i))})},abortFetch({state:e,dispatch:t},{uuid:s}){let a=e.uploadFileMap;a[s].abort(),t("setUploadNote",[{uuid:s,pushin:!1}])},uploadFile({rootState:e,state:t,dispatch:s},a){let i=e.auth.access_token;a.append("company_id",e.administration.company.id);let o=t.uploadFileMap[a.get("uuid")].signal;return C.post(f["cloud"],C["upload"],a,{authorization:"Bearer "+i,"content-type":!1},"POST",o).then(e=>({...e,uuid:a.get("uuid")})).catch(e=>({name:a.get("name"),uuid:a.get("uuid"),error:e}))},importXml({rootState:e,state:t,dispatch:s},a){let i=e.auth.access_token;a.append("company_id",e.administration.company.id);let o=t.uploadFileMap[a.get("uuid")].signal;return C.post(f["cloud"],C["upload_xml"],a,{authorization:"Bearer "+i,"content-type":!1},"POST",o).then(e=>({...e,uuid:a.get("uuid")})).catch(e=>({name:a.get("name"),uuid:a.get("uuid"),error:e}))},checkImportXml({rootState:e,dispatch:t},s){let a=e.auth.access_token;return new Promise(e=>{C.get(f["cloud"],C["upload_xml"],{id:s.task_id},{authorization:"Bearer "+a}).then(t=>{e(t)},t=>{console.log("check create_xml er",t),e(t)})})},sendClassError({rootState:e,state:t,dispatch:s},a){let i=e.auth.access_token;return C.post(f["cloud"],C["class_error"],a,{authorization:"Bearer "+i},"POST").then(e=>e).catch(e=>e)},getFile({rootState:e,dispatch:t,commit:s},a){let i=e.auth.access_token,o=a.typeBlob||"url",n=!!a.uuid&&L.uploadFileMap[a.uuid].signal;return new Promise((e,s)=>{C.get(f["cloud"],C["getfile"]+a.id,{},{authorization:"Bearer "+i},o,{signal:n}).then(t=>{e({id:a.id,file:t,uuid:a.uuid})}).catch(e=>("AbortError"===e.name&&t("setUploadNote",{uuid:a.uuid,action:"download",pushin:!1}),{uuid:a.uuid,error:e}))})}};var M={namespaced:!0,state:L,actions:H,mutations:N};const z={login:"",error_login:!1,id_token:"",framer:{active:!1,src:""},access_token:!1,admin_token:"a81935fe0411eb630e6b7435a7ee5b2f40c1c85bd561eb76fc000967a08aa921",invite:!1,token_state:"",token:"",expiry:"",refresh_token:"",token_type:"",invite_code:!1},$={errorLogin(e,t){e.error_login=t.status},error(e,t){e.type="alert-danger",e.message=t},setTokenId(e,t){e.id_token=t.id_token,e.access_token=t.access_token},framer(e,t){e.framer={active:!0,src:t.src}},setTokenState(e,t){e.token_state=t.state},setToken(e,t){e.id_token=t.id_token,e.token=t.access_token,e.access_token=t.access_token,e.expiry=t.expiry,e.refresh_token=t.refresh_token,e.token_type=t.token_type},setInviteCode(e,t){e.invite_code=t}},R={getCodeForToken({commit:e,dispatch:t}){return new Promise(e=>{C.get(f["account"],C["pretoken"]).then(e=>(localStorage.setItem("state",JSON.stringify({state:e.state,path:cg.currentRoute.path,url:cg.currentRoute.fullPath})),window.location.href=e.redirect_url,!0))})},logout({state:e,commit:t}){localStorage.removeItem("token"),window.location.href=f["login"]+C["logout"]+"?id_token_hint="+e.id_token},framer({commit:e}){e("framer",{src:"https://prodoc.ubdev.ru/api/v1/oauth2/auth"})},setTokenId({state:e,dispatch:t,commit:s},a){return s("setToken",a),new Promise(e=>{t("administration/getUser",null,{root:!0}).then(e=>t("administration/getGroupPermissions",null,{root:!0})).then(s=>{if(!s||!s.length){const e=()=>{t("administration/getGroupPermissions",null,{root:!0}).then(t=>{t&&t.length||setTimeout(e,500)})};e()}JSON.parse(localStorage.getItem("state"));cg.push("/workflow"),e(!0)})})},token({commit:e},t){return console.log("////  token"),new Promise(s=>{C.get(f["account"],C["token"],t).then(t=>{localStorage.setItem("token",JSON.stringify({refresh_token:t.refresh_token})),e("setToken",t),s(t)})})},refresh({state:e,commit:t},s){let a=JSON.parse(localStorage.getItem("token"))||{refresh_token:!1},i=e.refresh_token||a.refresh_token||!1;return!!i&&new Promise(e=>{C.post(f["account"],C["refresh"],{refresh_token:i}).then(s=>{localStorage.setItem("token",JSON.stringify(s)),t("setToken",s),e(s)},t=>{console.log("error refresh_token_",t),e(!1)})})},checkInvite({rootState:e,commit:t,dispatch:s},a){let i=e.auth.access_token?e.auth.access_token:"";return new Promise((e,t)=>{C.get(f["account"],C["invite"],{code:a.code},{authorization:"Bearer "+i}).then(t=>{let i=t.status||!1;if(i)if(-1==i)window.location.href=t.register_url+"&email="+t.email+"&company="+t.company.name+"&redirect_url="+f["server"]+a.redirect_url;else if(200==i){let t={code:a.code,answer:"allow"};e(s("confirmInvite",t))}else console.log("Неизвестная ошибка.. [status]"),e(!1);else console.log("Неизвестная ошибка.. [status = false]"),e(!1)},e=>s("toLoginAfterRegistration"))})},toLoginAfterRegistration({commit:e}){C.get(f["account"],C["invite_redirect"]).then(e=>{window.location.href=e.redirect_url})},confirmInvite({rootState:e,commit:t},s){let a=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["invite_confirm"],s,{authorization:"Bearer "+a},"POST").then(t=>{e(t)},e=>{console.log("invite confirm error",e)})})},restore({commit:e},t){let s={status:!1,params:{}};return new Promise(e=>{C.post(f["login"],C["restore"],t).then(()=>{s.status=!0,e(s)},t=>{s.params=Object.assign({},t),e(s)})})},logcheck({rootState:e,state:t}){return new Promise(e=>{e({status:t.authorized})})}};var D={namespaced:!0,state:z,actions:R,mutations:$};const J={"0x80":"EMPTY","0x8A":"PING","0x8B":"PONG","0x81":"OK","0x82":"ERROR","0x83":"CHECK","0x87":"EVENT"},V={EMPTY:"0x00",PING:"0x0A",PONG:"0x0B",OK:"0x01",ERROR:"0x02",LOGIN:"0x03",EVENT:"0x07"},K={"0x40000001":"SUBSCRIBE","0x80000001":"SOMEONE_SUBSCRIBED","0x40000002":"UNSUBSCRIBE","0x80000002":"SOMEONE_UNSUBSCRIBED","0x00000003":"DISCONNECTED","0x80000003":"SOMEONE_DISCONNECTED","0x40000004":"MESSAGES","0x80000004":"MESSAGE_LIST","0x40000005":"MESSAGE","0x80000005":"SOMEONE_MESSAGED","0x40000006":"GET_SUBSCRIBE_LIST","0x80000006":"SUBSCRIBE_LIST","0x4000000B":"BORDERS","0x8000000B":"BORDER_LIST","0x4000000A":"BORDER","0x8000000A":"SOMEONE_BORDERED"},G={SUBSCRIBE:"0x40000001",SOMEONE_SUBSCRIBED:"0x80000001",UNSUBSCRIBE:"0x40000002",SOMEONE_UNSUBSCRIBED:"0x80000002",DISCONNECTED:"0x00000003",SOMEONE_DISCONNECTED:"0x80000003",MESSAGES:"0x40000004",MESSAGE_LIST:"0x80000004",MESSAGE:"0x40000005",SOMEONE_MESSAGED:"0x80000005",GET_SUBSCRIBE_LIST:"0x40000006",SUBSCRIBE_LIST:"0x80000006",BORDERS:"0x4000000B",BORDER_LIST:"0x8000000B",BORDER:"0x4000000A",SOMEONE_BORDERED:"0x8000000A"},Q=e=>"number"!==typeof e?e:0===e?"0x00":e>15?"0x"+e.toString(16).toUpperCase():"0x0"+e.toString(16).toUpperCase(),X=e=>e?parseInt(e,16):0,W=(e,t,s)=>{let a=new Blob([Y(e,t,s)]);return a},Y=(e,t,s)=>{let a=[0,0,0,0];a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=e,t&&(a[5]=255&t,a[6]=t>>>8&255,a[7]=t>>>16&255,a[8]=t>>>24&255);let i=q(s);a[0]=i.length+(t?4:0),a=[...a,...i];let o=new Uint8Array(a);return o},q=e=>{let t=0,s=new Uint8Array(4*e.length);for(let a=0;a!=e.length;a++){let i=e.charCodeAt(a);if(i<128)s[t++]=i;else{if(i<2048)s[t++]=i>>6|192;else{if(i>55295&&i<56320){if(++a>=e.length)throw new Error("UTF-8 encode: incomplete surrogate pair");let o=e.charCodeAt(a);if(o<56320||o>57343)throw new Error("UTF-8 encode: second surrogate character 0x"+o.toString(16)+" at index "+a+" out of range");i=65536+((1023&i)<<10)+(1023&o),s[t++]=i>>18|240,s[t++]=i>>12&63|128}else s[t++]=i>>12|224;s[t++]=i>>6&63|128}s[t++]=63&i|128}}return s.subarray(0,t)},Z=e=>{let t=0,s="";while(t<e.length){let a=e[t++];if(a>127)if(a>191&&a<224){if(t>=e.length)throw new Error("UTF-8 decode: incomplete 2-byte sequence");a=(31&a)<<6|63&e[t++]}else if(a>223&&a<240){if(t+1>=e.length)throw new Error("UTF-8 decode: incomplete 3-byte sequence");a=(15&a)<<12|(63&e[t++])<<6|63&e[t++]}else{if(!(a>239&&a<248))throw new Error("UTF-8 decode: unknown multibyte start 0x"+a.toString(16)+" at index "+(t-1));if(t+2>=e.length)throw new Error("UTF-8 decode: incomplete 4-byte sequence");a=(7&a)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++]}if(a<=65535)s+=String.fromCharCode(a);else{if(!(a<=1114111))throw new Error("UTF-8 decode: code point 0x"+a.toString(16)+" exceeds UTF-16 reach");a-=65536,s+=String.fromCharCode(a>>10|55296),s+=String.fromCharCode(1023&a|56320)}}return s},ee=(e,t)=>Z(e),te=e=>new Response(e).arrayBuffer().then(e=>{let t=new Uint8Array(e),s=ne(t[4]);return{type:s,buffer:t.slice(5)}}),se=(e,t=null,s="")=>W(oe(e),ie(t),s),ae=(e,t=!1)=>new Promise(t=>{te(e).then(e=>{t(ce(e))})}),ie=e=>{let t=null;return e&&(t=X(G[e])),t},oe=e=>X(V[e]),ne=e=>J[Q(e)],re=e=>{let t=0;e.map((e,s)=>{let a=8*s;t|=e<<a});let s=Q(t>>>0);return K[s]},le=e=>{let t=re(e.slice(0,4)),s=ee(e.slice(4),"UTF-8");return{type:t,body:s}},ce=e=>{let t={packetType:e.type,eventType:"",body:"",action:""};switch(e.type){case"CHECK":t.action="login";break;case"OK":t.action="ok";break;case"ERROR":{let s=ee(e.buffer,"UTF-8");t.body=s,t.action="errorq";break}case"EVENT":{let s=le(e.buffer);t.eventType=s.type,t.body=s.body,t.action=s.type?s.type.toLowerCase():"";break}}return t},me={socket:"",eventOut:"",eventIn:"",doc:"",docId:"",version:null,check:!1,subscribe:!1,key:"",comments:[],activeComment:!1,user:"",project:null,timerId:"",borders:[],borderHelper:{name:0,status:!1},borderList:[],borderStack:[],borderEdit:!1,draft:!1,draftBbox:{x:0,y:0,w:0,h:0},draftList:[],draftHover:""},de={setSocket(e,t){e.socket=t},setTimer(e,t){e.timerId=t},setDocId(e,t){e.docId=t},setDocCurrent(e,t){e.doc=t},setDocVersion(e,t){e.version=t},setUser(e,t){e.user=t},setProject(e,t){e.project=t},setEventOut(e,t){e.eventOut=t},setSubscribe(e){e.subscribe=!0},setKey(e,t){e.key=t},setMessages(e,t){e.comments=t},setActiveComment(e,t){e.activeComment=t},close(e){e.socket="",e.subscribe=!1},setBorders(e,t){e.borders=t},updateBorders(e,t){e.borders=t},setBorderHelper(e,t){e.borderHelper=t},addBorder(e,t){e.borders=[...e.borders,t]},clearBorderStack(e,t){e.borderStack=[]},updateBorderStack(e,t){e.borderStack=t},setBorderList(e,t){e.borderList=t},editBorder(e,t){e.borderEdit=t},setDraftBbox(e,t){e.draftBbox={...e.draftBbox,...t}},setDraftHover(e,t){e.draftHover=t}},pe={setBorderHelper({state:e,commit:t},s){let a=JSON.parse(JSON.stringify(e.borders));a=x(a,"name");let i=(a.length?a[a.length-1].name:0)+1,o={name:i,status:!1,x:0,y:0};o={...o,...s},t("setBorderHelper",o)},addBorder({state:e,commit:t,dispatch:s},a){let i=e.borderHelper.name,o=(new Date).getTime().toString(),n={id:o,uid:e.user.id,x:a.x,y:a.y,w:0,h:0,vis:1,name:i};s("setBorderHelper",{status:!1}),t("addBorder",n),s("border",{name:n.name,x:n.x,y:n.y,h:n.h,w:n.w,vis:1,act:1})},updateBorder({state:e,dispatch:t,commit:s},a){let i=e.borders;i=i.map(e=>{if(e.id==a.id){let s={...e,...a};return t("border",{id:s.id,uid:s.uid,name:s.name,x:s.x,y:s.y,h:s.h,w:s.w,act:0}),s}return e})},setBorderList({state:e,commit:t},s){let a=e.borders,i=[],o=[];a.map(e=>{s.some(t=>t==e.id)?i=[...i,e]:o=[...o,e]}),t("setBorderList",i),t("updateBorderStack",o)},removeBorderInStack({state:e,dispatch:t,commit:s},a){t("border",{id:a,act:-1})},renameBorderInStack({state:e,dispatch:t,commit:s},a){let i=JSON.parse(JSON.stringify(e.comments)),o=JSON.parse(JSON.stringify(e.borders));o=o.filter(e=>e.id!=a),s("updateBorders",o);let n=[];i.map(e=>{n=[...n,...e.borders]});let r=[];i.map(e=>{e.borders.map(e=>{r=[...r,...o.filter(t=>t.id==e)]})});let l=[];if(o.map(e=>{n.some(t=>t==e.id)||(l=[...l,e])}),l.length){let s=Math.max(...r.map(e=>e.name),0)+1,a=x(l,"name");l=a.map((e,t)=>({...e,name:s+t})),l.map(s=>{e.user.id==s.uid&&t("updateBorder",s)})}},setSocket({state:e,dispatch:t,commit:s},a){let i=a.did,o=i.version?i.version:i.files[0].id;s("setDocId",i.id),s("setDocCurrent",i),s("setDocVersion",o);let n=new WebSocket(f["socket_project"]+C["comments"]);s("setSocket",n),n.onmessage=s=>{ae(s.data,e.eventOut).then(a=>{if("ok"==a.action)"LOGIN"!=e.eventOut||e.subscribe||t("subscribe"),e.eventOut;else if(a.action)try{t(a.action,a.body)}catch(s){console.log('ERROR: no action for event. param "res.action = "',a.action,". er: ",s)}})},n.onopen=e=>{s("setEventOut","LOGIN")},n.onclose=t=>{clearInterval(e.timerId),s("close"),s("setBorders",[])}},login({rootState:e,state:t,dispatch:s,commit:a}){let i=e.auth.access_token,o=e.administration.user,n=e.administration.userAvatar,r=e.workflow.activeProject;o.avatar=n,a("setUser",o),a("setProject",r);let l=se("LOGIN",null,i);t.socket.send(l)},close({state:e}){e.socket&&e.socket.close()},ping({state:e}){let t=se("PING");e.socket.send(t)},errorq({state:e,commit:t},s){console.log("---ERROR ",": ",s)},subscribe({state:e,commit:t,dispatch:s}){t("setSubscribe"),t("setEventOut","SUBSCRIBE");let a=se("EVENT","SUBSCRIBE",JSON.stringify({typ:0,id:e.user.company.toString(),prj:e.project.id.toString(),did:e.docId.toString(),ver:parseInt(e.version)}));e.socket.send(a),e.timerId=setInterval(()=>s("ping"),4e4)},someone_subscribed({rootState:e,state:t,dispatch:s,commit:a},i){if(i=JSON.parse(i),"SUBSCRIBE"==t.eventOut)a("setEventOut","SOMEONE_SUBSCRIBED"),a("setKey",i.key),s("messages"),s("borders");else{let t=e.administration.company.users;t=t(e=>e.id),t.some(e=>e==i.uid)||s("administration/getCompany",null,{root:!0})}},borders({state:e,commit:t}){t("setEventOut","BORDERS");let s=se("EVENT","BORDERS",JSON.stringify({key:e.key}));e.socket.send(s)},border_list({state:e,commit:t},s){s=JSON.parse(s);let a=s.brds||[];a=a.map(e=>{let t={id:e.bid,uid:e.uid,name:parseInt(e.nam),x:e.x,y:e.y,h:e.h,w:e.w,vis:e.vis};return t}),t("setBorders",a)},border({state:e,commit:t},s){let a={key:e.key,act:s.act};1==s.act&&(a={...a,nam:s.name.toString(),x:s.x,y:s.y,h:s.h,w:s.w,vis:1}),0==s.act&&(a={...a,bid:s.id,nam:s.name.toString(),x:s.x,y:s.y,h:s.h,w:s.w,vis:1}),-1==s.act&&(a={...a,bid:s.id}),a=se("EVENT","BORDER",JSON.stringify(a)),e.socket.send(a)},someone_bordered({state:e,dispatch:t,commit:s},a){a=JSON.parse(a);let i={},o=[...e.borders];1==a.act&&(a.uid==e.user.id?(o=o.map(e=>e.name==a.nam?{...e,id:a.bid}:e),s("updateBorders",o)):(i.id=a.bid,i.uid=a.uid,i.name=parseInt(a.nam),i.x=a.x,i.y=a.y,i.h=a.h,i.w=a.w,i.vis=0,s("addBorder",i))),0==a.act&&(o=o.map(e=>e.id==a.bid?{...e,name:parseInt(a.nam),x:a.x,y:a.y,h:a.h,w:a.w}:e),s("updateBorders",o)),-1==a.act&&t("renameBorderInStack",a.bid)},messages({state:e,commit:t}){t("setEventOut","MESSAGES");let s=se("EVENT","MESSAGES",JSON.stringify({key:e.key,frm:null,siz:100,lid:null}));e.socket.send(s)},message_list({rootState:e,state:t,dispatch:s,commit:a},i){i=JSON.parse(i);let o=e.administration.company.users,n=i.msgs;const r=e=>(e=e.map(e=>{let s=o.filter(t=>t.id==e.uid);s=!!s.length&&s[0];let a={id:e.mid,uid:e.uid,pid:e.pid,type:"comment",avatar:t.user.id==e.uid?t.user.avatar.src:"",title:"Документ версии ",user:t.user.id==e.uid?t.user.first_name+" "+t.user.last_name:s&&s.first_name?s.first_name+" "+t.user.last_name:s.email,text:e.txt,date:e.tim,borders:e.brds||[],reply:e.chld.length?r(e.chld):[]};return a}),e.reverse());a("setMessages",r(n))},message({state:e,dispatch:t,commit:s},a){let i={key:e.key,pid:a.pid.toString(),act:a.action};if(-1==a.action&&(i.mid=a.id,a.brds.map(e=>{t("border",{id:e,act:-1})})),0==a.action&&(i.mid=a.id,i.txt=a.text),1==a.action){let e=a.borders;i.brds=e,i.txt=a.text}i=se("EVENT","MESSAGE",JSON.stringify(i)),e.socket.send(i)},someone_messaged({rootState:e,state:t,dispatch:s,commit:a},i){i=JSON.parse(i);let o=e.administration.company.users,n={},r=[...t.comments];if(1==i.act){let e=o.filter(e=>e.id==i.uid);e=!!e.length&&e[0],n.id=i.mid,n.uid=i.uid,n.pid=i.pid,n.type="comment",n.avatar=t.user.id==i.uid?t.user.avatar.src:"",n.title="Документ версии ",n.user=t.user.id==i.uid?t.user.first_name+" "+t.user.last_name:e&&e.first_name?e.first_name+" "+t.user.last_name:e.email,n.text=i.txt,n.borders=i.brds||[],n.date=i.tim,n.reply=[],r=parseInt(i.pid)?r.map(e=>e.id==n.pid?{...e,reply:[...e.reply,n]}:e):[...r,n]}0==i.act&&(r=parseInt(i.pid)?r.map(e=>e.id==i.pid?{...e,reply:e.reply.map(e=>e.id==i.mid?{...e,text:i.txt}:e)}:e):r.map(e=>e.id==i.mid?{...e,text:i.txt}:e)),-1==i.act&&(r=parseInt(i.pid)?r.map(e=>e.id==i.pid?{...e,reply:e.reply.filter(e=>e.id!=i.mid)}:e):r.filter(e=>e.id!=i.mid)),a("setMessages",r),t.user.id==i.uid&&(parseInt(i.pid)||a("setActiveComment",i.mid))}};var ue={namespaced:!0,state:me,actions:pe,mutations:de};const he={workflow_project:"",projects:[],folders:[],folderTree:[],currentFolder:0,docs:[],taskList:[],groups:[],foldersMap:[],isExpandedList:[],listDocs:[],listSocket:[],fileTypeConversion:["ifc","rvt","zip","ifcxml"],fileTypeList:["ifc","rvt","zip","ifcxml","doc","consolidations","3ds","bmp","csv","dae","docx","dwg","dxf","iges","jpg","pdf","png","step","stl","stp","tiff","xls"],activeProject:null,active:{},commentList:[],activeComment:!1,commentState:{status:!1,markerStack:[],commentActive:"",commentInput:""},markerHelper:{value:0,status:!1},markerStack:[],markerList:[],markerEdit:!1,draft:!1,draftBbox:{x:0,y:0,w:0,h:0},draftList:[],draftSelected:"",draftHover:"",pdfInit:!1,activeGroup:!1,activeFolder:!1,activeFolderName:"",openFolder:0,templates_collision:[]},fe={openFolder(e,t){e.openFolder=t},setTaskList(e,t){e.taskList=t},setCurrentFolder(e,t){e.currentFolder=t},setExpanded(e,t){e.isExpandedList=t},setMarkerHelper(e,t){e.markerHelper=t},addMarker(e,t){e.markerStack=[...e.markerStack,t]},clearMarkerStack(e,t){e.markerStack=[]},updateMarkerStack(e,t){e.markerStack=t},setMarkerList(e,t){e.markerList=t},editMarker(e,t){e.markerEdit=t},setActiveProject(e,t){e.activeProject=t},setActiveGroup(e,t){e.activeGroup=t},setActiveFolder(e,t){e.activeFolder=t.id,e.activeFolderName=t.name},setActive(e,t){e.active=t},saveChange(e,t){let s=e.projects.map(e=>e.id==t.params.id?Object.assign({},t.params):e);e.projects=s},setComments(e,t){e.commentList=t},addComment(e,t){e.commentList=t},setActiveComment(e,t){e.activeComment=t},saveCommentState(e,t){e.commentState={...e.commentState,...t}},setDraft(e,t){e.draft=t},setDraftBbox(e,t){e.draftBbox={...e.draftBbox,...t}},setDraftSelected(e,t){e.draftSelected=t},setDraftHover(e,t){e.draftHover=t},setPdfInit(e,t){e.pdfInit=t},updateComment(e,t){e.commentList=t},setTableType(e,t){e[t.name]=t.value},addGroup(e,t){e.groups.push(t)},updateGroup(e,t){e.groups=t},setProjectItems(e,t){e.groups=t},setProject(e,t){e.projects=t},setGroups(e,t){e.groups=t},setFolders(e,t){e.folders=t},setFolderTree(e,t){e.folderTree=t},setFoldersMap(e,t){e.foldersMap=t},setDocs(e,t){e.docs=t||[]},setListSocket(e,t){e.listSocket=t},setListDocs(e,t){e.listDocs=t},setCollisionTemplates(e,t){e.templates_collision=t}},ve={createXml({rootState:e,commit:t},s){let a=e.auth.access_token;return new Promise(e=>{C.post(f["cloud"],C["create_xml"],s,{authorization:"Bearer "+a}).then(t=>{e(t)},t=>{console.log("create_xml er",t),e(t)})})},checkCreateXml({rootState:e,dispatch:t,commit:s},a){let i=e.auth.access_token;return new Promise(e=>{C.get(f["cloud"],C["create_xml"],{id:a.task_id},{authorization:"Bearer "+i}).then(t=>{e(t)},t=>{console.log("check create_xml er",t),e(t)})})},getCollisionTemplates({rootState:e,commit:t}){let s=e.auth.access_token;C.get(f["cloud"],C["templates"],{},{authorization:"Bearer "+s}).then(e=>{let s=e||[];t("setCollisionTemplates",s)},e=>{console.log("get templates collisions error",e)})},updateCollisionTemplates({rootState:e,dispatch:t,commit:s},a){let i=e.auth.access_token;return C.post(f["cloud"],C["templates"],a,{authorization:"Bearer "+i},"PUT").then(e=>(t("getCollisionTemplates"),!0),e=>(console.log("update templates collisions error",e),e))},deleteCollisionTemplates({rootState:e,dispatch:t,commit:s},a){let i=e.auth.access_token;return C.post(f["cloud"],C["template"]+"/"+a.id,{},{authorization:"Bearer "+i},"DELETE").then(e=>(t("getCollisionTemplates"),!0),e=>(console.log("update templates collisions error",e),e))},getHistory({rootState:e,commit:t},s){let a=e.auth.access_token,i=e.administration.user,o=e.workflow.activeProject;return new Promise(e=>{C.get(f["project"],C["messages"],{typ:0,id:i.company.toString(),prj:o.id.toString(),did:s.did.toString(),ver:parseInt(s.version),frm:null,siz:"100",lid:null},{authorization:"Bearer "+a}).then(t=>{e({version:parseInt(s.version),created:s.created,msgs:t.msgs})},t=>{console.log("get history er",t),e(t)})})},getProjects({rootState:e,dispatch:t,commit:s},a){let i=e.auth.access_token;const{type_id:o,id:n}=a;C.get(f["project"],C["projects"]+o+"/"+n,{},{authorization:"Bearer "+i}).then(e=>{let t=e||[];s("setProject",t)},e=>{console.log("get projects er",e),401==e.status&&t("auth/refresh").then(e=>{t("getProjects",a)})})},addProject({rootState:e,dispatch:t},s){let a=e.auth.access_token;const{type_id:i,id:o,uuid:n,body:r}=s;let l=i+"/"+o+"/"+n+"/";C.post(f["project"],C["projects"]+l+"info",r,{authorization:"Bearer "+a}).then(()=>{t("getProjects",{type_id:i,id:o})})},updateProject({rootState:e,dispatch:t},s){let a=e.auth.access_token;const{type_id:i,id:o,uuid:n,body:r}=s;let l=i+"/"+o+"/"+n+"/";C.post(f["project"],C["projects"]+l+"info",r,{authorization:"Bearer "+a}).then(()=>{t("getProjects",{type_id:i,id:o})})},removeProject({rootState:e,state:t,commit:s,dispatch:a},i){let o=e.auth.access_token;const n="c",r=e.administration.company.id,{uuid:l}=i;let c=n+"/"+r+"/"+l;return new Promise(e=>{e(C.post(f["project"],C["projects"]+c,{},{authorization:"Bearer "+o},"DELETE"))})},getProjectSize({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=e.administration.company.id;let n=o+"/"+a.id;return new Promise(e=>{e(C.get(f["cloud"],C["project_size"]+n,{},{authorization:"Bearer "+i}))})},getRemovedFiles({rootState:e,state:t,commit:s}){let a=e.auth.access_token;const i="c",o=e.administration.company.id;let n=i+"/"+o+"/trash";return new Promise(e=>{e(C.get(f["project"],C["projects"]+n,{},{authorization:"Bearer "+a}))})},restoreFiles({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o="c",n=e.administration.company.id;let r=o+"/"+n+"/"+a.uuid+"/attachment/trash/"+a.fileType+"/"+a.fileId;return new Promise(e=>{C.post(f["project"],C["projects"]+r,{},{authorization:"Bearer "+i}).then(t=>{e({fileType:a.fileType,name:a.fileName,id:a.fileId,status:1})},t=>{e({fileType:a.fileType,name:a.fileName,id:a.fileId,status:0,text:t.data.error})})})},addConsolidation({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o="c",n=e.administration.company.id,r=t.activeProject.id;let l=o+"/"+n+"/"+r+"/consolidation";return new Promise(e=>{C.post(f["project"],C["projects"]+l,a.body,{authorization:"Bearer "+i},"PUT").then(t=>{e(t)},t=>{e({status:0,text:t.data.error})})})},removeRemovedFiles({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o="c",n=e.administration.company.id;let r=o+"/"+n+"/";switch(a.action){case"trash":r+="trash";break;case"project":r+=a.uuid+"/attachment/trash/";break;case"file":r+=a.uuid+"/attachment/trash/file/"+a.fileId;break;case"folder":r+=a.uuid+"/attachment/trash/folder/"+a.fileId;break;default:r+=a.uuid+"/attachment/trash/file/"+a.fileId}return new Promise(e=>{C.post(f["project"],C["projects"]+r,{},{authorization:"Bearer "+i},"DELETE").then(t=>{e({fileType:a.fileType,name:a.fileName,id:a.fileId,status:1})},t=>{e({fileType:a.fileType,name:a.fileName,id:a.fileId,status:0,text:t.data.error})})})},setMarkerHelper({state:e,commit:t},s){let a=(e.markerStack.length?e.markerStack[e.markerStack.length-1].value:e.markerList.length?e.markerList[e.markerList.length-1].value:0)+1,i={value:a,status:!1,x:0,y:0};i={...i,...s},t("setMarkerHelper",i)},addMarker({state:e,commit:t,dispatch:s},a){let i=e.markerHelper.value,o=(new Date).getTime().toString(),n={id:o,x:a.x,y:a.y,w:0,h:0,value:i};s("setMarkerHelper",{status:!1}),t("addMarker",n)},updateMarker({state:e,commit:t},s){let a=e.markerStack;a=a.map(e=>e.id==s.id?{...e,...s}:e),t("updateMarkerStack",a)},setMarkerList({state:e,commit:t},s){let a=[...e.markerList,...s];t("setMarkerList",a)},removeMarker({state:e,commit:t},s){let a=e.markerStack;if(a=a.filter(e=>e.id!=s),a.length){let t=e.markerList.length+1,s=a;a=s.map((e,s)=>({...e,value:t+s}))}t("updateMarkerStack",a)},dropNode({state:e,commit:t},s){let a=[];a=s.drop?s.list.map(e=>{if(e.data.position=e.path[e.path.length-1],e.path.length-1){let t="["+e.path.slice(0,-1).join(",")+"]";e.data.parent=s.list.filter(e=>e.pathStr==t)[0].data.id}else e.data.parent=0;return e}):[...s.list],t("updateGroup",a)},setExpanded({state:e,commit:t},s){t("setExpanded",s);let a=e.foldersMap.map(e=>s.filter(t=>t==e.id).length?{...e,isExpanded:!0}:{...e,isExpanded:!1});t("setFoldersMap",a)},getFile({rootState:e,commit:t},s){let a=e.auth.access_token;return new Promise(e=>{C.get(f["cloud"],C["getfile"]+s.id,{},{authorization:"Bearer "+a},!0).then(t=>{e({id:s.id,file:t})},e=>"empty")})},getGroups({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/";return new Promise(e=>{C.get(f["project"],C["projects"]+l+"attachment/groups",{},{authorization:"Bearer "+i}).then(t=>{s("setGroups",t),e(t)},e=>"er")})},getFolders({rootState:e,dispatch:t,commit:s}){let a=e.auth.access_token;const i=he.activeProject.id,o="c",n=e.administration.company.id;let r=o+"/"+n+"/"+i+"/";return new Promise(e=>{C.get(f["project"],C["projects"]+r+"attachment",{},{authorization:"Bearer "+a}).then(t=>{s("setFolders",t||[]),e(t)},e=>"er")})},createFoldersMap({rootState:e,state:t,dispatch:s,commit:a}){let i=t.folders||[],o=t.groups||[],n=e.administration.user,r=e.administration.groupPermissions,l=e.administration.folderPermissions,c=e.administration.filesPermissions,m=w.createMap(i);o=o.map(e=>(e.id="group_"+e.name,e.parent=0,e.group=e.id,e.toGroup="root",e.folders&&e.folders.length&&e.folders.map(t=>{m=m.map(s=>(s.id==t.folder&&(s.parent=e.id,s.toGroup=e.id),s))}),e));let d=[],p=[];m.map(e=>{e.files&&e.files.map(e=>{if(!e.is_deleted){let s=/{.*}/,a=(e.name.match(s),""),i="",o="",l=!1,m="",u=e.name.split(".");a=e.name,o=u.splice(-1,1)[0]||"type",t.fileTypeList.some(e=>e==o)||(o="unknown"),e.consolidations&&(o="consolidations"),i=u.join("."),m=e.version?e.files.filter(t=>t.id==e.version)[0].url:e.files&&e.files.length?e.files[0].url:1,l=!!t.fileTypeConversion.some(e=>e==o),l&&p.push({inworkId:e.id,url:m,socketId:""}),d.push({...e,inwork:!1,status_file:-1,tags:[],type:o,name_short:i,access:T({userID:n.id+"",itemID:e.id+"",created_by:e.created_by+"",adminPerms:r,perms:c})})}})}),m=[...o,...m],m=m.map(e=>({...e,isExpanded:t.isExpandedList.filter(t=>t==e.id).length,access:e.group?3:T({userID:n.id+"",itemID:e.id+"",created_by:e.created_by+"",adminPerms:r,perms:l})})).filter(e=>1&e.access),Promise.all([a("setFoldersMap",m),a("setListDocs",d),a("setListSocket",p)]).then(()=>{t.listSocket.length&&s("onSocket")})},onSocket({rootState:e,state:t,dispatch:s,commit:a},i){let o=e.auth.access_token;t.listSocket.map(e=>{e.url&&!e.socketId&&(e.socketId=new WebSocket(f["socket_files"]+C["socket_files"]+e.url),e.socketId.onmessage=function(i){let o=JSON.parse(i.data),n=!1,r=t.listDocs.map(t=>{if(t.id==e.inworkId)switch(t.inwork&&o.tags&&o.tags["next.version.json"]&&1==o.tags["next.version.json"]&&Promise.all([s("getFolders"),s("getGroups")]).finally(e=>{s("createFoldersMap")}),t.status_file=o.sts,o.sts){case-1:t.inwork=!1,t.tags=o.tags||{},n=!0;break;case 0:t.inwork=!0,t.tags=o.tags||{};break;case 1:t.inwork=!1,t.tags=o.tags,n=!0;break;case 2:t.inwork=!0,t.tags=o.tags;break;case 3:t.inwork=!1,n=!0,t.tags=o.tags;break;default:t.inwork=!1,t.tags=o.tags||{},n=!0}return t});a("setListDocs",r),n&&(2==e.socketId.readyState&&3==e.socketId.readyState||e.socketId.close())},e.socketId.onopen=function(t){e.socketId.send(o)},e.socketId.onclose=function(t){s("socketClose",e.inworkId)})})},socketClose({state:e,commit:t},s){let a=e.listSocket.map(e=>(e.inworkId==s&&(e.socketId=""),e));t("setListSocket",a)},convertationTag({rootState:e,commit:t},s){let a=e.auth.access_token;const i=s.uuid,o=s.tag;let n=i+"/"+o,r=s.force?"?force=true":"",l=s.body||{};return new Promise(e=>{C.post(f["cloud"],C["getfile"]+n+r,l,{authorization:"Bearer "+a}).then(t=>{e(t)},t=>{e(t)})})},fixModel({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/attachment/file/"+a.id+"/fix";return new Promise(e=>{C.post(f["project"],C["projects"]+l,{},{authorization:"Bearer "+i}).then(t=>{e(t)},e=>"er")})},getClue({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;return new Promise((e,t)=>{C.post(f["project"],C["class_error"],a,{authorization:"Bearer "+i}).then(t=>{e(t)},e=>{t(null)})})},getAttributes({rootState:e,state:t,commit:s},a){let i=e.auth.access_token,o=a;return new Promise((e,t)=>{C.get(f["project"],C["attr_error"],o,{authorization:"Bearer "+i}).then(t=>{e(t)},e=>{t(null)})})},getParameters({rootState:e,state:t,commit:s},a){let i=e.auth.access_token,o=a;return new Promise((e,t)=>{C.get(f["project"],C["attr_error"],o,{authorization:"Bearer "+i}).then(t=>{e(t)},e=>{t(null)})})},getDelta({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/attachment/file/"+a.id+"/delta";return new Promise(e=>{C.post(f["project"],C["projects"]+l,{},{authorization:"Bearer "+i}).then(t=>{e(t)},e=>"er")})},createTree({state:e,commit:t},s){let a=s||e.folders,i=e.currentFolder,o=e.currentFolder;i=i.split("/").slice(1);let n=[];i.map(e=>{let t=n.join("")+"/"+e;n.push(t)});let r=1;const l=(e,t=!1)=>{let s=t||!1,a=[],i={result:a};return e.map(e=>{let t=e.split("/").slice(1,3),a=!!n.filter(t=>t==e).length;t.reduce((t,i,n,l)=>(t[i]||(t[i]={result:[]},t.result.push({title:i,data:{id:r++,path:e,group:!1,toGroup:s},isExpanded:a,isSelected:o==e,children:t[i].result})),t[i]),i)}),a};let c=e.groups.map(e=>{let t={title:e.group,data:{id:r++,path:"/"+e.group,group:!0,toGroup:e.group},isExpanded:!0,isSelected:o=="/"+e.group,children:l(e.folders,e.group)};return e.folders.map(e=>{a=a.filter(t=>t!=e)}),t}),m=l(a),d=[...c,...m],p=w.createMap(d);t("setFolderTree",d),t("setFoldersMap",p)},getDocs({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/";return new Promise(e=>{C.get(f["project"],C["projects"]+l+"attachment/files",{},{authorization:"Bearer "+i}).then(e=>{s("setDocs",e)},e=>"er")})},addDoc({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/attachment/file";return new Promise(e=>{C.post(f["project"],C["projects"]+l,a,{authorization:"Bearer "+i},"PUT").then(t=>{e(t)},t=>{e({...t,error:!0})}).catch(t=>{e({...t,error:!0})})})},updateDocInState({state:e,commit:t},s){let a=e.listDocs.map(e=>e.id==s.id?{...e,...s}:e),i=e.foldersMap.map(e=>(e.id==s.folder&&(e.files=e.files.map(e=>e.id==s.id?{...e,...s}:e)),e));t("setFoldersMap",i),t("setListDocs",a)},removeDoc({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/attachment/file/"+a.id;return new Promise(e=>{C.post(f["project"],C["projects"]+l,{},{authorization:"Bearer "+i},"DELETE").then(t=>{e(t)},e=>"er")})},addGroup({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/attachment/group";return new Promise(e=>{C.post(f["project"],C["projects"]+l,a,{authorization:"Bearer "+i},"PUT").then(t=>{e(t)},e=>"er")})},addFolder({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/attachment/folder";return new Promise(e=>{C.post(f["project"],C["projects"]+l,a,{authorization:"Bearer "+i},"PUT").then(t=>{t.notify=1,e(t)},t=>{t.notify=0,e(t)})})},removeGroup({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/attachment/group";return new Promise(e=>{C.post(f["project"],C["projects"]+l,a,{authorization:"Bearer "+i},"DELETE").then(t=>{e(t)},e=>"er")})},removeFolder({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/attachment/folder/"+a.uuid;return new Promise(e=>{C.post(f["project"],C["projects"]+l,{},{authorization:"Bearer "+i},"DELETE").then(t=>{e(t)},e=>"er")})},updateNode({state:e,commit:t},s){let a=s.nodes.map(e=>e.data.id==s.id?{...e,title:s.props.name}:e);t("updateGroup",a)},updateGroups({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/",c=a;return new Promise(e=>{C.post(f["project"],C["projects"]+l+"attachment/groups",c,{authorization:"Bearer "+i}).then(t=>{e(t)},e=>"er")})},updateFolders({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;const o=t.activeProject.id,n="c",r=e.administration.company.id;let l=n+"/"+r+"/"+o+"/";return new Promise(e=>{C.post(f["project"],C["projects"]+l+"attachment/folders",{pathes:a.paths},{authorization:"Bearer "+i}).then(t=>{let i=a.parent||!1;i&&s("setCurrentFolder",i),e(t.pathes)},e=>"er")})},setActiveProject({state:e,commit:t},s){let a=e.projects.filter(e=>e.id==s.id);a=a.length?Object.assign({},a[0]):null,t("setActiveProject",a)},setActiveGroup({state:e,commit:t},s){if(t("setActiveGroup",{id:s.id}),s.hasOwnProperty("value")){let a=[...e.groups];a=a.map(e=>e.id==s.id?{...e,active:s.value}:e),t("updateGroup",a)}},saveChange({commit:e},t){e("saveChange",t)},setCommentsHistory({state:e,commit:t}){new Promise(t=>{t(e.historyList)}).then(e=>(t("setComments",e),e)).then(e=>{let s=[];e.map(e=>{s=[...s,...e.annotation]}),t("setMarkerList",s)})},addComment({state:e,commit:t,dispatch:s},a){if("2d"==a.doc){let i=Object.assign({},a);i.id=(new Date).getTime(),i.annotation=[...e.markerStack],i.annotation=i.annotation.map(e=>({...e,comment:i.id}));let o=[...e.commentList];o=[...o,i],s("setMarkerList",i.annotation),t("addComment",o),t("clearMarkerStack"),t("setActiveComment",i.id)}if("3d"==a.doc){let s=Object.assign({},a);s.id=(new Date).getTime(),s.position={x:a.position.x,y:a.position.y,z:a.position.z};let i=[...e.commentList];i=[...i,s],t("addComment",i),t("setActiveComment",s.id)}},updateComment({state:e,commit:t},s){let a=e.commentList.map(e=>e.id==s.id?Object.assign({},e,{text:s.text}):e);t("updateComment",a)},removeComment({state:e,commit:t},s){let a=e.commentList.filter(e=>e.id!=s.id),i=[];if(a.map(e=>{i=[...i,...e.annotation]}),e.markerStack.length){let s=i.length?i[i.length-1].value:0,a=[...e.markerStack];a=a.map((e,t)=>({...e,value:s+t+1})),t("updateMarkerStack",a)}t("setMarkerList",i),t("updateComment",a)},saveCommentState({state:e,commit:t},s){let a={status:!0,markerStack:e.markerStack,commentActive:e.activeComment,commentInput:s.input};t("saveCommentState",a)},addReply({state:e,commit:t},s){let a=e.commentList.filter(e=>e.id==s.id)[0];s.reply.id=(new Date).getTime(),a.reply.push(s.reply);let i=e.commentList.map(e=>e.id==s.id?a:e);t("updateComment",i)},updateReply({state:e,commit:t},s){let a=e.commentList.filter(e=>e.id==s.comment_id)[0],i=a.reply;i=i.map(e=>e.id==s.id?Object.assign({},e,{text:s.text}):e),a.reply=i;let o=e.commentList.map(e=>e.id==s.comment_id?Object.assign({},e,{reply:i}):e);t("updateComment",o)},removeReply({state:e,commit:t},s){let a=e.commentList.filter(e=>e.id==s.comment_id)[0],i=a.reply;i=i.filter(e=>e.id!=s.id);let o=e.commentList.map(e=>e.id==s.comment_id?Object.assign({},e,{reply:i}):e);t("updateComment",o)},getTaskProject({rootState:e,commit:t},s){let a=e.auth.access_token;const{type_id:i,id:o,project_uuid:n,filter:r}=s;e.administration.user.id;C.get(f["tasks"],C["projects"]+i+"/"+o+"/"+n+"/tasks",r,{authorization:"Bearer "+a}).then(e=>{let s=e||[];t("setTaskList",s)}).catch(e=>{console.log("get tasks er",e)})},getTaskList({rootState:e,dispatch:t,commit:s},a){let i=e.auth.access_token;const{type_id:o,id:n,project_uuid:r,filter:l}=a;let c=e.administration.user.id,m=[];e.administration.groupPermissions.filter(e=>"1"==e.id||"2"==e.id).map(e=>{m=[...m,...e.users.map(e=>e.id)]});let d=o+"/"+n+(r?"/"+r:"")+"/tasks";C.get(f["tasks"],C["projects"]+d,l,{authorization:"Bearer "+i}).then(e=>{let a=e||[],i=[];a=a.filter(e=>m.some(e=>e==c)||e.user==c||e.owner==c),a.map(e=>{e.file&&"fff"!=e.file&&i.push(t("common/getFile",{id:e.file},{root:!0}))}),Promise.allSettled(i).then(e=>{a=a.map(t=>{let s=e.find(e=>e.value.id==t.file);return t.src=s&&s.value?s.value.file:"",t.task_id=parseInt(t.task_id),t}),s("setTaskList",a)}).catch(e=>{console.log("get tasks er, get screen er",e)})}).catch(e=>{console.log("get tasks er",e)})},updateTask({rootState:e,dispatch:t},s){let a=e.auth.access_token;const{type_id:i,id:o,project_uuid:n,body:r,docid:l,filter:c}=s;let m=s.task_id?"/"+s.task_id:"";C.post(f["tasks"],C["projects"]+i+"/"+o+"/"+n+"/task"+m,r,{authorization:"Bearer "+a,"content-type":!1}).then(e=>{t("getTaskList",{type_id:i,id:o,project_uuid:n,filter:c})}).catch(e=>{console.log("get tasks er",e)})},getWorkList({rootState:e,commit:t},s){let a=e.auth.access_token;const i=he.activeProject.id,o="c",n=e.administration.company.id;let r=o+"/"+n+"/"+i+"/attachment/file/"+s.file+"/task";return new Promise((e,t)=>{C.get(f["cloud"],C["projects"]+r,{},{authorization:"Bearer "+a}).then(t=>{e(t)}).catch(e=>{t(e)})})},setWorkList({rootState:e},t){let s=e.auth.access_token;const a=he.activeProject.id,i="c",o=e.administration.company.id;let n=i+"/"+o+"/"+a+"/attachment/file/"+t.file+"/task",r=t.body;return new Promise(e=>{C.post(f["cloud"],C["projects"]+n,r,{authorization:"Bearer "+s},"PUT").then(t=>{e(t)}).catch(t=>{console.log("set tasks er",t),e(t)})})},getWorkList_({rootState:e,commit:t},s){return new Promise((e,t)=>{C.post(f["api"],C["getjobs"],{unitbim_file_id:"2016e938998b-2135-439d-bc8a-8574aea89003"},{authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZXNzaW9uX2lkIjo1Njc5LCJpYXQiOjE2NTI3ODYzMjV9.iH1kovseBbTsYPFpYBwuw0mUZ-z-owph63KSx4eoIXU"}).then(t=>{e(t)}).catch(e=>{console.log("get job er",e),t(e)})})},setWorkList_({rootState:e},t){let s=t.body;return new Promise((e,t)=>{C.post(f["api"],C["setjob"],s,{authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZXNzaW9uX2lkIjo1Njc5LCJpYXQiOjE2NTI3ODYzMjV9.iH1kovseBbTsYPFpYBwuw0mUZ-z-owph63KSx4eoIXU"}).then(t=>{e(t)}).catch(e=>{console.log("set job er",e),t(e)})})},jsonToXlsx({rootState:e},t){let s=e.auth.access_token;return new Promise(e=>{C.post(f["cloud"],C["json_to_xlsx"],t,{authorization:"Bearer "+s},"POST",!1,!0).then(t=>{e({file:t})}).catch(e=>{console.log("json_to_xlsx er",e),reject({error:e})})})}};var be={namespaced:!0,state:he,actions:ve,mutations:fe};const ge={configLicense:{collisions:{code:23,type:"RouteUserInt"},size2000:{code:23,type:"RouteUserInt"},errorKSI:{code:23,type:"RouteUserInt"},size2000:{code:22,type:"RouteUserPro"},consolidation:{code:22,type:"RouteUserPro"},commentsPDF:{code:21,type:"RouteUserBase"},tasksPDF:{code:21,type:"RouteUserBase"},size2000:{code:21,type:"RouteUserBase"},editRVT:{code:21,type:"RouteUserBase"},size20:{code:20,type:"RouteUserStart"}},licenseList:[],currentLicense:null,userAvatar:{type:"default",src:"",avatar:""},companyLogo:{type:"default",src:"",avatar:""},existUser:!1,groupPermissions:[],folderPermissions:[],filesPermissions:[],user:{id:0,company:0,role:"0",type_id:"",country_id:null,region_id:null,city:"",address:"",post_code:"",profession:"",position:"",department:"",university:"",avatar:"",is_deleted:0,type:"",country:"",region:"",email:"",first_name:"",middle_name:"",last_name:"",gender:"",birth_day:0,status:0},company:{id:0,name:"",official_name:"",inn:"",kpp:"",ogrn:"",country_id:null,region_id:null,city:"",address:"",post_code:"",logo:"",is_deleted:0,owner:0,country:"",region:""},history_limit:3,invited:[]},ye={setConfig(e,t){e.configLicense=t},setLicense(e,t){e.licenseList=t},setCurrentLicense(e,t){e.currentLicense=t},setGroupPermissions(e,t){let s=JSON.parse(JSON.stringify(t));e.groupPermissions=s},setFolderPermissions(e,t){let s=JSON.parse(JSON.stringify(t));e.folderPermissions=s},setFilesPermissions(e,t){let s=JSON.parse(JSON.stringify(t));e.filesPermissions=s},existUser(e,t){e.existUser=t},setUser(e,t){let s=JSON.parse(JSON.stringify(t));e.user={...e.user,...s}},setCompany(e,t){let s=JSON.parse(JSON.stringify(t));e.company={...e.company,...s}},setAvatar(e,t){e[t.name].type=t.type,e[t.name].src=t.value,e[t.name].avatar=t.avatar},invited(e,t){e.invited=t},setHistoryLimit(e,t){e.history_limit=t}},_e={getGroupPermissions({rootState:e,state:t,dispatch:s,commit:a},i=null){let o=e.auth.access_token;return s("getConfig"),s("getLicense"),new Promise(e=>{C.get(f["account"],C["permission"]+"/company/groups",{},{authorization:"Bearer "+o}).then(s=>{s=s||[],s=s.map(e=>{let s=e.users?e.users:[];return i?s.some(e=>e.id+""==i.id+"")&&a("setUser",{role:e.id,permission:B(e)}):s.some(e=>e.id+""==t.user.id+"")&&a("setUser",{role:e.id,permission:B(e)}),{...e,users:s}}),a("setGroupPermissions",s),e(s)},t=>{console.log("er",t),e(!1)})})},getFoldersPermissions({rootState:e,commit:t},s=null){let a=e.auth.access_token;return new Promise(e=>{C.get(f["account"],C["permission"]+"/company/folders",{},{authorization:"Bearer "+a}).then(s=>{t("setFolderPermissions",s),e(s)},t=>{console.log("er",t),e(!1)})})},getFilesPermissions({rootState:e,commit:t},s=null){let a=e.auth.access_token;return new Promise(e=>{C.get(f["account"],C["permission"]+"/company/files",{},{authorization:"Bearer "+a}).then(s=>{t("setFilesPermissions",s),e(s)},t=>{console.log("er",t),e(!1)})})},setUserPermissions({rootState:e,commit:t},s){let a=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["permission"]+"/company/group/"+s.id+"/user",s.body,{authorization:"Bearer "+a}).then(t=>{e(t)},t=>{console.log("er",t),e(!1)})})},setGroupPermissions({rootState:e,commit:t},s){let a=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["permission"]+"/company/group/"+s.id+"/permissions",s.body,{authorization:"Bearer "+a}).then(t=>{e(t)},t=>{console.log("er",t),e(!1)})})},setFolderPermissions({rootState:e,commit:t},s){let a=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["permission"]+"/company/folder/"+s.id,s.body,{authorization:"Bearer "+a},"PUT").then(t=>{e(t)},t=>{console.log("er",t),e(!1)})})},setFilesPermissions({rootState:e,commit:t},s){let a=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["permission"]+"/company/file/"+s.id,s.body,{authorization:"Bearer "+a},"PUT").then(t=>{e(t)},t=>{console.log("er",t),e(!1)})})},getHistoryLimit({rootState:e,commit:t}){let s=e.auth.access_token;return new Promise(e=>{C.get(f["project"],C["history_limit"],{},{authorization:"Bearer "+s}).then(s=>{t("setHistoryLimit",s.history_limit),e(s.history_limit)})})},setHistoryLimit({rootState:e,commit:t},s){let a=e.auth.access_token;return new Promise(e=>{C.post(f["project"],C["history_limit"],{history_limit:s},{authorization:"Bearer "+a},"PUT").then(s=>{t("setHistoryLimit",s.history_limit),e(s.history_limit)})})},defaultAvatar({commit:e},t){let s=t.str?t.str.charAt(0):"U",a=150,i=90,o=k(s,a,i),n=k(s);e("setAvatar",{name:t.name,type:"default",value:o,avatar:n})},addUser({rootState:e,commit:t,dispatch:s}){let a=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["account_user"],{},{authorization:"Bearer "+a},"PUT").then(e=>(t("setUser",e),s("defaultAvatar",{name:"userAvatar",str:e.first_name}),s("getGroupPermissions",null))).then(e=>s("setCompany",e)).then(t=>{e(t)})})},getUser({rootState:e,commit:t,dispatch:s,state:a}){let i=e.auth.access_token;return new Promise(e=>{C.get(f["account"],C["account_user"],{},{authorization:"Bearer "+i}).then(i=>{i.id=i.id+"",a.groupPermissions.map(e=>{let t=e.users?e.users:[];i.id&&t.some(e=>e.id==i.id)&&(i.role=e.id)}),t("setUser",i);let o=i.avatar||!1;o&&-1==o.indexOf("data")&&-1==o.indexOf("blob")?s("common/getFile",{id:o},{root:!0}).then(e=>{t("setAvatar",{name:"userAvatar",type:"file",value:e.file,avatar:e.file})},e=>{console.log(e)}):s("defaultAvatar",{name:"userAvatar",str:i.first_name}),s("getCompany").then(t=>{e(t)})},t=>{console.log("er",t),404==t.status&&s("addUser").then(t=>{e(t)})})})},setCompany({rootState:e,commit:t,dispatch:s},a){let i=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["account_company"],{},{authorization:"Bearer "+i},"PUT").then(a=>{t("setCompany",a),s("defaultAvatar",{name:"companyLogo",str:""}),t("existUser",!0),e(a)})})},getCompany({rootState:e,state:t,commit:s,dispatch:a}){let i=e.auth.access_token;return new Promise(e=>{C.get(f["account"],C["account_company"],{with_users:!0},{authorization:"Bearer "+i}).then(e=>{let t=e.logo||!1;return t&&-1==t.indexOf("data")&&-1==t.indexOf("blob")?a("common/getFile",{id:t},{root:!0}).then(e=>{s("setAvatar",{name:"companyLogo",type:"file",value:e.file,avatar:e.file})}).catch(t=>{a("defaultAvatar",{name:"companyLogo",str:e.name})}):a("defaultAvatar",{name:"companyLogo",str:e.name}),s("setCompany",e),e}).then(e=>{let t=[];return e.users.map(e=>{e.avatar&&-1==e.avatar.indexOf("data")&&-1==e.avatar.indexOf("blob")&&t.push(a("common/getFile",{id:e.avatar},{root:!0}))}),Promise.all(t)}).then(e=>{let s=JSON.parse(JSON.stringify(t.company));return s.users=s.users.map(t=>{if(t.avatar&&-1==t.avatar.indexOf("data")&&-1==t.avatar.indexOf("blob")){let s=e.filter(e=>e.id==t.avatar)[0];return{...t,avatarSrc:s.file,id:t.id+""}}{let e=t.first_name||t.email;return{...t,id:t.id+"",avatarSrc:k(e),avatarFull:k(e,150,90)}}}),s}).then(t=>{s("setCompany",t),s("existUser",!0),e(t)})})},updateCompany({rootState:e,state:t,commit:s,dispatch:a},i){let o=e.auth.access_token,n=(Object.keys(i),{...t.company,...i});return new Promise(e=>{C.post(f["account"],C["account_company"],n,{authorization:"Bearer "+o},"PUT").then(t=>{s("setCompany",t);let i=t.logo||!1,o={status:"success",text:"Данные успешно обновлены."};i&&-1==i.indexOf("data")&&-1==i.indexOf("blob")?a("common/getFile",{id:i},{root:!0}).then(t=>{s("setAvatar",{name:"companyLogo",type:"file",value:t.file,avatar:t.file}),e(o)}):(a("defaultAvatar",{name:"companyLogo",str:t.name}),e(o))},t=>{let s={status:"error",text:t.message};e(s)})})},updateUser({rootState:e,state:t,commit:s,dispatch:a},i){let o=e.auth.access_token,n={...t.user,...i};return new Promise(e=>{C.post(f["account"],C["account_user"],n,{authorization:"Bearer "+o},"PUT").then(t=>{s("setUser",t);let i=t.avatar||!1,o={status:"success",text:"Данные успешно обновлены."};i&&-1==i.indexOf("data")&&-1==i.indexOf("blob")?a("common/getFile",{id:i},{root:!0}).then(t=>{s("setAvatar",{name:"userAvatar",type:"file",value:t.file,avatar:t.file}),e(o)}):(a("defaultAvatar",{name:"userAvatar",str:t.first_name}),e(o))},t=>{let s={status:"error",text:t.message};e(s)})})},updateEmployee({rootState:e,state:t,commit:s,dispatch:a},i){let o=e.auth.access_token,n=i;return new Promise(e=>{C.post(f["account"],C["account_user"],n,{authorization:"Bearer "+o},"PUT").then(t=>{s("setUser",t);let i=t.avatar||!1,o={status:"success",text:"Данные успешно обновлены."};i&&-1==i.indexOf("data")&&-1==i.indexOf("blob")?a("common/getFile",{id:i},{root:!0}).then(t=>{s("setAvatar",{name:"userAvatar",type:"file",value:t.file,avatar:t.file}),e(o)}):(a("defaultAvatar",{name:"userAvatar",str:t.first_name}),e(o))},t=>{let s={status:"error",text:t.message};e(s)})})},inviteUser({rootState:e},t){let s=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["invite"],t,{authorization:"Bearer "+s},"POST").then(t=>{e(t)},t=>{let s={status:"error",text:t.message};e(s)})})},noregistredRemove({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["invite"]+"?email="+a,{},{authorization:"Bearer "+i},"DELETE").then(t=>{e(t)},t=>{let s={status:"error",text:t.message};e(s)})})},invitedRemove({rootState:e,state:t,commit:s},a){let i=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["invited_user"]+"/"+a,{},{authorization:"Bearer "+i},"DELETE").then(t=>{e(t)},t=>{let s={status:"error",text:t.message};e(s)})})},invitedList({rootState:e,commit:t}){let s=e.auth.access_token;return new Promise(e=>{C.get(f["account"],C["invited"],{},{authorization:"Bearer "+s}).then(e=>{t("invited",e)})})},newpass({state:e,commit:t},s){let a=e.user.id;return new Promise(e=>{C.post(f["login"],C["password"],{old_password:s.old_password,new_password:s.new_password,user_id:a},{},"PUT").then(()=>{e({status:"success",text:"Вы успешно сменили пароль."})},t=>{let s={status:"error",text:t.data.error};e(s)})})},getConfig({rootState:e,commit:t}){return new Promise(e=>{C.get("","/config/config.json",{},{}).then(e=>{t("setConfig",e.configLicense)})})},getLicense({rootState:e,commit:t}){let s=e.auth.access_token;return new Promise(e=>{C.get(f["account"],C["license"]+"/order",{},{authorization:"Bearer "+s}).then(e=>{t("setCurrentLicense",e)}).catch(e=>{t("setCurrentLicense",null)})})},setLicense({rootState:e,commit:t},s){let a=e.auth.access_token;return new Promise(e=>{C.post(f["account"],C["license"]+"/order",s,{authorization:"Bearer "+a}).then(e=>{})})}};var Ce={namespaced:!0,state:ge,actions:_e,mutations:ye};const we={title:"",dct_name:"",dct_status:""},ke={setTitle(e,t){e.title=t},setDctView(e,t){e.dct_name=t.name,e.dct_status=t.status}},xe={};var Se={namespaced:!0,state:we,actions:xe,mutations:ke};a["default"].use(h["a"]);var Ae=new h["a"].Store({modules:{common:M,auth:D,comments:ue,workflow:be,administration:Ce,toolbar:Se}}),Ie=function(){var e=this,t=e._self._c;return t("div",{staticClass:"m-back",style:e.style},[t("div",{staticClass:"vm-progress"},[t("div",{staticClass:"loader"},[t("svg",{staticClass:"circular",attrs:{viewBox:"25 25 50 50"}},[t("circle",{staticClass:"path",attrs:{cx:"50",cy:"50",r:"20",fill:"none","stroke-width":"2","stroke-miterlimit":"10"}})])])])])},Oe=[],je={name:"Init",data:()=>({width:0,height:0}),computed:{style(){return{width:this.width+"px",height:this.height+"px"}}},methods:{getSize(){this.width=window.innerWidth,this.height=window.innerHeight}},mounted(){this.getSize()}},Fe=je,Pe=Object(m["a"])(Fe,Ie,Oe,!1,null,null,null),Ee=(Pe.exports,s("a722")),Ue=function(){var e=this,t=e._self._c;return t(Ee["a"],{attrs:{app:""}},[t("app-bar",{attrs:{part:e.part}}),t("sidebar",{attrs:{part:e.part}}),t("core-view")],1)},Be=[],Te={main:{title:s("6e0e"),title_type:"img",parentLink:"",drawer:!0,type:"nav",list:[{name:"main-page",title:"Главная страница",link:"/main",access_list:[]},{name:"workflow",title:"Документооборот",link:"/workflow",access_list:[]},{name:"",title:"Администрирование",link:"/administration",access_list:[]}]},engineering:{title:"Проектирование",title_type:"text",parentLink:"/main",drawer:!0,type:"nav",list:[{name:"moduls",title:"Модули",link:"/engineering/moduls",access_list:[]},{name:"teamwork",title:"Совместная работа",link:"/engineering/teamwork",access_list:[]},{name:"callback",title:"Обратная связь",link:"/engineering/callback",access_list:[]},{name:"reference",title:"Справка",link:"/engineering/reference",access_list:[]}]},workflow:{title:"Документооборот",title_type:"text",parentLink:"/main",drawer:!0,type:"nav",list:[{name:"projects",title:"Проекты",link:"/workflow/projects",access_list:[]},{name:"managetasks",title:"Управление задачами",link:"/workflow/managetasks",access_list:[]},{name:"deleted",title:"Удаленные файлы",link:"/workflow/deleted",access_list:[]},{name:"reference",title:"Справка",link:"/workflow/reference",access_list:[],icon:"trd-external-link"}]},cloud:{title:"Облако",title_type:"text",parentLink:"/main",drawer:!0,type:"nav",list:[{name:"projects",title:"Проекты",link:"/cloud/projects",access_list:[]},{name:"common-access",title:"Общий доступ",link:"/cloud/common_access",access_list:[]},{name:"basket",title:"Корзина",link:"/cloud/basket",access_list:[]}]},"project-item":{clone:"cloud",parentLink:"/cloud/projects"},"workflow-project":{title:"Logo_text.svg",title_type:"img",parentLink:"/workflow",drawer:!0,type:"folders",list:[{name:"workflow",title:"Документооборот",link:"/workflow",access_list:[]}]},"workflow-view":{title:"",title_type:"template",parentLink:"/workflow/{id}/list",drawer:!1,type:"none",list:[{name:"workflow",title:"",link:"/workflow",access_list:[]}]},"model-view":{title:"Logo_text.svg",title_type:"img",parentLink:"/main",drawer:!1,type:"none",list:[]},administration:{title:"Администрирование",title_type:"text",parentLink:"/main",drawer:!0,type:"nav",list:[{name:"statistics",title:"Статистика",link:"/administration/statistics",access_list:["1","2"]},{name:"account",title:"Учетная запись",link:"/administration/account",access_list:[]},{name:"payment",title:"Оплата",link:"/administration/payment",access_list:["1","2"]},{name:"settings",title:"Настройки",link:"/administration/settings",access_list:["1","2"]}]}},Le=s("40dc"),Ne=s("2a7f"),He=function(){var e=this,t=e._self._c;return t(Le["a"],{staticClass:"m-toolbar",attrs:{color:e.bg_color,"clipped-left":"","clipped-right":"",app:"",flat:!0}},[t("promise"),t("logobar",{attrs:{part:e.part}}),t(Ne["a"],{staticClass:"pl-4"},e._l(e.title,(function(s,a){return t("span",[t("router-link",{class:["m-title-link",{"m-title-link--disabled":e.title.length==a+1}],attrs:{to:s.path}},[e._v(e._s(s.title))]),e._v("\n            "+e._s(e.title.length!=a+1?"/":"")+"\n        ")],1)})),0),t("div",{staticClass:"flex-grow-1"}),t("Profile"),t("Menu")],1)},Me=[],ze=s("adda"),$e=s("da13"),Re=s("5d23"),De=function(){var e=this,t=e._self._c;return t($e["a"],{staticClass:"m-logo"},[t(Re["a"],{staticClass:"m-overflow-visible"},[t(Re["c"],{staticClass:"m-title"},[t("div",[t("div",{staticClass:"m-inline m-cell-1"},[t("router-link",{directives:[{name:"show",rawName:"v-show",value:""!==e.part.parentLink,expression:"part.parentLink !== ''"}],style:{color:"transparent"},attrs:{to:{path:e.parentLink()}}},[t(o["a"],{attrs:{size:"25",color:"#6e6e6e"}},[e._v("keyboard_arrow_left")])],1)],1),t("div",{staticClass:"m-inline mr-3"},[t(ze["a"],{attrs:{width:"35",src:e.logo}})],1),t("div",{staticClass:"m-inline"},[t(ze["a"],{directives:[{name:"show",rawName:"v-show",value:"img"==e.part.title_type,expression:"part.title_type == 'img'"}],staticClass:"m-inline-b",attrs:{src:e.logo_text}}),t("span",{directives:[{name:"show",rawName:"v-show",value:"text"==e.part.title_type,expression:"part.title_type == 'text'"}]},[t("span",{staticClass:"title-page"},[e._v(e._s(e.part.title))])])],1),"template"==e.part.title_type?t("div",{staticClass:"m-inline"},[t("div",{staticClass:"m-dct-name"},[e._v(e._s(e.dct_props.name))]),t("div",{staticClass:"m-dct-status"},[e._v(e._s(e.dct_props.status))])]):e._e()])]),t(Re["b"])],1)],1)},Je=[],Ve={name:"Logobar",props:["part"],data(){return{backLink:null,title:"",logo:s("4d2a"),logo_text:s("6e0e"),dct_view:!1}},computed:Object(h["b"])({dct_props:function(e){return{name:e.toolbar.dct_name,status:e.toolbar.dct_status}}}),methods:{logoImg(){let e=this.part.title;return e},parentLink(){let e=this.part.parentLink,t=/[^{}]+(?=})/g,s=e.match(t);if(null!=s)for(let a=0,i=s.length,o="";a<i;a++)o="{"+s[a]+"}",e=e.replace(o,this.$route.params[s[a]]);return e}}},Ke=Ve,Ge=Object(m["a"])(Ke,De,Je,!1,null,null,null),Qe=Ge.exports,Xe=s("8336"),We=s("b0af"),Ye=s("8860"),qe=s("e449"),Ze=function(){var e=this,t=e._self._c;return t(qe["a"],{attrs:{bottom:"",left:"","offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({attrs:s,on:a}){return[t(Xe["a"],e._g(e._b({attrs:{text:"",icon:"",color:"#7f7f7f"}},"v-btn",s,!1),a),[t(o["a"],{attrs:{size:"30"}},[e._v("menu")])],1)]}}])},[t(We["a"],[t(Ye["a"],{attrs:{dense:""}},e._l(e.notes,(function(s,a){return t($e["a"],{key:a,staticClass:"m-custom--list__item--width220",attrs:{href:s.link,target:"_blank"},on:{click:e.onClick}},[t(Re["c"],{domProps:{textContent:e._s(s.title)}})],1)})),1)],1)],1)},et=[],tt={data:()=>({notes:[{title:"UnitBIM",link:"https://ubapp.ru/"},{title:"Разработчикам",link:"https://ubapp.ru/develop/"},{title:"Справочник",link:"https://doc.unitbim.ru/"},{title:"Политика",link:"https://policy.unitbim.ru/politika-obrabotki-dannykh"},{title:"Контакты",link:"https://ubapp.ru/contacts/"}]}),methods:{onClick(){}}},st=tt,at=Object(m["a"])(st,Ze,et,!1,null,null,null),it=at.exports,ot=s("8212"),nt=s("ce7e"),rt=s("8270"),lt=function(){var e=this,t=e._self._c;return t(qe["a"],{attrs:{bottom:"",left:"","offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({attrs:s,on:a}){return[t(Xe["a"],e._g(e._b({staticClass:"toolbar-items",attrs:{icon:""}},"v-btn",s,!1),a),[t(ot["a"],{attrs:{size:"30"}},[t("img",{staticClass:"m-card--avatar-wrap_img",attrs:{src:e.avatar.avatar,alt:"avatar"}})])],1)]}}])},[t(We["a"],[t($e["a"],{staticClass:"grow"},[t(rt["a"],{attrs:{size:"30"}},[t(ze["a"],{staticClass:"m-card--avatar-wrap_img",attrs:{src:e.avatar.avatar}})],1),t(Re["a"],[t(Re["c"],{staticClass:"m-text--size14 py-1"},[e._v("\n                    "+e._s(e.user.first_name+" "+e.user.last_name)+"\n                ")]),t(Re["b"],{staticClass:"m-text--size12"},[e._v("\n                    "+e._s(e.user.email)+"\n                ")])],1)],1),t(nt["a"]),t(Ye["a"],{attrs:{dense:""}},e._l(e.createMenu(),(function(s,a){return t($e["a"],{key:a,on:{click:function(t){return t.preventDefault(),e.onClick(s.link)}}},[t(Re["c"],{domProps:{textContent:e._s(s.title)}})],1)})),1)],1)],1)},ct=[],mt={data:()=>({notes:[{title:"Профиль",link:"/administration/account",access:[]},{title:"Настройки",link:"/administration/settings",access:["1","2"]},{title:"Выход",link:"logout",access:[]}]}),computed:{avatar(){return this.$store.state.administration.userAvatar},user(){return this.$store.state.administration.user}},methods:{createMenu(){let e=this.notes.filter(e=>!e.access.length||e.access.some(e=>e==this.user.role));return e},onClick(e){if("logout"==e)this.$store.dispatch("auth/logout");else{if(this.$route.path==e)return;this.$router.push(e)}}}},dt=mt,pt=Object(m["a"])(dt,lt,ct,!1,null,null,null),ut=pt.exports,ht=s("1800"),ft=function(){var e=this,t=e._self._c;return t(qe["a"],{attrs:{"min-width":"100%","offset-y":"",value:e.note.length,transition:"slide-y-transition","close-on-click":!1,"close-on-content-click":!1,attach:"#ddd",auto:""},scopedSlots:e._u([{key:"activator",fn:function({attrs:s}){return[t("div",e._b({staticClass:"m-promise-event",attrs:{role:"list",id:"ddd"}},"div",s,!1))]}}])},[t(We["a"],e._l(e.note,(function(s,a){return t($e["a"],{key:a+"file"},[t(rt["a"],{attrs:{size:"25"}},[t(ze["a"],{attrs:{src:e.promise[s.action].src}})],1),t(Re["a"],{staticClass:"m-text--size12"},[e._v("\n                "+e._s(e.promise[s.action].text+s.name)+"\n            ")]),t(ht["a"],[t(Xe["a"],{attrs:{icon:"",width:24,height:24},on:{click:function(t){return e.abortFetch({uuid:s.uuid})}}},[t(o["a"],{attrs:{size:18}},[e._v("\n                      mdi-close\n                    ")])],1)],1)],1)})),1)],1)},vt=[],bt={name:"Promise",data(){return{promise:{upload:{src:s("4dc2"),text:"Загрузка файла "},download:{src:s("4e83"),text:"Скачивание файла "},createxml:{src:s("4dc2"),text:"Генерация xml "}}}},computed:{note(){let e=this.$store.state.common.uploadFileNames;return e}},methods:{abortFetch({uuid:e,action:t}){this.$store.dispatch("common/abortFetch",{uuid:e})}}},gt=bt,yt=Object(m["a"])(gt,ft,vt,!1,null,null,null),_t=yt.exports,Ct={name:"AppBar",props:["part"],components:{Logobar:Qe,Promise:_t,Menu:it,Profile:ut},data(){return{bg_color:"#fbfbfb",bg_color_list:{normal:"#fbfbfb",white:"#fff"},logo:s("4d2a"),logo_text:s("6e0e"),titlePage:"",backLink:null}},watch:{$route(e,t){this.setBG()}},computed:Object(h["b"])({title(e){return e.toolbar.title}}),created(){this.setBG()},methods:{setBG(){"workflow-view"==this.$route.name?this.bg_color=this.bg_color_list.white:this.bg_color=this.bg_color_list.normal}}},wt=Ct,kt=Object(m["a"])(wt,He,Me,!1,null,null,null),xt=kt.exports,St=s("f774"),At=function(){var e=this,t=e._self._c;return t(St["a"],{staticClass:"m-navigator",attrs:{value:e.part.drawer,stateless:"","disable-resize-watcher":"",clipped:"",width:"225",app:"",floating:""}},["nav"==e.part.type?t(Ye["a"],{attrs:{dense:""}},e._l(e.part.list,(function(s,a){return t($e["a"],{key:a,attrs:{to:s.link}},[t(Re["a"],[t(Re["c"],[e._v(e._s(s.title))])],1),t(ht["a"],[t(o["a"],{attrs:{size:"14"}},[e._v(e._s(s.icon))])],1)],1)})),1):e._e(),"folders"==e.part.type?t("sidebar-folders"):e._e()],1)},It=[],Ot=s("553a"),jt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pt-3"},[t("sl-vue-tree",{ref:"tree",attrs:{"allow-multiselect":!0},on:{select:e.nodeSelected,toggle:e.expand,drop:e.dropNode,beforedrop:e.beforeDrop,nodeclick:e.getDocs},scopedSlots:e._u([{key:"title",fn:function({node:s}){return[e._l(s.level-1,(function(a){return s.level>1?t("span",{staticClass:"level-gap"}):e._e()})),s.data.group?e._e():t("span",{staticClass:"leaf-icon pl-1",class:["level-"+s.level]},[t(o["a"],{attrs:{size:"18"}},[e._v("icon-folder")])],1),t("span",{staticClass:"sl-vue-tree-title--name",class:[{"sl-group":s.data.group},"level-"+s.level],on:{click:function(t){return e.expandGroup(s)}}},[e._v("\n                "+e._s(s.title)+"\n            ")])]}},{key:"toggle",fn:function({node:s}){return[s.data.group||3!=s.level&&s.children.length?t("span",{class:[{expanded:s.isExpanded},"level-"+s.level]},[t(o["a"],{attrs:{size:"18"}},[e._v("mdi-chevron-down")])],1):e._e(),2!=s.level||s.children.length?e._e():t("span")]}},{key:"sidebar",fn:function({node:s}){return s.data.access?[t("edit-menu",{attrs:{node:s,editNode:e.editNode,creatingBranchId:e.creatingBranchId,isFile:e.isFile},on:{"update:editNode":function(t){e.editNode=t},"update:edit-node":function(t){e.editNode=t},"update:creatingBranchId":function(t){e.creatingBranchId=t},"update:creating-branch-id":function(t){e.creatingBranchId=t},"update:isFile":function(t){e.isFile=t},"update:is-file":function(t){e.isFile=t},newFolderAction:e.newFolderAction,editFolderAction:e.editFolderAction,removeFolderAction:e.removeFolderAction,accessFolderAction:e.accessFolderAction}})]:void 0}}],null,!0),model:{value:e.folderslist,callback:function(t){e.folderslist=t},expression:"folderslist"}},[t("template",{slot:"draginfo"},[t(o["a"],{attrs:{size:"18"}},[e._v(e._s(e.nodeSelectedEl.icon))]),t("span",[e._v("\n\n                "+e._s(e.nodeSelectedEl.title)+"\n            ")])],1)],2),t(Ot["a"],{staticClass:"m-nav-footer pa-0 pr-2",attrs:{fixed:""}},[t("create-menu",{attrs:{node:0,editNode:e.editNode,creatingBranchId:e.creatingBranchId,isFile:e.isFile,newGroup:e.newGroup,newFolder:e.newFolder},on:{"update:editNode":function(t){e.editNode=t},"update:edit-node":function(t){e.editNode=t},"update:creatingBranchId":function(t){e.creatingBranchId=t},"update:creating-branch-id":function(t){e.creatingBranchId=t},"update:isFile":function(t){e.isFile=t},"update:is-file":function(t){e.isFile=t},"update:newGroup":function(t){e.newGroup=t},"update:new-group":function(t){e.newGroup=t},"update:newFolder":function(t){e.newFolder=t},"update:new-folder":function(t){e.newFolder=t}}})],1),t("create-group",{attrs:{newGroup:e.newGroup},on:{"update:newGroup":function(t){e.newGroup=t},"update:new-group":function(t){e.newGroup=t},createGroup:e.createGroup}}),t("create-folder",{attrs:{newFolder:e.newFolder},on:{"update:newFolder":function(t){e.newFolder=t},"update:new-folder":function(t){e.newFolder=t},createFolder:e.createFolder}}),t("edit-folder",{attrs:{editFolder:e.editFolder,node:e.editNode},on:{"update:editFolder":function(t){e.editFolder=t},"update:edit-folder":function(t){e.editFolder=t},renameNode:e.renameNode}}),t("remove-folder",{attrs:{removeFolderFlag:e.removeFolderFlag,node:e.editNode},on:{"update:removeFolderFlag":function(t){e.removeFolderFlag=t},"update:remove-folder-flag":function(t){e.removeFolderFlag=t},removeNode:e.removeNode}}),t("access-rights",{attrs:{accessrights:e.accessrights,item:e.editNode},on:{"update:accessrights":function(t){e.accessrights=t}}})],1)},Ft=[],Pt=s("c536"),Et=s.n(Pt),Ut=s("ec26"),Bt=function(){var e=this,t=e._self._c;return t(qe["a"],{attrs:{top:"",right:"","offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t("div",e._g({staticClass:"flex m-create-menu"},s),[t(o["a"],[e._v("\n                mdi-plus\n            ")]),t("span",[e._v("Создать")])],1)]}}])},[t(We["a"],[t(Ye["a"],{attrs:{dense:""}},e._l(e.notes,(function(s,a){return t($e["a"],{key:a,on:{click:function(t){return e.create(s.value)}}},[t(Re["c"],{staticClass:"m-menu-title",domProps:{textContent:e._s(s.title)}})],1)})),1)],1)],1)},Tt=[],Lt={props:["node"],data:()=>({notes:[{title:"Группу",value:"group"},{title:"Папку",value:"folder"}]}),methods:{create(e){let t={parent:0,file:!1,group:!1,lvl:1};this.$emit("update:editNode",0),"group"==e?(t.group=!0,this.$emit("update:newGroup",!0)):(t.group=!1,this.$emit("update:newFolder",!0)),this.$emit("update:isFile",t)}}},Nt=Lt,Ht=Object(m["a"])(Nt,Bt,Tt,!1,null,null,null),Mt=Ht.exports,zt=s("99d9"),$t=s("169a"),Rt=s("2fa4"),Dt=s("8654"),Jt=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.newGroup,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v("Новая группа\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5",staticStyle:{"background-color":"#fbfbfb","min-height":"120px"}},[t(Dt["a"],{attrs:{label:"Название группы",autocomplete:"off"},model:{value:e.group_name,callback:function(t){e.group_name=t},expression:"group_name"}})],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:e.checkChange()},on:{click:e.createGroup}},[e._v("Создать")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},Vt=[],Kt={props:["newGroup"],name:"CreateGroup",data(){return{group_name:""}},watch:{newGroup(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{checkChange(){return!this.group_name},cancel(){this.group_name="",this.$emit("update:newGroup",!1)},createGroup(){this.$emit("createGroup",{name:this.group_name}),this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.createGroup())}}},Gt=Kt,Qt=Object(m["a"])(Gt,Jt,Vt,!1,null,null,null),Xt=Qt.exports,Wt=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.newFolder,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v("Новая папка\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5",staticStyle:{"background-color":"#fbfbfb","min-height":"120px"}},[t(Dt["a"],{attrs:{label:"Название папки",autocomplete:"off"},model:{value:e.folder_name,callback:function(t){e.folder_name=t},expression:"folder_name"}})],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:e.checkChange()},on:{click:e.createFolder}},[e._v("Создать")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},Yt=[],qt={props:["newFolder"],name:"CreateFolder",data(){return{folder_name:""}},watch:{newFolder(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{checkChange(){return!this.folder_name},cancel(){this.folder_name="",this.$emit("update:newFolder",!1)},createFolder(){this.$emit("createFolder",{name:this.folder_name}),this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.createFolder())}}},Zt=qt,es=Object(m["a"])(Zt,Wt,Yt,!1,null,null,null),ts=es.exports,ss=function(){var e=this,t=e._self._c;return t(qe["a"],{attrs:{top:"",right:"","offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(o["a"],e._g({staticClass:"m-folder-btn",attrs:{text:"",icon:"",size:"20"},on:{mousedown:function(e){e.stopPropagation()}}},s),[e._v("\n            mdi-dots-horizontal\n        ")])]}}])},[t(We["a"],[t(Ye["a"],{attrs:{dense:""}},e._l(e.createMenu(),(function(s,a){return t($e["a"],{key:a,on:{click:function(t){return e.action(s)}}},[t(Re["c"],{staticClass:"m-menu-title",domProps:{textContent:e._s(s.title)}})],1)})),1)],1)],1)},as=[],is={props:["node","editNode"],data:()=>({notes:[{title:"Переименовать",value:"rename",action:"editFolderAction",access:1},{title:"Удалить",value:"remove",action:"removeFolderAction",access:1},{title:"Создать папку",value:"folder",action:"newFolderAction",access:0},{title:"Права доступа",value:"access",action:"accessFolderAction",access:1}]}),methods:{action(e){this.$emit("update:editNode",this.node),this.$emit(e.action,!0)},getAccess(e){return this.node.data.access>>e&1},createMenu(){return this.notes.filter(e=>this.getAccess(e.access)&&("access"!=e.value||!this.node.data.group))}}},os=is,ns=Object(m["a"])(os,ss,as,!1,null,null,null),rs=ns.exports,ls=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.editFolder,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v("Новая имя папки\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5",staticStyle:{"background-color":"#fbfbfb","min-height":"120px"}},[t(Dt["a"],{attrs:{label:"Название папки",value:e.node.title,autocomplete:"off"},on:{input:e.editName}})],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:e.checkChange()},on:{click:e.updateNode}},[e._v("Переименовать")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},cs=[],ms={props:["editFolder","node"],name:"EditFolder",data(){return{folder_name:""}},watch:{editFolder(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{checkChange(){if(!this.node)return;let e=!this.folder_name||this.folder_name==this.node.title,t=[];if(this.getType())t=this.$store.state.workflow.foldersMap.filter(e=>!!e.group);else{let e=this.node.data.parent;t=this.$store.state.workflow.foldersMap.filter(t=>t.parent==e&&!t.group)}return t.map(t=>{t.name==this.folder_name&&(e=!0)}),e},cancel(){this.folder_name="",this.$emit("update:editFolder",!1)},editName(e){this.folder_name=e},getType(){return this.node&&!!this.node.data.group},updateNode(){this.$emit("renameNode",this.folder_name),this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.updateNode())}}},ds=ms,ps=Object(m["a"])(ds,ls,cs,!1,null,null,null),us=ps.exports,hs=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.removeFolderFlag,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v("Удалить "+e._s((e.node.isLeaf,"папку"))+" "+e._s(e.node.title)+"?\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(zt["a"],{staticClass:"pa-5"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.removeNode}},[e._v("Удалить")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},fs=[],vs={props:["removeFolderFlag","node"],name:"RemoveFolder",watch:{removeFolderFlag(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{cancel(){this.$emit("update:removeFolderFlag",!1)},removeNode(){this.$emit("removeNode"),this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.removeNode())}}},bs=vs,gs=Object(m["a"])(bs,hs,fs,!1,null,null,null),ys=gs.exports,_s=s("c6a6"),Cs=s("cc20"),ws=s("62ad"),ks=s("8fea"),xs=s("0fd9"),Ss=s("b73d"),As=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.accessrights,scrollable:"","max-width":"914px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("Права доступа: "+e._s(e.workItem.name)+"\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 px-4"},[t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"12",md:"12"}},[t(_s["a"],{ref:"managers",attrs:{label:"Добавить пользователя",placeholder:" ",items:e.managers,disabled:!e.managers.length,chips:"","hide-selected":"","return-object":"","item-text":"name","item-value":"id",multiple:""},scopedSlots:e._u([{key:"selection",fn:function(s){return[t(Cs["a"],e._b({attrs:{dark:"","input-value":s.selected,close:""},on:{"click:close":function(t){return e.removeChips(s.item)}}},"v-chip",s.attrs,!1),[t(ot["a"],{attrs:{left:""}},[t(ze["a"],{attrs:{src:s.item.avatar}})],1),e._v("\n                                "+e._s(s.item.name)+"\n                            ")],1)]}},{key:"item",fn:function(s){return[t(rt["a"],[t(ot["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:s.item.avatar}})])],1),t(Re["a"],[t(Re["c"],{domProps:{innerHTML:e._s(s.item.name)}}),t(Re["b"],{domProps:{innerHTML:e._s(s.item.role)}})],1)]}},{key:"append-outer",fn:function(){return[t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.managerList.length},on:{click:e.addUsers}},[e._v("Добавить")])]},proxy:!0}]),model:{value:e.managerList,callback:function(t){e.managerList=t},expression:"managerList"}})],1)],1),t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"12",md:"12"}},[t(ks["a"],{staticClass:"m-table-custom",attrs:{headers:e.headers,items:e.users,"disable-pagination":"","hide-default-footer":""},scopedSlots:e._u([{key:"no-data",fn:function(){return[e._v("\n                            "+e._s(e.noData)+"\n                        ")]},proxy:!0},{key:"item.src",fn:function({item:e}){return[t(ot["a"],{attrs:{size:"30"}},[t("img",{staticClass:"m-card--avatar-wrap_img",attrs:{src:e.avatar,alt:"avatar"}})])]}},{key:"item.action",fn:function({item:s}){return[s.level?t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){return e.removeUser(s)}}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1):e._e()]}},{key:"item.read",fn:function({item:s}){return[t(Ss["a"],{attrs:{color:"success",inset:"",disabled:!s.level},model:{value:s.permissions.can_open,callback:function(t){e.$set(s.permissions,"can_open",t)},expression:"item.permissions.can_open"}})]}},{key:"item.edit",fn:function({item:s}){return[e._v("\n                            "+e._s(s.can_edit)+"\n                            "),t(Ss["a"],{attrs:{color:"success",inset:"",disabled:!s.level},model:{value:s.permissions.can_edit,callback:function(t){e.$set(s.permissions,"can_edit",t)},expression:"item.permissions.can_edit"}})]}},{key:"item.download",fn:function({item:s}){return[t(Ss["a"],{attrs:{color:"success",inset:"",disabled:!s.level},model:{value:s.permissions.can_download,callback:function(t){e.$set(s.permissions,"can_download",t)},expression:"item.permissions.can_download"}})]}},{key:"item.comment",fn:function({item:s}){return[t(Ss["a"],{attrs:{color:"success",inset:"",disabled:!s.level},model:{value:s.permissions.can_comment,callback:function(t){e.$set(s.permissions,"can_comment",t)},expression:"item.permissions.can_comment"}})]}}])})],1)],1)],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.check.change},on:{click:e.save}},[e._v("Подтвердить")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"normal"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},Is=[],Os={name:"AccessRights",props:["accessrights","item"],data(){return{managerList:[],users:[],addedUserList:[],removedUserList:[],changedPermissionUserList:[],headers:[{text:"",align:"center",sortable:!1,value:"src"},{text:"Имя",value:"name"},{text:"Просматривать",value:"read"},{text:"Редактировать",value:"edit"},{text:"Может скачивать",value:"download"},{text:"Комментировать",value:"comment"},{text:"",value:"action",sortable:!1}],noData:"Нет данных"}},computed:{managers(){let e=this.$store.state.administration.company.users||[];return e=e.filter(e=>!this.users.some(t=>t.permissions.id==e.id+"")).map(e=>({id:e.id+"",avatar:e.avatarSrc,email:e.email,name:e.first_name+" "+e.last_name})),e},workItem(){let e=this.item?this.item.name:"",t=this.item?this.item.id:"",s=this.item?this.item.type:null;return{name:e,id:t,type:s}},userList(){return[...this.admins,...this.users]},check(){let e={change:!1,changedUsers:[],addedUsers:[],removedUsers:[]},t=this.workItem.type;if(t){t="folder"==t?"folderPermissions":"filesPermissions";let s=this.$store.state.administration[t]||[];s=s.find(e=>e.id==this.workItem.id),s&&!s.users&&(s.users=[]),s||(s={users:[]});let a=[];this.$store.state.administration.groupPermissions.map(e=>{"1"!=e.id&&"2"!=e.id||(a=[...a,...e.users])}),s.users=[...s.users,...a.filter(e=>!s.users.some(t=>t.id==e.id))];let i=this.users.filter(e=>!s.users.some(t=>t.id==e.permissions.id)),o=s.users.filter(e=>!this.users.some(t=>e.id==t.permissions.id));(i.length||o.length)&&(e.change=!0,e.addedUsers=i.map(e=>e.permissions),e.removedUsers=o);this.users.filter(e=>s.users.some(t=>t.id==e.permissions.id)).map(t=>{let a=s.users.find(e=>e.id==t.permissions.id);Object.entries(a).map(([s,a])=>{let i=a,o=t.permissions[s];"boolean"==typeof a&&o!=i&&(e.change=!0,e.changedUsers.push(t.permissions))})})}return e}},watch:{accessrights(e){if(e){document.addEventListener("keyup",this.enter,!1);let e=this.workItem.type;if(e){e="folder"==e?"folderPermissions":"filesPermissions";let t=(this.$store.state.administration[e]||[]).find(e=>e.id==this.workItem.id),s=[];this.$store.state.administration.groupPermissions.map(e=>{"1"!=e.id&&"2"!=e.id||(s=[...s,...e.users])});let a=t&&t.users?JSON.parse(JSON.stringify(t.users)):[],i=this.$store.state.administration.company.users||[],o=[];s.map(e=>{let t=i.find(t=>t.id==e.id);o.push({permissions:{can_comment:!0,can_download:!0,can_edit:!0,can_open:!0,email:t.email,full_name:t.first_name+" "+t.last_name,id:t.id},id:t.id+"",avatar:t.avatarSrc,email:t.email,name:t.first_name+" "+t.last_name,level:0})}),o=[...o,...i.filter(e=>a.some(t=>t.id==e.id)&&!s.some(t=>t.id==e.id)).map(e=>{let t=a.find(t=>t.id==e.id);return{permissions:{...t},id:e.id+"",avatar:e.avatarSrc,email:e.email,name:t.full_name.trim(),level:1}})],this.users=o}}else document.removeEventListener("keyup",this.enter,!1)}},methods:{checkRole(e){let t=1;this.$store.state.administration.user.id==e&&(t=0);let s=this.$store.state.administration.groupPermissions;return s.map(s=>{"1"!=s.id&&"2"!=s.id||s.users.some(t=>t.id==e)&&(t=0)}),t},cancel(){this.$emit("update:accessrights",!1)},enter(e){13===e.keyCode&&(e.preventDefault(),this.save())},save(){let e=this.workItem.type;e="folder"==e?"folderPermissions":"filesPermissions";let t=[],s=this.$store.state.administration["folderPermissions"],a=this.$store.state.administration["filesPermissions"],i=this.$store.state.administration[e],o=this.$store.state.administration.groupPermissions,n=!!i&&i.find(e=>e.id==this.workItem.id);i=i&&n?n:{id:this.workItem.id,groups:o};let r="folderPermissions"==e?"FolderPermissions":"FilesPermissions";t.push(this.$store.dispatch("administration/set"+r,{id:this.workItem.id,body:{...i,users:this.users.map(e=>e.permissions)}}));let l={};this.check.addedUsers.length&&(l=this.traversUp({type:this.item.type,folder:"folder"==this.item.type?this.item.id:this.item.folder}),s.filter(e=>l.folders.some(t=>t==e.id)).map(e=>{let s=[...e.users,...this.check.addedUsers.filter(t=>!e.users.some(e=>e.id==t.id)).map(e=>({...e,can_open:!0,can_edit:!1,can_download:!1,can_comment:!1}))];t.push(this.$store.dispatch("administration/setFolderPermissions",{id:e.id,body:{...e,users:s}}))})),l=this.traversDown(this.workItem.id),s.filter(e=>l.folders.some(t=>t==e.id)).map(e=>{let s=e.users?e.users.map(e=>this.check.changedUsers.some(t=>t.id==e.id)&&this.check.changedUsers.find(t=>t.id==e.id)||e):[];s=s.filter(e=>!this.check.removedUsers.some(t=>t.id==e.id)),s=[...s.filter(e=>!this.check.addedUsers.some(t=>t.id==e.id)),...this.check.addedUsers],t.push(this.$store.dispatch("administration/setFolderPermissions",{id:e.id,body:{...e,users:s}}))}),a.filter(e=>l.files.some(t=>t==e.id)).map(e=>{let s=e.users?e.users.map(e=>this.check.changedUsers.some(t=>t.id==e.id)&&this.check.changedUsers.find(t=>t.id==e.id)||e):[];s=s.filter(e=>!this.check.removedUsers.some(t=>t.id==e.id)),s=[...s.filter(e=>!this.check.addedUsers.some(t=>t.id==e.id)),...this.check.addedUsers],t.push(this.$store.dispatch("administration/setFilesPermissions",{id:e.id,body:{...e,users:s}}))}),Promise.all(t).then(e=>{this.$store.dispatch("administration/getFoldersPermissions"),this.$store.dispatch("administration/getFilesPermissions")}),this.cancel()},traversDown(e){let t=this.$store.state.workflow.foldersMap,s=t.find(t=>t.id==e),a={folders:[],files:[]};return s&&s.files&&(a.files=s.files.map(e=>e.id)),t.filter(t=>t.parent==e).map(e=>{a.folders.push(e.id);let t=this.traversDown(e.id);a.folders=[...a.folders,...t.folders],a.files=[...a.files,...t.files]}),a},traversUp(e){let t=this.$store.state.workflow.foldersMap,s=null,a=null;"folder"==e.type?(s=t.find(t=>t.id==e.folder),a=t.find(e=>e.id==s.parent)):a=t.find(t=>t.id==e.folder);let i={folders:[],files:[]};if(a&&!a.group){let e=this.traversUp({type:"folder",folder:a.id});i.folders=[a.id,...e.folders]}return i},getAvatar(e){return e?e.avatar:""},removeUser(e){this.users=this.users.filter(t=>t.permissions.id!=e.permissions.id),this.addedUserList=this.addedUserList.filter(t=>t.permissions.id!=e.permissions.id)},removeChips(e){this.managerList=this.managerList.filter(t=>t.id!=e.id)},addUsers(){let e=this.managerList.map(e=>({...e,level:this.checkRole(e.id),permissions:{id:e.id,email:e.email,full_name:e.name.trim(),can_comment:!1,can_download:!1,can_edit:!1,can_open:!1}}));this.addedUserList=[...this.addedUserList,...e],this.users=[...this.users,...e],this.managerList=[],this.$refs.managers.blur()}},created(){this.users=[],this.managerList=[]}},js=Os,Fs=Object(m["a"])(js,As,Is,!1,null,null,null),Ps=Fs.exports,Es=function(){var e=this,t=e._self._c;return t(qe["a"],{attrs:{top:"",right:"","offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(Xe["a"],e._g({staticClass:"m-btn-back--white",attrs:{text:"",icon:"",color:"#7f7f7f"},on:{mousedown:function(e){e.stopPropagation()}}},s),[t(o["a"],{attrs:{size:"20"}},[e._v("mdi-dots-horizontal")])],1)]}}])},[t(We["a"],[t(Ye["a"],{attrs:{dense:""}},e._l(e.notes,(function(s,a){return t($e["a"],{key:a,on:{click:function(t){return e.action(s.action)}}},[t(Re["c"],{staticClass:"m-menu-title",domProps:{textContent:e._s(s.title)}})],1)})),1)],1)],1)},Us=[],Bs={data:()=>({notes:[{title:"Сохранить как шаблон",value:"saveTemplate",action:"saveTemplate"},{title:"Выбрать шаблон",value:"choiceTemplate",action:"choiceTemplate"},{title:"Удалить",value:"remove",action:"remove"},{title:"Права доступа",value:"access",action:"accessFolder"}]}),methods:{action(e){this.$emit("update:"+e,!0)}}},Ts=Bs,Ls=Object(m["a"])(Ts,Es,Us,!1,null,null,null),Ns=Ls.exports,Hs={name:"SidebarFolders",components:{SlVueTree:Et.a,CreateMenu:Mt,CreateGroup:Xt,CreateFolder:ts,EditMenu:rs,EditFolder:us,RemoveFolder:ys,AccessRights:Ps,EditMain:Ns},data(){return{folderActive:null,search:"",editNode:0,nodeSelectedEl:{id:"",title:"",icon:""},creatingBranchId:!1,isFile:{parent:0,file:!1,group:!1,lvl:0},newGroup:!1,newFolder:!1,editFolder:null,removeFolderFlag:!1,accessrights:!1,drop:!1,curentNodeId:"",stackTree:[]}},computed:{folderslist:{get(){let e=this.$store.state.workflow.foldersMap,t=(this.$store.state.administration.folderPermissions,this.$store.state.administration.groupPermissions,this.$store.state.workflow.currentFolder),s=w.createTreeForSidebar(e,t);return s},set(e){}},getCurFol(){return this.$store.state.workflow.currentFolder}},methods:{getAccess(e,t){let s=!0;return t.map(t=>{s=s&&e>>t&1}),!!s},expand(e){let t=this.getNodes();t=t.filter(e=>e.isExpanded),t=t.map(e=>e.data.id),this.$store.dispatch("workflow/setExpanded",t)},nodeSelected(e){let t=e[0];this.folderActive=t,this.getAccess(t.data.access,[0])&&this.$store.commit("workflow/setCurrentFolder",t.data.id),this.nodeSelectedEl.id=t.data.id,this.nodeSelectedEl.title=t.title,this.nodeSelectedEl.icon=t.isLeaf?"icon-folder":"mdi-chevron-down"},getDocs(e){},beforeDrop(e,t){this.stack=JSON.parse(JSON.stringify(this.$store.state.workflow.foldersMap)),e=e[0],e.data.access>>1&1&&(e.data.group&&"inside"==t.placement||e.data.group&&"inside"!=t.placement&&t.node.level>1?this.drop=!1:this.drop=!0)},dropNode(e,t){if(this.drop){let s=[],a={id:e[0].data.id,name:e[0].title},i=JSON.parse(JSON.stringify(this.$store.state.workflow.foldersMap));if("inside"==t.placement){let o=i.filter(s=>s.parent==t.node.data.id&&!!s.group==!!e[0].data.group);if(a.order=o.length,a.parent=t.node.data.group?e[0].data.id:t.node.data.id,s.push(this.$store.dispatch("workflow/addFolder",a)),t.node.data.group){let e=i.filter(e=>e.id===t.node.data.id)[0];e.folders=e.folders||[],e.folders.push({folder:a.id,order:a.order}),s.push(this.$store.dispatch("workflow/addGroup",{name:e.name,order:e.order,folders:e.folders}))}if(o=i.filter(t=>t.parent==e[0].data.parent&&t.id!=e[0].data.id&&!t.group),o=x(o,"order"),o=o.map((e,t)=>(s.push(this.$store.dispatch("workflow/addFolder",{id:e.id,name:e.name,parent:e.toGroup?e.id:e.parent?e.parent:e.id,order:t})),{...e,order:t})),e[0].data.toGroup){let t=i.filter(t=>t.id===e[0].data.toGroup)[0];s.push(this.$store.dispatch("workflow/addGroup",{name:t.name,order:t.order,folders:o.map(e=>({folder:e.id,order:e.order}))}))}}else if(e[0].data.group){let a=i.filter(t=>!!t.group&&t.id!=e[0].data.id);a=x(a,"order");let o=i.filter(t=>t.id==e[0].data.id)[0],n=0;a.length>0&&(t.node.data.group?(a.map((e,s)=>{e.id==t.node.data.id&&(n=s)}),"before"==t.placement?a.splice(n,0,o):a.splice(n+1,0,o),a.map((e,t)=>{s.push(this.$store.dispatch("workflow/addGroup",{name:e.name,order:t,folders:e.folders}))})):(a.push(o),a.map((e,t)=>{s.push(this.$store.dispatch("workflow/addGroup",{name:e.name,order:t,folders:e.folders}))})))}else{let a=i.filter(t=>t.id==e[0].data.id)[0],o=0,n=i.filter(e=>!e.group&&e.parent==t.node.data.parent&&e.id!=a.id);n=x(n,"order"),n.map((e,s)=>{e.id==t.node.data.id&&(o=s)}),"root"==t.node.data.toGroup?n.splice(0,0,a):"before"==t.placement?n.splice(o,0,a):n.splice(o+1,0,a);let r=n.map((e,t)=>(s.push(this.$store.dispatch("workflow/addFolder",{id:e.id,name:e.name,parent:e.toGroup?e.id:e.parent?e.parent:e.id,order:t})),{...e,order:t}));if(t.node.data.toGroup&&"root"!=t.node.data.toGroup){let e=i.filter(e=>e.id==t.node.data.toGroup)[0];s.push(this.$store.dispatch("workflow/addGroup",{name:e.name,order:e.order,folders:r.map(e=>({folder:e.id,order:e.order}))}))}if(e[0].data.parent!=t.node.data.parent){let t=i.filter(t=>!t.group&&t.parent==e[0].data.parent&&t.id!=e[0].data.id);if(t=x(t,"order"),t=t.map((e,t)=>(s.push(this.$store.dispatch("workflow/addFolder",{id:e.id,name:e.name,parent:e.toGroup?e.id:e.parent?e.parent:e.id,order:t})),{...e,order:t})),e[0].data.toGroup){let a=i.filter(t=>t.id==e[0].data.toGroup)[0];s.push(this.$store.dispatch("workflow/addGroup",{name:a.name,order:a.order,folders:t.map(e=>({folder:e.id,order:e.order}))}))}}}Promise.all(s).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>{this.$store.dispatch("workflow/createFoldersMap")})}else this.$store.commit("workflow/setFoldersMap",[]),this.$store.commit("workflow/setFoldersMap",this.stack)},expandGroup(e){},renameNode(e){let t=JSON.parse(JSON.stringify(this.folderActive)),s="",a=[],i={};if(t.data.group){let o=this.$store.state.workflow.foldersMap.filter(e=>e.id==t.data.id)[0];i={name:o.name,order:t.data.order,created_at:o.created_at,created_by:o.created_by,updated_at:o.updated_at,updated_by:o.updated_by,folders:t.data.list||null},a.push(this.$store.dispatch("workflow/removeGroup",i)),i={name:e,order:t.data.order,folders:t.data.list||null},s="group_"+e,a.push(this.$store.dispatch("workflow/addGroup",i))}else i={id:t.data.id,name:e,parent:t.data.parent==t.data.toGroup?t.data.id:t.data.parent,order:t.data.order},s=t.data.id,a.push(this.$store.dispatch("workflow/addFolder",i));Promise.all(a).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>new Promise(e=>{e(this.$store.dispatch("workflow/createFoldersMap"))})).then(()=>{this.$store.commit("workflow/setCurrentFolder",s)})},removeFolderAction(e){this.removeFolderFlag=e},editFolderAction(e){this.editFolder=e},newFolderAction(e){this.newFolder=e},accessFolderAction(e){Promise.resolve(this.editNode={...this.editNode,id:this.editNode.data.id,type:"folder",name:this.editNode.title}).then(()=>{this.accessrights=!0})},removeNode(){let e=JSON.parse(JSON.stringify(this.folderActive)),t=[];if(t.push(this.$store.commit("workflow/setCurrentFolder",e.data.parent)),e.data.group){let s=this.$store.state.workflow.foldersMap.filter(t=>t.id==e.data.id)[0],a=s.folders||[];a.map((e,s)=>{t.push(this.$store.dispatch("workflow/removeFolder",{uuid:e.folder}))});let i={name:s.name,order:s.order,created_at:s.created_at,created_by:s.created_by,updated_at:s.updated_at,updated_by:s.updated_by,folders:s.folders};s=i,t.push(this.$store.dispatch("workflow/removeGroup",s))}else t.push(this.$store.dispatch("workflow/removeFolder",{uuid:e.data.id}));Promise.all(t).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>this.$store.dispatch("workflow/createFoldersMap")).then(()=>{let t=e.data.parent;this.$store.commit("workflow/setCurrentFolder",0),this.$store.commit("workflow/setCurrentFolder",t)})},createGroup(e){let t=this.$store.state.workflow.foldersMap.filter(e=>!!e.group),s={name:this.checkTween(t,e.name),order:t.length};this.$store.dispatch("workflow/addGroup",s).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>{this.$store.dispatch("workflow/createFoldersMap")})},createFolder(e){let t=JSON.parse(JSON.stringify(this.editNode))||0,s=t?t.data.id:0,a=this.$store.state.workflow.foldersMap.filter(e=>e.parent==s&&!e.group),i=Object(Ut["a"])(),o={id:i,parent:t?t.data.group?i:t.data.id:i,name:this.checkTween(a,e.name),order:a.length},n=!1;if(t&&t.data.group){n=this.$store.state.workflow.foldersMap.filter(e=>e.id==t.data.id)[0];let e={name:n.name,order:n.order,created_at:n.created_at,created_by:n.created_by,updated_at:n.updated_at,updated_by:n.updated_by,folders:n.folders||[]};n=e}this.$store.dispatch("workflow/addFolder",o).then(e=>{let t=[];n&&(n.folders.push({folder:e.id,order:0}),t.push(this.$store.dispatch("workflow/addGroup",n)));let a=this.$store.state.administration.folderPermissions.find(e=>e.id==s);if(!a){let e=this.$store.state.administration.user;a={users:[{id:e.id+"",email:e.email,full_name:e.first_name+" "+e.last_name,can_open:!0,can_edit:!0,can_download:!0,can_comment:!0}]}}return t.push(this.$store.dispatch("administration/setFolderPermissions",{id:e.id,body:{id:e.id,users:a.users,groups:this.$store.state.administration.groupPermissions.map(e=>({id:e.id,name:e.name,can_open:!0,can_edit:!0,can_download:!0,can_comment:!0}))}})),Promise.all(t)}).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>{this.$store.dispatch("workflow/createFoldersMap")}).then(()=>this.$store.dispatch("administration/getFoldersPermissions"))},checkTween(e,t){let s=t;return e.map(e=>{e.name==s&&(s+="0")}),s},getGroupsFolders(e){let t=JSON.parse(JSON.stringify(this.$store.state.workflow.groups)),s=JSON.parse(JSON.stringify(this.$store.state.workflow.folders));Promise.all([this.$store.dispatch("workflow/updateFolders",{paths:s,parent:e.currentFolder}),this.$store.dispatch("workflow/updateGroups",t)]).finally(()=>{this.$store.dispatch("workflow/createTree")})},traverseTree(e,t=[],s=[],a=""){return e.map(e=>{let i=a+"/"+e.title;t.push(i),s.push({id:e.data.id,prevPath:e.data.path,nextPath:i}),e.children.length&&this.traverseTree(e.children,t,s,i)}),{list:t,map:s}},getGroupsFoldersFromTree(){let e=JSON.parse(JSON.stringify(this.folderActive)),t=this.$store.state.workflow.folderTree,s=t.filter(e=>e.data.group),a=[],i=[],o=s.map(e=>{a=[...a,...e.children];let t=this.traverseTree(e.children),s={group:e.title,folders:t.list};return i.push({id:e.data.id,prevPath:e.data.path,nextPath:e.data.path}),i=[...i,...t.map],s}),n=t.filter(e=>!e.data.group);a=[...a,...n];let r=this.traverseTree(a),l=r.list;i=[...i,...r.map];let c="/";i.map(t=>{t.id==e.data.id&&(c=t.nextPath)}),Promise.all([this.$store.dispatch("workflow/updateFolders",{paths:l}),this.$store.dispatch("workflow/updateGroups",o)]).finally(()=>{this.$store.dispatch("workflow/createTree")})},getNodes(){let e=[];const t=this.$refs.tree;return t.traverse((function(t){e.push(Object.assign({},t))})),e}},mounted(){this.unwatch=this.$store.watch(e=>e.workflow.openFolder,e=>{e.name;let t=[];this.getNodes().map(s=>{s.data.path==e.path&&(t=s.path)});const s=this.$refs.tree;s.select(t)})},beforeDestroy(){this.unwatch()}},Ms=Hs,zs=Object(m["a"])(Ms,jt,Ft,!1,null,null,null),$s=zs.exports,Rs={name:"Sidebar",props:["part"],components:{SidebarFolders:$s},data(){return{mini:!0}}},Ds=Rs,Js=Object(m["a"])(Ds,At,It,!1,null,null,null),Vs=Js.exports,Ks=s("a75b"),Gs=function(){var e=this,t=e._self._c;return t(Ks["a"],{staticClass:"light lighten-3"},[t("div",{style:{height:"100%"},attrs:{id:"core-view"}},[t("router-view")],1)])},Qs=[],Xs={name:"CoreView"},Ws=Xs,Ys=Object(m["a"])(Ws,Gs,Qs,!1,null,null,null),qs=Ys.exports,Zs={name:"Layout",data:()=>({fab:!1,part:{}}),watch:{$route(e,t){this.part=this.createNav()}},components:{AppBar:xt,Sidebar:Vs,CoreView:qs},computed:{getRole(){return this.$store.state.administration.user.role}},created(){this.part=this.createNav()},methods:{onScroll(e){if("undefined"===typeof window)return;const t=window.pageYOffset||e.target.scrollTop||0;this.fab=t>20},toTop(){this.$vuetify.goTo(0)},createNav:function(){let e=Object.assign({},Te[this.$route.meta.part]),t=Object.keys(e);if(t.includes("clone")){let s=Object.assign({},Te[e.clone]);t.map(t=>{s[t]=e[t]}),e=Object.assign({},s)}e.list=e.list.filter(e=>!e.access_list.length||e.access_list.some(e=>this.getRole==e));let s=[];return this.$route.matched.map(e=>{Object.prototype.hasOwnProperty.call(e.meta,"crumbs")&&s.push({title:e.meta.crumbs,path:e.path})}),this.$store.commit("toolbar/setTitle",s),e}}},ea=Zs,ta=Object(m["a"])(ea,Ue,Be,!1,null,null,null),sa=ta.exports,aa=s("a523"),ia=s("0e8f"),oa=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container pb-10 pt-0",attrs:{fluid:"","fill-height":"","text-xs-center":""}},[t(Ee["a"],{attrs:{wrap:""}},[t(ia["a"],{attrs:{xs12:""}},[t(Ee["a"],{attrs:{fluid:"","fill-height":"",column:"","align-center":"","justify-center":""}},[t("div",{staticClass:"m-dummy--wrap mb-5"},[t("img",{attrs:{width:"100%",src:s("f158")}})]),t("div",{staticClass:"m-dummy--title"},[e._v("Раздел в разработке")]),t("div",{staticClass:"m-dummy--desc"},[e._v("Мы скоро завершим работы!")])])],1)],1),t("core-footer")],1)},na=[],ra=function(){var e=this,t=e._self._c;return e.visible?t(Ot["a"],{staticClass:"pb-2",attrs:{id:"core-footer",absolute:""}},[t("span",[e._v("\n        ©\n        UnitBIM 2018. Все права защищены.\n    ")]),t(Rt["a"]),e._l(e.links,(function(s,a){return t("span",{key:s.name},[t("a",{staticClass:"m-footer-link",attrs:{href:s.link}},[e._v(e._s(s.value))]),e._v("\n        "+e._s(a!=e.links.length-1?" / ":"")+"\n    ")])}))],2):e._e()},la=[],ca={data:()=>({visible:!0,links:[{name:"term",value:"Соглашение об использовании сайта",link:"https://unitbim.ru/account/#/modules/term"},{name:"privacy",value:"Политика обработки персональных данных",link:"https://unitbim.ru/account/#/modules/privacy"},{name:"cookies",value:"Файлы cookie",link:"https://unitbim.ru/account/#/modules/cookies"}]}),watch:{$route(e,t){this.display()}},methods:{display:function(){"workflow-view"==this.$route.name?this.visible=!1:this.visible=!0}},created(){this.display()}},ma=ca,da=Object(m["a"])(ma,ra,la,!1,null,null,null),pa=da.exports,ua={name:"Dummy",components:{CoreFooter:pa}},ha=ua,fa=Object(m["a"])(ha,oa,na,!1,null,null,null),va=fa.exports,ba=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container pb-10 pt-0",attrs:{fluid:"","fill-height":"","text-xs-center":""}},[t(Ee["a"],{attrs:{wrap:""}},[t(ia["a"],{attrs:{xs12:""}},[t(Ee["a"],{attrs:{fluid:"","fill-height":"",column:"","align-center":"","justify-center":""}},[t("div",[e._v("Callback")])])],1)],1)],1)},ga=[],ya={name:"Callback",render:()=>null,data:()=>({}),methods:{},mounted(){let e=this.$route.query,t=Object.prototype.hasOwnProperty.call(e,"code");if(t){let s=e.state;t=e.code,this.$store.dispatch("auth/token",{code:t,state:s}).then(e=>{let t=JSON.parse(localStorage.getItem("state"));"/invite"==t.path?(this.$store.commit("auth/setToken",e),this.$router.push(t.url)):this.$store.dispatch("auth/setTokenId",e).then(()=>{this.$router.push(t.url)})})}else console.log("Callback no code")}},_a=ya,Ca=Object(m["a"])(_a,ba,ga,!1,null,null,null),wa=Ca.exports,ka=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container",attrs:{"grid-list-md":"","text-xs-center":""}},[t(Ee["a"],{attrs:{row:"",wrap:""}},[t(ia["a"],{staticClass:"pa-0",attrs:{xs12:""}})],1),t(Ee["a"],{attrs:{row:"",wrap:""}},[e._v("\n        В разработке\n    ")]),t("core-footer")],1)},xa=[],Sa={name:"Main",components:{CoreFooter:pa}},Aa=Sa,Ia=Object(m["a"])(Aa,ka,xa,!1,null,null,null),Oa=(Ia.exports,function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container pb-10 pt-0",attrs:{fluid:"","fill-height":"","text-xs-center":""}},[t(Ee["a"],{attrs:{wrap:""}},[t(ia["a"],{attrs:{xs12:""}},[t(Ee["a"],{attrs:{fluid:"","fill-height":"",column:"","align-center":"","justify-center":""}},[t("div",[e._v("Модули")])])],1)],1)],1)}),ja=[],Fa={name:"Moduls",components:{},data:()=>({}),methods:{}},Pa=Fa,Ea=Object(m["a"])(Pa,Oa,ja,!1,null,null,null),Ua=(Ea.exports,function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container pb-10 pt-0",attrs:{"fill-height":"",fluid:"","text-xs-center":""}},[t(Ee["a"],{attrs:{row:"",wrap:""}},[t(ia["a"],{attrs:{xs12:""}},[t("router-view")],1)],1)],1)}),Ba=[],Ta={name:"Engineering"},La=Ta,Na=Object(m["a"])(La,Ua,Ba,!1,null,null,null),Ha=Na.exports,Ma=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container pb-10 pt-0",attrs:{fluid:"","fill-height":"","text-xs-center":""}},[t(Ee["a"],{attrs:{row:"",wrap:""}},[t(ia["a"],{attrs:{xs12:""}},[t(aa["a"],{ref:"wrap",staticClass:"m-container",attrs:{fluid:"","px-3":"","pb-10":"","pt-0":""}},[t(We["a"],{staticClass:"m-card pa-0 pt-0",attrs:{outlined:"","max-width":"1200"}},[t(zt["c"],{staticClass:"m-text--2c"},[e._v("Подтверждение приглашения")]),t(nt["a"]),t(zt["c"],[e._v("\n                    Приглашение от компании "+e._s(e.company.name)+"\n            ")]),e.confirmed?t(zt["c"],[e._v("\n                    Приглашение "+e._s("allow"==e.answer?"принято":"отклонено")+".\n            ")]):t(zt["a"],{staticClass:"px-4"},[t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:function(t){return e.confirm("allow")}}},[e._v("Подтвердить")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:function(t){return e.confirm("disallow")}}},[e._v("Отклонить")])],1)],1)],1)],1)],1)],1)},za=[],$a={name:"Invite",components:{CoreFooter:pa},data(){return{code:"",company:{},confirmed:!1,answer:""}},methods:{confirm(e){}},created(){}},Ra=$a,Da=Object(m["a"])(Ra,Ma,za,!1,null,null,null),Ja=Da.exports,Va=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container pb-10 pt-0",attrs:{"fill-height":"",fluid:"","text-xs-center":""}},[t(Ee["a"],{attrs:{row:"",wrap:""}},[t(ia["a"],{attrs:{xs12:""}},[t("router-view")],1)],1)],1)},Ka=[],Ga={name:"Administration"},Qa=Ga,Xa=Object(m["a"])(Qa,Va,Ka,!1,null,null,null),Wa=Xa.exports,Ya=function(){var e=this,t=e._self._c;return t("router-view")},qa=[],Za={name:"Workflow"},ei=Za,ti=Object(m["a"])(ei,Ya,qa,!1,null,null,null),si=ti.exports,ai=s("71d9"),ii=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container pb-10 pt-0",attrs:{fluid:"","fill-height":"","text-xs-center":""}},[t(Ee["a"],{attrs:{row:"",wrap:""}},[t(ia["a"],{attrs:{xs12:""}},[t(aa["a"],{ref:"wrap",attrs:{fluid:"","fill-height":!e.projectList.length,"px-3":"","pt-0":"","pb-10":""}},[e.projectList.length?e._e():t(Ee["a"],{attrs:{fluid:"","fill-height":"",column:"","align-center":"","justify-center":""}},[e.getAccess(e.getPermission,"and",[0])?[t("div",{staticClass:"m-dummy--title-2"},[e._v("У вас пока нет проектов, создайте его!")]),t("div",{staticClass:"py-3"},[t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:e.getAccess(e.getPermission,"and",[0]),expression:"getAccess(getPermission, 'and', [0])"}],staticClass:"m-btn--text_icon mr-4",attrs:{outlined:"",color:"primary"},on:{click:function(t){return t.stopPropagation(),e.onProject(!1)}}},[t(o["a"],{attrs:{size:"16",left:""}},[e._v("mdi-plus-circle-outline")]),e._v("Создать проект\n                    ")],1),e.checklicense("uploadProject")?t("span",[e._v("или")]):e._e(),e.getAccess(e.getPermission,"and",[0])&&e.checklicense("uploadProject")?t(Xe["a"],{staticClass:"ma-0 m-btn--text_icon",attrs:{text:""},on:{click:function(t){return t.stopPropagation(),e.inputFiles.apply(null,arguments)}}},[t(o["a"],{attrs:{size:"16",left:""}},[e._v("icon-upload")]),e._v("Загрузить проект\n                    ")],1):e._e()],1),t("div",{staticClass:"m-dummy--link-info mt-2"},[e._v("Как создать проект?")])]:[t("div",{staticClass:"m-dummy--title-2"},[e._v("У вас нет прав для создания проектов.")])]],2),e.projectList.length?t(ai["a"],{staticClass:"m-table-toolbar",attrs:{flat:"",height:"auto"}},[t(Dt["a"],{staticClass:"m-table-toolbar--search ml-2",attrs:{"prepend-icon":"search",placeholder:"Поиск...","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),t(Rt["a"]),t("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"input-files",attrs:{type:"file",name:"fileXml",required:""},on:{change:e.onImportXml}}),e.getAccess(e.getPermission,"and",[0])&&e.checklicense("uploadProject")?t(Xe["a"],{staticClass:"ma-0 m-btn--text_icon",attrs:{text:""},on:{click:function(t){return t.stopPropagation(),e.inputFiles.apply(null,arguments)}}},[t(o["a"],{attrs:{size:"16",left:""}},[e._v("icon-upload")]),e._v("Загрузить проект\n            ")],1):e._e(),t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:e.getAccess(e.getPermission,"and",[0]),expression:"getAccess(getPermission, 'and', [0])"}],staticClass:"ma-0 m-btn--text_icon ml-2",attrs:{outlined:"",color:"primary"},on:{click:function(t){return t.stopPropagation(),e.onProject(!1)}}},[t(o["a"],{attrs:{size:"16",left:""}},[e._v("mdi-plus-circle-outline")]),e._v("Создать проект\n            ")],1)],1):e._e(),e.projectList.length?t(ks["a"],{staticClass:"m-table-custom",attrs:{headers:e.headers,items:e.projectList,"fixed-headerw":"",heightq:"200","show-select":e.getAccess(e.getPermission,"or",[1,7]),search:e.search,"disable-pagination":"","hide-default-footer":""},scopedSlots:e._u([{key:"item.name",fn:function({item:s}){return[t("span",{staticClass:"m-text--hover",on:{click:function(t){return e.getProject(s)}}},[e._v(e._s(s.info.name)+"\n                ")])]}},{key:"item.manager",fn:function({item:t}){return[e._v("\n                "+e._s(t.info.in_charge_name)+"\n            ")]}},{key:"item.client",fn:function({item:t}){return[e._v("\n                "+e._s(t.info.client)+"\n            ")]}},{key:"item.date",fn:function({item:t}){return[e._v("\n                "+e._s(e.getDate(t.info.created_at))+"\n            ")]}},{key:"item.count_files",fn:function({item:t}){return[e._v("\n                "+e._s(t.info.number_of_files)+"\n            ")]}},{key:"item.action",fn:function({item:s}){return[!e.isSelected(s.id)&&e.getAccess(e.getPermission,"or",[1,7])?t("action-menu",{attrs:{permission:e.getPermission,item:s},on:{onProject:function(t){return e.onProject(s)},onProjectDescription:e.onProjectDescription,onCreateXml:e.onCreateXml,getProject:e.getProject,removeProject:e.removeProject}}):t("div",{style:{width:"34px"}})]}},{key:"pageText",fn:function(t){return[e._v("\n                "+e._s(t.pageStart)+" - "+e._s(t.pageStop)+" из "+e._s(t.itemsLength)+"\n            ")]}}],null,!1,1224835638),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}):e._e(),t("edit-project",{attrs:{editProject:e.editProject,item:e.itemCurrent},on:{"update:editProject":function(t){e.editProject=t},"update:edit-project":function(t){e.editProject=t}}}),t("project-description",{attrs:{projectDescription:e.projectDescription},on:{"update:projectDescription":function(t){e.projectDescription=t},"update:project-description":function(t){e.projectDescription=t}}}),t("create-xml",{attrs:{create_xml:e.create_xml,item:e.itemCurrent},on:{"update:create_xml":function(t){e.create_xml=t},createXml:e.createXml}}),t(We["a"],{directives:[{name:"show",rawName:"v-show",value:1==e.selected.length&&e.getAccess(e.getPermission,"and",[7])||e.selected.length&&e.getAccess(e.getPermission,"and",[1]),expression:"(selected.length == 1 && getAccess(getPermission, 'and', [7]))\n                || (selected.length && getAccess(getPermission, 'and', [1]))"}],staticClass:"m-table-custom--action",style:e.cardActionStyle},[t(zt["a"],[1==e.selected.length&&e.getAccess(e.getPermission,"and",[7])?t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:function(t){return e.onProject(!1)}}},[t(o["a"],{staticClass:"mr-1",attrs:{size:"20",color:"#0070e0"}},[e._v("mdi-information-outline")]),e._v("О проекте")],1):e._e(),e.getAccess(e.getPermission,"and",[1])?t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:e.removeProjectSelected}},[t(o["a"],{staticClass:"mr-1",attrs:{size:"20",color:"#0070e0"}},[e._v("mdi-trash-can-outline")]),e._v("\n                    Удалить\n                ")],1):e._e()],1)],1)],1)],1)],1)],1)},oi=[],ni=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.editProject,scrollable:"","max-width":"700px"},on:{input:t=>t||e.cancel()}},[t(e.component,{tag:"component",attrs:{component:e.component,addition:e.addition,additionID:e.additionID,project:e.item,open:e.editProject,storeage:e.storeage},on:{"update:component":function(t){e.component=t},"update:addition":function(t){e.addition=t},"update:additionID":function(t){e.additionID=t},"update:addition-i-d":function(t){e.additionID=t},"update:storeage":function(t){e.storeage=t},cancel:e.cancel}})],1)},ri=[],li=s("2b5d"),ci=s("b974"),mi=function(){var e=this,t=e._self._c;return t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("Добавление параметров проекта\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 px-4",staticStyle:{"background-color":"#fbfbfb","min-height":"120px"}},[t(Dt["a"],{attrs:{label:"Название параметра",autocomplete:"off"},model:{value:e.custom_name,callback:function(t){e.custom_name=t},expression:"custom_name"}}),t(ci["a"],{directives:[{name:"show",rawName:"v-show",value:!e.additionID,expression:"!additionID"}],attrs:{items:e.types,"item-text":"name","item-value":"value","persistent-hint":"",label:"Тип"},model:{value:e.custom_type,callback:function(t){e.custom_type=t},expression:"custom_type"}}),e.custom_type&&"string"==e.custom_type?t(Dt["a"],{attrs:{label:"Значение",autocomplete:"off"},model:{value:e.custom_value,callback:function(t){e.custom_value=t},expression:"custom_value"}}):e.custom_type&&"number"==e.custom_type?t(Dt["a"],{attrs:{label:"Значение",autocomplete:"off"},on:{input:function(t){return e.onlyNumber(t)}},model:{value:e.custom_value,callback:function(t){e.custom_value=t},expression:"custom_value"}}):e.custom_type&&"list"==e.custom_type?t(li["a"],{attrs:{filter:e.filter,"hide-no-data":!e.search,items:e.items,"search-input":e.search,autocomplete:"off","hide-selected":"",label:"Список значений",multiple:"","small-chips":""},on:{"update:searchInput":function(t){e.search=t},"update:search-input":function(t){e.search=t}},scopedSlots:e._u([{key:"no-data",fn:function(){return[t($e["a"],[t("span",{staticClass:"subheading"},[e._v("Создайте и нажмите ввод")]),t(Cs["a"],{attrs:{color:e.colors[e.nonce-1]+" lighten-3",label:"",small:""}},[e._v("\n                    "+e._s(e.search)+"\n                    ")])],1)]},proxy:!0},{key:"selection",fn:function({attrs:s,item:a,parent:i,selected:n}){return[a===Object(a)?t(Cs["a"],e._b({attrs:{color:a.color+" lighten-3","input-value":n,label:"",small:""}},"v-chip",s,!1),[t("span",{staticClass:"pr-2"},[e._v("\n                        "+e._s(a.text)+"\n                    ")]),t(o["a"],{attrs:{small:""},on:{click:function(e){return i.selectItem(a)}}},[e._v("close")])],1):e._e()]}},{key:"item",fn:function({index:s,item:a}){return[e.editing===a?t(Dt["a"],{attrs:{autofocus:"",flat:"","background-color":"transparent","hide-details":"",solo:""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.edit(s,a)}},model:{value:e.editing.text,callback:function(t){e.$set(e.editing,"text",t)},expression:"editing.text"}}):t(Cs["a"],{attrs:{color:a.color+" lighten-3",dark:"",label:"",small:""}},[e._v("\n                    "+e._s(a.text)+"\n                ")]),t("div",{staticClass:"flex-grow-1"}),t(ht["a"],{on:{click:function(e){e.stopPropagation()}}},[t(Xe["a"],{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.edit(s,a)}}},[t(o["a"],[e._v(e._s(e.editing!==a?"mdi-pencil":"mdi-check"))])],1)],1)]}}]),model:{value:e.model,callback:function(t){e.model=t},expression:"model"}}):e._e()],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[e.additionID?t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.removeCustom}},[e._v("Удалить")]):e._e(),t(Rt["a"]),e.additionID?e._e():t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:e.checkChange()},on:{click:e.addCustom}},[e._v("Добавить")]),e.additionID?t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:e.checkEditChange()},on:{click:e.addCustom}},[e._v("Изменить")]):e._e(),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)},di=[],pi={props:["addition","additionID"],name:"Custom",data(){return{custom_name:"",custom_value:"",custom_type:null,types:[{value:"string",name:"Текст"},{value:"number",name:"Число"},{value:"list",name:"Список"}],colors:[],editing:null,index:-1,items:[{header:"Выберите или создайте новое"}],nonce:1,menu:!1,model:[],x:0,search:null,y:0}},watch:{model(e,t){e.length!==t.length&&(this.model=e.map(e=>("string"===typeof e&&(e={text:e,color:this.colors[this.nonce-1]},this.items.push(e),this.nonce++),e)))}},methods:{onlyNumber(e){this.$nextTick(()=>{this.custom_value=this.custom_value.replace(/[^0-9]/g,"")})},checkChange(){return"string"==this.custom_type||"number"==this.custom_type?!(this.custom_type&&this.custom_name&&this.custom_value):"list"!=this.custom_type||!(this.custom_type&&this.custom_name&&this.model.length)},checkEditChange(){let e=this.addition.find(e=>e.id==this.additionID);if("string"==this.custom_type||"number"==this.custom_type)return!(this.custom_name!=e.name||this.custom_value!=e.value);if("list"==this.custom_type){if(this.model.length!=e.params.list.length)return!1;for(let t=0,s=this.model.length;t<s;t++)if(this.model[t].text!=e.params.list[t].name)return!1;return!0}return!0},edit(e,t){this.editing?(this.editing=null,this.index=-1):(this.editing=t,this.index=e)},filter(e,t,s){if(e.header)return!1;const a=e=>null!=e?e:"",i=a(s),o=a(t);return i.toString().toLowerCase().indexOf(o.toString().toLowerCase())>-1},removeCustom(){let e=this.addition.filter(e=>e.id!=this.additionID);this.$emit("update:addition",e),this.cancel()},addCustom(){let e={};if("string"==this.custom_type||"number"==this.custom_type)e.name=this.custom_name,e.value=this.custom_value,e.type=this.custom_type;else if("list"==this.custom_type){e.name=this.custom_name,e.type=this.custom_type,e.params={},e.params.value="0",e.params.list=[];for(let t=0,s=this.model.length;t<s;t++)e.params.list.push({name:this.model[t].text,value:""+t})}this.additionID?this.$emit("update:addition",this.addition.map(t=>t.id==this.additionID?{...t,...e,id:this.additionID}:t)):(e.id=""+this.addition.length,this.$emit("update:addition",[...this.addition,{...e,id:"f-"+this.addition.length}])),this.cancel()},editMode(){let e=this.addition.find(e=>e.id==this.additionID);if(this.custom_name=e.name,this.custom_type=e.type,"string"==e.type||"number"==e.type)this.custom_value=e.value;else if("list"==e.type)for(let t=0,s=e.params.list.length;t<s;t++)this.model.push({text:e.params.list[t].name}),this.items.push({text:e.params.list[t].name})},cancel(){this.custom_name="",this.custom_value="",this.custom_type=null,this.model=[],this.items.splice(1),this.$emit("update:component","edit")}},created(){this.additionID&&this.editMode()}},ui=pi,hi=Object(m["a"])(ui,mi,di,!1,null,null,null),fi=hi.exports,vi=s("4bd4"),bi=s("a844"),gi=function(){var e=this,t=e._self._c;return t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n        "+e._s(e.project?"Информация о проекте":"Создание нового проекта")+"\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{ref:"body",staticClass:"pt-5 px-4"},[t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(vi["a"],{ref:"form"},[t(Dt["a"],{attrs:{label:"Название проекта",placeholder:" ",required:"",rules:e.check},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Название проекта\n                            "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}]),model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1)],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Заказчик",placeholder:" "},model:{value:e.client,callback:function(t){e.client=t},expression:"client"}})],1)],1),t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(_s["a"],{attrs:{label:"Ответственный за проект",placeholder:" ",items:e.managers,chips:"","item-text":"name","item-value":"id"},scopedSlots:e._u([{key:"selection",fn:function(s){return[t(Cs["a"],e._b({attrs:{dark:"","input-value":s.selected,close:""},on:{"click:close":function(t){return e.removeChips()}}},"v-chip",s.attrs,!1),[t(ot["a"],{attrs:{left:""}},[t(ze["a"],{attrs:{src:s.item.avatar}})],1),e._v("\n                            "+e._s(s.item.name)+"\n                        ")],1)]}},{key:"item",fn:function(s){return[t(rt["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:s.item.avatar}})]),t(Re["a"],[t(Re["c"],{domProps:{innerHTML:e._s(s.item.name)}}),t(Re["b"],{domProps:{innerHTML:e._s(s.item.role)}})],1)]}}]),model:{value:e.manager,callback:function(t){e.manager=t},expression:"manager"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Номер проекта",placeholder:" ",height:"42"},model:{value:e.number,callback:function(t){e.number=t},expression:"number"}})],1)],1),t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"12",md:"12"}},[t(bi["a"],{attrs:{label:"Описание",placeholder:" ","multi-line":"",rows:"3"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1)],1),t(xs["a"],e._l(e.addition,(function(s,a){return t(ws["a"],{key:a,attrs:{cols:"12",sm:"6",md:"6"}},["string"==s.type?t(Dt["a"],{attrs:{placeholder:" ",label:s.name},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"i.value"}},[t("template",{slot:"append-outer"},[t(o["a"],{on:{click:function(t){return e.editCustom(s.id)}}},[e._v("edit")])],1)],2):"number"==s.type?t(Dt["a"],{attrs:{placeholder:" ",label:s.name},on:{input:function(t){return e.onlyNumber(t,s)}},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"i.value"}},[t("template",{slot:"append-outer"},[t(o["a"],{on:{click:function(t){return e.editCustom(s.id)}}},[e._v("edit")])],1)],2):"list"==s.type?t(_s["a"],{attrs:{items:s.params.list,"item-text":"name","item-value":"value",label:s.name,placeholder:" ",clearable:"","persistent-hint":""},model:{value:s.params.value,callback:function(t){e.$set(s.params,"value",t)},expression:"i.params.value"}},[t("template",{slot:"append-outer"},[t(o["a"],{on:{click:function(t){return e.editCustom(s.id)}}},[e._v("edit")])],1)],2):e._e()],1)})),1)],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.editCustom(null)}}},[e._v("Добавить параметр")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.validate}},[e._v("\n            "+e._s(e.project?"Сохранить":"Создать")+"\n        ")])],1)],1)},yi=[],_i={name:"Edit",props:["component","addition","additionID","project","open","storeage"],data(){return{check:[e=>!!e||"Необходимое поле"],name:"",client:"",manager:null,description:"",number:"",disabledSave:!0,selectCountry:null,selectRegion:null,selectCity:null,menu:!1}},computed:{readySave(){let e=!1,t=this.name||!1;return t&&(e=!0),e},managers(){let e=this.$store.state.administration.company.users||[],t=e.map(e=>({id:e.id,avatar:e.avatarSrc,name:e.first_name+" "+e.last_name,role:""}));return t}},watch:{open(e){this.$refs["body"].scrollTop=0,e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{cancel(){this.disabledSave=!0,this.name="",this.client="",this.manager=null,this.description="",this.number="",this.$emit("cancel")},removeChips(){this.manager=null},saveChange(){let e={name:this.name,description:this.description,number:this.number,client:this.client,in_charge_id:this.manager?this.manager+"":this.manager,addition:this.addition.map(e=>({name:e.name,value:"string"==e.type?e.value:"number"==e.type?parseInt(e.value):{value:e.params.list.find(t=>t.value==e.params.value).name,list:e.params.list.map(e=>e.name)}}))||null},t="c",s=this.$store.state.administration.company.id;if(this.project){let a=this.project.id;this.$store.dispatch("workflow/updateProject",{type_id:t,id:s,uuid:a,body:e}).then(()=>{this.$notify({group:"note",type:"success",text:"Проект "+e.name+" изменен."})})}else{let a=Object(Ut["a"])();this.$store.dispatch("workflow/addProject",{type_id:t,id:s,uuid:a,body:e}).then(()=>{this.$notify({group:"note",type:"success",text:"Создан проект "+e.name})})}this.cancel()},validate(){this.$refs.form.validate()&&this.saveChange()},enter(e){13===e.keyCode&&(e.preventDefault(),this.validate())},onlyNumber(e,t){this.$nextTick(()=>{t.value=t.value.replace(/[^0-9]/g,"")})},editCustom(e){let t=Object.keys(this.$data).filter(e=>"check"!=e),s={};t.map(e=>{s[e]=this[e]}),this.$emit("update:storeage",s),this.$emit("update:component","custom"),this.$emit("update:additionID",e)}},created(){if(this.storeage){let e=Object.keys(this.storeage);e.map(e=>{this[e]=this.storeage[e]})}else if(this.project){let e=JSON.parse(JSON.stringify(this.project));this.name=e.info.name,this.client=e.info.client,this.number=e.info.number,this.description=e.info.description,this.manager=e.info.in_charge_id}}},Ci=_i,wi=Object(m["a"])(Ci,gi,yi,!1,null,null,null),ki=wi.exports,xi={name:"EditProject",components:{Edit:ki,Custom:fi},props:["editProject","item"],data(){return{component:null,addition:[],additionID:null,storeage:null}},watch:{editProject(e){e&&(this.component="edit",this.addition=this.getAddition())}},methods:{decodeHtmlCharCodes(e){return e.replace(/(&#(\d+);)/g,(e,t,s)=>String.fromCharCode(s))},getAddition(){let e=this.item&&this.item.info.addition||[],t=[];return e.map((e,s)=>{"object"===typeof e.value&&e.value.list?t.push({id:"f-"+s,name:e.name,type:"list",params:{value:e.value.list.indexOf(e.value.value).toString(),list:e.value.list.map((e,t)=>({name:e,value:""+t}))}}):t.push({id:"f-"+s,name:e.name,type:"number"==typeof e.value?"number":"string",value:e.value})}),t},cancel(){this.addition=[],this.component=null,this.additionID=null,this.storeage=null,this.$emit("update:editProject",!1)}}},Si=xi,Ai=Object(m["a"])(Si,ni,ri,!1,null,null,null),Ii=Ai.exports,Oi=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.projectDescription,scrollable:"","max-width":"700px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n            Описание проекта\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 px-0"},[t(Ye["a"],{attrs:{dense:""}},[t("t-object"),t("t-declarant",{attrs:{name:"declarant",title:"Кто подает"}}),t("t-declarant",{attrs:{name:"developer",title:"Кто разработал"}}),t("t-technical-customer"),t("t-finances"),t("t-estimated-cost"),t("t-climate-conditions"),t("t-designer"),t("t-engineering-survey")],1)],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:function(e){}}},[e._v("\n                Сохранить\n            ")])],1)],1)],1)},ji=[],Fi=s("56b0"),Pi=function(){var e=this,t=e._self._c;return t(Fi["a"],{attrs:{"no-action":""},scopedSlots:e._u([{key:"activator",fn:function(){return[t(Re["a"],[t(Re["c"],{domProps:{textContent:e._s(e.item.title)}})],1)]},proxy:!0}]),model:{value:e.item.active,callback:function(t){e.$set(e.item,"active",t)},expression:"item.active"}},[t(nt["a"]),t($e["a"],{staticClass:"px-1"},[t(Re["a"],e._l(e.item.items,(function(e){return t(e.component,{tag:"component",attrs:{item:e},on:{"update:item":function(t){e=t}}})})),1)],1),t(nt["a"])],1)},Ei=[],Ui=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"text"==e.item.type?"12":e.size,md:"text"==e.item.type?"12":e.size}},["string"==e.item.type?t(Dt["a"],{attrs:{label:e.item.title,placeholder:" ",required:e.item.required,rules:e.item.rules},on:{change:e.onChange},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}}):"list"==e.item.type?t(_s["a"],{attrs:{label:e.item.title,placeholder:" ",items:e.item.list},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}}):"select"==e.item.type?t(ci["a"],{attrs:{label:e.item.title,placeholder:" ",items:e.item.list,multiple:e.item.multiple},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}}):"text"==e.item.type?t(bi["a"],{attrs:{label:e.item.title,placeholder:" ","multi-line":"",rows:"1"},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}}):e._e()],1)},Bi=[],Ti={name:"Fields",props:["item","size"],data(){return{}},methods:{onChange(e){this.$emit("onChange")}}},Li=Ti,Ni=Object(m["a"])(Li,Ui,Bi,!1,null,null,null),Hi=Ni.exports,Mi=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Re["c"],{attrs:{slot:"combo"},domProps:{textContent:e._s(e.item.title)},slot:"combo"}),t("div",{staticClass:"d-flex flex-wrap"},e._l(e.items,(function(s){return t("fields",{attrs:{item:s,size:"6"},on:{onChange:e.onChange,"update:item":function(e){s=e}}})})),1),e.item.multiple?t(Xe["a"],{staticClass:"m-btn mb-3",attrs:{outlined:"",color:"primary"},on:{click:e.add}},[e._v("\n        Добавить адрес\n    ")]):e._e()],1)},zi=[],$i={name:"TAddress",props:["item"],components:{Fields:Hi},data(){return{items:[{name:"сountry",title:"Страна",type:"string",value:"",number:0},{name:"region",title:"Регион",type:"string",value:"",number:0},{name:"post_index",title:"Почтовый индекс",type:"string",value:"",number:0},{name:"district",title:"Район",type:"string",value:"",number:0},{name:"city",title:"Город",type:"string",value:"",number:0},{name:"settlement",title:"Населенный пункт",type:"string",value:"",number:0},{name:"street",title:"Улица",type:"string",value:"",number:0},{name:"building",title:"Дом",type:"string",value:"",number:0},{name:"room",title:"Квартира",type:"string",value:"",number:0},{name:"note",title:"замечания по адресу",type:"text",value:"",number:0}]}},methods:{add(){let e=JSON.parse(JSON.stringify(this.items.filter(e=>0==e.number)));this.items=[...this.items,...e.map((e,t,s)=>({...e,number:this.item.length/s.length,value:""}))]},onChange(){this.item.value=this.items}},created(){this.onChange()}},Ri=$i,Di=Object(m["a"])(Ri,Mi,zi,!1,null,null,null),Ji=Di.exports,Vi=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Re["c"],{attrs:{slot:"combo"},domProps:{textContent:e._s(e.item.title)},slot:"combo"}),e._l(e.items,(function(e){return t("fields",{attrs:{item:e},on:{"update:item":function(t){e=t}}})})),e.item.multiple?t(Xe["a"],{staticClass:"m-btn mb-3",attrs:{outlined:"",color:"primary"},on:{click:e.add}},[e._v("\n        Добавить показатель\n    ")]):e._e()],2)},Ki=[],Gi={name:"TTei",props:["item"],components:{Fields:Hi},data(){return{items:[{name:"name",title:"Название",type:"string",value:"",number:0},{name:"measure",title:"Единица измерения показателя",type:"string",value:"",number:0},{name:"value",title:"Значение",type:"string",value:"",number:0}]}},methods:{add(){let e=JSON.parse(JSON.stringify(this.items.filter(e=>0==e.number)));this.items=[...this.items,...e.map((e,t,s)=>({...e,number:this.item.length/s.length,value:""}))]}}},Qi=Gi,Xi=Object(m["a"])(Qi,Vi,Ki,!1,null,null,null),Wi=Xi.exports,Yi=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[e._l(e.numberList,(function(s){return["string"==s.type?t(Dt["a"],{attrs:{label:s.title,placeholder:" "},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"item.value"}}):e._e()]})),e.item.multiple?t(Xe["a"],{staticClass:"m-btn mb-3",attrs:{outlined:"",color:"primary"},on:{click:e.add}},[e._v("\n        Добавить кадастровый номер\n    ")]):e._e()],2)},qi=[],Zi={name:"TCadastralNumber",props:["item"],data(){return{numberList:[{...this.item,number:0}]}},methods:{add(){let e=JSON.parse(JSON.stringify(this.numberList.filter(e=>0==e.number)));this.numberList=[...this.numberList,...e.map((e,t,s)=>({...e,number:this.numberList.length/s.length,value:""}))]}}},eo=Zi,to=Object(m["a"])(eo,Yi,qi,!1,null,null,null),so=to.exports,ao=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Re["c"],{attrs:{slot:"combo"},domProps:{textContent:e._s(e.item.title)},slot:"combo"}),e._l(e.items,(function(e){return t(e.component,{tag:"component",attrs:{item:e},on:{"update:item":function(t){e=t}}})})),e.item.multiple?t(Xe["a"],{staticClass:"m-btn mb-3",attrs:{outlined:"",color:"primary"},on:{click:e.add}},[e._v("\n        Добавить описание объекта\n    ")]):e._e()],2)},io=[],oo={name:"TObjectPart",props:["item"],components:{Fields:Hi,TAddress:Ji,TTei:Wi},data(){return{items:[{name:"name",title:"Наименование объекта",type:"string",component:"Fields",value:"",number:0},{name:"addresses",title:"Адреса объекта строительства",type:"combo",component:"TAddress",value:"",multiple:!0,number:0},{name:"functions",title:"Функциональное назначение (или код классификатора)",type:"string",component:"Fields",value:"",number:0},{name:"teis",title:"Технико-экономические показатели объекта капитального строительства",type:"combo",component:"TTei",value:"",multiple:!0,number:0}]}},methods:{add(){let e=JSON.parse(JSON.stringify(this.items.filter(e=>0==e.number)));this.items=[...this.items,...e.map((e,t,s)=>({...e,number:this.item.length/s.length,value:""}))]}}},no=oo,ro=Object(m["a"])(no,ao,io,!1,null,null,null),lo=ro.exports,co={name:"TObject",props:["items"],components:{Fields:Hi,TAddress:Ji,TTei:Wi,TCadastralNumber:so,TObjectPart:lo},data(){return{item:{name:"object",title:"Описание объекта строительства",active:!1,items:[{name:"name",title:"Наименования объекта строительства",type:"string",component:"Fields",value:""},{name:"addresses",title:"Адреса объекта строительства",type:"combo",component:"TAddress",value:"",multiple:!0},{name:"type",title:"Тип объекта",type:"list",component:"Fields",value:"0",list:["Объект производственного назначения","Объект непроизводственного назначения","Линейный объект"]},{name:"functions",title:"Функциональное назначение (или код классификатора)",type:"string",component:"Fields",value:""},{name:"teis",title:"Технико-экономические показатели объекта капитального строительства",type:"combo",component:"TTei",value:"",multiple:!0},{name:"cadastral_numbers",title:"Кадастровые номера земельных участков",type:"string",component:"TCadastralNumber",value:"",multiple:!0},{name:"parts",title:"Описание частей объекта строительства",type:"combo",component:"TObjectPart",value:"",multiple:!0}]}}}},mo=co,po=Object(m["a"])(mo,Pi,Ei,!1,null,null,null),uo=po.exports,ho=function(){var e=this,t=e._self._c;return t(Fi["a"],{attrs:{"no-action":""},scopedSlots:e._u([{key:"activator",fn:function(){return[t(Re["a"],[t(Re["c"],{domProps:{textContent:e._s(e.item.title)}})],1)]},proxy:!0}]),model:{value:e.item.active,callback:function(t){e.$set(e.item,"active",t)},expression:"item.active"}},[t(nt["a"]),t($e["a"],{staticClass:"px-1"},[t(Re["a"],[t("t-declarant-item")],1)],1),t(nt["a"])],1)},fo=[],vo=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(_s["a"],{attrs:{label:e.item.title,placeholder:" ",items:e.item.items,"return-object":"","item-text":"title","item-value":"name"},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}),t(e.selected.component,{tag:"component",attrs:{item:e.selected},on:{"update:item":function(t){e.selected=t}}})],1)},bo=[],go=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Re["c"],{attrs:{slot:"combo"},domProps:{textContent:e._s(e.item.title)},slot:"combo"}),e._l(e.items,(function(e){return t("fields",{attrs:{item:e},on:{"update:item":function(t){e=t}}})}))],2)},yo=[],_o={name:"TOrganization",props:["item"],components:{Fields:Hi,TAddress:Ji},data(){return{items:[{name:"name",title:"Полное наименование юридического лица",type:"string",value:""},{name:"ogrn",title:"Основной государственный регистрационный номер юридического лица",type:"string",value:""},{name:"inn",title:"Индивидуальный номер налогоплательщика - юридического лица",type:"string",value:""},{name:"kpp",title:"Код причины постановки на учет юридического лица",type:"string",value:""},{name:"addresses",title:"Адрес (местонахождение) юридического лица",type:"combo",component:"TAddress",value:""},{name:"email",title:"Адрес электронной почты юридического лица",type:"string",value:"",required:!0,rules:[e=>/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(e)||"Неверный email"]}]}},methods:{}},Co=_o,wo=Object(m["a"])(Co,go,yo,!1,null,null,null),ko=wo.exports,xo=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Re["c"],{attrs:{slot:"combo"},domProps:{textContent:e._s(e.item.title)},slot:"combo"}),e._l(e.items,(function(e){return t("fields",{attrs:{item:e},on:{"update:item":function(t){e=t}}})}))],2)},So=[],Ao={name:"TForeignOrganization",props:["item"],components:{Fields:Hi,TAddress:Ji},data(){return{items:[{name:"name",title:"Полное наименование юридического лица",type:"string",value:""},{name:"inn",title:"Индивидуальный номер налогоплательщика - юридического лица",type:"string",value:""},{name:"kpp",title:"Код причины постановки на учет юридического лица",type:"string",value:""},{name:"addresses",title:"Адрес (местонахождение) юридического лица",type:"combo",component:"TAddress",value:""},{name:"email",title:"Адрес электронной почты юридического лица",type:"string",value:"",required:!0,emailRules:[e=>/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(e)||"Неверный email"]}]}},methods:{}},Io=Ao,Oo=Object(m["a"])(Io,xo,So,!1,null,null,null),jo=Oo.exports,Fo=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Re["c"],{attrs:{slot:"combo"},domProps:{textContent:e._s(e.item.title)},slot:"combo"}),e._l(e.items,(function(e){return t("fields",{attrs:{item:e},on:{"update:item":function(t){e=t}}})}))],2)},Po=[],Eo={name:"TIP",props:["item"],components:{Fields:Hi,TAddress:Ji},data(){return{items:[{name:"last_name",title:"Фамилия",type:"string",value:""},{name:"first_name",title:"Имя",type:"string",value:""},{name:"second_name",title:"Отчество",type:"string",value:""},{name:"ogrn",title:"Основной государственный регистрационный номер юридического лица",type:"string",value:""},{name:"addresses",title:"Адрес (местонахождение) юридического лица",type:"combo",component:"TAddress",value:""},{name:"email",title:"Адрес электронной почты юридического лица",type:"string",value:"",required:!0,rules:[e=>/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(e)||"Неверный email"]}]}},methods:{}},Uo=Eo,Bo=Object(m["a"])(Uo,Fo,Po,!1,null,null,null),To=Bo.exports,Lo=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Re["c"],{attrs:{slot:"combo"},domProps:{textContent:e._s(e.item.title)},slot:"combo"}),e._l(e.items,(function(e){return t("fields",{attrs:{item:e},on:{"update:item":function(t){e=t}}})}))],2)},No=[],Ho={name:"TPerson",props:["item"],components:{Fields:Hi,TAddress:Ji},data(){return{items:[{name:"last_name",title:"Фамилия",type:"string",value:""},{name:"first_name",title:"Имя",type:"string",value:""},{name:"second_name",title:"Отчество",type:"string",value:""},{name:"snils",title:"СНИЛС",type:"string",value:"",required:!0,rules:[e=>/[0-9]{3}-[0-9]{3}-[0-9]{3} [0-9]{2}/.test(e)||"Неверный номер"]},{name:"addresses",title:"Адрес (местонахождение) юридического лица",type:"combo",component:"TAddress",value:""},{name:"email",title:"Адрес электронной почты юридического лица",type:"string",value:"",required:!0,rules:[e=>/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(e)||"Неверный email"]}]}},methods:{}},Mo=Ho,zo=Object(m["a"])(Mo,Lo,No,!1,null,null,null),$o=zo.exports,Ro={name:"TDeclarantItem",components:{TOrganization:ko,TForeignOrganization:jo,TIP:To,TPerson:$o},data(){return{selected:"",item:{title:"Тип определяющий лицо, участвующее в процессе подготовки документации, РИИ И ПД и подачи на экспертизу",active:!1,items:[{name:"organization",title:"Юридическое лицо",type:"combo",component:"TOrganization",value:""},{name:"foreign_organization",title:"Иностранное юридическое лицо (филиал, представительство)",type:"combo",component:"TForeignOrganization",value:""},{name:"ip",title:"Индивидуальный предприниматель",type:"combo",component:"TIP",value:""},{name:"person",title:"Физическое лицо",type:"combo",component:"TPerson",value:""}]}}}},Do=Ro,Jo=Object(m["a"])(Do,vo,bo,!1,null,null,null),Vo=Jo.exports,Ko={name:"TDeclarant",components:{TDeclarantItem:Vo},props:["name","title"],data(){return{selected:"",item:{name:this.name||"declarant",title:this.title||"Кто подает",active:!1,value:"",items:[{number:1,params:{}}]}}}},Go=Ko,Qo=Object(m["a"])(Go,ho,fo,!1,null,null,null),Xo=Qo.exports,Wo=function(){var e=this,t=e._self._c;return t(Fi["a"],{attrs:{"no-action":""},scopedSlots:e._u([{key:"activator",fn:function(){return[t(Re["a"],[t(Re["c"],{domProps:{textContent:e._s(e.item.title)}})],1)]},proxy:!0}]),model:{value:e.item.active,callback:function(t){e.$set(e.item,"active",t)},expression:"item.active"}},[t(nt["a"]),t($e["a"],{staticClass:"px-1"},[t(Re["a"],[t("t-technical-customer-item")],1)],1),t(nt["a"])],1)},Yo=[],qo=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(_s["a"],{attrs:{label:e.item.title,placeholder:" ",items:e.item.items,"return-object":"","item-text":"title","item-value":"name"},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}),t(e.selected.component,{tag:"component",attrs:{item:e.selected},on:{"update:item":function(t){e.selected=t}}})],1)},Zo=[],en={name:"TTechnicalCustomerItem",components:{TOrganization:ko,TForeignOrganization:jo},data(){return{selected:"",item:{name:"customer",title:"Технический заказчик",active:!1,items:[{name:"organization",title:"Юридическое лицо",type:"combo",component:"TOrganization",value:""},{name:"foreign_organization",title:"Иностранное юридическое лицо (филиал, представительство)",type:"combo",component:"TForeignOrganization",value:""}]}}}},tn=en,sn=Object(m["a"])(tn,qo,Zo,!1,null,null,null),an=sn.exports,on={name:"TDeclarant",components:{TTechnicalCustomerItem:an},data(){return{selected:"",item:{name:"customer",title:"Кто заказал",active:!1,value:"",items:[{number:1,params:{}}]}}}},nn=on,rn=Object(m["a"])(nn,Wo,Yo,!1,null,null,null),ln=rn.exports,cn=function(){var e=this,t=e._self._c;return t(Fi["a"],{attrs:{"no-action":""},scopedSlots:e._u([{key:"activator",fn:function(){return[t(Re["a"],[t(Re["c"],{domProps:{textContent:e._s(e.item.title)}})],1)]},proxy:!0}]),model:{value:e.item.active,callback:function(t){e.$set(e.item,"active",t)},expression:"item.active"}},[t(nt["a"]),t($e["a"],{staticClass:"px-1"},[t(Re["a"],e._l(e.item.items,(function(e){return t(e.component,{tag:"component",attrs:{item:e},on:{"update:item":function(t){e=t}}})})),1)],1),t(nt["a"])],1)},mn=[],dn=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Re["c"],{attrs:{slot:"combo"},domProps:{textContent:e._s(e.item.title)},slot:"combo"}),e._l(e.items,(function(e){return t("fields",{attrs:{item:e},on:{"update:item":function(t){e=t}}})})),e.item.multiple?t(Xe["a"],{staticClass:"m-btn mb-3",attrs:{outlined:"",color:"primary"},on:{click:e.add}},[e._v("\n        Добавить источник\n    ")]):e._e()],2)},pn=[],un={name:"TFinance",props:["item"],components:{Fields:Hi,TTechnicalCustomer:ln},data(){return{items:[{name:"finance_type",title:"Вид источника финансирования",type:"select",list:[1,2,3],value:"",number:0},{name:"budget_type",title:"Уровень бюджета (в случае бюджетного финансирования)",type:"select",list:[1,2,3,4,5],value:"",number:0},{name:"size",title:"Размер финансирования (в % от общей суммы)",type:"string",value:"",number:0},{name:"owner",title:"Сведения о юридическом лице – источнике финансирование",type:"combo",component:"TTechnicalCustomer",value:"",number:0},{name:"commentary",title:"Замечания по источнику",type:"text",value:"",number:0}]}},methods:{add(){let e=JSON.parse(JSON.stringify(this.items.filter(e=>0==e.number)));this.items=[...this.items,...e.map((e,t,s)=>({...e,number:this.item.length/s.length,value:""}))]}}},hn=un,fn=Object(m["a"])(hn,dn,pn,!1,null,null,null),vn=fn.exports,bn={name:"TFinances",components:{Fields:Hi,TFinance:vn},props:["name"],data(){return{item:{name:"finances",title:"Описание источников финансирования",active:!1,items:[{name:"sources",title:"Источник финансирования",type:"combo",component:"TFinance",value:"",multiple:!0},{name:"commentary",title:"Замечания по источникам финансирования",type:"text",value:""}]}}}},gn=bn,yn=Object(m["a"])(gn,cn,mn,!1,null,null,null),_n=yn.exports,Cn=function(){var e=this,t=e._self._c;return t(Fi["a"],{attrs:{"no-action":""},scopedSlots:e._u([{key:"activator",fn:function(){return[t(Re["a"],[t(Re["c"],{domProps:{textContent:e._s(e.item.title)}})],1)]},proxy:!0}]),model:{value:e.item.active,callback:function(t){e.$set(e.item,"active",t)},expression:"item.active"}},[t(nt["a"]),t($e["a"],{staticClass:"px-1"},[t(Re["a"],[t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(_s["a"],{attrs:{label:e.item.title,placeholder:" ",items:e.item.items,"return-object":"","item-text":"title","item-value":"name"},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}),t(e.selected.component,{tag:"component",attrs:{item:e.selected},on:{"update:item":function(t){e.selected=t}}})],1)],1)],1),t(nt["a"])],1)},wn=[],kn=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Re["c"],{attrs:{slot:"combo"},domProps:{textContent:e._s(e.item.title)},slot:"combo"}),e._l(e.items,(function(e){return t("fields",{attrs:{item:e},on:{"update:item":function(t){e=t}}})}))],2)},xn=[],Sn={name:"TComplexEstimatedCost",props:["item"],components:{Fields:Hi},data(){return{items:[{name:"cost_basic",title:"Сметная стоимость в базисном уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"works_cost_basic",title:"Сметная стоимость строительно-монтажных работ в базисном уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"hardware_cost_basic",title:"Сметная стоимость оборудования в базисном уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"other_cost_basic",title:"Сметная стоимость прочих затрат в базисном уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"project_works_cost_basic",title:"Сметная стоимость проектно-изыскательских работ в базисном уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"back_sum_cost_basic",title:"Возвратные суммы в базисном уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"cost",title:"Сметная стоимость в текущем уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"works_cost",title:"Сметная стоимость строительно-монтажных работ в текущем уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"hardware_cost",title:"Сметная стоимость оборудования в текущем уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"other_cost",title:"Сметная стоимость прочих затрат в текущем уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"project_works_cost",title:"Сметная стоимость проектно-изыскательских работ в текущем уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"nds_cost",title:"Сумма налога на добавленную стоимость (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"back_sum_cost",title:"Возвратные суммы в текущем уровне цен (в тысячах рублей)",type:"string",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"cost_basic_comment",title:"Комментарий к сметной стоимости в базисном уровне цен",type:"text",value:""},{name:"cost_comment",title:"Комментарий к сметной стоимости в текущем уровне цен",type:"text",value:""}]}},methods:{}},An=Sn,In=Object(m["a"])(An,kn,xn,!1,null,null,null),On=In.exports,jn={name:"TEstimatedCost",components:{Fields:Hi,TComplexEstimatedCost:On},data(){return{selected:"",item:{name:"cost",title:"Сведения о сметной стоимости",active:!1,items:[{name:"sum",title:"Описание сумм при указании сметной стоимости",type:"string",component:"Fields",value:"",required:!0,rules:[e=>/(Не требуется)|(Отсутствует)|(-{0,1}\d*\.{0,1}\d*)/.test(e)||"Неверный ввод"]},{name:"detail",title:"Сметная стоимость (расшифровка по составляющим)",type:"combo",component:"TComplexEstimatedCost",value:""}]}}}},Fn=jn,Pn=Object(m["a"])(Fn,Cn,wn,!1,null,null,null),En=Pn.exports,Un=function(){var e=this,t=e._self._c;return t(Fi["a"],{attrs:{"no-action":""},scopedSlots:e._u([{key:"activator",fn:function(){return[t(Re["a"],[t(Re["c"],{domProps:{textContent:e._s(e.item.title)}})],1)]},proxy:!0}]),model:{value:e.item.active,callback:function(t){e.$set(e.item,"active",t)},expression:"item.active"}},[t(nt["a"]),t($e["a"],{staticClass:"px-1"},[t(Re["a"],e._l(e.item.items,(function(e){return t(e.component,{tag:"component",attrs:{item:e},on:{"update:item":function(t){e=t}}})})),1)],1),t(nt["a"])],1)},Bn=[],Tn={name:"TClimateConditions",props:["items"],components:{Fields:Hi},data(){return{item:{name:"climate_conditions",title:"Климатические условия",active:!1,items:[{name:"climate_district",title:"Климатический район, подрайон",type:"select",component:"Fields",list:["I","IА","IБ","IВ","IГ","IД","II","IIА","IIБ","IIВ","IIГ","III","IIIА","IIIБ","IIIВ","IV","IVА","IVБ","IVВ","IVГ"],multiple:!0,value:""},{name:"geological_conditions",title:"Категория сложности инженерно-геологических(геокриологических) условий",type:"select",component:"Fields",list:["I","II","III"],multiple:!0,value:""},{name:"wind_district",title:"Ветровой район",type:"select",component:"Fields",list:["Iа","I","II","III","IV","V","VI","VII"],multiple:!0,value:""},{name:"snow_district",title:"Снеговой район",type:"select",component:"Fields",list:["I","II","III","IV","V","VI","VII","VIII"],multiple:!0,value:""},{name:"seismic_activity",title:"Интенсивность сейсмических воздействий",type:"select",component:"Fields",list:[5,6,7,8,9,10],multiple:!0,value:""},{name:"climate_conditions_note",title:"Дополнительные сведения о природных и техногенных условиях территории, на которой планируется осуществлять строительство, реконструкцию, капитальный ремонт объекта капитального строительства",type:"text",component:"Fields",value:""}]}}}},Ln=Tn,Nn=Object(m["a"])(Ln,Un,Bn,!1,null,null,null),Hn=Nn.exports,Mn=function(){var e=this,t=e._self._c;return t(Fi["a"],{attrs:{"no-action":""},scopedSlots:e._u([{key:"activator",fn:function(){return[t(Re["a"],[t(Re["c"],{domProps:{textContent:e._s(e.item.title)}})],1)]},proxy:!0}]),model:{value:e.item.active,callback:function(t){e.$set(e.item,"active",t)},expression:"item.active"}},[t(nt["a"]),t($e["a"],{staticClass:"px-1"},[t(Re["a"],[e._l(e.item.items,(function(e){return t("t-designer-item",{attrs:{params:e}})})),t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Xe["a"],{staticClass:"m-btn mb-3",attrs:{outlined:"",color:"primary"},on:{click:e.add}},[e._v("\n                    Добавить\n                ")])],1)],2)],1),t(nt["a"])],1)},zn=[],$n=function(){var e=this,t=e._self._c;return t("div",[t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(_s["a"],{attrs:{label:e.item.title,placeholder:" ",items:e.item.items,"return-object":"","item-text":"title","item-value":"name"},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}),t(e.selected.component,{tag:"component",attrs:{item:e.selected},on:{"update:item":function(t){e.selected=t}}})],1),t("fields",{attrs:{item:e.general,size:"5"},on:{"update:item":function(t){e.general=t}}})],1)},Rn=[],Dn={name:"TDesignerItem",components:{Fields:Hi,TOrganization:ko,TForeignOrganization:jo,TIP:To},props:["params"],data(){return{selected:"",general:{name:"general",title:"Отметка о роли генерального проектировщика",type:"select",list:["да","нет"],value:""},item:{name:"designers",title:"Сведения о лицах, подготовивших проектную документацию",active:!1,items:[{name:"organization",title:"Юридическое лицо",type:"combo",component:"TOrganization",value:""},{name:"foreign_organization",title:"Иностранное юридическое лицо (филиал, представительство)",type:"combo",component:"TForeignOrganization",value:""},{name:"ip",title:"Индивидуальный предприниматель",type:"combo",component:"TIP",value:""}]}}}},Jn=Dn,Vn=Object(m["a"])(Jn,$n,Rn,!1,null,null,null),Kn=Vn.exports,Gn={name:"TDesigner",components:{TDesignerItem:Kn},data(){return{item:{name:"designers",title:"Сведения о тех, кто принимал участие",active:!1,items:[{number:1,params:{}}]}}},methods:{add(){this.item.items=[...this.item.items,{number:this.item.items.length+1,params:{}}]}}},Qn=Gn,Xn=Object(m["a"])(Qn,Mn,zn,!1,null,null,null),Wn=Xn.exports,Yn=function(){var e=this,t=e._self._c;return t(Fi["a"],{attrs:{"no-action":""},scopedSlots:e._u([{key:"activator",fn:function(){return[t(Re["a"],[t(Re["c"],{domProps:{textContent:e._s(e.item.title)}})],1)]},proxy:!0}]),model:{value:e.item.active,callback:function(t){e.$set(e.item,"active",t)},expression:"item.active"}},[t(nt["a"]),t($e["a"],{staticClass:"px-1"},[t(Re["a"],e._l(e.item.items,(function(e){return t(e.component,{tag:"component",attrs:{item:e},on:{"update:item":function(t){e=t}}})})),1)],1),t(nt["a"])],1)},qn=[],Zn=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pb-0",attrs:{cols:"12",sm:"12",md:"12"}},[t(Re["c"],{attrs:{slot:"combo"},domProps:{textContent:e._s(e.item.title)},slot:"combo"}),t("div",{staticClass:"d-flex flex-wrap"},e._l(e.items,(function(e){return t("fields",{attrs:{item:e,size:"6"},on:{"update:item":function(t){e=t}}})})),1),e.item.multiple?t(Xe["a"],{staticClass:"m-btn mb-3",attrs:{outlined:"",color:"primary"},on:{click:e.add}},[e._v("\n        Добавить адрес\n    ")]):e._e()],1)},er=[],tr={name:"TEngineeringSurveyAddress",props:["item"],components:{Fields:Hi},data(){return{items:[{name:"region",title:"Код субъекта Российской Федерации",type:"string",value:"",number:0},{name:"district",title:"Описание района изысканий (Наименование муниципального района, в случае проведения изысканий на территории Российской Федерации)",type:"text",value:"",number:0}]}},methods:{add(){let e=JSON.parse(JSON.stringify(this.items.filter(e=>0==e.number)));this.items=[...this.items,...e.map((e,t,s)=>({...e,number:this.item.length/s.length,value:""}))]}}},sr=tr,ar=Object(m["a"])(sr,Zn,er,!1,null,null,null),ir=ar.exports,or={name:"TEngineeringSurvey",props:["items"],components:{TEngineeringSurveyAddress:ir,TDeclarantItem:Vo,TTechnicalCustomerItem:an},data(){return{item:{name:"object",title:"Описание объекта строительства",active:!1,items:[{name:"address",title:"Местоположение района (площадки, трассы) проведения инженерных изысканий",type:"combo",component:"TEngineeringSurveyAddress",value:"",multiple:!0},{name:"developer",title:"Застройщик, обеспечивший проведение инженерных изысканий",type:"combo",component:"TDeclarantItem",value:""},{name:"customer",title:"Технический заказчик, обеспечивший проведение инженерных изысканий",type:"combo",component:"TTechnicalCustomerItem",value:""}]}}}},nr=or,rr=Object(m["a"])(nr,Yn,qn,!1,null,null,null),lr=rr.exports,cr={name:"ProjectDescription",components:{TObject:uo,TDeclarant:Xo,TTechnicalCustomer:ln,TFinances:_n,TEstimatedCost:En,TClimateConditions:Hn,TDesigner:Wn,TEngineeringSurvey:lr},props:["projectDescription"],data(){return{project_description:{}}},methods:{cancel(){this.$emit("update:projectDescription",!1)}}},mr=cr,dr=Object(m["a"])(mr,Oi,ji,!1,null,null,null),pr=dr.exports,ur=s("34c3"),hr=function(){var e=this,t=e._self._c;return t(qe["a"],{attrs:{top:"",right:"","offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(o["a"],e._g({staticClass:"m-icon-border",attrs:{text:"",icon:"",size:"20"},on:{mousedown:function(e){e.stopPropagation()}}},s),[e._v("\n            mdi-dots-horizontal\n        ")])]}}])},[t(We["a"],[t(Ye["a"],{attrs:{dense:""}},e._l(e.createMenu,(function(s,a){return t($e["a"],{key:a,on:{click:function(t){return e.action(s)}}},[t(ur["a"],{staticClass:"mr-1"},[t(o["a"],{attrs:{color:"#0070e0",size:"20"}},[e._v(e._s(s.icon))])],1),t(Re["c"],{staticClass:"m-menu-title",domProps:{textContent:e._s(s.title)}})],1)})),1)],1)],1)},fr=[],vr={props:["item","permission"],data:()=>({notes:[{title:"О проекте",value:"about",action:"about",access:7,icon:"trd-info",lic:null},{title:"Эксертиза",value:"struct",action:"struct",access:7,icon:"trd-info",lic:"licStruct"},{title:"Создать XML-схему",value:"createxml",action:"createxml",access:7,icon:"trd-xml",lic:"licCreatexml"},{title:"Удалить",value:"remove",action:"remove",access:1,icon:"trd-trash",lic:null}]}),computed:{createMenu(){return this.notes.filter(e=>U(this.permission,"and",[e.access])&&E(e.lic))}},methods:{action(e){switch(e.action){case"about":this.$emit("onProject",this.item);break;case"struct":this.$emit("onProjectDescription");break;case"createxml":this.$emit("onCreateXml",this.item);break;case"remove":this.$emit("removeProject",this.item);break;default:this.$emit("getProject",this.item)}}}},br=vr,gr=Object(m["a"])(br,hr,fr,!1,null,null,null),yr=gr.exports,_r=s("3a2f"),Cr=s("eb2a"),wr=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.create_xml,scrollable:"","max-width":"700px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n            Создать xml файл проекта\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"px-4",staticStyle:{"background-color":"#fbfbfb"}},[t("div",{staticClass:"py-4"},[e._v("Структура проектной документации")]),t("div",{staticClass:"m-custom--card"},[t("div",{staticClass:"m-custom--list__item"},[e._v("\n                    "+e._s(e.getProjectName)+"\n                ")]),t(nt["a"]),t(Cr["a"],{attrs:{dense:"",selectable:"",hoverable:"",transition:"","item-key":"id","selected-color":"primary","expand-icon":"mdi-chevron-down","return-object":"",items:e.getItems},scopedSlots:e._u([{key:"label",fn:function({item:s}){return[t("div",{staticClass:"v-treeview-node__label"},[e._v("\n                            "+e._s(s.name)+"\n\n                            "),-1===s.error?t(_r["a"],{attrs:{top:"",right:"",color:"#fff","max-width":"250px","content-class":"m-tooltip--info"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(o["a"],e._g({staticClass:"mr-1 m-info--file",attrs:{size:"20",color:"#ff0000"}},s),[e._v("mdi-alert-outline\n                                    ")])]}},{key:"default",fn:function(){return[t("span",{},[e._v("Согласно Постановлению Правительства № 1431 от 15 сентября 2020 года, трехмерная Информационная Модель проекта должна быть предоставлена в xml-схеме. Для это нужно конвертировать исходный файл Информационная Модель.")])]},proxy:!0}],null,!0)}):e._e()],1)]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)]),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.cancel.apply(null,arguments)}}},[e._v("Отмена")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.sendXml}},[e._v("Создать\n            ")])],1)],1)],1)},kr=[],xr={name:"CreateXml",props:["create_xml","item"],data(){return{getProjectName:"",selected:[],items:[],extensions:["rvt","ifc","pdf"]}},computed:{getItems(){const e=t=>t.map(t=>("file"==t.type?t.tags&&t.tags.hasOwnProperty("ifcxml.zip")&&(t.error=t.tags["ifcxml.zip"]):t.children=e(t.children),t)).filter(e=>2!=e.sts);let t=e(this.items);return t}},watch:{create_xml(e){e?(document.addEventListener("keyup",this.enter,!1),this.getProjectName=this.item.info.name,this.setItems(this.item)):(document.removeEventListener("keyup",this.enter,!1),this.items=[],this.getProjectName="")}},methods:{cancel(){this.$emit("update:create_xml",!1)},setItems(e){Promise.all([this.$store.commit("workflow/setActiveProject",e),this.$store.dispatch("workflow/getFolders")]).then(()=>{this.items=this.createTree(this.$store.state.workflow.folders)})},createTree(e,t=[]){let s=[];return e&&e.map(e=>{s.push({...e,sts:1,tags:null,type:"folder",error:null,children:[...this.createTree(e.folders,[...t,e.name]),...this.getFiles(e.files,[...t,e.name])]})}),s},getFiles(e,t){let s=[];return e&&(s=e.map(e=>this.checkFile(e)).filter(e=>null!=e).map(e=>({...e,path:t.join("/")+"/"}))),s},checkFile(e){let t=null,s=e.name.split(".").splice(-1,1)[0]||null;return this.extensions.some(e=>e==s)&&null==e.consolidations&&(t={...e,type:"file",sts:1,tags:null,error:null}),t=this.getTags(t,s),this.selected.push(t),t},getTags(e,t){if("pdf"!=t&&null!=e){e.sts=null;let t=this.$store.state.auth.access_token;e.socket=new WebSocket(f["socket_files"]+C["socket_files"]+e.files[0].url),e.socket.onmessage=t=>{let s=JSON.parse(t.data);this.items=this.transTree(this.items,e,s.sts,s.tags)},e.socket.onopen=function(s){e.socket.send(t)}}return e},transTree(e,t,s,a){return e=e.map(e=>("folder"==e.type?e.children=this.transTree(e.children,t,s,a):e.id==t.id&&(e.sts=s,e.tags=a),e)),e},sendXml(){let e=JSON.parse(JSON.stringify(this.item));this.cancel();let t={project_id:e.id,folders:(()=>{let e={};return this.selected.map(e=>{let t="",s=e.name.split(".").splice(-1,1)[0]||null;return"rvt"==s&&e.tags&&1==e.tags["ifcxml.zip"]&&(t="ifcxml.zip"),{[e.path]:{id:[e.id],tags:t}}}).map(t=>{Object.entries(t).map(([t,s])=>{e[t]=e[t]?{...e[t],[s.id]:s.tags}:{[s.id]:s.tags}})}),e})()},s=Object(Ut["a"])();this.$store.dispatch("common/setUploadNote",[{name:e.info.name,uuid:s,action:"createxml",pushin:!0}]).then(()=>this.$store.dispatch("workflow/createXml",t)).then(e=>new Promise(t=>{const s=setInterval(()=>{this.$store.dispatch("workflow/checkCreateXml",e).then(e=>{0!=e.sts&&(clearInterval(s),t(e))})},5e3)})).then(t=>{this.$store.dispatch("common/setUploadNote",[{uuid:s,pushin:!1},{name:e.info.name+".xml",uuid:s=Object(Ut["a"])(),action:"download",pushin:!0}]),this.$store.dispatch("common/getFile",{id:t.file_id,uuid:s,typeBlob:"blob"}).then(t=>{if(this.$store.dispatch("common/setUploadNote",[{uuid:s,action:"download",pushin:!1}]),t.error)console.log("download xml error",err);else{let s=document.createElement("a"),a=URL.createObjectURL(t.file);s.href=a,s.download=e.info.name+".zip",document.body.appendChild(s),s.click(),URL.revokeObjectURL(a),s.remove()}}).catch(e=>{console.log("downloadFile xml",e)})})},enter(e){13===e.keyCode&&(e.preventDefault(),this.sendXml())}}},Sr=xr,Ar=Object(m["a"])(Sr,wr,kr,!1,null,null,null),Ir=Ar.exports,Or={name:"WorkflowList",components:{EditProject:Ii,ProjectDescription:pr,ActionMenu:yr,CreateXml:Ir},data(){return{search:"",all_row:!1,table_type_list:[{name:"list",icon:"mdi-format-list-bulleted"},{name:"grid",icon:"mdi-view-grid"}],headers:[{text:"Название проекта",value:"name",grid:!1},{text:"Ответственный за проект",value:"manager",grid:!0},{text:"Заказчик",value:"client",grid:!0},{text:"Дата создания",value:"date",align:"left",grid:!0},{text:"Кол. файлов",value:"count_files",grid:!0,align:"center"},{text:"",value:"action",sortable:!1,grid:!1}],projects:[],selected:[],newProject:!1,aboutProject:!1,editProject:!1,itemCurrent:null,type_id:"",company_id:"",create_xml:!1,projectDescription:!1}},computed:{filteredProjects(){const e=this.search.toLowerCase();return this.projectList.filter(t=>t.name.toString().toLowerCase().includes(e))},projectList(){let e=this.$store.state.workflow.projects;return e},cardActionStyle(){let e=0,t=0;if(this.selected.length){let s=this.$refs["wrap"].getBoundingClientRect();e=s.width,t=s.x}return{width:e+"px",left:t+"px"}},getPermission(){let e=this.$store.state.administration.user;return e.permission}},methods:{checklicense(e){return E(e)},getAccess(e,t,s){return U(e,t,s)},getAccessSelected(e,t){return!this.selected.length||!!U(this.getPermission,e,t)},onCreateXml(e){console.log("open create xml"),this.itemCurrent=e,this.create_xml=!0},onProjectDescription(){this.projectDescription=!0},createXml(e){console.log("create xml")},getDate(e){let t={year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return new Date(1e3*parseInt(e)).toLocaleDateString("ru-RU",t)},isSelected(e){let t=this.selected.filter(t=>e==t.id);return!!t.length},addProject(){this.newProject=!0},onProject(e){this.itemCurrent=e||this.getSelectedProject(),this.editProject=!0},getSelectedProject(){if(1==this.selected.length){let e=this.projectList.filter(e=>e.id==this.selected[0].id)[0];return e}return null},getProject:function(e){this.$store.commit("workflow/setActiveGroup",!1),this.$store.commit("workflow/setActiveFolder",!1),this.$router.push("/workflow/"+e.id+"/list")},removeProject:function(e){this.$store.dispatch("workflow/removeProject",{uuid:e.id}).then(()=>{this.$store.dispatch("workflow/getProjects",{type_id:this.type_id,id:this.company_id})}).then(()=>{this.$notify({group:"note",type:"success",text:"Проект "+e.info.name+" удален."})})},removeProjectSelected:function(){let e=this.selected,t=[];e.map(e=>{t.push(this.$store.dispatch("workflow/removeProject",{uuid:e.id}).then(()=>{this.$notify({group:"note",type:"success",text:"Проект "+e.info.name+" удален."})}))}),Promise.all(t).then(()=>{this.$store.dispatch("workflow/getProjects",{type_id:this.type_id,id:this.company_id}),this.selected=[]})},inputFiles(){this.$refs["input-files"].click()},onImportXml(e){let t,s=e.target.files||e.dataTransfer.files;for(let o in s)isNaN(o)||(t=s[o]);let a=new FormData,i=Object(Ut["a"])();a.append("file",t),a.append("name",t.name),a.append("is_attachment",!0),a.append("uuid",i),this.$store.dispatch("common/setUploadNote",[{name:t.name,uuid:i,action:"upload",pushin:!0}]).then(()=>this.$store.dispatch("common/importXml",a)).then(e=>new Promise(t=>{const s=setInterval(()=>{this.$store.dispatch("common/checkImportXml",{task_id:e.TaskID}).then(e=>{1!=e.Status&&(clearInterval(s),t(e))})},2e3)})).then(e=>{console.log(e),this.$store.dispatch("common/setUploadNote",[{uuid:i,action:"upload",pushin:!1}])}).then(()=>{this.$store.dispatch("workflow/getProjects",{type_id:this.type_id,id:this.company_id})})}},created(){this.type_id="c",this.company_id=this.$store.state.administration.company.id,this.$store.dispatch("administration/getGroupPermissions",null).then(()=>{this.$store.dispatch("workflow/getProjects",{type_id:this.type_id,id:this.company_id})})}},jr=Or,Fr=Object(m["a"])(jr,ii,oi,!1,null,null,null),Pr=Fr.exports,Er=function(){var e=this,t=e._self._c;return t(e.getViewer,{tag:"component",attrs:{model:e.model,list:e.list,doc:e.doc,project_id:e.id}})},Ur=[],Br=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container",attrs:{fluid:"","fill-height":"","text-xs-center":"","pa-0":""}},[t(Ee["a"],{ref:"wrap",attrs:{wrap:"","ma-0":""}},[t("div",{ref:"pdf-wrap",staticClass:"m-pdf-wrap",class:{"no-event":e.no_event},style:e.style_pdf},[t("div",{ref:"pdf",staticClass:"m-zoom",class:{"pdf-move":e.mouse_down}},[t("div",{ref:"container",staticClass:"pdf-container",attrs:{id:"viewerContainer"}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.compareMode,expression:"compareMode"}],ref:"compare-wrap",staticClass:"pdf-container pdf-container--twice__wrap",style:{width:e.twice_width+"%"}},[t("span",{directives:[{name:"show",rawName:"v-show",value:e.model.files.length<2,expression:"model.files.length < 2"}],staticClass:"pdf-container--twice__wrap--desc"},[e._v("Нужно как минимум две версии файла. Загрузите еще одну версию.")]),t("div",{ref:"containerTwice",staticClass:"pdf-container pdf-container--twice"})]),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.compareMode,expression:"!compareMode"}],ref:"stack",staticClass:"m-anno-view--stack",class:{novisible:!e.pdfInit}},e._l(e.anno_list,(function(e,s){return t("anno",{key:"stack"+s,attrs:{anno:e}})})),1),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.compareMode,expression:"!compareMode"}],ref:"view",staticClass:"m-anno-view",class:{novisible:!e.pdfInit}},e._l(e.anno_list,(function(e,s){return t("anno",{key:s,attrs:{anno:e}})})),1),t("border-stack",{attrs:{width:e.version.once.pdfWidth,height:e.version.once.pdfHeight}}),t("border-helper",{directives:[{name:"show",rawName:"v-show",value:!e.compareMode,expression:"!compareMode"}]}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.compareMode,expression:"compareMode"}],ref:"dragger",staticClass:"dragger--wrap",style:e.compare_style},[t("div",{ref:"compare-handler",staticClass:"dragger--handler"})])],1)]),t(We["a"],{directives:[{name:"show",rawName:"v-show",value:e.compareMode,expression:"compareMode"}],staticClass:"m-version-pdf m-version-pdf--left"},[t(qe["a"],{attrs:{top:"","close-on-click":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:a}){return[t(zt["c"],e._g(e._b({staticClass:"px-3 py-2"},"v-card-text",a,!1),s),[t($e["a"],{staticClass:"pa-0"},[t("span",[e._v("V"+e._s(e.version.once.value))]),t(Rt["a"]),t(o["a"],{attrs:{right:""}},[e._v("\n                                    mdi-chevron-down\n                                ")])],1)],1)]}}])},[e.getVersionList.length?t(Ye["a"],e._l(e.getVersionList,(function(s,a){return t($e["a"],{key:a,on:{click:function(t){return e.updatePdf(s,"once")}}},[t(Re["c"],[e._v("V"+e._s(s))])],1)})),1):e._e()],1)],1),t(We["a"],{directives:[{name:"show",rawName:"v-show",value:e.compareMode&&0!=e.version.twice.value,expression:"compareMode && version.twice.value != 0"}],staticClass:"m-version-pdf m-version-pdf--right"},[t(qe["a"],{attrs:{top:"","close-on-click":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:a}){return[t(zt["c"],e._g(e._b({staticClass:"px-3 py-2"},"v-card-text",a,!1),s),[t($e["a"],{staticClass:"pa-0"},[t("span",[e._v("V"+e._s(e.version.twice.value))]),t(Rt["a"]),t(o["a"],{attrs:{right:""}},[e._v("\n                                    mdi-chevron-down\n                                ")])],1)],1)]}}])},[e.getVersionList.length?t(Ye["a"],e._l(e.getVersionList,(function(s,a){return t($e["a"],{key:a,on:{click:function(t){return e.updatePdf(s,"twice")}}},[t(Re["c"],[e._v("V"+e._s(s))])],1)})),1):e._e()],1)],1),t("panel-options",{attrs:{options:e.options,params:e.optionParams},on:{setOption:e.setOption,setSubOption:e.setSubOption}})],1),e.getAccess(e.model.access,"and",[3])&&e.checklicense("commentsPDF")&&e.checklicense("tasksPDF")?t("tools",{attrs:{toolsbar:e.toolsbar,compareMode:e.compareMode,project_id:e.project_id,document:e.model,screen:e.screen,blob:e.blob},on:{"update:toolsbar":function(t){e.toolsbar=t},"update:screen":function(t){e.screen=t},getImageData:e.getImageData}}):e._e(),t("iframe",{ref:"pdf-frame",staticStyle:{height:"0",width:"0",border:"0"}})],1)},Tr=[],Lr=function(){var e=this,t=e._self._c;return t(St["a"],{staticClass:"m-navigator-tools m-navigator-no-scroll px-2 pr-0",attrs:{permanent:"",width:e.tools_width,right:"",clipped:"",color:"transparent",app:""}},[t(Ee["a"],{staticClass:"ma-0",attrs:{"fill-height":""}},[t("div",{staticClass:"m-overflow-hidden m-tools-content",class:{"m-tools-content--mini":e.mini}},[t(Ee["a"],{staticClass:"ma-0",attrs:{"fill-height":""}},[t(e.tab,{tag:"component",attrs:{document:e.document,project_id:e.project_id,screen:e.screen,blob:e.blob,task_new:e.task_new},on:{"update:task_new":function(t){e.task_new=t},getImageData:e.getImageData,clearImageData:e.clearImageData,newTask:e.newTask}})],1)],1),t("div",{staticClass:"pl-0 pr-0 text-right m-tools-menu",attrs:{ccols:"2"}},[t($e["a"],{staticClass:"m-nav-right-tools m-nav-right-tools__dil",on:{click:function(t){return t.stopPropagation(),e.expand.apply(null,arguments)}}},[t(o["a"],{attrs:{size:"25",color:"#7f7f7f"}},[e._v(e._s(e.mini?"mdi-chevron-double-left":"mdi-chevron-double-right"))])],1),e._l(e.getTabs,(function(s,a){return t($e["a"],{key:a,staticClass:"m-nav-right-tools",class:{active:s.name==e.tab},on:{click:function(t){return e.setTab(s.name)}}},[t(o["a"],{attrs:{color:e.activeBtn(s.name),size:"25"}},[e._v(e._s(s.icon))])],1)}))],2),e.compareMode?t("div",{staticClass:"m-overhead"},[t("span",[e._v("Недоступно в режиме сравнения.")])]):e._e()])],1)},Nr=[],Hr=s("a293"),Mr=function(){var e=this,t=e._self._c;return t("div",{staticClass:"m-comment-box"},[t("div",{staticClass:"m-comment-list"},[t("div",{ref:"list-items",staticClass:"m-comment-list--items"},e._l(e.commentList,(function(s,a){return t(xs["a"],{key:"comment"+s.id,attrs:{dense:""}},[t(ws["a"],{attrs:{cols:"12"}},[t("comment",{attrs:{comment:s,posActive:e.posActive},on:{"update:posActive":function(t){e.posActive=t},"update:pos-active":function(t){e.posActive=t}}})],1)],1)})),1)]),t("div",{staticClass:"m-comment-header"},[t(xs["a"],{attrs:{dense:""}},[t(ws["a"],{attrs:{cols:"12"}},[t(xs["a"],[t(ws["a"],{attrs:{cols:"6"}},[t(We["a"],{staticClass:"m-comment-header--tools",attrs:{outlined:!0,color:"#fafafa"}},[e._l(e.borderStack,(function(s,a){return t("div",{key:"marker"+s.id,staticClass:"m-comment-marker--item",class:{edit:s.id==e.markerEdit},on:{mouseenter:function(t){return e.markerHover(s)},mouseleave:function(t){return e.markerLeave(s)},click:function(t){return e.removeMarker(s)}}},[t("div",{directives:[{name:"show",rawName:"v-show",value:s.id!=e.markerEdit,expression:"i.id != markerEdit"}],staticClass:"m-comment-marker--value"},[e._v(e._s(s.name))]),t(o["a"],{directives:[{name:"show",rawName:"v-show",value:s.id==e.markerEdit,expression:"i.id == markerEdit"}],attrs:{size:"14",color:"#fff"}},[e._v("close")])],1)})),t("div",{staticClass:"m-comment-marker--add"},[t("div",{staticClass:"m-comment-marker--btn",on:{click:function(t){return t.stopPropagation(),e.addMarker(t)}}},[t(o["a"],{attrs:{size:"14",color:"#fff"}},[e._v("mdi-plus")])],1),t("span",[e._v("Маркер")])])],2)],1),t(ws["a"],{staticClass:"d-flex",attrs:{cols:"6"}},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:e.newTask}},[e._v("\n                            Создать задачу\n                        ")])],1)],1),t(We["a"],{directives:[{def:Hr["a"],name:"click-outside",rawName:"v-click-outside",value:e.focusInputRemove,expression:"focusInputRemove"}],staticClass:"m-comment-input",class:{active:e.focus},attrs:{outlined:!0,color:"#fff"},on:{mouseup:e.focusInput}},[t(aa["a"],{attrs:{"py-0":""}},[t(xs["a"],[t(ws["a"],{staticClass:"pb-0",attrs:{cols:"2"}},[t(ot["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:e.userAvatar.src}})])],1),t(ws["a"],{staticClass:"py-0",attrs:{cols:"10"}},[t(bi["a"],{staticClass:"m-comment-no-border",attrs:{id:"comment",placeholder:"Комментировать","auto-grow":"",outlined:"","hide-details":"","multi-line":"",rows:"2"},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}})],1)],1),t(xs["a"],{directives:[{name:"show",rawName:"v-show",value:e.focus,expression:"focus"}]},[t(ws["a"],{staticClass:"pt-0",attrs:{cols:"2"}}),t(ws["a"],{staticClass:"pt-0",attrs:{cols:"10"}},[t(zt["a"],{staticClass:"pa-0"},[t(Xe["a"],{staticClass:"mt-2 m-btn",attrs:{disabled:!e.comment,outlined:"",dense:"",color:"primary"},on:{click:e.saveComment}},[e._v("\n                                    Опубликовать\n                                    ")]),t(Xe["a"],{staticClass:"mt-2 m-btn m-btn-normal",attrs:{disabled:!e.comment,outlined:"",dense:"",color:"normal"},on:{click:e.clearComment}},[e._v("\n                                    Отмена\n                                    ")])],1)],1)],1)],1)],1)],1)],1)],1)])},zr=[],$r=function(){var e=this,t=e._self._c;return t(We["a"],{directives:[{def:Hr["a"],name:"click-outside",rawName:"v-click-outside",value:e.no_view,expression:"no_view"}],staticClass:"m-comment-card",class:[{active:e.activeComment}],attrs:{outlined:!0,color:"#fafafa"},on:{mouseenter:e.commentHover,mouseleave:e.commentLeave},nativeOn:{click:function(t){return e.view.apply(null,arguments)}}},[t("comment-item",{attrs:{comment:e.comment,viewMode:e.viewMode}}),t(aa["a"],{directives:[{name:"show",rawName:"v-show",value:e.viewMode,expression:"viewMode"}],staticClass:"m-reply-wrap pt-0"},[t(xs["a"],[t(ws["a"],{staticClass:"pb-0",attrs:{cols:"2"}},[t(ot["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:e.getAvatar(),alt:"avatar"}})])],1),t(ws["a"],{staticClass:"pb-0",attrs:{cols:"10"}},[t(bi["a"],{staticClass:"m-comment-avatar pt-0 mt-0",attrs:{placeholder:"Ответить","auto-grow":"","hide-details":"","multi-line":"",rows:"2"},model:{value:e.reply,callback:function(t){e.reply=t},expression:"reply"}})],1)],1),t(xs["a"],[t(ws["a"],{staticClass:"pt-0",attrs:{cols:"2"}}),t(ws["a"],{staticClass:"pt-0",attrs:{cols:"10"}},[t(zt["a"],{staticClass:"pa-0"},[t(Xe["a"],{staticClass:"mt-2 m-btn",attrs:{disabled:!e.reply,outlined:"",dense:"",color:"primary"},on:{click:e.replyComment}},[e._v("\n                    Ответить\n                    ")]),t(Xe["a"],{staticClass:"mt-2 m-btn m-btn-normal",attrs:{disabled:!e.reply,outlined:"",dense:"",color:"normal"},on:{click:e.clearReply}},[e._v("\n                    Отмена\n                    ")])],1)],1)],1)],1)],1)},Rr=[],Dr=s("c28b"),Jr=s.n(Dr),Vr=function(){var e=this,t=e._self._c;return t(aa["a"],{attrs:{"py-0":""}},[t(xs["a"],[t(ws["a"],{staticClass:"pb-0",attrs:{cols:"2"}},[t(ot["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:e.getAvatar(e.comment)}})])],1),t(ws["a"],{staticClass:"pb-0",attrs:{cols:"10"}},[t("div",{staticClass:"m-comment-title"},[e._v(e._s(e.viewMode?e.comment.user:e.comment.title+e.comment.version))]),t("div",{staticClass:"m-comment-subtitle"},[e._v(e._s(e.dateToStr(e.comment.date)))])])],1),t(xs["a"],[t(ws["a"],{staticClass:"pb-0 pt-2",attrs:{cols:"2"}}),t(ws["a"],{staticClass:"pb-0 pt-2",attrs:{cols:"10"}},e._l(e.comment.borders,(function(s,a){return t("div",{key:"marker"+s.id,staticClass:"m-comment-marker--item"},[t("div",{staticClass:"m-comment-marker--value"},[e._v(e._s(s.name))])])})),0)],1),t(xs["a"],[t(ws["a"],{attrs:{cols:"2"}}),t(ws["a"],{attrs:{cols:"10"}},[t("span",{directives:[{name:"show",rawName:"v-show",value:!e.editMode,expression:"!editMode"}],staticClass:"m-comment-text"},[e._v(e._s(e.comment.text))]),t(bi["a"],{directives:[{name:"show",rawName:"v-show",value:e.editMode,expression:"editMode"}],ref:"textarea",staticClass:"m-comment-no-border m-0",attrs:{autofocus:e.editMode,"auto-grow":"",outlined:"","hide-details":"","multi-line":"",rows:"1"},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}})],1)],1),t(xs["a"],{directives:[{name:"show",rawName:"v-show",value:e.user.id==e.comment.uid&&e.viewMode,expression:"user.id == comment.uid ? viewMode : false"}]},[t(ws["a"],{staticClass:"pt-0",attrs:{cols:"2"}}),t(ws["a"],{staticClass:"pt-0",attrs:{cols:"10"}},[t(zt["a"],{directives:[{name:"show",rawName:"v-show",value:!e.editMode,expression:"!editMode"}],staticClass:"pa-0"},[t("div",{staticClass:"m-btn-text",on:{click:e.edit}},[e._v("\n                    Изменить\n                ")]),t("div",{staticClass:"m-btn-text",on:{mouseup:e.removeComment}},[e._v("\n                    Удалить")])]),t(zt["a"],{directives:[{name:"show",rawName:"v-show",value:e.editMode,expression:"editMode"}],staticClass:"pa-0"},[t("div",{staticClass:"m-btn-text",on:{click:e.saveChange}},[e._v("\n                    Сохранить\n                ")]),t("div",{staticClass:"m-btn-text",on:{click:e.cancelChange}},[e._v("\n                    Отмена\n                ")])])],1)],1),e.comment.reply.length&&e.viewMode?t(xs["a"],[t(ws["a"],{staticClass:"py-0",attrs:{cols:"2"}}),t(ws["a"],{staticClass:"pa-0",attrs:{cols:"10"}},e._l(e.comment.reply,(function(s,a){return t("comment-item",{key:a,attrs:{comment:s,viewMode:e.viewMode}})})),1)],1):e._e()],1)},Kr=[],Gr={name:"CommentItem",props:["comment","viewMode"],data(){return{text:"",reply:"",editMode:!1}},computed:{user(){return this.$store.state.administration.user}},methods:{dateToStr(e){let t=new Date(2020,0,1,0,0,0,0);return t=e+t.getTime(),t=new Date(t),t.toLocaleDateString()+" "+t.toLocaleTimeString()},edit(){this.editMode=!0,this.text=this.comment.text},cancelChange(){this.editMode=!1,this.text=""},saveChange(){this.editMode=!1,this.$store.dispatch("comments/message",{id:this.comment.id,pid:this.comment.pid,action:0,text:this.text}),this.text=""},removeComment(){this.$store.dispatch("comments/message",{brds:this.comment.borders.map(e=>e.id),pid:this.comment.pid,id:this.comment.id,action:-1,text:this.comment.text})},getAvatar(e){if(e.avatar)return e.avatar;{let t=this.$store.state.administration.company.users,s=t.filter(t=>t.id==e.uid);if(s.length){if(s[0].avatar)return s[0].avatarSrc;{let e=s[0].first_name?s[0].first_name:s[0].email;return k(e)}}}}}},Qr=Gr,Xr=Object(m["a"])(Qr,Vr,Kr,!1,null,null,null),Wr=Xr.exports,Yr={name:"Comment",props:["comment"],directives:{clickOutside:Jr.a.directive},components:{CommentItem:Wr},data(){return{reply:"",viewMode:!1}},computed:{activeComment(){let e=this.$store.state.comments.activeComment;return e==this.comment.id?this.viewMode=!0:this.viewMode=!1,this.viewMode},user(){return this.$store.state.administration.user}},watch:{viewMode(e){e&&this.$emit("update:posActive",this.$el.offsetTop)}},methods:{view(){this.$store.commit("comments/setActiveComment",this.comment.id)},no_view(){this.viewMode&&(this.$store.commit("comments/setActiveComment",!1),this.viewMode=!1)},replyComment(){this.$store.dispatch("comments/message",{pid:this.comment.id,text:this.reply,borders:[],action:1}),this.reply=""},clearReply(){this.reply=""},commentHover(){this.$store.commit("comments/setDraftHover",this.comment.id)},commentLeave(){this.$store.commit("comments/setDraftHover","")},getAvatar(){let e=this.user.avatar.avatar;if(e)return e;{let e=this.user.first_name?this.user.first_name:this.user.email;return k(e)}}}},qr=Yr,Zr=Object(m["a"])(qr,$r,Rr,!1,null,null,null),el=Zr.exports,tl=s("13a3"),sl=s.n(tl),al={name:"Comments",components:{Comment:el},directives:{ClickOutside:sl.a},props:["document"],data(){return{comment:"",focus:!1,posActive:0}},computed:Object(h["b"])({commentList(e){let t=JSON.parse(JSON.stringify(e.comments.comments)),s=JSON.parse(JSON.stringify(e.comments.borders));return t=t.map(e=>{let t=[];return e.borders.map(e=>{let a=s.filter(t=>t.id==e);t=[...t,...a]}),e.borders=t,e.version=this.document.version?(()=>{let e=this.document.files.filter(e=>e.id==this.document.version);return e?e[0].version:this.document.files[0].version})():this.document.files[0].version,e}),t},borderStack(e){let t=JSON.parse(JSON.stringify(this.$store.state.comments.comments)),s=JSON.parse(JSON.stringify(this.$store.state.comments.borders)),a=[];t.map(e=>{a=[...a,...e.borders]});let i=[];return s.map(e=>{a.some(t=>t==e.id)||(i=[...i,e])}),x(i,"name")},markerEdit(e){return e.comments.borderEdit},userAvatar(e){return e.administration.userAvatar}}),watch:{focus(e){this.focusComment(e)},posActive(e){this.scrollToComment(e)}},methods:{newTask(){this.$emit("newTask")},userCheck(e){return this.$store.state.administration.user.id==e.uid},addMarker(e){this.$store.dispatch("comments/setBorderHelper",{x:e.clientX,y:e.clientY,status:!0})},markerHover(e){this.$store.commit("comments/editBorder",e.id)},markerLeave(e){this.$store.commit("comments/editBorder",!1)},removeMarker(e){this.userCheck(e)&&this.$store.dispatch("comments/removeBorderInStack",e.id)},scrollToComment(e){this.$nextTick(()=>{this.$refs["list-items"].scrollTo({top:e-4,behavior:"smooth"})})},focusComment(e){this.$nextTick(()=>{if(e){let e=document.getElementById("comment");e.focus()}})},saveComment:function(){this.$store.dispatch("comments/message",{pid:0,text:this.comment,borders:this.borderStack.filter(e=>this.userCheck(e)).map(e=>e.id),action:1}),this.comment="",this.focus=!1},clearComment(){this.comment="",this.focus=!1},focusInput(){this.focus=!0},focusInputRemove(){this.focus&&!this.comment&&(this.focus=!1)}},created(){let e=this.$store.state.workflow.commentState;e.status&&(this.comment=e.commentInput,this.$store.commit("workflow/setActiveComment",e.commentActive))},beforeDestroy(){this.$store.dispatch("workflow/saveCommentState",{input:this.comment}),this.$store.commit("workflow/setActiveComment",!1)}},il=al,ol=Object(m["a"])(il,Mr,zr,!1,null,null,null),nl=ol.exports,rl=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pt-0",style:{overflow:"auto"},attrs:{cols:"12"}},[t(xs["a"],{attrs:{dense:""}},e._l(e.getHistoryList,(function(s,a){return t(ws["a"],{key:a,ref:s.id,refInFor:!0,attrs:{cols:"12"}},[t(We["a"],{staticClass:"m-history-card",class:{active:e.active==s.version},attrs:{outlined:!0,color:"#fafafa"},on:{mouseenter:function(t){return e.commentHover(s)},mouseleave:function(t){return e.commentLeave(s)}},nativeOn:{click:function(t){return e.setActive(s,a)}}},[t(aa["a"],{staticClass:"py-0"},[t(xs["a"],[t(ws["a"],{staticClass:"pb-2",attrs:{cols:"12"}},[t("div",{staticClass:"m-history-name"},[e._v(e._s(s.title)+"\n                                "),t(o["a"],{staticClass:"m-history-exp",attrs:{color:e.active==s.version?"#99c6f3":"#7f7f7f",size:"25"},on:{click:function(t){return e.expand(t,s,a)}}},[e._v(e._s(e.active==s.version?"mdi-chevron-up":"mdi-chevron-down"))])],1),t("div",{staticClass:"m-history-time"},[e._v(e._s(e.getDate(s.created)))])])],1)],1),e._l(s.list,(function(a){return t("history-comment",{directives:[{name:"show",rawName:"v-show",value:e.active==s.version,expression:"active == item.version"}],attrs:{comment:a}})}))],2)],1)})),1)],1)},ll=[],cl=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"pt-0"},[t(xs["a"],[t(ws["a"],{staticClass:"pt-1",attrs:{cols:"2"}},[t(ot["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:e.comment.avatar}})])],1),t(ws["a"],{staticClass:"pt-2",attrs:{cols:"10"}},[t("div",{staticClass:"m-comment-title"},[e._v(e._s(e.comment.user)+" ("+e._s(e.getDate(e.comment.date))+")")])])],1),t(xs["a"],[t(ws["a"],{attrs:{cols:"2"}}),t(ws["a"],{staticClass:"pt-0",attrs:{cols:"10"}},[t("span",{staticClass:"m-comment-text"},[e._v(e._s(e.comment.text))])])],1),e.comment.hasOwnProperty("reply")&&e.comment.reply.length?t(xs["a"],[t(ws["a"],{staticClass:"py-0",attrs:{cols:"2"}}),t(ws["a"],{staticClass:"pa-0",attrs:{cols:"10"}},e._l(e.comment.reply,(function(e,s){return t("history-comment",{key:s,attrs:{comment:e}})})),1)],1):e._e()],1)},ml=[],dl={name:"HistoryComment",props:["comment"],data(){return{}},methods:{getDate(e){let t=new Date(e),s=[];return s.push(t.getDate()),s.push(t.getMonth()+1),s.push(t.getFullYear()),s.join(".")}}},pl=dl,ul=Object(m["a"])(pl,cl,ml,!1,null,null,null),hl=ul.exports,fl={name:"HistoryList",components:{HistoryComment:hl},props:["document"],data(){return{active:"",historyList:[]}},computed:{getHistoryList(){let e=this.historyList;return e=e.map(e=>({title:"Документ версии "+e.version,version:e.version,created:e.created,list:this.createMsgs(e.msgs,e.version)})),e}},methods:{getDate(e){let t=new Date(e),s=[];return s.push(t.getDate()),s.push(t.getMonth()+1),s.push(t.getFullYear()),s.join(".")},createMsgs(e,t){let s=this.$store.state.administration;return e=e.map(e=>({id:e.mid,uid:e.uid,pid:e.pid,type:"comment",avatar:s.user.id==e.uid?s.user.avatar.src:"",title:"Документ версии "+t,user:s.user.id==e.uid?s.user.first_name+" "+s.user.last_name:user&&user.first_name?user.first_name+" "+s.user.last_name:user.email,text:e.txt,date:e.tim,borders:e.brds,reply:e.chld.length?this.createMsgs(e.chld,t):[]})),e.reverse()},setActive(e,t){this.active!=e.version&&(this.active=e.version)},getDate(e){e=new Date(e);let t=[];t.push(e.getDate()),t.push(e.getMonth()+1),t.push(e.getFullYear());let s=[];return s.push(e.getHours()),s.push(e.getMinutes()),t.join(".")+" "+s.join(":")},expand(e,t,s){e.stopPropagation(),this.active==t.version?this.active=null:this.setActive(t,s)},commentHover(e){this.$store.commit("workflow/setDraftHover",e.id)},commentLeave(e){this.$store.commit("workflow/setDraftHover","")}},created(){let e=[];this.document.files.map(t=>{e.push(this.$store.dispatch("workflow/getHistory",{did:this.document.id,created:t.created_at,version:t.version}))}),Promise.all(e).then(e=>{this.historyList=e})},beforeDestroy(){}},vl=fl,bl=Object(m["a"])(vl,rl,ll,!1,null,null,null),gl=bl.exports,yl=function(){var e=this,t=e._self._c;return t("div",{staticClass:"m-comment-box"},[t("div",{staticClass:"m-comment-list"},[t("div",{ref:"list-items",staticClass:"m-comment-list--items"},e._l(e.getList,(function(s){return t(xs["a"],{attrs:{dense:""}},[t(ws["a"],{attrs:{cols:"12"}},[t(We["a"],{attrs:{color:"#fff"}},[t("div",{staticClass:"d-flex"},[t(zt["d"],{staticClass:"m-text--size16 m-text--color-4a5568 pb-0"},[e._v("\n                                "+e._s(s.name)+"\n                            ")]),t(Rt["a"]),t(ot["a"],{staticClass:"ma-4 mb-0",attrs:{size:"30"}},[t("img",{attrs:{src:s.avatar}})])],1),t(zt["b"],{staticClass:"pt-1"},[e._v("Название файла")]),t(nt["a"]),t("div",{staticClass:"py-0 px-4"},[t(ze["a"],{attrs:{src:s.src,height:"200px"}})],1),t(nt["a"]),t(zt["a"],{staticClass:"py-3 pr-2 pl-0"},[t("div",[t(zt["b"],{staticClass:"py-0"},[e._v("Создан    "+e._s(s.create_date)+"\n                                ")]),t(zt["b"],{staticClass:"py-0"},[e._v("До\n                                    "+e._s(s.deadline_date)+"\n                                ")])],1),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:function(t){return e.editTask(s)}}},[e._v("\n                            Редактировать\n                            ")])],1)],1)],1)],1)})),1)]),t("div",{staticClass:"m-comment-header"},[t(xs["a"],{attrs:{dense:""}},[t(ws["a"],{attrs:{cols:"12"}},[t(We["a"],{attrs:{outlined:!0,color:"#fff"}},[t(zt["a"],{staticClass:"pa-0"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:function(t){e.task_form=!e.task_form}}},[e._v("\n                        Создать задачу\n                        ")])],1)],1)],1)],1)],1),e.task_form?t("task-create",{attrs:{task_form:e.task_form,screen:e.screen,blob:e.blob,editMode:e.editMode,model:e.document,project_id:e.project_id,task:e.task},on:{"update:task_form":function(t){e.task_form=t},"update:editMode":function(t){e.editMode=t},"update:edit-mode":function(t){e.editMode=t},"update:task":function(t){e.task=t},setTaskNew:e.setTaskNew,getImageData:e.getImageData}}):e._e()],1)},_l=[],Cl=s("2e4b"),wl=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-overhead m-overhead--white d-block pa-4 overflow-auto"},[t(xs["a"],{staticClass:"d-block"},[t("div",{staticClass:"d-flex"},[t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1)]),t(Dt["a"],{attrs:{label:"Название задачи",placeholder:" "},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),t(ci["a"],{attrs:{items:e.statusList,"item-text":"name","item-value":"value","persistent-hint":"",label:"Статус",placeholder:" "},model:{value:e.selectStatus,callback:function(t){e.selectStatus=t},expression:"selectStatus"}}),t(_s["a"],{attrs:{label:"Ответственный за проект",placeholder:" ",items:e.managers,chips:"","item-text":"name","item-value":"id"},scopedSlots:e._u([{key:"selection",fn:function(s){return[t(Cs["a"],e._b({attrs:{dark:"","input-value":s.selected,close:""},on:{"click:close":function(t){return e.removeChips()}}},"v-chip",s.attrs,!1),[t(ot["a"],{attrs:{left:""}},[t(ze["a"],{attrs:{src:s.item.avatar}})],1),e._v("\n                "+e._s(s.item.name)+"\n            ")],1)]}},{key:"item",fn:function(s){return[t(rt["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:s.item.avatar}})]),t(Re["a"],[t(Re["c"],{domProps:{innerHTML:e._s(s.item.name)}}),t(Re["b"],{domProps:{innerHTML:e._s(s.item.role)}})],1)]}}]),model:{value:e.manager,callback:function(t){e.manager=t},expression:"manager"}}),t(qe["a"],{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(Dt["a"],e._g({staticClass:"mb-4",attrs:{label:"Дата выполнения",readonly:"",placeholder:" "},model:{value:e.computedDateFormatted,callback:function(t){e.computedDateFormatted=t},expression:"computedDateFormatted"}},s))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[t(Cl["a"],{ref:"picker",attrs:{landscape:!0,locale:"ru",max:"2050-01-01",min:"1950-01-01"},on:{change:e.save},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1),t("div",{staticClass:"py-4",staticStyle:{position:"relative"}},[t("label",{staticClass:"v-label v-label--active theme--light",staticStyle:{left:"0px",right:"auto",position:"absolute","max-width":"133%","-webkit-transform":"translateY(-18px) scale(0.75)",transform:"translateY(-18px) scale(0.75)","-webkit-transform-origin":"top left","transform-origin":"top left"},attrs:{for:"input-477"}},[e._v("Картинка ошибки")]),t(Xe["a"],{staticClass:"pic",attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.getImageData}},[t(o["a"],{attrs:{size:"20"}},[e._v("mdi-panorama-variant-outline")])],1),e.screen?t(ze["a"],{attrs:{src:e.screen}}):e.editMode?t(ze["a"],{attrs:{src:this.task.src}}):t(ze["a"],{staticClass:"no_image",attrs:{src:e.no_image}})],1),t(bi["a"],{attrs:{label:"Описание",placeholder:" ","multi-line":"",rows:"3"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),t(zt["a"],{staticClass:"pa-0"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"normal"},on:{click:e.cancel}},[e._v("\n        Отмена\n        ")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.sendTask}},[e._v("\n        "+e._s(e.editMode?"Отправить":"Создать")+"\n        ")])],1)],1)},kl=[],xl={name:"TaskCreate",props:["task_form","screen","project_id","blob","model","editMode","task"],data(){return{name:this.editMode?this.task.name:"",selectStatus:this.editMode?this.task.status:null,statusList:[{name:"Новая",value:0},{name:"В работе",value:1},{name:"На рассмотрение",value:2},{name:"Выполненное",value:3}],taskDay:"",date:this.editMode?this.task.deadline.substr(0,10):null,menu:!1,manager:this.editMode?this.task.user:null,no_image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAEMCAYAAADqG+D0AAAAAXNSR0IArs4c6QAAIABJREFUeF7tnXt8Vdd159c+V+hlQBIg9AYBAkmApHuuoKZOnI/juHl8OpmZ+JXUebiO3WnjJJNMbefhTBNPJ5lkXDfOq03itE3SpjPx4GkeM8007jQlTmrjDvfuKxASBglLSAiEQIqQAD2uzp7PZi5TSkC69+g89j77d/6xP2Lvtdf+/tbd66zz2IcRDhAAARAAARBwQYC56IMuIAACIAACIEBIIAgCEAABEAABVwSQQFxhQycQAAEQAAEkEMQACIAACICAKwJIIK6woRMIgAAIgAASCGIABEAABEDAFQEkEFfY0AkEQAAEQAAJBDEAAiAAAiDgigASiCts6AQCIAACIIAEghgAARAAARBwRQAJxBU2dAIBEAABEEACQQyAAAiAAAi4IoAE4gobOoEACIAACCCBIAZAAARAAARcEUACcYUNnUAABEAABJBAEAMgAAIgAAKuCCCBuMKGTiAAAiAAAkggiAEQAAEQAAFXBJBAXGFDJxAAARAAASQQxAAIgAAIgIArAkggrrChEwiAAAiAABIIYgAEQAAEQMAVASQQV9jQCQRAAARAAAkEMQACIAACIOCKABKIK2zoBAIgAAIggASCGAABEAABEHBFAAnEFTZ0AgEQAAEQQAJBDIAACIAACLgigATiChs6gQAIgAAIIIEgBkAABEAABFwRQAJxhQ2dQAAEQAAEopJAmG3bc0KIBcZYoeM4s5ZlFUh5HcfJWJYl/zaHv4EB4gC/hRDXgyIhxBxjLMY5LyQioXsKikoCsWzbniciS3dB4D8IgEDkCTic8xXy/Fb3mSKB6K4g/AcBENCNABKIYoqhAlFMELgDAiBwQwJIIIoFBxKIYoLAHRAAASQQXWIACUQXpeAnCIAAKhDFYgAJRDFB4A4IgAAqEF1iAAlEF6XgJwiAACoQxWIACUQxQeAOCIAAKhBdYgAJRBel4CcIgAAqEMViINcEIsrKykr37dsnX+KZJqLVRDSbnUsREU0R0Sr8DQwQB/gt5LEenCeilbfddtv85OTkRSJa6v06JBBNE0hkhFOMP9wBARAgyvVENjLr0FKZUpegME44XYSBnyBgEAHj1iEkEIOiG1MFARDwlQASiK94/TNunHD+oYRlEAABlwSMW4dQgbiMFHQDARAAgWsIIIFoGhLGCaepTnAbBKJMwLh1CBVIlMMZcwMBEAiSABJIkLQ9HMs44TxkB1MgAALeEDBuHUIF4k3gwAoIgAAIIIFoGgPGCaepTnAbBKJMwLh1CBVIlMMZcwMBEAiSABJIkLQ9HMs44TxkB1MgAALeEDBuHUIF4k3gwAoIgAAIIIFoGgPGCaepTnAbBKJMwLh1CBVIlMMZcwMBEAiSABJIkLQ9HMs44TxkB1MgAALeEDBuHUIF4k3gwAoI+EXA6uzsLE4mkzNE5FwZpKmpqaisrMxJJpPzfg0Mu3kTQALJG5kaHYwTTg3s8MJHApdP7pqamjYvLCzUEVEzEZU5juMwxjJCiCHLsvpjsdhAX1/fBSJa8NEXmM6NgHHrECqQ3AIDrUAgKALyN1mSSCTeJoR4mIgSRCQ/t3ztb1Vk/zYohPjeuXPn/mBoaGiCiC4F5SjG+SUCSCCaBoVxwmmqE9xehEAikbhTCPEFIqolIitbVRQQ0ZVkcXXvK3+T/80QkWw3MT8//3XLsj5z8OBBWZXIQyYe2QaH/wSMW4dQgfgfVBgBBBYlUF5eXt7Y2Ph5xth7iCjmAa6jg4ODD4yPj++/+r6JB3ZhYnECSCCaRohxwmmqE9y+hsDWrVvvWrly5XezFYSnfBhjX0+lUr/jqVEYW4yAcesQKhD8IEAgJAL19fUfqKysfDpbdfj1W3yJc/5mIjof0jRNGhYJRFO1jRNOU53gdpZAVVXVfbW1tX8ZEJBnOefvyt4rCWhII4cxbh3y66wn6OgxTrigAWM8zwgUtLa2vr+4uPgPiGiFZ1aXNnSYc96WbYab6kvzctPCuHUICcRNmKAPCLgjECsvL1+1adOm8es8luvOYu69FmKx2F0HDhz4Qe5d0DJPAkggeQJTpblxwqkCHn7kRyCRSDwnhLgrv17etT59+vTuU6dOHfDOIixdRcC4dQgVCOIfBIIhwHbs2PFYYWHhfw5muOuP4jjO97u6ut4Wpg8RHhsJRFNxjRNOU51MdlvGaDcRtYYM4YJlWduTyeSJkP2I4vDGrUOoQKIYxpiTagRYa2vrjuLi4oNZx8L83ckb6D/jnN+O/bM8DxMkEM+RBmPQOOGCwYpRPCJQkEgk/oMQ4lEiKvTIplszctNFi3O+urOzcxa7+brFeN1+xq1DYZ4JeamcccJ5CQ+2/CXQ2NhYXlFRcS67v5W/g+VmXczOzu7p6en5x9yao1WOBIxbh5BAcowMNAMBtwSqq6t319TUqLRYy8tY93DO/7vbOaEfKhBJAAkEvwQQ8JlATU3NO6urq7/j8zD5mv9TzvlD+XZC+0UJoALRNECME05TnYx0u6qq6vHa2trPqDR5IcTL6XR6j0o+RcAX49YhVCARiFpMQW0CbW1tny0oKPiYYl72cc63KuaT7u4ggWiqoHHCaaqTkW7btv0UET2i2OQnOOdrFPNJd3eMW4dQgegesvBfeQLxePwzjLHHFXMUFYj3giCBeM80EIvGCRcIVQziCYGqqqqP1dbWftYTY94Z2c85/1XvzMGSfEzbtu35HB7XdjjncidmR3dqqEB0VxD+K0+gurr67pqamr2KOfo5zvnHFfNJd3eQQDRV0DjhNNXJSLfr6uri69ev5wpN3onFYvceOHAA74F4K4px6xAqEG8DCNZA4JcI1NbWllZVVb1CRPUK4JEvEYr+/v7m8+fP9yngT5RcQALRVE3jhNNUJ1PdthKJxKNCiE8H/BXC6/GW190XOOflRDSHz9x6GpLGrUOoQDyNHxgDgesTaGtrqygoKBgmotKQGS04jrO3oKDgPdhI0XMlkEA8RxqMQeOECwYrRvGIgDxRE7Ztv0REN4e8hdC5vr6+lqmpqbMezQ1m/omAcesQKhCEPwgERGDz5s33lZWVfZuICgIa8peGcRznW11dXQ+ENX7Ex0UC0VRg44TTVCfj3bZtW76RLt9MD+UYHR2tHBkZQfXhD33j1iFUIP4EEqyCwI0IrLRtu5+I1uXwwplXFOWN88zo6OjtIyMj8jKa9i+weQXGYztIIB4DDcqcccIFBRbjeE9g586drStWrJDvhRR5b/36Fhljz6ZSqXcENZ6h4xi3DqECMTTSMe1wCTQ0NNy6bt26F4LwgjH2wVQq9Uz2sd0ghjR1DCQQTZU3TjhNdYLbVxFobW1NFBcXy0tKfn0n3RFCvJBOp99IRHKPJhz+EjBuHUIF4m9AwToILEqgqalp9apVq/6KiN7gNapTp07ddvr0aVnlyLfPcfhPAAnEf8a+jGCccL5QhNGwCBS3t7d/NhaL/QYRVWUXfLcndzOO4+yfnJx8YGBgYCCsCRk6rnHrkNsgVS0+jBNONQHgz/IJVFVVra+trf0IEX2YiGIuLA5alvXWZDJ5yEVfdFk+AePWISSQ5QcNLICAFwQu/xZvu+22WDKZLC8pKamrra19m2VZrxNCtBHRyuy9EtlunjE2K4SQFcaL/f39P8hkMl0XL148nXXk8oaJXjgFG3kRQALJC5c6jY0TTh308CQIAtu3b98Ri8XWzc3NWSUlJdNEdCydTv8iiLExRs4EjFuHUIHkHBtoCAJKELi8r5YSnsCJawkggWgaE8YJp6lOcBsEokzAuHUIFUiUwxlzAwEQCJIAEkiQtD0cyzjhPGQHUyAAAt4QMG4dQgXiTeDACgiAAAgggWgaA8YJp6lOcBsEokzAuHUIFUiUwxlzAwEQCJIAEkiQtD0cyzjhPGQHUyAAAt4QMG4dQgXiTeDACgiAAAgggWgaA8YJp6lOcBsEokzAuHUIFUiUwznkuXV0dNRZlvUlzvld2c+34lOqIWuC4X0lgATiK17/jBsnnH8oPbNcaNv2IBFVM8aeTKVSH8e3uD1jC0NqEjBuHUIFomYgau+VbdvPE9GvZScihBC3ptPpf9B+YpgACNyYABKIptFhnHCK6nR5o7/29vYXY7HYHiK6+gTlzNjY2PuGh4fl1/dwgEAUCRi3DqECiWIYhzcnFo/H38cY+8o1yUN6JHeQHeacb81+nxv3Q8LTCSP7QwAJxB+uvls1TjjfiboYoKOj4w8ty/rdJbq+eubMmd0nT54852IIdAEBlQkYtw6hAlE5HDXyLZFIvF0I8S0iKl7KbcuyPp9MJh9Zqh3+HQQ0I4AEoplgV9w1TjiVdNq5c2f7ihUrePZR3VxcEwsLC19sbm5+dO/evQu5dEAbENCAgHHrECoQDaJSZRerq6vfUlNT81Ui2piHn/J+CBsfH3/D4ODg3+MLe3mQQ1OVCSCBqKzOIr4ZJ5wCOllEJN/1OEpE9de5aZ6Li/Pz8/Md3d3dvbk0RhsQUJyAcesQKhDFI1JV96qqqjbX1tbK9zqql+GjfBLrPOd8LV4yXAZFdFWFABKIKkrk6YdxwuXJx+vmJfF4/FuMsXs9MLwghPhf6XT6N4ho2gN7MAECYREwbh1CBRJWqOk7bsy27QNEFPd4Cs9yzt/hsU2YA4EgCSCBBEnbw7GME85DdnmZ6uzs/JDjOF/Iq1NujWUl8nQ6nf4IbqrnBgytlCNg3DqECkS5GFTXoebm5sdKS0uf9NFD59ixY+3T09OHfRwDpkHALwJIIH6R9dmuccL5zPNa89b27dvfWlRU9D2XT1vl7C5jbGpycvL+/v5+ORYOENCJgHHrECoQncIzJF/r6+tvrqys3B/g8CdHRkaaR0dHL+JyVoDUMdRyCSCBLJdgSP2NEy4ozrt3727IZDLyPY2bghpTjsMYOzI+Pm4PDAzMBDkuxgKBZRAwbh1CBbKMaIl61/r6+jWVlZXHiGhNGHO9cOHCM0ePHv3tMMbGmCDgggASiAtoKnQxTrgAoEumPyaiOwIY60ZDyC1PPlxWVvbH+/bty4ToB4YGgVwIGLcOoQLJJSzManM5JhKJRK8QQn67Q25ZEupx6dKlNx85ckQmMxwgoDIBJBCV1VnEN+OE80un7du3FxYVFf0eET2uQvLIzvP07OzsHT09PXi81y/hYdcLAsatQ6hAvAibCNmIx+PPMMZ+S7EpyT2zxjjnctNGuf27vLSFAwRUI4AEopoiOfpjnHA5csmnGbNt+xNE9EkiWpFPx4DaCsbY8+fPn393X1/fWEBjYhgQyIeAcesQKpB8wiPCbROJRLsQIp+PQoVCw7KsLyeTyX8byuAYFAQWJ4AEommEGCeclzo1Njb+ZkVFhdzfqsxLuz7ZkpewnuGcP+yTfZgFAbcEjFuHUIG4DZVo9GMrV65ct3Xr1m4iqvR7mxKPkMn7IezYsWM7p6en5QuOuB/iEViYWTYBJJBlIwzHgHHCeYG5rq5u2/r162XyUPGex1JTdKanp19/7NixF5ZqiH8HgYAIGLcOoQIJKLJUG6aioqKssbHxh0T0OtV8y8Of0bGxsU3Dw8OX8uiDpiDgFwEkEL/I+mzXOOGWyVN+FCpFRO3LtBN2d/lk1k9SqdQb8UncsKXA+PK9Kdu253N4f8rhnMuqX16O1fpABaK1fO6cj8fj32CMPeSut3q95ufnv9vd3S0/iYsDBMIkgAQSJv1ljG2ccG5Ztba2PllcXPyY2/4K93uYc/413FRXWKHou2bcOoQKJPpBfWWGrL29/d2xWOxbmjxtla8yzvz8/K3d3d0v5tsR7UHAIwJIIB6BDNqMccLlC3jz5s13lZWVPZdvP53aCyGOnzhx4l3j4+Mv6eQ3fI0MAePWIVQgkYndG0+ks7Nzi+M4h4ioJOLTle+EnOCcN2VvUGp/kzLiekVtekggmipqnHC56tTe3r4pFovJdz1Kc+0TgXYvjo2NvXV4eHg8AnPRZQryZNT0lzqNW4dQgejy83TnZ5lt239NRK9x113fXo7jfLKrq+s/6jsDbTyPyRdRb7755oaXX365z/AkggSiTdj+c0eNE24JneRHoOTuuv1EtCGiN82XClV5U/3pu++++yNPPPEELmUtRcvlv69Zs2b1xo0bjxLRuunp6fcfO3bs6y5NRaGbcesQKpAohO01c2hsbCxfs2bN00KI+w1NHpKIvJzCTp48GT9z5oy8/4Mk4kOsd3R0fM2yrCvfrT8/MDDwmomJiR5DeSOB+BBjQZg0TrjFoCYSiT8TQjwQBHgNxpifmppq7evrk9UYDu8IsI6Ojm9YlvXea09SRkdHEyMjI/LTAKYdxq1DqECiFeKxeDz+bcaYfCs79G+ZK4JWViLjnPN1ivgTBTdYc3PzfaWlpd+5wWTGpqam3tTX15c27J4IEoim0W2ccNfTafv27b9SVFS03+DLVjcKX/kNkec45+/MfhJX0zBXw+2WlpY3lZSU/M0S3lwYHBysHR8fP6+G14F4Ydw6hAokkLjyf5AtW7Z8YPXq1U8TUYH/o2k7wrOc83do670Cjre2ttYUFxe/SkRFObhzcmpqak9fX99wDm2j0AQJRFMVjRPuKp3Y2rVrmzds2PAyEa3EpatFIzhjWdajyWTyS4ZdWvHkZ71mzZqGjRs3/h0Rbc3DYA/nPEFEs3n00bWpcesQKhBdQzXrd21tbUtVVZX8Mh+O3Ag4ZWVlHfv27ZMvV+LIg4Bt2/LjXbfm0eVK0wOWZd2STCblVudRPpBANFXXOOGkTps2baoqLy//ByLaoqluYbk9fPbs2QeHhoaeD8sBjcZltbW1JVVVVT8lok6399dmZmae7+3tfZNG83bjqnHrECoQN2GiRp8C27bl+w0tarijlxdy48V0Ot1KRPKs2PQtOBYTz0okEg8KIZ5ZpsLyPZy/5pz/qwjzRgJZZpCE1d044Wzb/hERvSUs4BEZNzk2NnYrPol7YzXb29v/JBaLyXeKPHksfGFh4S8OHjz4nojEz7XTMG4dQgWiYSTv2LHjLwsLC+W7HlHRLzQVJiYmPjUwMPD7oTmg7sCsrKysc/PmzfLSVbFXCUROd25u7k8OHz78W+pO3bVnSCCu0YXb0RThWCKReFgIIZ8i8uSMMFzZlBhdOI7z6LZt2764d+9e+b4IDiKqra19bVVV1c98giEvGT7GOf9Dn+yHZdaUdej/843KGawRwrW0tDxSUlLyVFi/jiiPOzk5+SvHjx8/EOHr8znL19jY2FJRUfG3RFSfcycXDWdnZ/9TT0/PJ1x0VbWLEevQ1fCRQFQNxWv8isfjuxlj8jFKeTkBh/cERmZnZzt7enpOe29aK4vFtm0PEFFVAF4LIcTb0+m0/FJmFB5kQAIJIGj8GCLSwu3atWvnwsJCSn53wQ94sHmZgHxKaIxzXpf9/ygsaHlLm0gkfiyEeGPeHd13EJlM5s5Dhw59370JZXpGeh26HmVUIMrE3vUdWbVqVUtTU9OzRNSuuKtRcM8RQnwnnU4/TEQXojChfOawY8eOPy8sLHxX0A9nMMam5ubmHuru7v5v+firYFskEAVFycWlKAp35aNQ8nKCPCuOSrLPRc9Q2wghvppNIqH6EeDg8l2Ph+S8Q3w4Y0a+EMs5Hwlw3l4PFcV1aFFGUVmUIifc2rVr6xoaGr7LGHut11EOe0sSmLMs69PJZNKIT+I2Nzf/TmlpqUweYR/js7Oz9/b09Mj9tnQ8IrcOLSUCEshShML591gikfgGPgoVDvwrX9Pr7+9vPn/+/PEof12vvb19UywWkx9/KguN9lUDZ3cIiBPRlAr+5OkDEkiewFRpHiXh5BYlP3G5aZ0qekTFj+nJycm3HD9+/OdRmdDV8yguLm5sbW2VG3HKrdlVOZmUDy9c6O3t3TkzMzOoGfcorUM5oVclaHJydpFGkRHulltu+fVLly79z+UCQX9vCFy1Z9acNxbVsFJaWlqzbdu2P2WMKbkdDmPs7/v7+x+cnJyU3x7R5YjMOpQrcCSQXEkF0K65ufmjpaWlnwtgKAyRH4GfcM5/LSKXsuRvntm2LSuPbflhCLS1rEROcs4bNXqsGgkk0BDxbjDdhbM2bNhwy9q1a+XNQ/muR1QSu3cKh2zp4sWLX3zllVc+HLIbXgxfkkgkviiE0GUvqp8NDg6+c3x8fMiLyftsQ/d1KG88UVmotBaupqamtbq6uidv9dAhaAL3cc7lOznypUMtj127dn1gYWHhyzo5zxjbm0ql7iOijOJ+a70OuWGLBOKGmod9WlpaGktKSrqIaLWHZmHKHwLyRcM96XT6//hj3lerVmtr6yeKi4s/SUQFvo7kj/E+znkHEV1SeNsTJBB/tPfdqq7CFdq2LR8TlS8K4tCDQG9vb++vz8zMaHVzd/Xq1Vu2bNnyShaxlieOjLGPplIpWT3JJKLioes65JqlloF0ndlqKdwyvjHtWnB0XDYBeflqmHO+OXsmrPzlrKamJnvVqlVyLzXtD8bYT1Kp1B2KViFarkPLCQokkOXQc9dXMhfxePyn2bfM8V0PdxzD7vXc1NTUg319fefDdmSx8SsrK1fW19fL7XDWquxnHr4Jxtjvp1KpTyt4TwQJJA8hVWqqk3DyEcrfJaInQ9x3SCXttPXFsqzHk8nkZxWegIy1/01Er4/gk33v45x/TTH2Oq1DnqBDBeIJxtyNtLe3/1EsFpO7veLQn0Dm0qVLnzly5Ij8JK5yl7Li8fiPVH1R0APpF4qKir66f//+D3pgyysTSCBekQzYjhbCxePxexhj3yGiwoD5YDh/CFz+Zsjx48e3TE5OystESnxD5J577on19fXJjSA/FsHK44qSl1mfOHHi5nPnzqnyVJwW65CXPwVUIF7SXMTWnj17ErOzszLQcc8jIOYBDiMrkR1Hjhw5GuCYNxzKtu27iWivCr4E4cOFCxfef/To0T8OYqwlxkACUUAENy4oLdz69evfWFdXJ6/XbnIzOfRRnoA8Gx7KbrsRahWyY8eOhwoLC59SZXfdgJS7NDo6esfIyMhLIVeBSq9DfmiBCsQPqv9kU/K98q5HNaoPf2GHbH2BiP4L5/z+EBexEtu2h4mo3MRYO3369K5Tp04lQ4wDJJAQ4S9naCWFW7duXXNDQ8PfElHDciaHvvoQcBznm11dXe8N2uPKykq7vr7+b4ioMsL3PZbCevHChQtvPnr0qNx+P4xKUMl1aCloy/l3VCDLobd43+J4PP5txti9/g0BywoSmGeMvSuVSgX2fW/5rkddXd1/ZYz9CwV5BO2S09fXt35qamoihCfjkECCVtuj8VQTboVt27KUbvNofjCjF4GFWCwWP3DgQHcAbhcmEomDQojmAMbSZYiLk5OT8ePHjx8L2GHV1iHfp48KxAfEu3fv/lAmk/mCD6ZhUh8Ch06cOPGg34+YtrW1/buCgoLP64MlME9PDw0NbTt79myQn8ZFAglMXm8HUka4lpaWJ0pKSj7l7fRgTVMCxzjnrX59EAkfIFsyKnonJiYSAwMDM0u29KaBMuuQN9NZ2goqkKUZ5dqCbd269c6VK1fKa9941yNXatFv96OJiYm7PF7ErG3btr3+pptueh6xtngAMcaSqVRqd0A31ZFANP09hy5cQ0PDrnXr1qnyRqymMkbT7dHR0Q+OjIx8xavZVVdXb6+pqTnslb2I25FPY/2Ucy73A/P7CH0d8nuC19pHBeIB8dbW1q3FxcUHiajYA3MwET0CIpPJPNLS0vKlvXv3yvdFXB/xeLycMdZPRGtcGzGwoxBibzqd9vuJSCQQTWMrNOE2bNhQsXbtWvlxoTJN2cHtgAiMjY1tHR4elou/23cUim3blh+Fku8VReXkLyD65GQymR8cOnToziw7txos5m9o61BQEFGBcL7Cy+fDbdt+kYh+NSwBMa5WBM5kMpmWQ4cOyXcU8j7i8fifMcYeyLsjOlwhkBFCfCqdTn/OyzXgKrxIIJrGWtDCyZvkIpFI9AohtuFsUNOoCd5tueX7ac55fXbonM+CbduWb1e/JniXozfi3NzcM4cPH/5tH2YW9DrkwxTyMxmVMjhQ4To7O1c4jvN7RPTvkTzyCzi0pgXG2FcYY48lk8n5HHiweDz+Lxljf4UnrnKglWMTIcQH0um03ME35ySeg+lA16Ec/PG9CRKIC8QdHR1/blnWu110RRcQuExACPFMOp1e8iz49ttvf2hiYuIZnKh4HziO47y3q6vrmx5aRgLxEGaQpoISjiUSiceFEE8QUUGQE8RYkSMw4zjOw4ssYKyysvI19fX18r2imsjNXo0JzSwsLHz84MGDXu0aEdQ6pAa9CJ3VBCKcbdu7iOgfI8RNmUA00BF5P0T09vZum5mZkV8zvPqTuFZpaWlVc3PzCSKKId58jY7ZhYWF1oMHD8onKZd7BLIOLddJL/vjElaONBsbG++vqKiQew7h+fscmaFZTgQGJyYm3j4wMPDyldb19fVNlZWVPyQiuQ0KDv8JTM/Pz9/f3d0t7zMt50ACWQ69EPv6KZxMshW2bfcS0drsGWGIU8XQUSPAGOtOpVJxIpIvGcrLpC8JIW6O2jwVn8/gkSNHXnvp0iX5QS63h5/rkFuffO2HCmQJvPX19e2VlZX7iajEVyVg3GgClmU9l0wm72lra/uLgoKCd+KyVeDhIJ/Gmu/p6dk+OzsrX/Z0cyCBuKGmQB9fhCsrK6vYvHnz94nodQrMES5El8DlR0kZY38nhHhDdppRObnTSjUhxIGBgYF/84tf/IK7cNyXdciFH4F1iUqQ+iHcing8fogxhg/1BBaOxg8kb6RjJ+dww+DKy54bs5cU83lPxI91KFwaS4yOBHIDQIlE4o+EEA8rrR6cAwEQ8IOATBq9g4OD946Pj+ez6zESiB9qBGDTU+G2bdv21E033fRIAH5jCBAAAXUJ/JBz/g4iupSji56uQzmOGWozVCD/HD9ra2t7uKCg4Eu4lBDrOo0PAAAEzElEQVRqXGJwEFCFwNmhoaHNZ8+enc5h2xMkEFVUy9MPT4RrbGz81xUVFd/Lc2w0BwEQiDABxthTr7766qcnJiYml5imJ+uQTihRgWTVSiQS7UII+UXBQp0EhK8gAAL+ExBCvJBOp29bogpBAvFfCl9GWJZwmzZt2lheXt5DRKW+eAejIAACuhOQN9a/zjn/EBHN3WAyy1qHdASECoSo1LbtF4ioU0cB4TMIgECgBD7EOf/yDSoRJJBApfBuMDfCyeTJbNuWG9nJD/xEJZl6RxWWQAAEriXgOI7zXFdX19uvg8bNOqQ14agsmvkIJ7dhl+Xoqng8/mXG2HuQPLSOYTgPAoETOHny5JvPnDnz42sGzmcd8vTT2oEDyA5oWgIRnPPLb/rG4/FvMsZ+MyzwGBcEQEBvAhcvXvzoK6+88uRVs0AC0VTSXIWb55wX27YtP2X5EHbW1VRtuA0CahDInDt37s4TJ078j6w7ua5DDuccFYgaGl72Ihfh5GWr2YKCgjdkMpmfZy9jYd8hhUSEKyCgI4GRkZE9o6Ojl7/nYtu23JJ/qXUFCUQxoXNJINLly1s2410PxdSDOyCgN4H5mZmZO3p7e39u2/YFIipeYjpIIIrpnWsCUcxtuAMCIBABApevbgwNDW1paGgYzOEzxEggiomOBKKYIHAHBAwjILeBl5suyg/P4RKWZuIjgWgmGNwFAYMJoAJRTHwkEMUEgTsgAAI3JIAEolhwIIEoJgjcAQEQQALRJQaQQHRRCn6CAAigAlEsBpBAFBME7oAACKAC0SUGkEB0UQp+ggAIoAJRLAaQQBQTBO6AAAigAtElBpBAdFEKfoIACKACUSwGkEAUEwTugAAIoALRJQaQQHRRCn6CAAigAlEsBpBAFBME7oAACKAC0SUGkEB0UQp+ggAIoAJRLAaQQBQTBO6AAAigAtElBpBAdFEKfoIACKACUSwGkEAUEwTugAAIoALRJQaQQHRRCn6CAAigAlEsBpht23NCiAXGWKHjOLOWZRVIHx3HyViWJf82h7+BAeIAv4UQ14MiIcQcYyzGOS/MfmJbsaU0P3dYfs3RGgRAAARAAAT+HwEkEEQCCIAACICAKwJIIK6woRMIgAAIgAASCGIABEAABEDAFQEkEFfY0AkEQAAEQAAJBDEAAiAAAiDgigASiCts6AQCIAACIIAEghgAARAAARBwRQAJxBU2dAIBEAABEEACQQyAAAiAAAi4IoAE4gobOoEACIAACCCBIAZAAARAAARcEUACcYUNnUAABEAABJBAEAMgAAIgAAKuCCCBuMKGTiAAAiAAAkggiAEQAAEQAAFXBJBAXGFDJxAAARAAASQQxAAIgAAIgIArAkggrrChEwiAAAiAABIIYgAEQAAEQMAVASQQV9jQCQRAAARAAAkEMQACIAACIOCKABKIK2zoBAIgAAIggASCGAABEAABEHBFAAnEFTZ0AgEQAAEQQAJBDIAACIAACLgigATiChs6gQAIgAAIIIEgBkAABEAABFwRQAJxhQ2dQAAEQAAEkEAQAyAAAiAAAq4IIIG4woZOIAACIAACSCCIARAAARAAAVcEkEBcYUMnEAABEAABJBDEAAiAAAiAgCsCSCCusKETCIAACIDA/wWpWNQqGFIUyQAAAABJRU5ErkJggg==",description:this.editMode?this.task.dscr:""}},computed:{computedDateFormatted(){let e=this.formatDate(this.date);return e},managers(){let e=this.$store.state.administration.company.users||[],t=e.map(e=>({id:e.id,avatar:e.avatarSrc,name:e.first_name+" "+e.last_name,role:""}));return t}},watch:{menu(e){e&&setTimeout(()=>this.$refs.picker.activePicker="YEAR")}},methods:{getImageData(){this.$emit("getImageData")},cancel(){this.setTaskNew(!1),this.$emit("update:task_form",!1),this.$emit("update:editMode",!1),this.$emit("update:task",null)},setTaskNew(e){this.$emit("setTaskNew",e)},save(e){this.$refs.menu.save(e)},formatDate(e){if(!e)return null;const[t,s,a]=e.split("-");let i=(new Date).getTimezoneOffset(),o=new Date(parseInt(t),parseInt(s)-1,parseInt(a),Math.abs(i)/60),n=o.getTime(o);return this.taskDay=n,`${a}/${s}/${t}`},parseDate(e){if(!e)return null;const[t,s,a]=e.split("/");return`${a}-${s.padStart(2,"0")}-${t.padStart(2,"0")}`},removeChips(){this.manager=null},sendTask(){let e=new FormData;if(this.editMode){let t={};this.screen&&(e.append("file",this.blob),e.append("name",this.model.name)),this.name!=this.task.name&&(t.name=this.name),new Date(this.date).toISOString()!=this.task.deadline&&(t.deadline=new Date(this.date).toISOString()),this.manager!=this.task.user&&(t.user=this.manager),this.selectStatus!=this.task.status&&(t.status=this.selectStatus),this.description!=this.task.dscr&&(t.dscr=this.description),this.name!=this.task.name&&(t.name=this.name),e.append("JSON",JSON.stringify(t))}else e.append("file",this.blob),e.append("name",this.model.name),e.append("JSON",JSON.stringify({deadline:new Date(this.date).toISOString(),docid:this.model.id,status:this.selectStatus,name:this.name,user:this.manager,dscr:this.description,file:""}));this.cancel(),this.$store.dispatch("workflow/updateTask",{type_id:"c",id:this.$store.state.administration.company.id,project_uuid:this.project_id,body:e,task_id:!!this.editMode&&this.task.task_id.toString(),docid:this.model.id,filter:{docid:this.model.id}})}}},Sl=xl,Al=(s("e09d"),Object(m["a"])(Sl,wl,kl,!1,null,null,null)),Il=Al.exports,Ol={name:"Tasks",components:{TaskCreate:Il},props:["project_id","document","task_new","screen","blob"],data(){return{src:s("4a8c"),task_form:this.task_new,expanded:[],editMode:!1,task:null}},computed:{userAvatar(){return this.$store.state.administration.userAvatar},getList(){let e="",t={year:"2-digit",month:"short",day:"2-digit"},s=this.$store.state.workflow.taskList.filter(e=>e.docid==this.document.id).map(s=>({...s,avatar:(e=this.$store.state.administration.company.users.find(e=>e.id==s.owner))?e.avatarSrc:"",create_date:new Date(s.create).toLocaleDateString("ru-RU",t),deadline_date:new Date(s.deadline).toLocaleDateString("ru-RU",t)}));return x(s,"task_id")}},methods:{getImageData(){this.$emit("getImageData")},setTaskNew(e){this.$emit("update:task_new",e),this.$emit("clearImageData")},editTask(e){this.editMode=!0,this.task_form=!0,this.task=e}}},jl=Ol,Fl=Object(m["a"])(jl,yl,_l,!1,null,null,null),Pl=Fl.exports,El={name:"Tools",components:{Comments:nl,HistoryList:gl,Tasks:Pl},props:["document","compareMode","screen","project_id","blob"],data(){return{task_new:!1,mini:!1,tools_width:440,tab:"Comments",tabs:[{name:"HistoryList",icon:"history",visible:!0},{name:"Comments",icon:"mdi-comment-text-outline",visible:!0},{name:"Tasks",icon:"trd-ticket",visible:!1}]}},computed:{getTaskList(){return this.$store.state.workflow.taskList.length},getTabs(){return this.tabs.map(e=>{let t=!0;return"Tasks"==e.name&&(t=!!this.getTaskList),{...e,visible:t}}).filter(e=>e.visible)}},watch:{mini:function(e){this.tools_width=e?56:440,this.$emit("update:toolsbar",e)}},methods:{getImageData(){this.$emit("getImageData")},setTab(e){this.tab=e},newTask(){this.task_new=!0,this.setTab("Tasks")},clearImageData(){this.$emit("update:screen","")},activeBtn(e){let t=this.tab==e?"#2c2c2c":"#7f7f7f";return t},expand(){this.mini=!this.mini},socketOpen(){this.$store.dispatch("comments/setSocket",{did:this.document})},socketClose(e){console.log("socketClose"),this.$store.dispatch("comments/close")}},created(){this.socketOpen(),this.$store.dispatch("workflow/getTaskList",{type_id:"c",id:this.$store.state.administration.company.id,project_uuid:this.project_id,filter:{docid:this.document.id}})},beforeDestroy(){this.socketClose(),this.$store.commit("workflow/setTaskList",[])}},Ul=El,Bl=Object(m["a"])(Ul,Lr,Nr,!1,null,null,null),Tl=Bl.exports,Ll=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__options--3d"},[t(zt["a"],e._l(e.options,(function(s,a){return t("div",{key:s.name,staticClass:"option--wrap"},[s.hidden?e._e():t(_r["a"],{attrs:{disabled:!s.title,top:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:n}){return["btn"!=s.type&&s.type?t("span",{staticClass:"m-text--size12"},[e._v(e._s(e.optionValue(s.value)))]):t(Xe["a"],e._g(e._b({staticClass:"m-btn m-btn-icon--cube mx-1",class:{"m-btn--divider":s.divider,"mr-2":s.divider},attrs:{text:"",disabled:s.disabled},on:{click:function(t){return e.setOption(s,a)}}},"v-btn",n,!1),i),[s.icon?t(o["a"],{attrs:{size:"22",color:s.active&&!s.turnoff?"#4e93e9":"#525252"}},[e._v(e._s(s.icon))]):e._e()],1)]}}],null,!0)},[t("span",[e._v(e._s(s.title))])]),s.children&&s.active?t(We["a"],{staticClass:"option--sub"},e._l(s.children,(function(i,n){return t("div",{key:n,staticClass:"option--sub-item",on:{click:function(t){return e.setSubOption(s,a,i,n)}}},[t(o["a"],{attrs:{size:"24",color:i.active?"#4e93e9":"#525252"}},[e._v(e._s(i.icon))]),t("span",{class:{active:i.active}},[e._v(e._s(i.title))])],1)})),0):e._e()],1)})),0)],1)},Nl=[],Hl={name:"PanelOptions",props:["options","params"],computed:{getOptions(){return this.options.filter(e=>!e.hidden)}},methods:{setSubOption(e,t,s,a){this.$emit("setSubOption",{name:t,active:e.active,sub_name:a,sub_active:s.active})},setOption(e,t){this.$emit("setOption",{name:t,active:e.active,turnoff:e.turnoff||!1})},optionValue(e){return this.params[e]||""}}},Ml=Hl,zl=Object(m["a"])(Ml,Ll,Nl,!1,null,null,null),$l=zl.exports,Rl=function(){var e=this,t=e._self._c;return t("div",{staticClass:"m-anno-draft",class:{novisible:!e.commentHover&&!e.activeComment,active:e.commentHover||e.activeComment},style:e.anno_style()},[t("div",{staticClass:"m-draft-handler"},[t("div",{staticClass:"m-comment-marker--value"},[e._v(e._s(e.anno.name))])])])},Dl=[],Jl={data(){return{}},props:["anno"],computed:Object(h["b"])({commentHover(e){let t=e.comments.comments.filter(t=>t.id==e.comments.draftHover);return!!t.length&&t[0].borders.some(e=>e==this.anno.id)},activeComment(e){let t=e.comments.comments.filter(t=>t.id==e.comments.activeComment);return!!t.length&&t[0].borders.some(e=>e==this.anno.id)}}),methods:{anno_style(){return{left:this.anno.x+"%",top:this.anno.y+"%",width:this.anno.w+"%",height:this.anno.h+"%"}}}},Vl=Jl,Kl=Object(m["a"])(Vl,Rl,Dl,!1,null,null,null),Gl=Kl.exports,Ql=function(){var e=this,t=e._self._c;return t("div",{ref:"over",staticClass:"m-anno-conductor",class:{novisible:!e.pdfInit},attrs:{id:"conductor"},on:{mouseup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:(t.preventDefault(),e.dropBorderHelper(t))}}},e._l(e.borderStack,(function(s,a){return t("draft",{key:"border"+s.id,attrs:{item:s},on:{getBorder:e.getBorder}})})),1)},Xl=[],Wl=function(){var e=this,t=e._self._c;return t("div",{ref:"draft",staticClass:"m-anno-draft active",class:{hidden:e.borderEdit&&e.item.id!==e.borderEdit},style:e.styles(),attrs:{id:"draft"},on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:(t.stopPropagation(),t.preventDefault(),e.letElem(t,"startmove"))}}},[e._l(4,(function(s,a){return t("div",{key:"edge"+a,staticClass:"m-draft-edge",class:"m-draft-edge-"+a,on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:(t.stopPropagation(),t.preventDefault(),e.letElem(t,"startresize","edge"+a))}}})})),t("div",{key:"handler",staticClass:"m-draft-handler",on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:(t.stopPropagation(),t.preventDefault(),e.letElem(t,"startmove"))}}},[t("div",{staticClass:"m-comment-marker--value"},[e._v(e._s(e.item.name))])]),t("div",{key:"handle0",staticClass:"m-draft-resizer",on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:(t.stopPropagation(),t.preventDefault(),e.letElem(t,"startresize","handle2"))}}})],2)},Yl=[],ql={data(){return{}},props:["item"],computed:{borderEdit(){return this.$store.state.comments.borderEdit}},methods:{init(){this.$el.style.left=this.item.x+"%",this.$el.style.top=this.item.y+"%",this.item.w&&(this.$el.style.width=this.item.w+"%",this.$el.style.height=this.item.h+"%")},styles(){let e={left:this.item.x+"%",top:this.item.y+"%"};return this.item.w&&(e.width=this.item.w+"%",e.height=this.item.h+"%"),this.$store.state.administration.user.id!=this.item.uid&&(e["pointer-events"]="none"),e},letElem(e,t,s=""){this.$emit("getBorder",{e:e,item:this.item,action:t,el:this.$el,dirMove:s})}},mounted(){this.init()}},Zl=ql,ec=Object(m["a"])(Zl,Wl,Yl,!1,null,null,null),tc=ec.exports,sc={components:{draft:tc},data(){return{border:"",borderEdit:null,borderW:0,borderH:0,posX:0,posY:0,pageX:0,pageY:0,move:!1,dirMove:"",resize:!1,parentEl:"",draftInit:{},draftDrag:!1,draftShow:!1,draftTransform:!1}},props:["width","height"],watch:{width(e){this.$el.style.width=e+"px"},height(e){this.$el.style.height=e+"px"},scale(e){let t=this.$el.parentElement.getBoundingClientRect();this.parentEl={x:t.x,y:t.y,width:Math.round(t.width),height:Math.round(t.height)};let s=this.$el.getBoundingClientRect();this.width=s.width,this.height=s.height,this.posX=Math.round(s.x-t.x),this.posY=Math.round(s.y-t.y)}},computed:{borderStack(){let e=JSON.parse(JSON.stringify(this.$store.state.comments.comments)),t=JSON.parse(JSON.stringify(this.$store.state.comments.borders)),s=[];e.map(e=>{s=[...s,...e.borders]});let a=[];return t.map(e=>{s.some(t=>t==e.id)||(a=[...a,e])}),a},borderHelper(){let e=this.$store.state.comments.borderHelper;return e},pdfInit(){return this.$store.state.workflow.pdfInit}},methods:{dropBorderHelper(e){if(this.borderHelper.status){let t=this.$el.getBoundingClientRect(),s=e.clientX-t.x-6,a=e.clientY-t.y-6;this.$store.dispatch("comments/addBorder",{x:parseFloat((100*s/t.width).toFixed(2)),y:parseFloat((100*a/t.height).toFixed(2))})}},getBorder(e){let t=this.$el.getBoundingClientRect(),s=e.el.getBoundingClientRect();this.parentEl={x:t.x,y:t.y,width:Math.round(t.width),height:Math.round(t.height)},this.border=e.el,this.borderEdit=e.item,this.posX=s.x-t.x,this.posY=s.y-t.y,this.borderW=s.width,this.borderH=s.height,this[e.action](e.e,e.dirMove)},setDraftAttr(e){let t=this.border,s={x:this.posX,y:this.posY,w:this.borderW,h:this.borderH};e={...s,...e};let a=this.parentEl,i=(100*e.x/a.width).toFixed(2),o=(100*e.y/a.height).toFixed(2),n=(100*e.w/a.width).toFixed(2),r=(100*e.h/a.height).toFixed(2);t.style.left=i+"%",t.style.top=o+"%",t.style.width=n+"%",t.style.height=r+"%"},startresize(e,t){this.dirMove=t,this.pageX=e.clientX,this.pageY=e.clientY,this.resize=!0},startmove(e){this.pageX=e.clientX,this.pageY=e.clientY,this.move=!0},drag(e){if(this.move){let t=e.clientX-this.pageX+this.posX,s=e.clientY-this.pageY+this.posY,a=this.checkMove(t,s);t=a.x,s=a.y,this.setDraftAttr({x:t,y:s})}this.resize&&("handle0"==this.dirMove?this.setDraftAttr(this.checkResize(e,1,0,0,1)):"handle1"==this.dirMove?this.setDraftAttr(this.checkResize(e,1,1,0,0)):"handle2"==this.dirMove?this.setDraftAttr(this.checkResize(e,0,1,1,0)):"handle3"==this.dirMove?this.setDraftAttr(this.checkResize(e,0,0,1,1)):"edge0"==this.dirMove?this.setDraftAttr(this.checkResize(e,1,0,0,0)):"edge1"==this.dirMove?this.setDraftAttr(this.checkResize(e,0,1,0,0)):"edge2"==this.dirMove?this.setDraftAttr(this.checkResize(e,0,0,1,0)):"edge3"==this.dirMove&&this.setDraftAttr(this.checkResize(e,0,0,0,1)))},checkResize(e,t,s,a,i){let o={},n=e.clientX-this.pageX,r=e.clientY-this.pageY,l=this.parentEl;return t&&(o.y=this.posY+r<=0?0:this.posY+r,o.h=o.y>0?this.borderH-r:this.borderH+this.posY,o.h<13&&(o.h=o.h<0?-1*o.h+13:13,o.y=this.borderH+this.posY-13,o.h+o.y>=l.height&&(o.h=l.height-o.y)),o.y+8>=l.height&&(o.y=l.height-8,o.h=8)),s&&(o.w=this.posX+n+this.borderW>=l.width?l.width-this.posX:this.borderW+n,o.w<13&&(o.x=o.w<0?this.posX+n+this.borderW:this.posX,o.w=o.w<0?-1*o.w+13:13,o.x<=0&&(o.x=0,o.w=this.posX+13))),a&&(o.y=this.posY,o.h=this.posY+r+this.borderH>=l.height?l.height-this.posY:this.borderH+r,o.h<13&&(o.y=o.h<0?this.posY+r+this.borderH:this.posY,o.h=o.h<0?-1*o.h+13:13,o.y<=0&&(o.y=0,o.h=this.posY+13))),i&&(o.x=this.posX+n<=0?0:this.posX+n,o.w=o.x>0?this.borderW-n:this.borderW+this.posX,o.w<13&&(o.w=o.w<0?-1*o.w+13:13,o.x=this.borderW+this.posX-13,o.w+o.x>=l.width&&(o.w=l.width-o.x)),o.x+8>=l.width&&(o.x=l.width-8,o.w=8)),o},endEvent(e){if(this.move){this.move=!1;let e=this.border;this.posX=e.offsetLeft,this.posY=e.offsetTop;let t=this.parentEl,s=100*this.posX/t.width,a=100*this.posY/t.height,i=100*this.borderW/t.width,o=100*this.borderH/t.height;this.$store.dispatch("comments/updateBorder",{id:this.borderEdit.id,name:this.borderEdit.name,x:parseFloat(s.toFixed(2)),y:parseFloat(a.toFixed(2)),w:parseFloat(i.toFixed(2)),h:parseFloat(o.toFixed(2))})}if(this.resize){this.resize=!1;let e=this.border;this.posX=e.offsetLeft,this.posY=e.offsetTop,this.borderW=e.offsetWidth,this.borderH=e.offsetHeight;let t=this.parentEl,s=100*this.posX/t.width,a=100*this.posY/t.height,i=100*this.borderW/t.width,o=100*this.borderH/t.height;this.$store.dispatch("comments/updateBorder",{id:this.borderEdit.id,name:this.borderEdit.name,x:parseFloat(s.toFixed(2)),y:parseFloat(a.toFixed(2)),w:parseFloat(i.toFixed(2)),h:parseFloat(o.toFixed(2))})}},checkMove(e,t){let s=this.parentEl,a=this.border.getBoundingClientRect();return t<=0&&(t=0),e<=0&&(e=0),t+a.height>=s.height&&(t=s.height-a.height),e+a.width>=s.width&&(e=s.width-a.width),{x:e,y:t}}},mounted(){window.addEventListener("mousemove",this.drag,!1),window.addEventListener("mouseup",this.endEvent,!1)},destroyed(){window.removeEventListener("mousemove",this.drag),window.removeEventListener("mouseup",this.endEvent)}},ac=sc,ic=Object(m["a"])(ac,Ql,Xl,!1,null,null,null),oc=ic.exports,nc=function(){var e=this,t=e._self._c;return t("div",{staticClass:"m-comment-marker--helper",class:{active:e.borderHelper.status}},[t("div",{staticClass:"m-comment-marker--value"},[e._v(e._s(e.borderHelper.value))])])},rc=[],lc={data(){return{borderHelperPos:{x:0,y:0}}},computed:{borderHelper(){let e=this.$store.state.comments.borderHelper;return e.status&&this.setPosition(e.x,e.y),e}},methods:{setPosition(e,t){let s=this.$el;s.style.left=e-13+"px",s.style.top=t-13+"px"},dragBorderHelper(e){if(this.borderHelper.status){let t={x:e.clientX,y:e.clientY};this.setPosition(t.x,t.y)}},removeBorderHelper(){this.borderHelper.status&&this.$store.dispatch("comments/setBorderHelper",{status:!1})}},mounted(){window.addEventListener("mousemove",this.dragBorderHelper,!1),window.addEventListener("mouseup",this.removeBorderHelper,!1)},destroyed(){window.removeEventListener("mousemove",this.dragBorderHelper),window.removeEventListener("mouseup",this.removeBorderHelper)}},cc=lc,mc=Object(m["a"])(cc,nc,rc,!1,null,null,null),dc=mc.exports,pc=s("fba4"),uc=s.n(pc),hc=s("968b");function fc(e){return"object"===typeof e&&null!==e&&!0===e.__PDFDocumentLoadingTask}function vc(e,t){let a;if("string"===typeof e)a={url:e};else{if("object"!==typeof e||null===e)throw new TypeError("invalid src type");a=Object.assign({},e)}a.CMapReaderFactory=function(){this.fetch=function(e){return s("a62e")("./"+e.name+".bcmap").then((function(e){return{cMapData:e,compressionType:uc.a.CMapCompressionType.BINARY}}))}};let i=uc.a.getDocument(a);return i.__PDFDocumentLoadingTask=!0,t&&t.onPassword&&(i.onPassword=t.onPassword),t&&t.onProgress&&(i.onProgress=t.onProgress),i}var bc={name:"ViewPdf",components:{Tools:Tl,PanelOptions:$l,anno:Gl,borderStack:oc,borderHelper:dc},props:{model:{type:Object,default:null},project_id:{type:String,default:""}},data(){return{FUrl:null,scale:"page-mini",btn_off:!1,toolsbar:!1,style_pdf:{},no_event:!1,screen:"",blob:"",version:{once:{value:0,annotation:!1,text:!1,pdf:null,pdfViewer:null,pdfWidth:0,pdfHeight:0,internalSrc:""},twice:{value:0,annotation:!1,text:!1,pdf:null,pdfViewer:null,pdfWidth:0,pdfHeight:0,internalSrc:""}},loading:!0,newScale:1,page:1,num_pages:0,rotate:0,annotation:!1,text:!0,mouse_down:0,posMouse:{x:0,y:0},posCompare:{x:0},compareMode:!1,compare_handler:{height:0,top:0,left:50},twice_width:50,options:{prev:{name:"prev",title:"Предыдущая страница",active:!1,turnoff:!0,action:"prev_page",children:null,icon:"mdi-chevron-left",divider:!1},num_pages:{name:"numpages",title:!1,active:!1,turnoff:!0,action:!1,children:null,icon:!1,type:"text",value:"num_pages",divider:!1},next:{name:"next",title:"Следующая страница",active:!1,turnoff:!0,action:"next_page",children:null,icon:"mdi-chevron-right",divider:!1},zoomout:{name:"zoomout",title:"Zoom -",active:!1,turnoff:!0,action:"zoomout",children:null,icon:"mdi-magnify-minus-outline",divider:!1},zoomin:{name:"zoomin",title:"Zoom +",active:!1,turnoff:!0,action:"zoomin",children:null,icon:"mdi-magnify-plus-outline",divider:!1},printer:{name:"printer",title:"Печать",active:!1,turnoff:!0,action:"print",children:null,icon:"trd-printer",divider:!1},compare:{name:"compare",title:"Сравнить",active:!1,action:"compare",children:null,icon:"trd-compare",divider:!1},download:{name:"download",title:"Скачать",active:!1,turnoff:!0,action:"download",children:null,icon:"trd-download",divider:!1}}}},computed:Object(h["b"])({anno_list(e){let t=e.comments.borders,s=e.comments.comments,a=[];return s.map(e=>{e.borders.map(e=>{a=[...a,...t.filter(t=>t.id==e)]})}),a},pdfInit(e){return e.workflow.pdfInit},stateBtn(){return this.btn_off},compare_style(){return{left:this.compare_handler.left+"%",height:this.compare_handler.height+"px",top:this.compare_handler.top+"px"}},getVersionList(){let e=this.model.files.map(e=>e.version);return e.filter(e=>e!=this.version.once.value&&e!=this.version.twice.value)},optionParams(){return{num_pages:this.num_pages?this.page+" из "+this.num_pages:""}}}),watch:{toolsbar:function(e){"number"!==typeof this.scale&&(e?setTimeout(function(){this.scale="page-full"}.bind(this),400):setTimeout(function(){this.scale="page-mini"}.bind(this),400))},pdf:function(e){var t=e.pdfInfo||e._pdfInfo;this.$emit("numpages",t.numPages)},page:function(e){var t=this;this.version.once.pdf.getPage(e).then((function(e){t.version.once.pdfViewer.setPdfPage(e),t.version.once.pdfViewer.draw()}))},rotate:function(e){this.version.once.pdfViewer&&(this.version.once.pdfViewer.update(this.scale,e),this.version.once.pdfViewer.draw())}},methods:{setOption(e){this.options[e.name].active=e.turnoff?e.active:!e.active,this.options[e.name].action&&this[this.options[e.name].action](!e.active)},setSubOption(e){this.options[e.name].children[e.sub_name].active=!e.sub_active,this.options[e.name].children[e.sub_name].action&&this[this.options[e.name].children[e.sub_name].action](this.options[e.name].children[e.sub_name]),this.setOption(e)},getAccess(e,t,s){return U(e,t,s)},checklicense(e){return E(e)},prev_page(){this.page>1&&this.page--},next_page(){this.page<this.num_pages&&this.page++},print(){this.$store.dispatch("common/getFile",{id:this.FUrl,typeBlob:"blob"}).then(e=>{let t=new Blob([e.file],{type:"application/pdf"}),s=URL.createObjectURL(t);this.$refs["pdf-frame"].src=s,this.$refs["pdf-frame"].onload=()=>{setTimeout(()=>{URL.revokeObjectURL(s),this.$refs["pdf-frame"].focus(),this.$refs["pdf-frame"].contentWindow.print()},1)}})},download(){let e=this.FUrl,t=this.model.name,s=Object(Ut["a"])();this.$store.dispatch("common/setUploadNote",[{name:t,uuid:s,action:"download",pushin:!0}]),this.$store.dispatch("common/getFile",{id:e,uuid:s,typeBlob:"blob"}).then(e=>{if(this.$store.dispatch("common/setUploadNote",[{uuid:s,action:"download",pushin:!1}]),e.error)console.log("downloadFile error",err);else{let s=document.createElement("a"),a=URL.createObjectURL(e.file);s.href=a,s.download=t,document.body.appendChild(s),s.click(),URL.revokeObjectURL(a),s.remove()}}).catch(e=>{console.log("downloadFile error",e)})},compare(e){let t=this.model.files||!1;if(this.compareMode=e,e){if(this.twice_width=this.twice_width?this.twice_width:50,t){let e=this.model.version?(()=>{let e=t.filter(e=>e.id!=this.model.version);return e||t})():t;this.version.once.value!=e[0].version?(this.version.twice.value=e[0].version,this.$store.dispatch("common/getFile",{id:e[0].url}).then(e=>{this.setPDF(e.file,this.$refs.containerTwice,"twice"),this.setCompareHandler()})):this.setCompareHandler()}}else{this.$refs.containerTwice.innerHTML="",this.version.twice.pdf=null,this.compare_handler.left=50,this.twice_width=50;let e=this.model.version?(()=>{let e=this.model.files.filter(e=>e.id==this.model.version);return e?e[0]:t[0]})():t[0];this.version.once.value!=e.version&&(this.version.once.value=e.version,this.$refs.container.innerHTML="",this.$store.dispatch("common/getFile",{id:e.url}).then(e=>{this.$nextTick(()=>{this.setPDF(e.file,this.$refs.container,"once")})}))}},setCompareHandler(){this.$refs["compare-handler"].addEventListener("mousedown",this.onCompareDown,!1);let e=this.$refs["pdf-wrap"];this.$refs["compare-wrap"];this.compare_handler.height=e.clientHeight,this.compare_handler.top=e.scrollTop-parseInt(getComputedStyle(e).paddingTop),this.compare_handler.left=100-this.twice_width},onCompareDown(e){e.stopPropagation(),document.body.classList.add("select-none"),this.posCompare={x:e.clientX,left:this.version.once.pdfViewer.width/100*this.compare_handler.left,width:this.twice_width},this.compare_down=1,document.addEventListener("mouseup",this.onCompareUp,!1),document.addEventListener("mousemove",this.onMouseMove,!1)},onCompareUp(e){document.body.classList.remove("select-none"),this.compare_down=0,document.removeEventListener("mouseup",this.onCompareUp),document.removeEventListener("mousemove",this.onMouseMove)},zoomin(){this.btn_off=!0,this.scale="string"===typeof this.scale?1:this.scale=Math.abs(this.scale)+1,this.drawScaled(this.scale)},zoomout(){this.btn_off=!0,this.scale="string"===typeof this.scale?-1:this.scale=-1*(Math.abs(this.scale)+1),this.drawScaled(this.scale)},updatePdf(e,t){let s=this.model.files.find(t=>t.version==e),a="once"==t?this.$refs["container"]:this.$refs["containerTwice"];a.innerHTML="",this.version[t].value=s.version,this.$store.dispatch("common/getFile",{id:s.url}).then(e=>{this.$nextTick(()=>{this.setPDF(e.file,a,t)})})},setPDF(e,t,s){let a=this;fc(e)||(a.version[s].internalSrc=vc(e));let i=new hc["PDFLinkService"],o=void 0,n=void 0;a.version[s].annotation&&(o=new hc["DefaultAnnotationLayerFactory"]),a.version[s].text&&(n=new hc["DefaultTextLayerFactory"]),a.version[s].internalSrc.then(e=>(a.version[s].pdf=e,this.num_pages||(this.num_pages=this.version.once.pdf.numPages),e.getPage(a.page))).then(e=>{a.version[s].pdfViewer=new hc["PDFPageView"]({container:t,id:a.page+(new Date).getTime(),scale:1,defaultViewport:e.getViewport(1),textLayerFactory:n,annotationLayerFactory:o}),a.version[s].pdfViewer.setPdfPage(e),i.setViewer(a.version[s].pdfViewer),"twice"==s?a.drawScaled("twice"):a.drawScaled(a.scale)}).catch(e=>a.$emit("error",e))},getWidthWrap(){let e=this.$refs["pdf-wrap"],t={r:parseInt(getComputedStyle(e).paddingRight),l:parseInt(getComputedStyle(e).paddingLeft),t:parseInt(getComputedStyle(e).paddingTop),b:parseInt(getComputedStyle(e).paddingBottom)},s=e.clientWidth,a=e.clientHeight;return{width:s-(t.r+t.l),height:a-(t.t+t.b)}},calculateScale(e=-1,t=-1){this.version.once.pdfViewer.update(1,this.rotate),-1===e&&-1===t&&(e=this.getWidthWrap().width);let s=e/this.version.once.pdfViewer.viewport.width;return s},getImageData(){let e=window.devicePixelRatio,t=this.version.once.pdfViewer.width*e,s=this.version.once.pdfViewer.height*e,a=this.version.once.pdfViewer.canvas,i=a.getContext("2d"),o=i.getImageData(0,0,a.width,a.height),n=document.createElement("canvas");n.width=t,n.height=s;let r=n.getContext("2d");r.putImageData(o,0,0);let l=this.$store.state.comments.borders,c=this.$store.state.comments.comments,m=this.$store.state.comments.activeComment,d=[],p=[];c.map(e=>(d=[...d,...e.borders],e)).filter(e=>e.id==m).map(e=>{p=[...p,...e.borders]});let u=[];l.map(e=>{d.some(t=>t==e.id)&&!p.some(t=>t==e.id)||(u=[...u,e])}),u.map(e=>{r.beginPath(),r.rect(e.x*t/100+2,e.y*s/100+2,e.w*t/100-4,e.h*s/100-4),r.fillStyle="rgba(255, 216, 48, 0.3)",r.fill(),r.lineWidth=4,r.strokeStyle="#ffd830",r.stroke(),r.beginPath(),r.arc(e.x*t/100+4,e.y*s/100+4,10,0,2*Math.PI,!1),r.fillStyle="#ffd830",r.fill(),r.beginPath(),r.fillStyle="#ffffff";let a=i.measureText(e.name);r.font="12px 'Fira Sans'",r.fillText(e.name,e.x*t/100+4-a.width/2,e.y*s/100+8),r.fill()}),this.screen=n.toDataURL("image/png"),n.toBlob(e=>{this.blob=e})},drawScaled(e){if(this.version.once.pdfViewer){if("page-mini"===e||"page-full"===e)e=this.calculateScale(),this.newScale=e;else if("twice"===e)e=this.newScale;else{let t=e>0?1:-1;e=this.newScale+this.newScale/10*t,this.newScale=e}this.version.once.pdfViewer.update(e,this.rotate),this.resizeLayers(),this.version.once.pdfViewer.draw().then(e=>{setTimeout(()=>{this.btn_off=!1,this.$store.commit("workflow/setPdfInit",!0)},0)}),this.version.twice.pdf&&(this.version.twice.pdfViewer.update(e,this.rotate),this.version.twice.pdfViewer.draw()),this.loading=!1}},resizeLayers(){this.$refs["pdf"].style.width=this.version.once.pdfViewer.width+"px",this.version.once.pdfWidth=this.version.once.pdfViewer.width,this.version.once.pdfHeight=this.version.once.pdfViewer.height;let e=this.$refs.view;e.style.width=this.version.once.pdfViewer.width+"px",e.style.height=this.version.once.pdfViewer.height+"px";let t=this.$refs.stack;t.style.width=this.version.once.pdfViewer.width+"px",t.style.height=this.version.once.pdfViewer.height+"px";let s=this.$refs["pdf-wrap"];this.$nextTick(()=>{this.compare_handler.left=100-this.twice_width,this.compare_handler.top=-1*(this.$refs["container"].getBoundingClientRect().y-s.getBoundingClientRect().y),this.compare_handler.height=s.clientHeight})},onMouseDown(e){document.body.classList.add("select-none"),this.posMouse={x:e.clientX,y:e.clientY,scrollY:this.$refs["pdf-wrap"].scrollTop,scrollX:this.$refs["pdf-wrap"].scrollLeft},this.mouse_down=1,document.addEventListener("mouseup",this.onMouseUp,!1),document.addEventListener("mousemove",this.onMouseMove,!1)},onMouseUp(e){this.mouse_down=0,document.body.classList.remove("select-none"),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)},onMouseMove(e){if(1==this.mouse_down){let t=this.posMouse.y-e.clientY;this.$refs["pdf-wrap"].scrollTop=this.posMouse.scrollY+t;let s=this.posMouse.x-e.clientX;this.$refs["pdf-wrap"].scrollLeft=this.posMouse.scrollX+s}if(1==this.compare_down){let t=this.posCompare.x-e.clientX;const s=this.$refs["container"].getBoundingClientRect(),a=this.$refs["pdf-wrap"];this.$refs["b-zoom"];if(this.posCompare.left-t>=a.clientWidth-s.x);else if(this.posCompare.left-t<=0)this.compare_handler.left=0,this.compare_handler.height=a.clientHeight,this.twice_width=100;else if(this.posCompare.left-t>=s.width)this.compare_handler.left=100,this.compare_handler.height=a.clientHeight,this.twice_width=0;else{let e=100/this.version.once.pdfViewer.width*(this.posCompare.left-t);this.compare_handler.left=e,this.compare_handler.height=a.clientHeight,this.twice_width=100-e}}},compareForScroll(e){this.compare_handler.top=-1*(this.$refs["container"].getBoundingClientRect().y-e.getBoundingClientRect().y),this.compare_handler.height=e.clientHeight}},mounted(){let e=this.$refs["pdf-wrap"],t=e.getBoundingClientRect();this.style_pdf={height:t.height+"px"};let s=this.model.files||!1;if(s){let e=this.model.version?(()=>{let e=s.filter(e=>e.id==this.model.version);return e?e[0]:s[0]})():s[0];this.version.once.value=e.version,this.FUrl=e.url,this.$store.dispatch("common/getFile",{id:e.url}).then(e=>{this.$nextTick(()=>{setTimeout(()=>this.setPDF(e.file,this.$refs.container,"once"),200),this.$refs["pdf"].addEventListener("mousedown",this.onMouseDown,!1),this.$refs["pdf-wrap"].addEventListener("scroll",e=>{this.compareForScroll(e.target)},!1)})})}},beforeDestroy(){this.$refs["pdf"].removeEventListener("mousedown",this.onMouseDown),this.$store.commit("workflow/setPdfInit",!1)}},gc=bc,yc=Object(m["a"])(gc,Br,Tr,!1,null,null,null),_c=yc.exports,Cc=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container",attrs:{fluid:"","fill-height":"","text-xs-center":"","pa-0":""}},[t(Ee["a"],{staticStyle:{position:"relative"},attrs:{wrap:"","ma-0":"",id:"fullscreen"}},[t("div",{ref:"canvas-wrap",staticClass:"m-3d-wrap",attrs:{id:"canvas-wrap"}},[t("iframe",{ref:"viewer",staticStyle:{height:"100%",width:"100%",border:"0"},attrs:{src:e.viewer,id:"viewer",name:"viewer"}})]),t("panel-options",{attrs:{options:e.options},on:{setOption:e.setOption,setSubOption:e.setSubOption}}),t("div",{staticClass:"m-panel__wrap--left",class:{multy:e.multy}},[t("panel-property",{directives:[{name:"show",rawName:"v-show",value:e.options.property.active,expression:"options.property.active"}],attrs:{menuItem:e.options.property,hiddenList:e.hiddenList,selectedObjID:e.selectedObjID,properties:e.propertiesObj,classifications:e.classifierList,styleP:e.getStylePanelsLeft.style},on:{setOption:e.setOption,onHideObject:e.onHideObject,onShowObject:e.onShowObject}}),t("panel-resurs",{directives:[{name:"show",rawName:"v-show",value:e.options.resurs.active,expression:"options.resurs.active"}],attrs:{menuItem:e.options.resurs,model:e.model,source:e.source,postMessage:e.postMessage,selectedObjID:e.selectedObjID,hiddenList:e.hiddenList,styleP:e.getStylePanelsLeft.style},on:{setOption:e.setOption,onHideObject:e.onHideObject,onShowObject:e.onShowObject,onObjectsHighlight:e.onObjectsHighlight,onShowObjectsOnly:e.onShowObjectsOnly,onCreateSectionBoxForObjects:e.onCreateSectionBoxForObjects,onRemoveSectionBox:e.onRemoveSectionBox,"update:selectedObjID":function(t){e.selectedObjID=t},"update:selected-obj-i-d":function(t){e.selectedObjID=t}}})],1),t("div",{staticClass:"m-panel__wrap--right",class:{multy:e.multy}},[t("panel-filters",{directives:[{name:"show",rawName:"v-show",value:e.options.filters.active,expression:"options.filters.active"}],attrs:{menuItem:e.options.filters,filters:e.filters,styleP:e.getStylePanels.style},on:{onFilter:e.onFilter,setFilters:e.setFilters,setOption:e.setOption,"update:filters":function(t){e.filters=t}}}),t("panel-dispatcher",{directives:[{name:"show",rawName:"v-show",value:e.options.dispatcher.active,expression:"options.dispatcher.active"}],attrs:{menuItem:e.options.dispatcher,levelsMap:e.levelsMap,hiddenList:e.hiddenList,postMessage:e.postMessage,styleP:e.getStylePanels.style},on:{setOption:e.setOption,onHideObject:e.onHideObject,onShowObject:e.onShowObject,onDispatcher:e.onDispatcher,getJsonFile:e.getJsonFile}}),t("panel-hidden",{directives:[{name:"show",rawName:"v-show",value:e.options.hidden.active,expression:"options.hidden.active"}],attrs:{menuItem:e.options.hidden,hiddenList:e.hiddenList,styleP:e.getStylePanels.style},on:{setOption:e.setOption,onShowObject:e.onShowObject}}),t("panel-delta",{directives:[{name:"show",rawName:"v-show",value:e.options.delta.active,expression:"options.delta.active"}],attrs:{menuItem:e.options.delta,delta:e.deltaList,styleP:e.getStylePanels.style},on:{setOption:e.setOption}}),t("panel-search",{directives:[{name:"show",rawName:"v-show",value:e.options.search.active,expression:"options.search.active"}],attrs:{worker:e.worker,ParamSearch:e.ParamSearch,styleP:e.getStylePanels.style,postMessage:e.postMessage,menuItem:e.options.search,list:e.ParamSearchId},on:{setOption:e.setOption,onSearch:e.onSearch,"update:ParamSearch":function(t){e.ParamSearch=t},"update:param-search":function(t){e.ParamSearch=t},"update:list":function(t){e.ParamSearchId=t}}}),t("panel-rooms",{directives:[{name:"show",rawName:"v-show",value:e.options.rooms.active,expression:"options.rooms.active"}],attrs:{menuItem:e.options.rooms,rooms:e.rooms,styleP:e.getStylePanels.style},on:{setOption:e.setOption,onRoomVisibilityItem:e.onRoomVisibilityItem,onRoomVisibility:e.onRoomVisibility,"update:rooms":function(t){e.rooms=t}}}),t("panel-collision-settings",{directives:[{name:"show",rawName:"v-show",value:e.options.collision_settings.active,expression:"options.collision_settings.active"}],attrs:{menuItem:e.options.collision_settings,model:e.model,source:e.source,compute_ready:e.compute_ready,collision_settings:e.collision_settings,collisions_compiling:e.collisions_compiling,styleP:e.getStylePanels.style},on:{setOption:e.setOption,onComputeCollisions:e.onComputeCollisions,onComputeParameters:e.onComputeParameters,onComputeRepeat:e.onComputeRepeat,"update:collisions_compiling":function(t){e.collisions_compiling=t}}}),t("panel-collision-report",{directives:[{name:"show",rawName:"v-show",value:e.options.collision_reports.active,expression:"options.collision_reports.active"}],attrs:{menuItem:e.options.collision_reports,planes:e.options.planes.active,collisions:e.options.collisions.active,model:e.model,compute_ready:e.compute_ready,onLoadsOptions:e.onLoads.options,styleP:e.getStylePanels.style},on:{"update:onLoadsOptions":function(t){return e.$set(e.onLoads,"options",t)},"update:on-loads-options":function(t){return e.$set(e.onLoads,"options",t)},setOption:e.setOption,onCollisionsActive:e.onCollisionsActive,onShowCollisionsOnly:e.onShowCollisionsOnly,onCreateSectionBoxForCollisions:e.onCreateSectionBoxForCollisions,onObjectsHighlight:e.onObjectsHighlight,onShowObjectsOnly:e.onShowObjectsOnly,onCreateSectionBoxForObjects:e.onCreateSectionBoxForObjects,onRemoveSectionBox:e.onRemoveSectionBox}}),t("panel-work-list",{directives:[{name:"show",rawName:"v-show",value:e.options.work_list.active,expression:"options.work_list.active"}],attrs:{menuItem:e.options.work_list,model:e.model,selectedObjID:e.selectedObjID,selectedObjIDList:e.selectedObjIDList,propertyJson:e.properties,source:e.source,styleP:e.getStylePanels.style},on:{setOption:e.setOption,onSetSelectionMode:e.onSetSelectionMode,onClearSelection:e.onClearSelection,onShowObjectsOnly:e.onShowObjectsOnly,onSetColorForObjects:e.onSetColorForObjects,onSetColorsForObjects:e.onSetColorsForObjects,onUnsetColorsForObjects:e.onUnsetColorsForObjects}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.options.tabs.active,expression:"options.tabs.active"}],staticClass:"m-panel__wrap--bottom",class:{multy:e.multy||e.options.tabs.minimize}},[t("panel-tabs",{attrs:{active:e.options.tabs.active,model:e.model,menuItem:e.options.tabs,minimize:e.options.tabs.minimize},on:{setOption:e.setOption,updateOption:e.updateOption}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.onLoadsCheck,expression:"!onLoadsCheck"}],staticClass:"m-back",class:{"m-back--trans":e.onLoads.model}},[t("div",{staticClass:"vm-progress"},[t("div",{staticClass:"loader"},[t("svg",{staticClass:"circular",attrs:{viewBox:"25 25 50 50"}},[t("circle",{staticClass:"path",attrs:{cx:"50",cy:"50",r:"20",fill:"none","stroke-width":"2","stroke-miterlimit":"10"}})]),t("div",{staticClass:"vm-progress--percent"},[t("span",[e._v(e._s(e.getPercent)+"%")])])]),t("span",[e._v(e._s(e.preloaderTitle))])])])],1),t("tools3d",{ref:"tools",attrs:{toolsbar:e.toolsbar},on:{"update:toolsbar":function(t){e.toolsbar=t}}})],1)},wc=[],kc=s("c4e3"),xc=(s("0083"),function(){var e=this,t=e._self._c;return t(St["a"],{staticClass:"m-navigator-tools m-navigator-no-scroll px-2 pr-0 m-navigator-hide",attrs:{permanent:"",width:e.tools_width,right:"",clipped:"",color:"transparent",app:""}},[t(Ee["a"],{staticClass:"ma-0",attrs:{"fill-height":""}},[t("div",{staticClass:"m-overflow-hidden m-tools-content",class:{"m-tools-content--mini":e.mini}},[t(Ee["a"],{staticClass:"ma-0",attrs:{"fill-height":""}},["comment"==e.tab?t("comments3d",{attrs:{getPosCamera:e.getPosCamera,setPosCamera:e.setPosCamera,documentId:e.documentId},on:{"update:getPosCamera":function(t){e.getPosCamera=t},"update:get-pos-camera":function(t){e.getPosCamera=t}}}):e._e(),"history"==e.tab?t("history-list"):e._e(),"access"==e.tab?t("access"):e._e()],1)],1),t("div",{staticClass:"pl-0 pr-0 text-right m-tools-menu",attrs:{ccols:"2"}},[t($e["a"],{staticClass:"m-nav-right-tools m-nav-right-tools__dil",on:{click:function(t){return t.stopPropagation(),e.expand.apply(null,arguments)}}},[t(o["a"],{attrs:{size:"25",color:"#7f7f7f"}},[e._v(e._s(e.mini?"mdi-chevron-double-left":"mdi-chevron-double-right"))])],1),e._l(e.tabs,(function(s,a){return t($e["a"],{key:a,staticClass:"m-nav-right-tools",class:{active:s.name==e.tab},on:{click:function(t){return e.setTab(s.name)}}},[t(o["a"],{attrs:{color:e.activeBtn(s.name),size:"25"}},[e._v(e._s(s.icon))])],1)}))],2)])],1)}),Sc=[],Ac=function(){var e=this,t=e._self._c;return t("div",{staticClass:"m-comment-box"},[t("div",{staticClass:"m-comment-list"},[t("div",{ref:"list-items",staticClass:"m-comment-list--items"},e._l(e.commentList,(function(s,a){return t(xs["a"],{key:"comment"+s.id,attrs:{dense:""}},[t(ws["a"],{attrs:{cols:"12"}},[t("comment3d",{attrs:{comment:s,posActive:e.posActive},on:{getPosCamera:e.getPosCamera,"update:posActive":function(t){e.posActive=t},"update:pos-active":function(t){e.posActive=t}}})],1)],1)})),1)]),t("div",{staticClass:"m-comment-header"},[t(xs["a"],{attrs:{dense:""}},[t(ws["a"],{attrs:{cols:"12"}},[t(We["a"],{directives:[{def:Hr["a"],name:"click-outside",rawName:"v-click-outside",value:e.focusInputRemove,expression:"focusInputRemove"}],staticClass:"m-comment-input",class:{active:e.focus},attrs:{outlined:!0,color:"#fff"},on:{mouseup:e.focusInput}},[t(aa["a"],{attrs:{"py-0":""}},[t(xs["a"],[t(ws["a"],{staticClass:"pb-0",attrs:{cols:"2"}},[t(ot["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:"https://cdn.vuetifyjs.com/images/john.jpg"}})])],1),t(ws["a"],{staticClass:"py-0",attrs:{cols:"10"}},[t(bi["a"],{staticClass:"m-comment-no-border",attrs:{id:"comment",placeholder:"Комментировать","auto-grow":"",outlined:"","hide-details":"","multi-line":"",rows:"2"},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}})],1)],1),t(xs["a"],{directives:[{name:"show",rawName:"v-show",value:e.focus,expression:"focus"}]},[t(ws["a"],{staticClass:"pt-0",attrs:{cols:"2"}}),t(ws["a"],{staticClass:"pt-0",attrs:{cols:"10"}},[t(zt["a"],{staticClass:"pa-0"},[t(Xe["a"],{staticClass:"mt-2 m-btn",attrs:{disabled:!e.comment,outlined:"",dense:"",color:"primary"},on:{click:e.saveComment}},[e._v("\n                                    Опубликовать\n                                    ")]),t(Xe["a"],{staticClass:"mt-2 m-btn m-btn-normal",attrs:{disabled:!e.comment,outlined:"",dense:"",color:"normal"},on:{click:e.clearComment}},[e._v("\n                                    Отмена\n                                    ")])],1)],1)],1)],1)],1)],1)],1)],1)])},Ic=[],Oc=function(){var e=this,t=e._self._c;return t(We["a"],{directives:[{def:Hr["a"],name:"click-outside",rawName:"v-click-outside",value:e.no_view,expression:"no_view"}],staticClass:"m-comment-card",class:[{active:e.activeComment}],attrs:{outlined:!0,color:"#fafafa"},on:{mouseenter:e.commentHover,mouseleave:e.commentLeave},nativeOn:{click:function(t){return e.view.apply(null,arguments)}}},[t("comment-item",{attrs:{comment:e.comment,viewMode:e.viewMode}}),t(aa["a"],{directives:[{name:"show",rawName:"v-show",value:e.viewMode,expression:"viewMode"}],staticClass:"m-reply-wrap pt-0"},[t(bi["a"],{staticClass:"m-comment-avatar",attrs:{placeholder:"Ответить","auto-grow":"","hide-details":"","multi-line":"",rows:"2"},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[t(ot["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:"https://cdn.vuetifyjs.com/images/john.jpg",alt:"avatar"}})])]},proxy:!0}]),model:{value:e.reply,callback:function(t){e.reply=t},expression:"reply"}}),t(xs["a"],[t(ws["a"],{staticClass:"pt-0",attrs:{cols:"2"}}),t(ws["a"],{staticClass:"pt-0",attrs:{cols:"10"}},[t(zt["a"],{staticClass:"pa-0"},[t(Xe["a"],{staticClass:"mt-2 m-btn",attrs:{disabled:!e.reply,outlined:"",dense:"",color:"primary"},on:{click:e.replyComment}},[e._v("\n                    Ответить\n                    ")]),t(Xe["a"],{staticClass:"mt-2 m-btn m-btn-normal",attrs:{disabled:!e.reply,outlined:"",dense:"",color:"normal"},on:{click:e.clearReply}},[e._v("\n                    Отмена\n                    ")])],1)],1)],1)],1)],1)},jc=[],Fc={name:"Comment",props:["comment"],directives:{clickOutside:Jr.a.directive},components:{CommentItem:Wr},data(){return{reply:"",viewMode:!1}},computed:{draftSelected(){return this.$store.state.workflow.draftSelected},activeComment(){let e=this.$store.state.workflow.activeComment;return e==this.comment.id?this.viewMode=!0:this.viewMode=!1,this.viewMode}},watch:{viewMode(e){e&&this.$emit("update:posActive",this.$el.offsetTop)}},methods:{view(){this.$emit("getPosCamera",this.comment.position),this.$store.commit("workflow/setActiveComment",this.comment.id)},no_view(){this.viewMode&&(this.$store.commit("workflow/setActiveComment",!1),this.viewMode=!1)},replyComment(){let e={type:"reply",comment_id:this.comment.id,avatar:"https://cdn.vuetifyjs.com/images/john.jpg",user:"Имя Фамилия",text:this.reply,title:"Версия документа 1"};this.$store.dispatch("workflow/addReply",{reply:e,id:this.comment.id}),this.reply=""},clearReply(){this.reply=""},commentHover(){this.$store.commit("workflow/setDraftHover",this.comment.id)},commentLeave(){this.$store.commit("workflow/setDraftHover","")}}},Pc=Fc,Ec=Object(m["a"])(Pc,Oc,jc,!1,null,null,null),Uc=Ec.exports,Bc={name:"Comments",components:{Comment3d:Uc},directives:{ClickOutside:sl.a},props:["getPosCamera","setPosCamera","documentId"],data(){return{comment:"",focus:!1,posActive:0}},computed:Object(h["b"])({commentList(e){return e.workflow.commentList},markerStack(e){let t=e.workflow.markerStack;return t},markerList(e){return e.workflow.markerList},markerEdit(e){return e.workflow.markerEdit}}),watch:{focus(e){this.focusComment(e)},posActive(e){this.scrollToComment(e)}},methods:{scrollToComment(e){this.$nextTick(()=>{this.$refs["list-items"].scrollTo({top:e-4,behavior:"smooth"})})},focusComment(e){this.$nextTick(()=>{if(e){let e=document.getElementById("comment");e.focus()}})},saveComment:function(){let e={type:"comment",avatar:"https://cdn.vuetifyjs.com/images/john.jpg",title:"Версия документа 1",user:"Имя Фамилия",text:this.comment,reply:new Array,position:this.setPosCamera(),doc:"3d"};this.$store.dispatch("workflow/addComment",e),this.comment="",this.focus=!1},clearComment(){this.comment="",this.focus=!1},focusInput(){this.focus=!0},focusInputRemove(){this.focus&&!this.comment&&(this.focus=!1)}},created(){let e=this.$store.state.workflow.commentState;e.status&&(this.comment=e.commentInput,this.$store.commit("workflow/setActiveComment",e.commentActive))},beforeDestroy(){this.$store.dispatch("workflow/saveCommentState",{input:this.comment}),this.$store.commit("workflow/setActiveComment",!1)}},Tc=Bc,Lc=Object(m["a"])(Tc,Ac,Ic,!1,null,null,null),Nc=Lc.exports,Hc=function(){var e=this,t=e._self._c;return t(ws["a"],{staticClass:"pt-0",style:{overflow:"auto"},attrs:{cols:"12"}},[t(xs["a"],{attrs:{dense:""}},e._l(e.userList,(function(s,a){return t(ws["a"],{key:a,attrs:{cols:"12"}},[t(We["a"],{staticClass:"m-access-card",attrs:{outlined:!0,color:"#fafafa"}},[t(aa["a"],{staticClass:"pt-0"},[t(xs["a"],[t(ws["a"],{staticClass:"pt-1",attrs:{cols:"2"}},[t(ot["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:"https://cdn.vuetifyjs.com/images/john.jpg"}})])],1),t(ws["a"],{staticClass:"pt-0",attrs:{cols:"10"}},[t("div",{staticClass:"m-access-name"},[e._v("\n                                "+e._s(s.name)+"\n                            ")]),t("div",{staticClass:"m-access-emp"},[e._v("\n                                "+e._s(s.emp)+"\n                            ")]),s.userID!=e.user.id||s.status?t("div",{staticClass:"m-access-status"},[e._v("\n                                "+e._s(e.getStatus(s.status))+"\n                            ")]):t(zt["a"],{staticClass:"pa-0"},[s.status?e._e():t(Xe["a"],{staticClass:"mt-2 m-btn",attrs:{outlined:"",color:"primary"},on:{click:function(t){return e.setAccess(s.id)}}},[e._v("\n                                Утвердить\n                                ")])],1)],1)],1)],1)],1)],1)})),1)],1)},Mc=[],zc={name:"Access",data(){return{user:{id:"001"},statusList:[{value:1,name:"Утвердил"},{value:0,name:"Не утвердил"}],userList:[{id:"003",userID:"002",avatar:"https://cdn.vuetifyjs.com/images/john.jpg",name:"Вася Петров",emp:"Главный архитектор",status:1},{id:"002",userID:"003",avatar:"https://cdn.vuetifyjs.com/images/john.jpg",name:"Вася Петров",emp:"Главный инженер",status:0},{id:"001",userID:"001",avatar:"https://cdn.vuetifyjs.com/images/john.jpg",name:"Вася Петров",emp:"Главный архитектор",status:0}]}},methods:{getStatus(e){return this.statusList.filter(t=>t.value==e)[0].name},setAccess(e){this.userList=this.userList.map(t=>t.id==e?Object.assign(t,{status:1}):t)}}},$c=zc,Rc=Object(m["a"])($c,Hc,Mc,!1,null,null,null),Dc=Rc.exports,Jc={name:"Tools",components:{Comments3d:Nc,HistoryList:gl,Access:Dc},props:["getPosCamera","setPosCamera","documentId"],data(){return{mini:!0,tools_width:0,tab:"comment",tabs:[{name:"history",icon:"history"},{name:"comment",icon:"mdi-comment-text-outline"},{name:"access",icon:"mdi-stamper"}]}},watch:{mini:function(e){this.tools_width=e?0:440,this.$emit("update:toolsbar",e)}},methods:{setTab(e){this.tab=e},activeBtn(e){let t=this.tab==e?"#2c2c2c":"#7f7f7f";return t},expand(){this.mini=!this.mini}}},Vc=Jc,Kc=Object(m["a"])(Vc,xc,Sc,!1,null,null,null),Gc=Kc.exports,Qc=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__property m-card-scrollable",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-23 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Свойства объекта "),t("b",[e._v(" "+e._s(e.properties.Name))]),t(Rt["a"]),t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:"Room"!=e.properties.object,expression:"properties.object != 'Room'"}],staticClass:"m-btn--close-top m-btn--close-top__right3",attrs:{text:"",icon:"",disabled:!e.selectedObjID,color:"#7f7f7f"},on:{click:e.visibilityObject}},[t(o["a"],{attrs:{size:"20"}},[e._v(e._s(this.hidden?"mdi-eye-off":"mdi-eye"))])],1),t(Xe["a"],{staticClass:"m-btn--close-top m-btn--close-top__right2",attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{staticClass:"m-btn--close-top",attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),e.checkArray.list.length?t(zt["c"],{staticClass:"pa-0 pb-5 m-card-scrollable__text"},[e._l(e.checkArray.list,(function(s){return t("div",[t("div",{staticClass:"m-card-list__title"},[e._v(e._s(s.Name))]),e._l(s.PropertySet,(function(s){return t("div",{staticClass:"m-card-list__row"},[t("span",{staticClass:"m-card-list__cell"},[e._v(e._s(s.Name))]),t("span",{staticClass:"m-card-list__cell"},[e._v(e._s(s.NominalValue))])])}))],2)})),e.classifications&&!e.checkArray.classifier?[t("div",{staticClass:"m-card-list__title px-4"},[e._v("Классификация:")]),"none"==e.classifications?[t("div",{staticClass:"m-card-list__row"},[t("span",{staticClass:"m-card-list__div"},[e._v("Классификатор не был создан, так как Информационная Модель не соответствует требованиям по КСИ или СП.\n                    ")])])]:e._l(e.classifications.Classification,(function(s){return t("div",{staticClass:"m-card-list__row"},[t("span",{staticClass:"m-card-list__cell"},[e._v(e._s(s.Name))]),t("span",{staticClass:"m-card-list__cell"},[e._v(e._s(s.NominalValue))])])}))]:e._e()],2):t(zt["c"],{staticClass:"pa-0 pb-5 m-card-scrollable__text"},[t("div",{staticClass:"py-2 px-4 m-text--size14 m-text--center m-text--color-2c2c2c"},[e._v("Выберите объект.\n        ")])])],1)},Xc=[],Wc={name:"PanelProperty",props:["menuItem","hiddenList","properties","classifications","selectedObjID","styleP"],data(){return{minimize:!1}},computed:{hidden(){return this.hiddenList.some(e=>e.id==this.selectedObjID)},checkArray(){let e=this.properties.Properties||this.properties.Parameters,t=Array.isArray(e),s=[],a=!1;return t&&(s=e.map(e=>(e.Name&&"Classification"==e.Name&&(a=!0),{Name:e.PropertyGroupTitle||e.Name,PropertySet:e.PropertyList?e.PropertyList.filter(e=>e).map(e=>({Name:e.Title,NominalValue:e.Value+e.Units||""})):e.PropertySet?e.PropertySet:e.Quantities?e.Quantities.filter(e=>e).map(e=>({Name:e.Name,NominalValue:e.Value+(e.Units||"")||""})):[]}))),{list:s,check:t,classifier:a}}},methods:{cancel(){this.$emit("setOption",this.menuItem)},visibilityObject(){this.hidden?this.$emit("onShowObject",[this.selectedObjID]):this.$emit("onHideObject",[this.selectedObjID])}}},Yc=Wc,qc=Object(m["a"])(Yc,Qc,Xc,!1,null,null,null),Zc=qc.exports,em=s("3129"),tm=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-card-scrollable m-dispatcher",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-0 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Диспетчер проекта\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t("panel-btn-mode-tmpl",{attrs:{list:e.list,menuItem:e.menuItem,postMessage:e.postMessage}}),t(zt["c"],{staticClass:"pa-0 pt-2 pb-5 m-card-scrollable__text"},[e.checkDev()?t("div",{staticClass:"m-link px-3",on:{click:e.getJsonFile}},[e._v("\n            скачать json\n        ")]):e._e(),t(em["a"],{directives:[{name:"show",rawName:"v-show",value:!e.levelsMap.length,expression:"!levelsMap.length"}],attrs:{type:"list-item-three-line, list-item-three-line"}}),t(Cr["a"],{directives:[{name:"show",rawName:"v-show",value:e.levelsMap.length,expression:"levelsMap.length"}],staticClass:"m-panel__collision--tree m-text--size12",attrs:{items:e.levelsMap,dense:"","return-object":"","expand-icon":"mdi-chevron-down",transition:"","item-key":"id",activatable:""},on:{"update:active":e.getList},scopedSlots:e._u([{key:"label",fn:function({item:t}){return[e._v("\n                "+e._s(t.name)+"\n            ")]}},{key:"prepend",fn:function({item:s}){return[t("icon-botton",{staticClass:"mr-4",on:{onClick:function(t){return e.onSelect(s,!s.hidden)}}},[e._v(e._s(s.hidden?"mdi-eye-off":"mdi-eye")+"\n                ")])]}}])})],1)],1)},sm=[],am=function(){var e=this,t=e._self._c;return t("span",{staticClass:"m-icon-botton",class:{"m-icon-botton--disabled":e.disabled},on:{click:e.onClick}},[t(o["a"],{attrs:{color:e.color,size:"20"}},[e._t("default")],2)],1)},im=[],om={name:"IconBotton",props:{disabled:{type:Boolean,required:!1},color:{type:String,required:!1},stop:{type:Boolean,required:!1}},methods:{onClick(e){this.stop&&e.stopPropagation(),this.$emit("onClick")}}},nm=om,rm=(s("e6e9"),Object(m["a"])(nm,am,im,!1,null,null,null)),lm=rm.exports,cm=function(){var e=this,t=e._self._c;return t(zt["d"],{staticClass:"pa-0"},[t("div",{staticClass:"pr-0 pl-1 py-1 m-panel__collision--options"},[t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",tile:"",dense:"",disabled:!e.list.length||!e.activeClsn,color:e.activeBox?"primary":"default"},on:{click:e.turnActiveBox}},[t(o["a"],{attrs:{left:"",size:"20"}},[e._v("trd-section")]),t("span",{staticClass:"m-text--size12"},[e._v("Показать")])],1),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.list.length,color:e.activeClsn&&e.list.length?"primary":"default"},on:{onClick:e.turnActiveClsn}},[e._v("trd-cube_hide\n        ")]),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.list.length,color:e.activeOnly&&e.list.length?"primary":"default"},on:{onClick:e.turnActiveOnly}},[e._v("trd-cube_show\n        ")])],1)])},mm=[],dm={name:"PanelBtnModeTmpl",components:{IconBotton:lm},props:["menuItem","list","postMessage"],data(){return{mode:[{name:"clsn",value:!1},{name:"box",value:!1},{name:"only",value:!1}],items:[]}},computed:{activeClsn:{get(){return this.mode.find(e=>"clsn"==e.name).value},set(e){this.mode=this.mode.map(t=>("clsn"==t.name&&(t.value=e),t))}},activeBox:{get(){return this.mode.find(e=>"box"==e.name).value},set(e){this.mode=this.mode.map(t=>("box"==t.name&&(t.value=e),t))}},activeOnly:{get(){return this.mode.find(e=>"only"==e.name).value},set(e){this.mode=this.mode.map(t=>("only"==t.name&&(t.value=e),t))}}},watch:{menuItem:{handler(e){e.active||(this.activeClsn&&this.turnActiveClsn(),this.activeOnly&&this.turnActiveOnly())},deep:!0},list(e){e?(this.activeClsn&&this.onActiveMode("clsn",!1),this.items=e,this.mode.map(e=>{e.value&&this.onActiveMode(e.name,!0)})):(this.activeClsn&&this.turnActiveClsn(),this.activeOnly&&this.turnActiveOnly())}},methods:{turnActiveClsn(){this.activeClsn=!this.activeClsn,this.activeOnly&&(this.onActiveMode("only",!1),this.activeOnly=!1),this.activeClsn||this.activeBox&&this.turnActiveBox(),this.onActiveMode("clsn",this.activeClsn)},turnActiveBox(){this.activeBox=!this.activeBox,this.activeOnly&&(this.onActiveMode("only",!1),this.activeOnly=!1),this.onActiveMode("box",this.activeBox)},turnActiveOnly(){this.activeOnly=!this.activeOnly,this.activeBox&&(this.onActiveMode("box",!1),this.activeBox=!1),this.activeClsn&&(this.onActiveMode("clsn",!1),this.activeClsn=!1),this.onActiveMode("only",this.activeOnly)},onActiveMode(e,t){let s=this.items;if(s.length)switch(e){case"clsn":this.onObjectsHighlight({list:s,active:t});break;case"box":this.onCreateSectionBoxForObjects({list:s,active:t});break;case"only":this.onShowObjectsOnly({list:s,active:t});break;default:}},onObjectsHighlight(e){this.postMessage({action:"onObjectsHighlight",value:{list:e.list,active:e.active}})},onShowObjectsOnly(e){this.postMessage({action:"onShowObjectsOnly",value:{list:e.list,active:e.active}})},onCreateSectionBoxForObjects(e){this.postMessage({action:"onCreateSectionBoxForObjects",value:{list:e.list,active:e.active}})}}},pm=dm,um=Object(m["a"])(pm,cm,mm,!1,null,null,null),hm=um.exports,fm={name:"PanelDispatcher",components:{IconBotton:lm,PanelBtnModeTmpl:hm},props:["menuItem","levelsMap","hiddenList","styleP","postMessage"],data(){return{minimize:!1,map:null,selected:[],list:[]}},computed:{},watch:{hiddenList(e){this.$emit("onDispatcher")}},methods:{getList(e){if(e.length){let t=e[0].children.map(e=>e.id);this.list=t}else this.list=[]},cancel(){this.$emit("setOption",this.menuItem)},checkDev(){let e=window.location.hostname;return"localhost"==e||"prodoc.ubdev.ru"},getJsonFile(){this.$emit("getJsonFile")},onSelect(e,t){let s=[];const a=e=>{let s=[];return"group"==e.type?s=e.children.filter(e=>e.hidden!=t).map(e=>e.id):e.children.map(e=>{s=[...s,...a(e)]}),s};"item"==e.type?s.push(e.id):s=a(e),s.length&&(t?this.$emit("onHideObject",s):this.$emit("onShowObject",s))},selectItem(e,t){let s=[];if(this.map[e.id].hidden=t,t)this.selected.some(t=>t==e.id)||("main"!=this.map[e.id].level&&(this.map[e.level].selected+=1),this.selected.push(e.id),"item"==e.type&&s.push(e.id));else if(this.selected.some(t=>t==e.id)){"main"!=this.map[e.id].level&&(this.map[e.level].selected-=1);let t=this.selected.indexOf(e.id);-1!=t&&this.selected.splice(t,1),"item"==e.type&&s.push(e.id)}return s}}},vm=fm,bm=(s("b7c6"),Object(m["a"])(vm,tm,sm,!1,null,"feb6935e",null)),gm=bm.exports,ym=s("ac7c"),_m=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-card-scrollable",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-0 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Ресурсы\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["d"],{staticClass:"pr-0 pl-4 py-2 m-modal--title-size14 m-card-scrollable__title"},[t(Xe["a"],{staticClass:"m-btn m-btn--float mr-2",class:{"m-btn-normal":!e.level},attrs:{outlined:"",color:e.level?"primary":"normal"},on:{click:function(t){return e.filterRun("level")}}},[e._v("Местоположение")]),t(Xe["a"],{staticClass:"m-btn m-btn--float",class:{"m-btn-normal":!e.cat},attrs:{outlined:"",color:e.cat?"primary":"normal"},on:{click:function(t){return e.filterRun("cat")}}},[e._v("Конструктив")])],1),t(nt["a"]),t(zt["d"],{staticClass:"pa-0"},[t("div",{staticClass:"pr-0 pl-1 py-1 m-panel__collision--options"},[t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",tile:"",dense:"",disabled:!e.active.length||!e.activeClsn,color:e.activeBox?"primary":"default"},on:{click:e.turnActiveBox}},[t(o["a"],{attrs:{left:"",size:"20"}},[e._v("trd-section")]),t("span",{staticClass:"m-text--size12"},[e._v("Показать")])],1),t("icon-botton",{staticClass:"mr-3",attrs:{disabled:!e.active.length,color:e.activeClsn&&e.active.length?"primary":"default"},on:{onClick:e.turnActiveClsn}},[e._v("trd-cube_hide\n            ")]),t("icon-botton",{staticClass:"mr-3",attrs:{disabled:!e.active.length,color:e.activeOnly&&e.active.length?"primary":"default"},on:{onClick:e.turnActiveOnly}},[e._v("trd-cube_show\n            ")]),t(Xe["a"],{staticClass:"m-btn px-2",attrs:{text:"",tile:"",dense:""},on:{click:function(t){return e.onVisibleAll(!1)}}},[t(o["a"],{attrs:{left:"",color:"#757575",size:"20"}},[e._v("mdi-eye-off")]),t("span",{staticClass:"m-text--size12"},[e._v("Скрыть все")])],1),t(Xe["a"],{staticClass:"m-btn px-1",attrs:{text:"",tile:"",dense:""},on:{click:function(t){return e.onVisibleAll(!0)}}},[t(o["a"],{attrs:{left:"",color:"#757575",size:"20"}},[e._v("mdi-eye")]),t("span",{staticClass:"m-text--size12"},[e._v("Показать все")])],1)],1)]),t(nt["a"]),t(zt["d"],{staticClass:"pr-0 pl-4 py-2 m-modal--title-size14 m-card-scrollable__title"},[t(ym["a"],{staticClass:"ma-0",attrs:{color:"primary",label:"Выбор элемента","hide-details":""},on:{change:e.onSelect},model:{value:e.selectMode,callback:function(t){e.selectMode=t},expression:"selectMode"}})],1),t(nt["a"]),t(zt["c"],{staticClass:"pa-0 pt-2 pb-5 m-card-scrollable__text"},[t(em["a"],{directives:[{name:"show",rawName:"v-show",value:!e.getLevels.length&&e.load,expression:"!getLevels.length && load"}],attrs:{type:"list-item-three-line, list-item-three-line"}}),t(Cr["a"],{directives:[{name:"show",rawName:"v-show",value:e.getLevels.length,expression:"getLevels.length"}],key:e.tree_id,staticClass:"m-resource m-panel__collision--tree m-text--size12",attrs:{items:e.getLevels,active:e.active,dense:"",activatable:"","return-object":"","expand-icon":"mdi-chevron-down",transition:"","item-key":"id"},on:{"update:active":[function(t){e.active=t},e.onActive]},scopedSlots:e._u([{key:"label",fn:function({item:t}){return[e._v("\n                "+e._s(t.name)+"\n            ")]}},{key:"prepend",fn:function({item:s}){return[t("icon-botton",{staticClass:"mr-4",attrs:{stop:""},on:{onClick:function(t){return e.onVisibile(s,!s.hidden)}}},[e._v(e._s(s.hidden?"mdi-eye-off":"mdi-eye")+"\n                ")])]}}])})],1)],1)},Cm=[],wm={name:"PanelResurs",components:{IconBotton:lm},props:["menuItem","hiddenList","styleP","model","source","selectedObjID","postMessage"],data(){return{minimize:!1,map:null,tree_id:0,selectMode:!1,selected:[],active:[],level:!1,cat:!1,group:!0,worker:null,levels:[],load:!0,visibleItem:!1,mode:[{name:"clsn",value:!1},{name:"box",value:!1},{name:"only",value:!1}]}},computed:{getLevels(){return this.levels},activeClsn:{get(){return this.mode.find(e=>"clsn"==e.name).value},set(e){this.mode=this.mode.map(t=>("clsn"==t.name&&(t.value=e),t))}},activeBox:{get(){return this.mode.find(e=>"box"==e.name).value},set(e){this.mode=this.mode.map(t=>("box"==t.name&&(t.value=e),t))}},activeOnly:{get(){return this.mode.find(e=>"only"==e.name).value},set(e){this.mode=this.mode.map(t=>("only"==t.name&&(t.value=e),t))}}},watch:{menuItem:{handler(e){e.active?this.worker?this.getResource():(this.worker=new Worker(window.location.origin+"/js/wresource.js"),this.worker.addEventListener("message",this.workerMessage,!1)):(this.activeClsn&&this.turnActiveClsn(),this.activeOnly&&this.turnActiveOnly(),this.active=[])},deep:!0},hiddenList(e){this.levels.length&&(this.load=!1,this.worker.postMessage({action:"onHidden",filters:this.getFilters(),list:e}))}},methods:{getFilters(){let e=[];return this.level&&(e=[...e,"level"]),this.cat&&(e=[...e,"cat"]),this.group&&(e=[...e,"group"]),e=[...e,"items"],e},getResource(){let e=[];if("consolidations"==this.model.type)this.$store.state.workflow.listDocs.filter(e=>this.model.consolidations.some(t=>t==e.id)).map(t=>{if(null==t.version)e.push(t.files[0].url);else{let s=t.files.find(e=>e.id==t.version);e.push(s?s.url:t.files[0].url)}});else if(null==this.model.version)e.push(this.model.files[0].url);else{let t=this.model.files.find(e=>e.id==this.model.version);e.push(t?t.url:this.model.files[0].url)}this.worker.postMessage({action:"getfile",token:this.$store.state.auth.token,urllist:e,api:f["cloud"]+C["getfile"],tag:"/resource.json",filters:this.getFilters(),hiddenList:this.hiddenList})},workerMessage(e){if(Object.prototype.hasOwnProperty.call(e.data,"action"))switch(e.data.action){case"initworker":this.getResource();break;case"buildtree":this.buildtree(e.data);break;case"buildSelected":this.buildSelected(e.data);break;case"onVisibleAll":this.setVisibleAll(e.data);break;default:}},cancel(){this.activeClsn&&this.turnActiveClsn(),this.activeOnly&&this.turnActiveOnly(),this.active=[],this.$emit("setOption",this.menuItem)},filterRun(e){this.tree_id+=1,this[e]=!this[e],this.load=!1,this.worker&&this.worker.postMessage({action:"buildtree",filters:this.getFilters()})},buildtree(e){this.levels=e.map,this.load=!0},onVisibleAll(e){this.worker.postMessage({action:"onVisibleAll",value:e})},onVisibile(e,t){this.load=!1,this.worker.postMessage({action:"onVisibile",filters:this.getFilters(),item:e,hidden:t})},setVisibleAll(e){this.buildSelected({hidden:!e.value,items:e.list})},buildSelected(e){e.hidden?this.$emit("onHideObject",e.items):this.$emit("onShowObject",e.items)},onActive(e){let t=e[0];t?(this.activeClsn&&this.onActiveMode("clsn",!1),"item"==t.type&&this.selectMode&&this.postMessage({action:"selectObjectById",value:t.id}),this.selected=this.active,this.mode.map(e=>{e.value&&this.onActiveMode(e.name,!0)})):this.selected.length&&(this.mode.map(e=>{this.onActiveMode(e.name,!1)}),this.selected=[],this.postMessage({action:"clearSelection",value:!0}))},onSelect(e){e?this.active.length&&"item"==this.active[0].type&&this.postMessage({action:"selectObjectById",value:this.active[0].id}):this.postMessage({action:"clearSelection",value:!0})},turnActiveClsn(){this.activeClsn=!this.activeClsn,this.activeOnly&&(this.onActiveMode("only",!1),this.activeOnly=!1),this.activeClsn||this.activeBox&&this.turnActiveBox(),this.onActiveMode("clsn",this.activeClsn)},turnActiveBox(){this.activeBox=!this.activeBox,this.activeOnly&&(this.onActiveMode("only",!1),this.activeOnly=!1),this.onActiveMode("box",this.activeBox)},turnActiveOnly(){this.activeOnly=!this.activeOnly,this.activeBox&&(this.onActiveMode("box",!1),this.activeBox=!1),this.activeClsn&&(this.onActiveMode("clsn",!1),this.activeClsn=!1),this.onActiveMode("only",this.activeOnly)},onActiveMode(e,t){let s=this.selected;if(!s.length)return;const a=e=>{let t=[];return"group"!=e.type?e.children.map(e=>{t=[...t,...a(e)]}):t=e.children.map(e=>e.id),t};let i=[];switch(s.map(e=>{"item"==e.type?i.push(e.id):i=[...i,...a(e)]}),e){case"clsn":i.length&&this.$emit("onObjectsHighlight",{list:i,active:t});break;case"box":i.length&&this.$emit("onCreateSectionBoxForObjects",{list:i,active:t});break;case"only":i.length&&this.$emit("onShowObjectsOnly",{list:i,active:t});break;default:}}},beforeDestroy(){this.worker&&(this.worker.terminate(),this.worker=null,this.load=!0,this.levels=[])}},km=wm,xm=(s("cb89"),Object(m["a"])(km,_m,Cm,!1,null,null,null)),Sm=xm.exports,Am=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-card-scrollable",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-0 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Скрытые объекты\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["d"],{staticClass:"pa-0"},[t("div",{staticClass:"pr-0 pl-1 py-1 m-panel__collision--options"},[t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",tile:"",dense:""},on:{click:function(t){return e.onVisibleAll()}}},[t(o["a"],{attrs:{left:"",color:"#757575",size:"20"}},[e._v("mdi-eye")]),t("span",{staticClass:"m-text--size12"},[e._v("Показать все")])],1)],1)]),t(nt["a"]),t(zt["c"],{staticClass:"pa-0 pb-5 m-card-scrollable__text"},[e.hiddenList.length?t(Ye["a"],{staticClass:"pa-0",attrs:{nav:"",dense:""}},e._l(e.hiddenList,(function(s,a){return t($e["a"],{key:a,staticClass:"ma-0 px-4",on:{click:function(t){return e.getObject(s)}}},[t(ur["a"],{staticClass:"mr-2"},[t(o["a"],{attrs:{size:"20"},domProps:{textContent:e._s("mdi-eye-off")}})],1),t(Re["a"],[t(Re["c"],{domProps:{textContent:e._s(s.name)}})],1)],1)})),1):t("div",{staticClass:"py-2 px-4 m-text--size14 m-text--center m-text--color-2c2c2c"},[e._v("У вас нет скрытых объектов, выберите объект и скройте его.\n            "),t("div",{staticClass:"py-2 px-4 m-text--size12 m-text--center"},[t("a",{attrs:{href:""}},[e._v("Как это сделать?")])])])],1)],1)},Im=[],Om={name:"PanelHidden",props:["menuItem","hiddenList","styleP"],data(){return{minimize:!1}},methods:{cancel(){this.minimize=!1,this.$emit("setOption",this.menuItem)},getObject(e){this.$emit("onShowObject",[e.id])},onVisibleAll(){this.$emit("onShowObject",this.hiddenList.map(e=>e.id))}}},jm=Om,Fm=Object(m["a"])(jm,Am,Im,!1,null,null,null),Pm=Fm.exports,Em=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-card-scrollable",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-0 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Постановление 87\n        "),t("span",{staticClass:"m-text--color-red"},[e._v(" (бета версия)")]),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pa-0 pb-5 m-card-scrollable__text"},[t($e["a"],{staticClass:"py-0 m-link--list-item"},[t(Re["a"],{staticClass:"pl-1 py-0"},[t("span",[t("a",{attrs:{target:"_blank",href:"https://doc.unitbim.ru/vozmozhnosti/postanovlenie-87-v-im"}},[e._v(" Почему не скрываются объекты?")])])])],1),e._l(e.filters,(function(s){return t(Fi["a"],{staticClass:"m-list-group",attrs:{value:!0,"sub-group":""},scopedSlots:e._u([{key:"activator",fn:function(){return[t(Re["a"],{staticClass:"pl-1 py-3"},[t(Re["c"],[e._v(e._s(s.title))])],1)]},proxy:!0},{key:"prependIcon",fn:function(){return[t(ur["a"],{staticClass:"ma-0"},[t(o["a"],{staticClass:"ma-0",attrs:{size:"20"},domProps:{textContent:e._s("mdi-chevron-down")}})],1)]},proxy:!0}],null,!0)},e._l(s.items,(function(s){return t(Fi["a"],{staticClass:"m-list-group",attrs:{value:!0},on:{click:function(e){}},scopedSlots:e._u([{key:"activator",fn:function(){return[t(Re["a"],{staticClass:"pl-1 py-3"},[t(Re["c"],[e._v(e._s(s.title))])],1)]},proxy:!0},{key:"prependIcon",fn:function(){return[t(ur["a"],{staticClass:"ma-0"},[t(o["a"],{staticClass:"ma-0",attrs:{size:"20"},domProps:{textContent:e._s(s.active?"mdi-eye-off":"mdi-eye")},on:{click:function(t){return t.stopPropagation(),t.target!==t.currentTarget?null:e.onFilter(s,!s.active,!1)}}})],1)]},proxy:!0}],null,!0)},e._l(s.items,(function(a){return t($e["a"],{staticClass:"pl-12",on:{click:function(t){return t.stopPropagation(),e.onFilter(a,!a.active,s.active)}}},[t(ur["a"],{staticClass:"mr-2 ml-6"},[t(o["a"],{attrs:{size:"20"},domProps:{textContent:e._s(a.active?"mdi-eye-off":"mdi-eye")}})],1),t(Re["a"],[t(Re["c"],{domProps:{textContent:e._s(a.title)}})],1)],1)})),1)})),1)}))],2)],1)},Um=[],Bm={name:"PanelFilters",props:["menuItem","filters","styleP"],data(){return{minimize:!1}},methods:{cancel(){this.minimize=!1,this.$emit("setOption",this.menuItem),this.$emit("setFilters",!1)},onFilter(e,t,s,a=!0){if(s)return!0;e.active=t,e.items=e.items.map(e=>(this.onFilter(e,t,!1,!1),{...e,active:t})),a&&this.$emit("onFilter",e)}}},Tm=Bm,Lm=Object(m["a"])(Tm,Em,Um,!1,null,null,null),Nm=Lm.exports,Hm=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-card-scrollable",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-0 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Изменения\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pa-0 pb-5 pt-2 m-card-scrollable__text"},[t("div",{staticClass:"pr-0 pl-4 py-1 m-panel__delta--wrap"},[t("div",{staticClass:"m-panel__delta--cube m-panel__delta--green"},[t("span",{staticClass:"m-text--size14"},[e._v(e._s(e.delta.add))]),t("span",[e._v("Добавлено")])]),t("div",{staticClass:"m-panel__delta--cube m-panel__delta--red"},[t("span",{staticClass:"m-text--size14"},[e._v(e._s(e.delta.del))]),t("span",[e._v("Удалено")])]),t("div",{staticClass:"m-panel__delta--cube m-panel__delta--yellow"},[t("span",{staticClass:"m-text--size14"},[e._v(e._s(e.delta.mod))]),t("span",[e._v("Изменено")])])]),t(nt["a"],{staticClass:"pb-2"}),e._l(e.items.list,(function(s){return t("div",{staticClass:"m-panel__delta--note__wrap",class:{active:s.active},on:{click:function(e){s.active=!s.active}}},[t("span",{staticClass:"m-panel__delta--note__header--chevron__wrap"},[s.parameters?t(o["a"],{staticClass:"m-panel__delta--note__header--chevron",attrs:{size:"20"}},[e._v("mdi-chevron-right\n                ")]):e._e()],1),t("div",{staticClass:"m-panel__delta--note__header"},[t("div",{staticClass:"m-panel__delta--note__color",class:"m-panel__delta--"+s.color}),t("span",{staticClass:"pl-2"},[e._v(e._s(s.name))])]),t("div",{staticClass:"m-panel__delta--note__body"},e._l(s.parameters,(function(s){return t("div",{staticClass:"m-panel__delta--note__desc"},[t("span",[e._v(e._s(s.name))]),t(Rt["a"]),t("span",[e._v(e._s(s.value)+e._s(s.units))])],1)})),0)])}))],2)],1)},Mm=[],zm={name:"PanelDelta",props:["menuItem","delta","styleP"],data(){return{minimize:!1,items:this.delta}},methods:{cancel(){this.$emit("setOption",this.menuItem)}}},$m=zm,Rm=Object(m["a"])($m,Hm,Mm,!1,null,null,null),Dm=Rm.exports,Jm=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-card-scrollable",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-0 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Помещения и зоны\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["d"],{staticClass:"pa-0"},[t("div",{staticClass:"pr-0 pl-1 py-1 m-panel__collision--options"},[t(Xe["a"],{staticClass:"m-btn px-2",attrs:{text:"",tile:"",dense:""},on:{click:function(t){return e.onVisibleAll(!1)}}},[t(o["a"],{attrs:{left:"",color:"#757575",size:"20"}},[e._v("mdi-eye-off")]),t("span",{staticClass:"m-text--size12"},[e._v("Скрыть все")])],1),t(Xe["a"],{staticClass:"m-btn px-1",attrs:{text:"",tile:"",dense:""},on:{click:function(t){return e.onVisibleAll(!0)}}},[t(o["a"],{attrs:{left:"",color:"#757575",size:"20"}},[e._v("mdi-eye")]),t("span",{staticClass:"m-text--size12"},[e._v("Показать все")])],1)],1)]),t(nt["a"]),t(zt["c"],{staticClass:"pa-0 pb-5 m-card-scrollable__text"},[t(em["a"],{directives:[{name:"show",rawName:"v-show",value:!e.rooms.load,expression:"!rooms.load"}],attrs:{type:"list-item-three-line, list-item-three-line"}}),e._l(e.rooms.list,(function(s){return t("div",{staticClass:"m-panel__delta--note__wrap pl-4 m-panel__delta--link d-flex",on:{click:function(t){return e.onClick(s)}}},[t("span",{staticClass:"m-panel__delta--note__header--chevron__wrap mr-2"},[t(o["a"],{attrs:{size:"20"},domProps:{textContent:e._s(s.active?"mdi-eye":"mdi-eye-off")}})],1),t("div",{staticClass:"m-panel__delta--note__header"},[t("div",{staticClass:"m-panel__delta--note__color",style:{"background-color":e.getColor(s)}}),t("div",{staticClass:"pl-2"},[e._v(e._s(s.Name))])])])}))],2)],1)},Vm=[],Km={name:"PanelRooms",props:["menuItem","rooms","styleP"],data(){return{minimize:!1}},methods:{cancel(){this.$emit("setOption",this.menuItem)},onClick(e){e.active=!e.active,this.$emit("onRoomVisibilityItem",{ids:[e.Id],value:e.active})},getColor(e){let t=this.rooms.colors.find(t=>t.id==e.Id);return t?t.color:"#efefef"},onVisibleAll(e){this.rooms.list.map(t=>{t.active=e}),this.$emit("onRoomVisibility",{value:e})}}},Gm=Km,Qm=Object(m["a"])(Gm,Jm,Vm,!1,null,null,null),Xm=Qm.exports,Wm=s("1baa"),Ym=s("e0c7"),qm=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-card-scrollable",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-0 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Поиск элементов\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t("div",{staticClass:"search"},[t(Dt["a"],{attrs:{"append-icon":"search","clear-icon":"mdi-close-circle",label:"",type:"text","hide-details":"",placeholder:"Введите поисковый запроc"},on:{"click:append":e.search},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1),t("div",{staticClass:"treeviewCheckBox"},[t(Cr["a"],{staticClass:"includeTreeView",attrs:{selectable:"",items:e.listTreeView},on:{input:e.onSelected}})],1),t(zt["a"],{staticClass:"bottoms"},[t(Xe["a"],{staticClass:"m-btn m-btn--float",class:{"m-btn-normal":!e.one},attrs:{outlined:"",color:e.one?"primary":"normal"},on:{click:function(t){e.typeSearch="ID",e.search(),e.setFilter("one")}}},[e._v("ID")]),t(Xe["a"],{staticClass:"m-btn m-btn--float",class:{"m-btn-normal":!e.two},attrs:{outlined:"",color:e.two?"primary":"normal"},on:{click:function(t){e.typeSearch="Name",e.search(),e.setFilter("two")}}},[e._v("Наименование")]),t(Xe["a"],{staticClass:"m-btn m-btn--float",class:{"m-btn-normal":!e.three},attrs:{outlined:"",color:e.three?"primary":"normal"},on:{click:function(t){e.typeSearch="Parameters",e.search(),e.setFilter("three")}}},[e._v("Свойства")]),t(Xe["a"],{staticClass:"m-btn m-btn--float",class:{"m-btn-normal":!e.four},attrs:{outlined:"",color:e.four?"primary":"normal"},on:{click:function(t){e.typeSearch="Category",e.search(),e.setFilter("four")}}},[e._v("Тип класса")])],1),t(zt["d"],{staticClass:"pa-0"},[t("div",{staticClass:"bottom_id"},[t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",tile:"",dense:"",disabled:!e.list.length||!e.activeClsn,color:e.activeBox?"primary":"default"},on:{click:e.turnActiveBox}},[t(o["a"],{attrs:{left:"",size:"20"}},[e._v("trd-section")]),t("span",{staticClass:"m-text--size12"},[e._v("Показать")])],1),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.list.length,color:e.activeClsn&&e.list.length?"primary":"default"},on:{onClick:e.turnActiveClsn}},[e._v("trd-cube_hide\n            ")]),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.list.length,color:e.activeOnly&&e.list.length?"primary":"default"},on:{onClick:e.turnActiveOnly}},[e._v("trd-cube_show\n            ")])],1)]),t(zt["c"],{staticClass:"pa-0 pb-5 m-card-scrollable__text"},[t(Ye["a"],{attrs:{dense:""}},[t(Ym["a"],{staticClass:"panelResults"},[e._v("Результат")]),t(Wm["a"],{attrs:{color:"primary"},model:{value:e.selectedItem,callback:function(t){e.selectedItem=t},expression:"selectedItem"}},e._l(e.ParamSearch,(function(s,a){return t($e["a"],{key:a},[t(Re["a"],{staticClass:"resultsForPanel"},["Name"==e.typeSearch?t(Re["c"],{domProps:{textContent:e._s(s.Name)}}):e._e(),"ID"==e.typeSearch?t(Re["c"],{domProps:{textContent:e._s(s.id)}}):e._e(),"Parameters"==e.typeSearch?t(Re["c"],{domProps:{textContent:e._s(s.ParametersAll)}}):e._e(),"Category"==e.typeSearch?t(Re["c"],{domProps:{textContent:e._s(s.Category)}}):e._e()],1)],1)})),1)],1)],1)],1)},Zm=[],ed=function(){var e=this,t=e._self._c;return t(zt["c"],{staticClass:"pa-0 m-card-scrollable__text"},[t(em["a"],{directives:[{name:"show",rawName:"v-show",value:!e.load,expression:"!load"}],attrs:{type:"list-item-three-line, list-item-three-line"}}),t(ks["a"],{directives:[{name:"show",rawName:"v-show",value:e.load,expression:"load"}],staticClass:"panel-tabs--table",attrs:{headers:e.headers,items:e.getList,"item-key":"id","disable-pagination":"","hide-default-footer":"",dense:""},scopedSlots:e._u([{key:"item",fn:function({item:s}){return[t("tr",{class:["panel-tabs--back-"+s.type]},e._l(e.headers,(function(a){return t("td",["node"==a.value?[s.node?t(o["a"],{class:"ml-"+3*s.levelNode,attrs:{size:"30"},on:{click:function(t){return e.expand(s)}}},[e._v("\n                            "+e._s(s.expand?"mdi-minus-circle-outline":"mdi-plus-circle-outline")+"\n                        ")]):e._e()]:"name"==a.value?[t("span",{class:"ml-"+4*s.levelNode},[e._v("\n                            "+e._s(s.name)+"\n                        ")])]:[e._v("\n                        "+e._s(s[a.value])+"\n                    ")]],2)})),0)]}}])})],1)},td=[],sd={name:"Components",props:["part","level","cname","elems"],data(){return{items:[],elements:[],load:!1,headers:[{text:"",value:"node",class:"panel-tabs--back-group"},{text:"Имя компонента",align:"start",sortable:!1,value:"name",class:"panel-tabs--back-group"},{text:"Наименование компонента",sortable:!1,value:"class",class:"panel-tabs--back-group"},{text:"Количество, шт.",sortable:!1,value:"count",class:"panel-tabs--back-group"},{text:"Местоположение",sortable:!1,value:"level",class:"panel-tabs--back-group"},{text:"Объем",sortable:!1,value:"volume",class:"panel-tabs--back-group"},{text:"Площадь",sortable:!1,value:"area",class:"panel-tabs--back-group"},{text:"Длина",sortable:!1,value:"length",class:"panel-tabs--back-group"},{text:"Высота",sortable:!1,value:"height",class:"panel-tabs--back-group"}],propsList:{part:[],level:[],cname:[]}}},computed:{getList:{get(){let e=[],t=Object.fromEntries(this.items.map(e=>[e.id,e]));return this.items.map(s=>{s.parent?s.path.every(e=>t[e].expand)&&e.push(s):e.push(s)}),e},set(e){}}},watch:{elems(e){this.elements=this.setElements(this.elems),this.applyFilters(),this.load=!0},part(e){this.applyFilters()},level(e){this.applyFilters()},cname(e){this.applyFilters()}},methods:{rowClass(e){let t={};switch(e.type){case"group":t["background-color"]="#eff6ff";break;case"item":t["background-color"]="#f7f7f7";break;default:}return t},applyFiltersCycle(e,t,s,a,i=[],o=[]){let n=[],r=s[s.length-a],l=[];return t[r].map(c=>{let m=Object(Ut["a"])(),d=[...o,{type:r,value:c}];a-1?(l=this.applyFiltersCycle(e,t,s,a-1,[...i,m],d),l.length&&n.push({id:m,type:"group",name:c,node:1,expand:!1,parent:i.length?i[i.length-1]:0,path:i,levelNode:s.length-a}),n=[...n,...l]):(l=e.filter(e=>e.node&&d.every(t=>e[t.type]==t.value)).map(e=>({...e,parent:m,path:[...i,m],levelNode:s.length-a+1})),l.length&&n.push({id:m,type:"group",name:c,node:1,expand:!1,parent:i[i.length-1],path:i,levelNode:s.length-a}),l.map(t=>{n.push(t),n=[...n,...e.filter(e=>!e.node&&d.every(t=>e[t.type]==t.value)&&e.parent==t.id).map(e=>({...e,path:[...i,m,t.id],levelNode:s.length-a+2}))]}))}),n},applyFilters(){let e=[],t=[];this.level&&t.push("level"),this.part&&t.push("part"),this.cname&&t.push("cname"),t.length?(this.load=!1,e=this.applyFiltersCycle(this.elements,this.propsList,t,t.length),this.load=!0,this.items=e):this.items=this.elements},expand(e){e.expand=!e.expand},setElements(e,t=0,s=0,a=[]){if(!e)return[];let i=[];return Object.entries(e).map(([e,o])=>{let n=Object(Ut["a"])();if(!this.propsList.level.some(e=>e==o.Level)&&o.Level&&o.Items&&this.propsList.level.push(o.Level),!this.propsList.part.some(e=>e==o.GrouppedByCategories)&&o.GrouppedByCategories&&o.Items&&this.propsList.part.push(o.GrouppedByCategories),!this.propsList.cname.some(e=>e==o.Class)&&o.Class&&o.Items&&this.propsList.cname.push(o.Class),i.push({id:n,type:o.Items?"elem":"item",elementId:e,name:o.Name,node:o.Items?1:0,expand:!1,parent:s,path:a,levelNode:t,part:o.GrouppedByCategories||null,level:o.Level||null,class:o.Class||null,cname:o.Class||null,classification:o.Classification||null,tech:o.TechnicalSystem||null,count:o.Count?o.Count+" шт.":null,volume:o.Volume&&o.VolumeUnit?(o.Volume||null)+(o.VolumeUnit||null):o.Volume?o.Volume:null,area:o.Area&&o.AreaUnit?(o.Area||null)+(o.AreaUnit||null):o.Area?o.Area:null,length:o.Length&&o.LengthUnit?(o.Length||null)+(o.LengthUnit||null):o.Length?o.Length:null,height:o.Height&&o.HeightUnits?(o.Height||null)+(o.HeightUnits||null):o.Height?o.Height:null,levelId:o.LevelId||null}),o.Items){let e=this.setElements(o.Items,t+1,n,[n]);i=[...i,...e]}}),i}}},ad=sd,id=(s("8ec5"),Object(m["a"])(ad,ed,td,!1,null,null,null)),od=id.exports,nd={name:"PanelSearch",components:{IconBotton:lm},props:["menuItem","list","postMessage","worker","ParamSearch","styleP"],data(){return{mode:[{name:"clsn",value:!1},{name:"box",value:!1},{name:"only",value:!1}],items:[],minimize:!1,message:"",typeSearch:"Name",searchWord:"",one:!1,two:!0,three:!1,four:!1,choiceRegistr:!1,choiceWholly:!1,listTreeView:[{name:"",children:[{id:1,name:"Учитывать регистр"},{id:2,name:"Значение целиком"}]}],selectedItem:0}},computed:{activeClsn:{get(){return this.mode.find(e=>"clsn"==e.name).value},set(e){this.mode=this.mode.map(t=>("clsn"==t.name&&(t.value=e),t))}},activeBox:{get(){return this.mode.find(e=>"box"==e.name).value},set(e){this.mode=this.mode.map(t=>("box"==t.name&&(t.value=e),t))}},activeOnly:{get(){return this.mode.find(e=>"only"==e.name).value},set(e){this.mode=this.mode.map(t=>("only"==t.name&&(t.value=e),t))}}},watch:{menuItem:{handler(e){e.active||(this.activeClsn&&this.turnActiveClsn(),this.activeOnly&&this.turnActiveOnly())},deep:!0},list(e){e?(this.activeClsn&&this.onActiveMode("clsn",!1),this.items=e,this.mode.map(e=>{e.value&&this.onActiveMode(e.name,!0)})):(this.activeClsn&&this.turnActiveClsn(),this.activeOnly&&this.turnActiveOnly())}},methods:{onSelected(e){this.choiceRegistr=!1,this.choiceWholly=!1,"1"!=e[0]&&"1"!=e[1]||(this.choiceRegistr=!0),"2"!=e[0]&&"2"!=e[1]||(this.choiceWholly=!0)},setFilter(e){switch(e){case"one":this.one=!this.one,this.four=!1,this.two=!1,this.three=!1;break;case"two":this.two=!this.two,this.one=!1,this.four=!1,this.three=!1;break;case"three":this.three=!this.three,this.one=!1,this.two=!1,this.four=!1;break;case"four":this.four=!this.four,this.one=!1,this.two=!1,this.three=!1;break;default:}},changeRegistr(){console.log("WORRRRk")},search(){""==this.message?(console.log("searchWord == none "),this.$emit("update:ParamSearch",[]),this.$emit("update:list",[])):(this.searchWord=this.message,this.worker.postMessage({action:"getSearch",value:{TypeSearch:this.typeSearch,SearchWord:this.searchWord,choiceRegistr:this.choiceRegistr,choiceWholly:this.choiceWholly}}))},cancel(){this.$emit("update:ParamSearch",[]),this.$emit("update:list",[]),this.$emit("setOption",this.menuItem)},setResultsSearch(){console.log("this is setResultsSearch")},turnActiveClsn(){this.list=[],this.list.push(this.ParamSearch[this.selectedItem]["id"]),this.activeClsn=!this.activeClsn,this.activeOnly&&(this.onActiveMode("only",!1),this.activeOnly=!1),this.activeClsn||this.activeBox&&this.turnActiveBox(),this.onActiveMode("clsn",this.activeClsn)},turnActiveBox(){this.list=[],this.list.push(this.ParamSearch[this.selectedItem]["id"]),this.activeBox=!this.activeBox,this.activeOnly&&(this.onActiveMode("only",!1),this.activeOnly=!1),this.onActiveMode("box",this.activeBox)},turnActiveOnly(){this.list=[],this.list.push(this.ParamSearch[this.selectedItem]["id"]),this.activeOnly=!this.activeOnly,this.activeBox&&(this.onActiveMode("box",!1),this.activeBox=!1),this.activeClsn&&(this.onActiveMode("clsn",!1),this.activeClsn=!1),this.onActiveMode("only",this.activeOnly)},onActiveMode(e,t){let s=this.items;if(s.length)switch(e){case"clsn":this.onObjectsHighlight({list:s,active:t});break;case"box":this.onCreateSectionBoxForObjects({list:s,active:t});break;case"only":this.onShowObjectsOnly({list:s,active:t});break;default:}},onObjectsHighlight(e){this.postMessage({action:"onObjectsHighlight",value:{list:e.list,active:e.active}})},onShowObjectsOnly(e){this.postMessage({action:"onShowObjectsOnly",value:{list:e.list,active:e.active}})},onCreateSectionBoxForObjects(e){this.postMessage({action:"onCreateSectionBoxForObjects",value:{list:e.list,active:e.active}})}}},rd=nd,ld=(s("4700"),Object(m["a"])(rd,qm,Zm,!1,null,null,null)),cd=ld.exports,md=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-card-scrollable",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-0 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Правила проверки\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["d"],{staticClass:"pa-0"},[t("div",{staticClass:"pr-0 pl-4 py-1 m-panel__collision--options"},[t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.compute_ready},on:{onClick:function(t){e.component="RulesSelect"}}},[e._v("trd-template\n            ")]),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.compute_ready},on:{onClick:function(t){e.component="GroupAdd"}}},[e._v("trd-group-add\n            ")]),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.checkGroups||!e.compute_ready},on:{onClick:e.removeItem}},[e._v("trd-group-delete\n            ")]),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.compute_ready},on:{onClick:function(t){e.component="RulesTypes"}}},[e._v("trd-rules-add\n            ")]),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.checkRules||!e.compute_ready},on:{onClick:e.removeItem}},[e._v("trd-rules-delete\n            ")]),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!(e.checkGroups||e.checkRules)||!e.compute_ready},on:{onClick:e.editItem}},[e._v("trd-edit\n            ")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",small:"",tile:"",color:"primary",disabled:!e.checkRules||!e.compute_ready},on:{click:e.onComputeCollisions}},[t(o["a"],{attrs:{left:"",size:"20"}},[e._v("\n                    trd-checked\n                ")]),e._v("\n                Проверить\n            ")],1)],1)]),t(nt["a"],{staticClass:"pb-2"}),t(zt["c"],{staticClass:"pa-0 pb-5 m-card-scrollable__text"},[t(em["a"],{directives:[{name:"show",rawName:"v-show",value:!e.compute_ready,expression:"!compute_ready"}],attrs:{type:"list-item-three-line, list-item-three-line"}}),t(Cr["a"],{directives:[{name:"show",rawName:"v-show",value:e.compute_ready,expression:"compute_ready"}],key:e.change,staticClass:"m-panel__collision--tree m-text--size12",attrs:{active:e.selected,items:e.getGroups,"return-object":"",dense:"",activatable:"","expand-icon":"mdi-chevron-down",transition:"","item-key":"id"},on:{"update:active":function(t){e.selected=t}},scopedSlots:e._u([{key:"prepend",fn:function({item:s}){return[t(o["a"],{attrs:{size:"20"}},[e._v("\n                    "+e._s("trd-"+s.type)+"\n                ")])]}},{key:"append",fn:function({item:s}){return[-1!=s.status?[s.status?s.status?t(o["a"],{attrs:{size:"20",color:"success"}},[e._v("\n                        trd-checked-ok\n                    ")]):e._e():t(o["a"],{attrs:{size:"20",color:"error"}},[e._v("\n                        mdi-alert-outline\n                    ")])]:e._e()]}}])})],1),t("dialog-view",{attrs:{component:e.component,temp:e.temp,model:e.model,componentNames:e.componentNames,source:e.source,elementParameters:e.elementParameters},on:{"update:component":function(t){e.component=t},"update:temp":function(t){e.temp=t},"update:componentNames":function(t){e.componentNames=t},"update:component-names":function(t){e.componentNames=t},"update:elementParameters":function(t){e.elementParameters=t},"update:element-parameters":function(t){e.elementParameters=t},updateTemp:e.updateTemp,saveMeta:e.saveMeta,cancel:e.hideDialog}})],1)},dd=[],pd=function(){var e=this,t=e._self._c;return t($t["a"],{staticClass:"m-panel__collision",attrs:{"hide-overlay":"",value:e.component,scrollable:"","max-width":"800px"},on:{input:t=>t||e.cancel()}},[t(e.component,{tag:"component",attrs:{temp:e.temp,elementParameters:e.elementParameters,componentNames:e.componentNames,source:e.source,model:e.model},on:{"update:elementParameters":function(t){e.elementParameters=t},"update:element-parameters":function(t){e.elementParameters=t},"update:componentNames":function(t){e.componentNames=t},"update:component-names":function(t){e.componentNames=t},setComponent:e.setComponent,setParams:e.setParams,save:e.save,cancel:e.cancel}})],1)},ud=[],hd=s("67b6"),fd=s("43a6"),vd=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__collision"},[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n        Тип проверки\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pb-3",staticStyle:{"background-color":"#fbfbfb"}},[t(fd["a"],{staticClass:"mt-0",model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[t(Ye["a"],{staticStyle:{"background-color":"#fbfbfb"}},[t(Wm["a"],{on:{change:e.onChange},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[t($e["a"],{staticClass:"pt-4",attrs:{value:"geom"},scopedSlots:e._u([{key:"default",fn:function({active:s}){return[t(ht["a"],{staticClass:"mb-0 mr-3 flex-row align-baseline"},[t(hd["a"],{staticClass:"mr-2",attrs:{value:"geom"}}),t(o["a"],[e._v("table-collision")])],1),t(Re["a"],[t(Re["c"],{staticClass:"pb-2"},[e._v("Геометрические коллизии")]),t(Re["b"],[e._v("Укажите параметры проверки между геометрическими элементами.")])],1)]}}])}),t(nt["a"]),t($e["a"],{staticClass:"pt-4",attrs:{value:"params"},scopedSlots:e._u([{key:"default",fn:function({active:s}){return[t(ht["a"],{staticClass:"mb-0 mr-3 flex-row align-baseline"},[t(hd["a"],{staticClass:"mr-2",attrs:{value:"params"}}),t(o["a"],[e._v("trd-info-1")])],1),t(Re["a"],[t(Re["c"],{staticClass:"pb-2"},[e._v("Параметры элемента")]),t(Re["b"],[e._v("Создайте проверку по атрибутивной информации элементов.")])],1)]}}])}),t(nt["a"]),t($e["a"],{staticClass:"pt-4",attrs:{value:"repeat"},scopedSlots:e._u([{key:"default",fn:function({active:s}){return[t(ht["a"],{staticClass:"mb-0 mr-3 flex-row align-baseline"},[t(hd["a"],{staticClass:"mr-2",attrs:{value:"repeat"}}),t(o["a"],[e._v("trd-repeat-line")])],1),t(Re["a"],[t(Re["c"],{staticClass:"pb-2"},[e._v("Дублирование элементов")]),t(Re["b"],[e._v("Проверить, чтобы не было повторяющихся элементов, что приводит к некорректной выгрузке элементов.")])],1)]}}])}),t(nt["a"])],1)],1)],1)],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.cancel.apply(null,arguments)}}},[e._v("Отмена")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.setComponent}},[e._v("Выбрать\n        ")])],1)],1)},bd=[],gd={name:"RulesTypes",props:["temp"],data(){return{type:"",selected:[],parts:{geom:"RulesSettings",params:"RulesSettingsParams",repeat:"RulesSettingsRepeat"}}},methods:{onChange(e){this.type=e.toString()},cancel(){this.$emit("cancel")},setComponent(){let e=JSON.parse(JSON.stringify(this.temp));e={...this.temp,part:this.type},this.$emit("setParams",e),this.$emit("setComponent",this.parts[this.type])},enter(e){13===e.keyCode&&(e.preventDefault(),this.cancel())},mounted(){document.addEventListener("keyup",this.enter,!1)},beforeDestroy(){document.removeEventListener("keyup",this.enter,!1)}}},yd=gd,_d=Object(m["a"])(yd,vd,bd,!1,null,null,null),Cd=_d.exports,wd=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__collision"},[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n        Геометрические коллизии\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pa-4",staticStyle:{"background-color":"#fbfbfb"}},[t("div",{staticClass:"m-text--size14 m-text--color-black pb-3"},[e._v("\n            Укажите между какими элементами нужно найти геометрический коллизии.\n        ")]),t("div",{staticClass:"m-text--size12 m-text--color-black"},[e._v("\n            Выбрать набор правил\n        ")]),t(ci["a"],{staticClass:"m-text--size14",attrs:{dense:"",label:"",placeholder:" ",items:e.groupList,"item-text":"name","item-value":"id","return-object":"","append-outer-icon":"trd-group-add","hide-details":""},on:{"click:append-outer":function(t){return e.groupAdd()}},model:{value:e.group,callback:function(t){e.group=t},expression:"group"}}),t("div",{staticClass:"m-text--size12 m-text--color-black pt-4"},[e._v("\n            Название проверки\n        ")]),t(Dt["a"],{staticClass:"m-text--size14",attrs:{dense:""},model:{value:e.ruleName,callback:function(t){e.ruleName=t},expression:"ruleName"}}),t("div",{staticClass:"m-text--size12 m-text--color-black pt-4"},[e._v("\n            Описание\n        ")]),t(bi["a"],{attrs:{placeholder:" ",label:"","multi-line":"",rows:"2"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),t("div",{staticClass:"m-text--size12 m-text--color-black"},[e._v("\n            Выбрать тип стандарта\n        ")]),t(ci["a"],{staticClass:"m-text--size14",attrs:{dense:"",label:"",placeholder:" ",items:e.standartList,"item-text":"title","item-value":"value"},on:{change:e.setStandart},model:{value:e.standart,callback:function(t){e.standart=t},expression:"standart"}}),t(xs["a"],{attrs:{dense:""}},[t(ws["a"],{attrs:{cols:6}},[t(We["a"],{staticClass:"mr-2 pa-0",attrs:{flat:"","min-height":"250",outlined:""}},[t(zt["c"],{staticClass:"m-text--color-black pa-0"},[t(Ye["a"],{staticClass:"pa-0",attrs:{flat:"",dense:""}},[t(Wm["a"],{staticClass:"pa-0",attrs:{multiple:"",color:"primary"},model:{value:e.list_1_selected,callback:function(t){e.list_1_selected=t},expression:"list_1_selected"}},e._l(e.list_1,(function(s){return t($e["a"],{key:s,staticClass:"m-panel__collision--list-item",attrs:{dense:"",value:s}},[e._v(e._s(s)+"\n                                ")])})),1)],1)],1)],1),t(zt["a"],[t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",disabled:!e.standart,color:"primary"},on:{click:function(t){return e.elementAdd(1)}}},[t(o["a"],{attrs:{size:"20",left:""}},[e._v("mdi-plus-circle-outline")]),e._v("Добавить элемент\n                    ")],1),t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",disabled:!e.list_1_selected.length},on:{click:function(t){return e.removeElement("list_1")}}},[t(o["a"],{attrs:{size:"20",left:""}},[e._v("trd-trash")]),e._v("Удалить\n                    ")],1)],1)],1),t(ws["a"],{attrs:{cols:6}},[t(We["a"],{staticClass:"ml-2 pa-0",attrs:{flat:"","min-height":"250",outlined:""}},[t(zt["c"],{staticClass:"m-text--color-black pa-0"},[t(Ye["a"],{staticClass:"pa-0",attrs:{flat:"",dense:""}},[t(Wm["a"],{staticClass:"pa-0",attrs:{multiple:"",color:"primary"},model:{value:e.list_2_selected,callback:function(t){e.list_2_selected=t},expression:"list_2_selected"}},e._l(e.list_2,(function(s){return t($e["a"],{key:s,staticClass:"m-panel__collision--list-item",attrs:{dense:"",value:s}},[e._v(e._s(s)+"\n                                ")])})),1)],1)],1)],1),t(zt["a"],[t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",disabled:!e.standart,color:"primary"},on:{click:function(t){return e.elementAdd(2)}}},[t(o["a"],{attrs:{size:"20",left:""}},[e._v("mdi-plus-circle-outline")]),e._v("Добавить элемент\n                    ")],1),t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",disabled:!e.list_2_selected.length},on:{click:function(t){return e.removeElement("list_2")}}},[t(o["a"],{attrs:{size:"20",left:""}},[e._v("trd-trash")]),e._v("Удалить\n                    ")],1)],1)],1)],1)],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Xe["a"],{staticClass:"m-btn",attrs:{disabled:!e.verify,outlined:"",color:"primary"},on:{click:e.saveTemplate}},[e._v("Сохранить как шаблон\n        ")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.back.apply(null,arguments)}}},[e._v("Отмена")]),t(Xe["a"],{staticClass:"m-btn",attrs:{disabled:!e.verify,outlined:"",color:"primary"},on:{click:e.saveRules}},[e._v("Сохранить\n        ")])],1)],1)},kd=[],xd={name:"RulesSettings",props:["temp","componentNames"],data(){return{group:this.temp.group||"",ruleName:this.temp.ruleName||"",list_1_selected:[],list_2_selected:[],description:this.temp.desc||"",standart:this.temp.std||"",standartList:[{name:"ksi",value:"ksi",title:"Классификатор строительной информации"},{name:"bim",value:"bim",title:"BIM Standart"}]}},computed:{groupList(){let e=this.$store.state.common.meta.collisions,t=e&&e.groups||[];return t},groupAll(){let e=this.$store.state.common.meta.collisions,t=e&&e.groups||[];return t},list_1(){if(this.standart){let e=Object.keys(this.componentNames[this.standart]),t=this.temp.list_1||[];return e.filter(e=>t.some(t=>t==e))}return[]},list_2(){if(this.standart){let e=Object.keys(this.componentNames[this.standart]),t=this.temp.list_2||[];return e.filter(e=>t.some(t=>t==e))}return[]},verify(){return!!this.group&&!!this.ruleName&&!!this.list_1.length&&!!this.list_2.length}},methods:{cancel(){this.$emit("cancel")},back(){this.$emit("setParams",{}),this.setComponent()},removeElement(e){let t=this[e].filter(t=>!this[e+"_selected"].some(e=>e==t)),s=JSON.parse(JSON.stringify(this.temp));s={...s,[e]:t},this[e+"_selected"]=[],this.$emit("setParams",s)},setComponent(e){this.$emit("setComponent",e)},setStandart(e){let t=JSON.parse(JSON.stringify(this.temp));t={...t,std:e},this.$emit("setParams",t)},elementAdd(e){let t=JSON.parse(JSON.stringify(this.temp));t={...t,list:e,ruleName:this.ruleName,group:this.group,desc:this.description},this.$emit("setParams",t),this.setComponent("RulesElement")},groupAdd(){let e=JSON.parse(JSON.stringify(this.temp));e={...e,ruleName:this.ruleName,group:this.group,desc:this.description},this.$emit("setParams",e),this.setComponent("GroupAdd")},saveRules(){this.$emit("save",{groups:this.groupAll.map(e=>e.id==this.group.id?{...e,part:"geom",children:this.temp.edit?e.children.map(e=>(e.id==this.temp.edit&&(e.part="geom",e.std=this.standart,e.name=this.ruleName,e.list_1=this.list_1,e.list_2=this.list_2,e.desc=this.description),e)):[...e.children,{id:Object(Ut["a"])(),parent:e.id,type:"rules",part:"geom",std:this.standart,name:this.ruleName,status:-1,list_1:this.list_1,list_2:this.list_2,desc:this.description}]}:e)}),this.cancel()},saveTemplate(){let e=this.$store.state.workflow.templates_collision,t=e.find(e=>e.name==this.group.name);if(t){let e=this.ruleName,s=Object(Ut["a"])();t.children.map(t=>{t.name==e&&(e+="_"+s)}),t={...t,part:"geom",children:[...t.children,{id:s,parent:t.id,type:"rules",part:"geom",std:this.standart,name:e,status:-1,list_1:this.list_1,list_2:this.list_2,desc:this.description}]}}else{let e=Object(Ut["a"])();t={id:e,name:this.group.name,status:-1,part:"geom",type:"group",children:[{id:Object(Ut["a"])(),parent:e,type:"rules",part:"geom",std:this.standart,name:this.ruleName,status:-1,list_1:this.list_1,list_2:this.list_2,desc:this.description}]}}this.$store.dispatch("workflow/updateCollisionTemplates",[t]).then(e=>{e.error?this.$notify({group:"note",type:"error",text:"Ошибка сохранения шаблона. "+e.data.error}):this.$notify({group:"note",type:"success",text:"Шаблон сохранен."})})},enter(e){13===e.keyCode&&(e.preventDefault(),this.cancel())}},mounted(){document.addEventListener("keyup",this.enter,!1)},beforeDestroy(){document.removeEventListener("keyup",this.enter,!1)}},Sd=xd,Ad=Object(m["a"])(Sd,wd,kd,!1,null,null,null),Id=Ad.exports,Od=s("9e88"),jd=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__collision"},[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n        Параметры элемента\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pa-4",staticStyle:{"background-color":"#fbfbfb"}},[t("div",{staticClass:"m-text--size14 m-text--color-black pb-3"},[e._v("\n            Укажите между какими элементами нужно найти геометрический коллизии.\n        ")]),t("div",{staticClass:"m-text--size12 m-text--color-black"},[e._v("\n            Выбрать набор правил\n        ")]),t(ci["a"],{staticClass:"m-text--size14",attrs:{dense:"",label:"",placeholder:" ",items:e.groupList,"item-text":"name","item-value":"id","return-object":"","append-outer-icon":"trd-group-add","hide-details":""},on:{"click:append-outer":function(t){return e.groupAdd()}},model:{value:e.group,callback:function(t){e.group=t},expression:"group"}}),t("div",{staticClass:"m-text--size12 m-text--color-black pt-4"},[e._v("\n            Название проверки\n        ")]),t(Dt["a"],{staticClass:"m-text--size14",attrs:{dense:""},model:{value:e.ruleName,callback:function(t){e.ruleName=t},expression:"ruleName"}}),t("div",{staticClass:"m-text--size12 m-text--color-black pt-4"},[e._v("\n            Описание\n        ")]),t(bi["a"],{attrs:{placeholder:" ",label:"","multi-line":"",rows:"2"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),t("div",{staticClass:"m-text--size12 m-text--color-black"},[e._v("\n            Выбрать тип стандарта\n        ")]),t(ci["a"],{staticClass:"m-text--size14",attrs:{dense:"",label:"",placeholder:" ",items:e.standartList,"item-text":"title","item-value":"value"},on:{change:e.setStandart},model:{value:e.standart,callback:function(t){e.standart=t},expression:"standart"}}),e._l(e.getElements,(function(s){return t(xs["a"],{attrs:{dense:""}},[t(ws["a"],{attrs:{cols:12}},[t("div",{staticClass:"m-text--size12 m-text--color-black pt-4"},[e._v("\n                    Название элемента\n                ")]),t("div",{staticClass:"d-flex"},[t(Dt["a"],{staticClass:"m-text--size14",attrs:{value:s.name,readonly:"",dense:""}}),t(Xe["a"],{staticClass:"m-btn",attrs:{text:""},on:{click:function(t){return e.removeElement(s)}}},[t(o["a"],{attrs:{size:"20",left:""}},[e._v("trd-trash")]),e._v("Удалить\n                    ")],1)],1),t(We["a"],{staticClass:"pa-0",attrs:{"min-height":"80",outlined:""}},[t(zt["c"],{staticClass:"m-text--color-black pa-0"},[t(Ye["a"],{staticClass:"pa-0",attrs:{flat:"",dense:""}},e._l(s.values,(function(a){return t($e["a"],{key:a.name,staticClass:"m-panel__collision--list-item",class:{"v-list-item--active":s.selected.some(e=>e==a.name)},attrs:{dense:"",color:"primary",value:a.name}},[t("div",{staticClass:"m-flex"},[t("span",{staticClass:"m-flex--item",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.selectParameter(s,a.name)}}},[e._v(" "+e._s(a.name)+"\n                                        ")]),t("span",{staticClass:"m-flex--item m-card-list__cell select-cell"},[t(ci["a"],{staticClass:"m-flex--item",attrs:{"hide-details":"","persistent-hint":"",items:e.equalList(a.type),"item-text":"title","item-value":"value",value:a.equal,dense:""},on:{change:function(t){return e.equalParameter(t,s,a.name)}}})],1),t("span",{staticClass:"m-flex--item py-0 px-4 m-card-list__cell parameter-cell"},["boolean"==a.type?t(Od["a"],{staticClass:"ma-0",attrs:{dense:"",placeholder:" ","hide-details":"",color:"primary"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"value.value"}}):"list"==a.type?t(_s["a"],{staticClass:"pa-0 ma-0",attrs:{items:a.list,"item-text":"name","item-value":"name","persistent-hint":"",placeholder:" ","hide-details":"",dense:""},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"value.value"}}):"integer"==a.type?t("input",{staticClass:"ma-0 pa-0 m-input--noattr",domProps:{value:a.value},on:{input:function(t){return e.onlyInteger(t,s,a.name)}}}):"float"==a.type?t("input",{staticClass:"ma-0 pa-0 m-input--noattr",domProps:{value:a.value},on:{input:function(t){return e.onlyFloat(t,s,a.name)}}}):"string"==a.type?t(Dt["a"],{staticClass:"ma-0 pa-0",attrs:{placeholder:" ","hide-details":"",value:a.value},on:{input:function(t){return e.valueParameter(t,s,a.name)}}}):t(Dt["a"],{staticClass:"ma-0 pa-0",attrs:{placeholder:" ","hide-details":"",value:a.value},on:{change:function(t){return e.valueParameter(t,s,a.name)}}})],1)])])})),1)],1)],1),t(zt["a"],[t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:function(t){return e.parametersAdd(s)}}},[t(o["a"],{attrs:{size:"20",left:""}},[e._v("mdi-plus-circle-outline")]),e._v("Добавить параметр\n                    ")],1),t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",disabled:!s.selected.length},on:{click:function(t){return e.removeParameter(s)}}},[t(o["a"],{attrs:{size:"20",left:""}},[e._v("trd-trash")]),e._v("Удалить\n                    ")],1)],1)],1)],1)})),t(xs["a"],{attrs:{dense:""}},[t(ws["a"],{attrs:{cols:12}},[t("div",{staticClass:"m-text--size12 m-text--color-black pt-4"},[e._v("\n                    Название элемента\n                ")]),t("div",{staticClass:"d-flex"},[t(Dt["a"],{staticClass:"m-text--size14",attrs:{disabled:!e.standart,value:"",readonly:"",dense:""}}),t(Xe["a"],{staticClass:"m-btn",attrs:{disabled:!e.standart,text:"",color:"primary"},on:{click:function(t){return e.elementAdd(1)}}},[t(o["a"],{attrs:{size:"20",left:""}},[e._v("mdi-plus-circle-outline")]),e._v("Добавить элемент\n                    ")],1)],1)])],1)],2),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Xe["a"],{staticClass:"m-btn",attrs:{disabled:!e.verify,outlined:"",color:"primary"},on:{click:e.saveTemplate}},[e._v("Сохранить как шаблон\n        ")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.back.apply(null,arguments)}}},[e._v("Отмена")]),t(Xe["a"],{staticClass:"m-btn",attrs:{disabled:!e.verify,outlined:"",color:"primary"},on:{click:e.saveRules}},[e._v("Сохранить\n        ")])],1)],1)},Fd=[],Pd={name:"RulesSettingsParams",props:["temp","model","componentNames"],data(){return{group:this.temp.group||"",ruleName:this.temp.ruleName||"",list_1_selected:[],description:this.temp.desc||"",elementName:"",signList:[{title:">",value:0},{title:"=",value:1},{title:"<",value:2},{title:P("&ge;"),value:3},{title:P("&le;"),value:4},{title:P("&ne;"),value:5}],standart:this.temp.std||"",standartList:[{name:"ksi",value:"ksi",title:"Классификатор строительной информации"},{name:"bim",value:"bim",title:"BIM Standart"}]}},computed:{groupList(){let e=this.$store.state.common.meta.collisions,t=e&&e.groups||[];return t},groupAll(){let e=this.$store.state.common.meta.collisions,t=e&&e.groups||[];return t},elements(){if(this.standart){let e=this.temp.list_1||[],t=this.temp.elements||[];return t=t.map(e=>({...e,selected:e.selected?e.selected:[]})),e=e.filter(e=>!t.some(t=>t.name==e)).map(e=>({name:e,values:[],selected:[]})),[...t,...e]}return[]},getElements(){if(this.standart){let e=this.componentNames?Object.keys(this.componentNames[this.standart]):[];return this.elements.filter(t=>e.some(e=>e==t.name))}return[]},verify(){return!!this.group&&!!this.ruleName&&!!this.elements.length}},methods:{cancel(){this.$emit("cancel")},onlyInteger(e,t,s){let a=e.target.value.replace(/[^0-9]/g,"");this.valueParameter(a,t,s)},onlyFloat(e,t,s){let a=e.target.value.replace(/[^0-9.]/g,"");this.valueParameter(a,t,s)},equalList(e){let t=[];switch(e){case"string":case"boolean":case"list":t=this.signList.filter(e=>1==e.value||5==e.value);break;case"integer":case"float":t=this.signList;break;default:}return t},back(){this.$emit("setParams",{}),this.setComponent()},removeElement(e){let t=JSON.parse(JSON.stringify(this.temp)),s=[];t.list_1&&(s=t.list_1.filter(t=>t!=e.name));let a=[];t.elements&&(a=t.elements.filter(t=>t.name!=e.name)),t={...t,list_1:s,elements:a},this.$emit("setParams",t)},setComponent(e){this.$emit("setComponent",e)},setStandart(e){let t=JSON.parse(JSON.stringify(this.temp));t={...t,std:e},this.$emit("setParams",t)},elementAdd(e){let t=JSON.parse(JSON.stringify(this.temp));t={...t,list:e,list_1:this.elements.map(e=>e.name),ruleName:this.ruleName,group:this.group,desc:this.description},this.$emit("setParams",t),this.setComponent("RulesElement")},parametersAdd(e){let t=JSON.parse(JSON.stringify(this.temp));t={...t,element:e,elements:this.elements},this.$emit("setParams",t),this.setComponent("GetParams")},equalParameter(e,t,s){let a=JSON.parse(JSON.stringify(this.temp)),i=a.elements;i=i.map(a=>({...a,values:t.name==a.name?a.values.map(t=>(t.name==s&&(t.equal=e),t)):a.values})),a={...a,elements:i},this.$emit("setParams",a)},valueParameter(e,t,s){let a=JSON.parse(JSON.stringify(this.temp)),i=this.temp.elements;i=i.map(a=>({...a,values:t.name==a.name?a.values.map(t=>(t.name==s&&(t.value=e),t)):a.values})),a={...a,elements:i},this.$emit("setParams",a)},selectParameter(e,t){let s=JSON.parse(JSON.stringify(this.temp)),a=s.elements;a=a.map(s=>({...s,selected:e.name==s.name?s.selected.some(e=>e==t)?s.selected.filter(e=>e!=t):[...s.selected,t]:s.selected})),s={...s,elements:a},this.$emit("setParams",s)},removeParameter(e){let t=JSON.parse(JSON.stringify(this.temp)),s=t.elements;s=s.map(t=>({...t,selected:[],values:e.name==t.name?t.values.filter(e=>!t.selected.some(t=>t==e.name)):t.values})),t={...t,elements:s},this.$emit("setParams",t)},groupAdd(){let e=JSON.parse(JSON.stringify(this.temp));e={...e,ruleName:this.ruleName,group:this.group,desc:this.description},this.$emit("setParams",e),this.setComponent("GroupAdd")},saveRules(){this.$emit("save",{groups:this.groupAll.map(e=>e.id==this.group.id?{...e,part:null,children:this.temp.edit?e.children.map(e=>(e.id==this.temp.edit&&(e.part="params",e.std=this.standart,e.name=this.ruleName,e.elements=this.elements.map(e=>({name:e.name,values:e.values})),e.desc=this.description),e)):[...e.children,{id:Object(Ut["a"])(),parent:e.id,type:"rules",part:"params",std:this.standart,name:this.ruleName,status:-1,elements:this.elements.map(e=>({name:e.name,values:e.values})),desc:this.description}]}:e)}),this.cancel()},saveTemplate(){let e=this.$store.state.workflow.templates_collision,t=e.find(e=>e.name==this.group.name);if(t){let e=this.ruleName,s=Object(Ut["a"])();t.children.map(t=>{t.name==e&&(e+="_"+s)}),t={...t,part:null,children:[...t.children,{id:s,parent:t.id,type:"rules",part:"params",std:this.standart,name:e,status:-1,elements:this.elements.map(e=>({name:e.name,values:e.values})),desc:this.description}]}}else{let e=Object(Ut["a"])();t={id:e,name:this.group.name,status:-1,part:"geom",type:"group",children:[{id:Object(Ut["a"])(),parent:e,type:"rules",part:"params",std:this.standart,name:this.ruleName,status:-1,elements:this.elements.map(e=>({name:e.name,values:e.values})),desc:this.description}]}}this.$store.dispatch("workflow/updateCollisionTemplates",[t]).then(e=>{e.error?this.$notify({group:"note",type:"error",text:"Ошибка сохранения шаблона. "+e.data.error}):this.$notify({group:"note",type:"success",text:"Шаблон сохранен."})})},enter(e){13===e.keyCode&&(e.preventDefault(),this.cancel())}},mounted(){document.addEventListener("keyup",this.enter,!1)},beforeDestroy(){document.removeEventListener("keyup",this.enter,!1)}},Ed=Pd,Ud=(s("05c3"),Object(m["a"])(Ed,jd,Fd,!1,null,"2a1fc30e",null)),Bd=Ud.exports,Td=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__collision"},[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n        Дублирование элементов\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pa-4",staticStyle:{"background-color":"#fbfbfb"}},[t("div",{staticClass:"m-text--size12 m-text--color-black"},[e._v("\n            Выбрать набор правил\n        ")]),t(ci["a"],{staticClass:"m-text--size14",attrs:{dense:"",label:"",placeholder:" ",items:e.groupList,"item-text":"name","item-value":"id","return-object":"","append-outer-icon":"trd-group-add","hide-details":""},on:{"click:append-outer":function(t){return e.groupAdd()}},model:{value:e.group,callback:function(t){e.group=t},expression:"group"}}),t("div",{staticClass:"m-text--size12 m-text--color-black pt-4"},[e._v("\n            Название проверки\n        ")]),t(Dt["a"],{staticClass:"m-text--size14",attrs:{dense:""},model:{value:e.ruleName,callback:function(t){e.ruleName=t},expression:"ruleName"}}),t("div",{staticClass:"m-text--size12 m-text--color-black pt-4"},[e._v("\n            Описание\n        ")]),t(bi["a"],{attrs:{placeholder:" ",label:"","multi-line":"",rows:"2"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Xe["a"],{staticClass:"m-btn",attrs:{disabled:!e.verify,outlined:"",color:"primary"},on:{click:e.saveTemplate}},[e._v("Сохранить как шаблон\n        ")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.back.apply(null,arguments)}}},[e._v("Отмена")]),t(Xe["a"],{staticClass:"m-btn",attrs:{disabled:!e.verify,outlined:"",color:"primary"},on:{click:e.saveRules}},[e._v("Сохранить\n        ")])],1)],1)},Ld=[],Nd={name:"RulesSettingsRepeat",props:["temp"],data(){return{group:this.temp.group||"",ruleName:this.temp.ruleName||"",description:this.temp.desc||""}},computed:{groupList(){let e=this.$store.state.common.meta.collisions,t=e&&e.groups||[];return t},groupAll(){let e=this.$store.state.common.meta.collisions,t=e&&e.groups||[];return t},verify(){return!!this.group&&!!this.ruleName}},methods:{cancel(){this.$emit("cancel")},back(){this.$emit("setParams",{}),this.setComponent()},setComponent(e){this.$emit("setComponent",e)},groupAdd(){let e=JSON.parse(JSON.stringify(this.temp));e={...e,ruleName:this.ruleName,group:this.group,desc:this.description},this.$emit("setParams",e),this.setComponent("GroupAdd")},saveRules(){this.$emit("save",{groups:this.groupAll.map(e=>e.id==this.group.id?{...e,part:"repeat",children:this.temp.edit?e.children.map(e=>(e.id==this.temp.edit&&(e.part="repeat",e.name=this.ruleName,e.desc=this.description),e)):[...e.children,{id:Object(Ut["a"])(),parent:e.id,type:"rules",part:"repeat",name:this.ruleName,status:-1,desc:this.description}]}:e)}),this.cancel()},saveTemplate(){let e=this.$store.state.workflow.templates_collision,t=e.find(e=>e.name==this.group.name);if(t){let e=this.ruleName,s=Object(Ut["a"])();t.children.map(t=>{t.name==e&&(e+="_"+s)}),t={...t,part:"repeat",children:[...t.children,{id:s,parent:t.id,type:"rules",part:"repeat",name:e,status:-1,desc:this.description}]}}else{let e=Object(Ut["a"])();t={id:e,name:this.group.name,status:-1,part:"repeat",type:"group",children:[{id:Object(Ut["a"])(),parent:e,type:"rules",part:"repeat",name:this.ruleName,status:-1,desc:this.description}]}}this.$store.dispatch("workflow/updateCollisionTemplates",[t]).then(e=>{e.error?this.$notify({group:"note",type:"error",text:"Ошибка сохранения шаблона. "+e.data.error}):this.$notify({group:"note",type:"success",text:"Шаблон сохранен."})})},enter(e){13===e.keyCode&&(e.preventDefault(),this.cancel())}},mounted(){document.addEventListener("keyup",this.enter,!1)},beforeDestroy(){document.removeEventListener("keyup",this.enter,!1)}},Hd=Nd,Md=Object(m["a"])(Hd,Td,Ld,!1,null,null,null),zd=Md.exports,$d=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__collision"},[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n        Выберите элемент\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[t(Dt["a"],{staticClass:"ma-0 pl-0 pr-4 pb-2 pt-0",attrs:{type:"text",clearable:"","prepend-inner-icon":"search",placeholder:"Поиск...","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),t(nt["a"]),t(zt["c"],{staticClass:"pa-4",staticStyle:{"background-color":"#fbfbfb"}},[t(xs["a"],{attrs:{dense:""}},[t(ws["a"],{attrs:{cols:12}},[t(We["a"],{staticClass:"ml-2 pa-0",attrs:{flat:"","min-height":"250",outlined:""}},[t(zt["c"],{staticClass:"m-text--color-black pa-0"},[t(Ye["a"],{staticClass:"pa-0",attrs:{flat:"",dense:""}},[t($e["a"],{directives:[{name:"show",rawName:"v-show",value:this.list.length,expression:"this.list.length"}],class:[{"v-list-item--active":this.selected.length==this.list.length},"primary--text"],on:{click:function(t){return e.onAll()}}},[e._v("Все\n                            ")]),t(Wm["a"],{staticClass:"pa-0",attrs:{multiple:"",color:"primary"},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.list,(function(s){return t($e["a"],{attrs:{value:s}},[e._v(e._s(s)+"\n                                ")])})),1)],1)],1)],1)],1)],1)],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.setComponent.apply(null,arguments)}}},[e._v("Отмена")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.add}},[e._v("Добавить\n        ")])],1)],1)},Rd=[],Dd={name:"RulesSettings",props:["temp","componentNames"],data(){return{search:"",selected:[]}},computed:{list(){let e=this.temp["list_"+this.temp.list]||[],t=this.temp.std||"ksi",s=Object.keys(this.componentNames[t]);return s.filter(t=>!e.some(e=>e==t)).filter(e=>e.toLowerCase().includes((this.search||"").toLowerCase())).sort()}},methods:{cancel(){this.$emit("cancel")},setComponent(){this.$emit("setComponent")},add(){let e=JSON.parse(JSON.stringify(this.temp)),t=this.temp["list_"+this.temp.list]||[];e={...e,["list_"+e.list]:[...t,...this.selected]},this.$emit("setParams",e),this.setComponent()},onAll(){this.selected.length==this.list.length?this.selected=[]:this.selected=this.list},enter(e){13===e.keyCode&&(e.preventDefault(),this.cancel())}},mounted(){document.addEventListener("keyup",this.enter,!1)},beforeDestroy(){document.removeEventListener("keyup",this.enter,!1)}},Jd=Dd,Vd=Object(m["a"])(Jd,$d,Rd,!1,null,null,null),Kd=Vd.exports,Gd=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__collision"},[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n        Выбрать набор правил\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"px-4 pt-4",staticStyle:{"background-color":"#fbfbfb"}},[t("div",{staticClass:"d-flex"},[t(We["a"],{staticStyle:{flex:"1",overflow:"hidden"},attrs:{flat:"",outlined:"","min-height":"150"}},[t(Cr["a"],{staticClass:"m-panel__collision--tree m-text--size12",attrs:{items:e.getListOut,dense:"",activatable:"",hoverable:"","multiple-active":"",active:e.selectedOut,"return-object":"","expand-icon":"mdi-chevron-down",transition:"","item-key":"id"},on:{"update:active":function(t){e.selectedOut=t}},scopedSlots:e._u([{key:"prepend",fn:function({item:s}){return[t(o["a"],{attrs:{size:"20"}},[e._v("\n                            "+e._s("trd-"+s.type)+"\n                        ")])]}}])})],1),t("div",{staticClass:"d-flex flex-column justify-center"},[t("span",{staticStyle:{cursor:"pointer"},on:{click:e.add}},[t(o["a"],{attrs:{color:e.selectedOut.length?"#000":"#c7c7c7",size:"30"}},[e._v("mdi-chevron-double-right")])],1)]),t(We["a"],{staticStyle:{flex:"1",overflow:"hidden"},attrs:{flat:"",outlined:"","min-height":"150"}},[t(Cr["a"],{staticClass:"m-panel__collision--tree m-text--size12",attrs:{items:e.getListIn,dense:"",hoverable:"","expand-icon":"mdi-chevron-down",transition:"","item-key":"id"},scopedSlots:e._u([{key:"prepend",fn:function({item:s}){return[t(o["a"],{attrs:{size:"20"}},[e._v("\n                            "+e._s("trd-"+s.type)+"\n                        ")])]}}])})],1)],1)]),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.download}},[e._v("Скачать\n        ")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.upload}},[e._v("Загрузить\n        ")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.remove}},[e._v("Удалить шаблон\n        ")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.cancel.apply(null,arguments)}}},[e._v("Отмена")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.submit}},[e._v("Выбрать\n        ")])],1)],1)},Qd=[],Xd={name:"RulesSelect",props:["temp"],data(){return{selectedOut:[],listIn:[],selectedIn:[]}},computed:{getListOut(){let e=[],t=JSON.parse(JSON.stringify(this.$store.state.workflow.templates_collision||[]));return t.map(t=>{if(this.getListIn.some(e=>e.name==t.name)){let s=this.getListIn.find(e=>e.name==t.name);if(s){let a=t.children.filter(e=>!s.children.some(t=>t.name==e.name));a.length&&(t.children=a,e.push(t))}}else e.push(t)}),e},getListIn(){let e=this.$store.state.common.meta.collisions,t=e&&e.groups||[];return t=JSON.parse(JSON.stringify(t)),this.listIn.map(e=>{if("rules"==e.type){let s=this.templates.find(t=>t.id==e.parent),a=t.find(e=>e.name==s.name);if(a)a.children.some(t=>t.name==e.name)||(t=t.map(t=>(t.name==a.name&&(t.children=[...t.children,{...e,id:Object(Ut["a"])(),parent:t.id}]),t)));else{let a=Object(Ut["a"])();t=[...t,{...s,status:-1,id:a,children:s.children.filter(t=>t.id==e.id).map(e=>({...e,id:Object(Ut["a"])(),parent:a}))}]}}else{let s=t.find(t=>t.name==e.name),a=Object(Ut["a"])();t=s?t.map(t=>(t.name==s.name&&e.children.map(e=>{t.children.some(t=>t.name==e.name)||(t.children=[...t.children,{...e,id:Object(Ut["a"])(),parent:t.id}])}),t)):[...t,{...e,status:-1,id:a,children:e.children.map(e=>({...e,id:Object(Ut["a"])(),parent:a}))}]}}),t},templates(){let e=JSON.parse(JSON.stringify(this.$store.state.workflow.templates_collision||[]));return e}},methods:{cancel(){this.$emit("cancel")},add(){this.selectedOut&&(this.addItem(this.selectedOut),this.selectedOut=[])},download(){let e=JSON.stringify(this.$store.state.workflow.templates_collision),t=new Blob([e],{type:"application/json"}),s=document.createElement("a"),a=URL.createObjectURL(t);s.href=a,s.download="Templates",document.body.appendChild(s),s.click(),URL.revokeObjectURL(a),s.remove()},upload(){},remove(){let e=this.selectedOut.filter(e=>"group"==e.type||""==e.type),t=this.selectedOut.filter(t=>!e.some(e=>e.id==t.parent)),s=[];e.map(e=>{s.push(this.$store.dispatch("workflow/deleteCollisionTemplates",{id:e.id}))});let a=this.templates.filter(e=>t.some(t=>e.id==t.parent)).map(e=>(e.children=e.children.filter(e=>!t.some(t=>e.id==t.id)),e));a.length&&s.push(this.$store.dispatch("workflow/updateCollisionTemplates",a)),Promise.all(s).then(e=>{console.log("remove")}).catch(e=>{console.log("remove error",e)}),this.selectedOut=[]},addItem(e){this.listIn=[...this.listIn,...e]},setComponent(e){this.$emit("setComponent",e)},submit(){this.$emit("save",{groups:this.getListIn}),this.listIn=[],this.setComponent()},enter(e){13===e.keyCode&&(e.preventDefault(),this.cancel())}},mounted(){document.addEventListener("keyup",this.enter,!1)},beforeDestroy(){document.removeEventListener("keyup",this.enter,!1)}},Wd=Xd,Yd=Object(m["a"])(Wd,Gd,Qd,!1,null,null,null),qd=Yd.exports,Zd=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__collision"},[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n        Добавить группу\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"px-4",staticStyle:{"background-color":"#fbfbfb"}},[t("div",{staticClass:"m-text--size12 m-text--color-black pt-4"},[e._v("\n            Название группы\n        ")]),t(Dt["a"],{staticClass:"m-text--size14",attrs:{dense:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.setComponent.apply(null,arguments)}}},[e._v("Отмена")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.save}},[e._v("Сохранить\n        ")])],1)],1)},ep=[],tp={name:"GroupAdd",props:["temp"],data(){return{name:this.temp.editName||""}},computed:{getGroups(){let e=this.$store.state.common.meta.collisions,t=e&&e.groups||[];return t}},methods:{cancel(){this.$emit("cancel")},setComponent(){this.$emit("setComponent")},save(){let e=[];if(this.temp.edit)e=this.getGroups.map(e=>(e.id==this.temp.edit&&(this.getGroups.some(e=>e.name==this.name)||(e.name=this.name)),e));else{let t=Object(Ut["a"])(),s=this.getGroups.some(e=>e.name==this.name)?this.name+"_"+t:this.name;e=[...this.getGroups,{id:t,name:s,status:-1,part:null,type:"group",children:[]}]}this.$emit("save",{groups:e}),this.setComponent()},enter(e){13===e.keyCode&&(e.preventDefault(),this.cancel())}},mounted(){document.addEventListener("keyup",this.enter,!1)},beforeDestroy(){document.removeEventListener("keyup",this.enter,!1)}},sp=tp,ap=Object(m["a"])(sp,Zd,ep,!1,null,null,null),ip=ap.exports,op=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__collision"},[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n        Выберите параметр\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[t(Dt["a"],{staticClass:"ma-0 pl-0 pr-4 pb-2 pt-0",attrs:{type:"text",clearable:"","prepend-inner-icon":"search",placeholder:"Поиск...","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),t(nt["a"]),t(zt["c"],{staticClass:"pa-4",staticStyle:{"background-color":"#fbfbfb"}},[t(xs["a"],{attrs:{dense:""}},[t(ws["a"],{attrs:{cols:12}},[t(We["a"],{staticClass:"ml-2 pa-0",attrs:{flat:"","min-height":"250",outlined:""}},[t(zt["c"],{staticClass:"m-text--color-black pa-0"},[t(Ye["a"],{staticClass:"pa-0",attrs:{flat:"",dense:""}},[t($e["a"],{directives:[{name:"show",rawName:"v-show",value:this.list.length,expression:"this.list.length"}],class:[{"v-list-item--active":this.selected.length==this.list.length},"primary--text"],on:{click:function(t){return e.onAll()}}},[e._v("Все\n                            ")]),t(Wm["a"],{staticClass:"pa-0",attrs:{multiple:"",color:"primary"},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.list,(function(s){return t($e["a"],{attrs:{value:s}},[e._v(e._s(s.name)+"\n                                ")])})),1)],1)],1)],1)],1)],1)],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.setComponent.apply(null,arguments)}}},[e._v("Отмена")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.add}},[e._v("Добавить\n        ")])],1)],1)},np=[],rp={name:"GetParams",props:["temp","elementParameters","source","model"],data(){return{search:"",selected:[]}},computed:{list(){let e=this.elementParameters.find(e=>e.name==this.temp.element.name);return e=e?e.values.filter(e=>!this.temp.element.values.some(t=>t.name==e.name)).filter(e=>e.name.toLowerCase().includes((this.search||"").toLowerCase())):[],e}},methods:{cancel(){this.$emit("cancel")},setComponent(){this.$emit("setComponent")},add(){let e=JSON.parse(JSON.stringify(this.temp)),t=e.elements||[];t=t.length?t.map(t=>({...t,selected:[],values:e.element.name==t.name?[...t.values,...this.selected]:t.values})):[{name:e.element.name,selected:[],values:this.selected}],e={...e,elements:t},this.$emit("setParams",e),this.setComponent()},onAll(){this.selected.length==this.list.length?this.selected=[]:this.selected=this.list},enter(e){13===e.keyCode&&(e.preventDefault(),this.cancel())}},created(){let e=this.elementParameters.find(e=>e.name==this.temp.element.name);if(!e)if("ksi"==this.temp.std)this.$store.dispatch("workflow/getParameters",{name:this.temp.element.name,source:this.source}).then(e=>{e&&this.elementParameters.push({name:this.temp.element.name,values:Object.entries(e).map(([e,t])=>({name:e,syn:t.syn||null,value:"boolean"!=t.ftype&&"",code:0,equal:"",type:t.list?"list":t.ftype,list:t.list?t.list:null}))})}).catch(e=>{console.log("Error get parameters:",e)});else if("bim"==this.temp.std){let e=[];if("consolidations"==this.model.type)this.model.consolidations.map(t=>{let s=this.$store.state.workflow.listDocs.find(e=>e.id==t),a="";if(null==s.version)a=s.files[0].url;else{let e=s.files.find(e=>e.version==s.version);a=e?e.url:s.files[0].url}e.push(this.$store.dispatch("common/getFileInfo",{id:a+"/allattrs.json"}))});else{let t="";if(null==this.model.version)t=this.model.files[0].url;else{let e=this.model.files.find(e=>e.version==this.model.version);t=e?e.url:this.model.files[0].url}e.push(this.$store.dispatch("common/getFileInfo",{id:t+"/allattrs.json"}))}Promise.all(e).then(e=>{console.log("elementParameters model",e);let t={};e.map(e=>{let s=Object.keys(e);s.map(s=>{if(t[s]){let a=Object.keys(e[s]);a.map(a=>{t[s][a]?t[s][a].syn=[...t[s][a].syn||[],...e[s][a].syn||[]]:t[s][a]=e[s][a]})}else t[s]=e[s]})});let s=t[this.temp.element.name];this.elementParameters.push({name:this.temp.element.name,values:Object.entries(s).map(([e,t])=>{let s={name:e,value:"boolean"!=t.ftype&&"",code:0,equal:"",type:t.list?"list":t.ftype,list:t.list?t.list:null};return t.syn&&(s.syn=t.syn),s})})}).catch(e=>{console.log("Error get parameters:",e)})}},mounted(){document.addEventListener("keyup",this.enter,!1)},beforeDestroy(){document.removeEventListener("keyup",this.enter,!1)}},lp=rp,cp=Object(m["a"])(lp,op,np,!1,null,null,null),mp=cp.exports,dp={name:"DialogView",components:{RulesTypes:Cd,RulesSettings:Id,RulesSettingsRepeat:zd,RulesSettingsParams:Bd,RulesElement:Kd,GroupAdd:ip,GetParams:mp,RulesSelect:qd},props:["component","temp","elementParameters","source","componentNames","model"],data(){return{path:[]}},watch:{component(e){e&&!this.path.length&&this.path.push(e)}},methods:{cancel(){this.path=[],this.$emit("cancel")},setComponent(e){e=e||!1,e?this.path.push(e):(this.path.pop(),e=this.path[this.path.length-1]||!1),this.$emit("update:component",e)},setParams(e){this.$emit("updateTemp",e)},save(e){this.$emit("saveMeta",e)}}},pp=dp,up=Object(m["a"])(pp,pd,ud,!1,null,null,null),hp=up.exports,fp={name:"PanelCollisionSettings",props:["menuItem","collision_settings","collisions_compiling","styleP","model","source","compute_ready"],components:{IconBotton:lm,DialogView:hp},data(){return{minimize:!1,component:!1,elementParameters:[],temp:{},change:0,componentNames:null,selected:[],compilingQueue:{active:0,group:0,rule:0}}},computed:{checkGroups(){return this.selected.some(e=>"group"==e.type)},checkRules(){return this.selected.some(e=>"rules"==e.type)},getGroups(){let e=this.$store.state.common.meta,t=e.collisions,s=t&&t.groups||[];return s}},watch:{collision_settings(e){if(e&&!this.componentNames)if("consolidations"==this.model.type){let e=[];this.model.consolidations.map(t=>{let s=this.$store.state.workflow.listDocs.find(e=>e.id==t),a="";if(null==s.version)a=s.files[0].url;else{let e=s.files.find(e=>e.version==s.version);a=e?e.url:s.files[0].url}e.push(this.$store.dispatch("common/getFileInfo",{id:a+"/elems.json"}))}),Promise.all(e).then(e=>{let t={bim:{},ksi:{}};e.map(e=>{let s=Object.keys(e.bim).map(s=>{t.bim[s]?t.bim[s]=[...t.bim[s],...e.bim[s]]:t.bim[s]=e.bim[s]});s=Object.keys(e.ksi).map(s=>{t.ksi[s]?t.ksi[s]=[...t.ksi[s],...e.ksi[s]]:t.ksi[s]=e.ksi[s]})}),this.componentNames=t}).catch(e=>{console.log("Get tag elems.json error:",e)})}else if(1==this.model.tags["elems.json"]){let e="";if(null==this.model.version)e=this.model.files[0].url;else{let t=this.model.files.find(e=>e.version==this.model.version);e=t?t.url:this.model.files[0].url}this.$store.dispatch("common/getFileInfo",{id:e+"/elems.json"}).then(e=>{this.componentNames=e}).catch(e=>{console.log("Get tag elems.json error:",e)})}},collisions_compiling(e){if(e)if(this.compilingQueue.active){if(0!=this.compilingQueue.rule)this.compilingQueue.rule-=1;else if(0!=this.compilingQueue.group){this.compilingQueue.group-=1;let e=this.getGroups.length-this.compilingQueue.group;this.compilingQueue.rule=this.getGroups[e].children.length}else this.compilingQueue.active=0,this.activeAutoCompiling(!1);let e=this.getGroups.length-this.compilingQueue.group,t=this.getGroups[e].children.length-this.compilingQueue.rule,s=this.getGroups[e].children[t];this.computeRule(s)}else this.compilingQueue.active=1,this.compilingQueue.group=this.getGroups.length,this.compilingQueue.rule=this.getGroups[0].children.length,this.activeAutoCompiling(!1);else this.compilingQueue.active&&this.activeAutoCompiling(!0)}},methods:{hideDialog(){this.temp={},this.component=!1},cancel(){this.temp={},this.$emit("setOption",this.menuItem)},activeAutoCompiling(e){this.$emit("update:collisions_compiling",e)},onComputeCollisions(){this.computeRule()},getElementIdList(e,t="ksi"){let s=[];return e.map(e=>{s=[...s,...this.componentNames[t][e]]}),s},computeRule(e=null){if((this.selected.length||e)&&(e=e||(this.selected.length?this.selected[0]:{part:"none"}),this.getGroups.map(t=>{t.children.map(t=>{t.id==e.id&&(e=t)})}),e)){if("geom"==e.part){let t={list_1:this.getElementIdList(e.list_1,e.std),list_2:this.getElementIdList(e.list_2,e.std),group:e.parent,rule:e.id,part:e.part};this.$emit("onComputeCollisions",t)}if("params"==e.part){let t=this.getGroups.find(t=>t.id==e.parent),s=t.children.find(t=>t.id==e.id).elements,a={elements:s.filter(t=>Object.keys(this.componentNames[e.std]).some(e=>e==t.name)).map(t=>({...t,list:this.getElementIdList([t.name],e.std)})),group:e.parent,std:e.std,rule:e.id,part:e.part};this.$emit("onComputeParameters",a)}if("repeat"==e.part){let t={group:e.parent,rule:e.id,part:e.part};this.$emit("onComputeRepeat",t)}}},editItem(){let e=this.selected[0];if("rules"==e.type){if("geom"==this.selected[0].part&&(this.temp.group=this.getGroups.find(t=>t.id==e.parent),this.temp.ruleName=e.name,this.temp.std=e.std,this.temp.desc=e.desc,this.temp.list_1=e.list_1,this.temp.list_2=e.list_2,this.temp.edit=e.id,this.component="RulesSettings"),"params"==this.selected[0].part){this.temp.group=this.getGroups.find(t=>t.id==e.parent);let t=this.temp.group.children.find(t=>t.id==e.id).elements;this.temp.ruleName=e.name,this.temp.std=e.std,this.temp.desc=e.desc,this.temp.elements=t,this.temp.edit=e.id,this.component="RulesSettingsParams"}if("repeat"==this.selected[0].part){this.temp.group=this.getGroups.find(t=>t.id==e.parent);this.temp.group.children.find(t=>t.id==e.id).elements;this.temp.ruleName=e.name,this.temp.desc=e.desc,this.temp.edit=e.id,this.component="RulesSettingsRepeat"}}else this.temp.edit=e.id,this.temp.editName=e.name,this.component="GroupAdd"},removeItem(){let e=this.selected[0];e&&("group"==e.type?this.saveMeta({groups:this.getGroups.filter(t=>t.id!=e.id)}):this.saveMeta({groups:this.getGroups.map(t=>(t.id==e.parent&&(t.children=t.children.filter(t=>t.id!=e.id)),t.children.length||(t.status=-1),t))}),this.selected=[])},updateTemp(e){this.temp=e},saveMeta(e){let t=JSON.parse(JSON.stringify(this.$store.state.common.meta));t.collisions?t.collisions={...t.collisions,...e,version:this.model.version}:t.collisions={...e,version:this.model.version},this.$store.dispatch("common/setFileMeta",{id:this.model.id,body:JSON.stringify(t)}).then(e=>this.$store.dispatch("common/getFileMeta",{id:this.model.id})).then(e=>{e.error?this.$notify({group:"note",type:"error",text:e.data.error}):this.$notify({group:"note",type:"success",text:"Изменения сохранены."})})}}},vp=fp,bp=Object(m["a"])(vp,md,dd,!1,null,null,null),gp=bp.exports,yp=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-card-scrollable m-report",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-0 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Результаты проверки\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["d"],{staticClass:"pa-0"},[t("div",{staticClass:"pr-0 pl-1 py-1 m-panel__collision--options"},[t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",tile:"",dense:"",disabled:!e.selected.length||!e.activeClsn||!e.compute_ready,color:e.activeBox?"primary":"default"},on:{click:e.turnActiveBox}},[t(o["a"],{attrs:{left:"",size:"20"}},[e._v("trd-section")]),t("span",{staticClass:"m-text--size12"},[e._v("Показать")])],1),t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",tile:"",dense:"",disabled:!e.getReports.length},on:{click:e.jsonToXlsx}},[t(o["a"],{attrs:{left:"",size:"20"}},[e._v("trd-download")]),t("span",{staticClass:"m-text--size12"},[e._v("Отчет")])],1),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.selected.length||!e.compute_ready,color:e.activeClsn&&e.selected.length?"primary":"default"},on:{onClick:e.turnActiveClsn}},[e._v("trd-cube_hide\n            ")]),t("icon-botton",{staticClass:"mr-4",attrs:{disabled:!e.selected.length||!e.compute_ready,color:e.activeOnly&&e.selected.length?"primary":"default"},on:{onClick:e.turnActiveOnly}},[e._v("trd-cube_show\n            ")]),t(Rt["a"])],1)]),t(nt["a"],{staticClass:"pb-2"}),t(zt["c"],{staticClass:"pa-0 pb-5 m-card-scrollable__text"},[t(em["a"],{directives:[{name:"show",rawName:"v-show",value:!e.compute_ready,expression:"!compute_ready"}],attrs:{type:"list-item-three-line, list-item-three-line"}}),t(Cr["a"],{directives:[{name:"show",rawName:"v-show",value:e.compute_ready,expression:"compute_ready"}],staticClass:"m-panel__collision--tree m-text--size12",attrs:{active:e.selected,items:e.getReports,dense:"",activatable:"","return-object":"","expand-icon":"mdi-chevron-down",transition:"","item-key":"id"},on:{"update:active":[function(t){e.selected=t},e.checkSelected]},scopedSlots:e._u([{key:"label",fn:function({item:s,index:a}){return[t("span",[e._v("\n                "+e._s("group"==s.type?s.name+" ["+s.children.length+"]":"rules"==s.type?s.name+" ["+s.pair+"/"+s.pairs+"]":s.name)+"\n                    "),s.valueRule?t("span",{staticClass:"m-text--color-red"},[e._v("\n                        "+e._s(s.valueRule)+"\n                    ")]):e._e()])]}},{key:"prepend",fn:function({item:s}){return[t(o["a"],{attrs:{size:"20"}},[e._v("\n                    "+e._s("trd-"+s.type)+"\n                ")])]}}])})],1)],1)},_p=[],Cp={name:"PanelCollisionReport",props:["menuItem","collisions","planes","styleP","model","compute_ready","onLoadsOptions"],components:{IconBotton:lm},data(){return{minimize:!1,selected:[],activated:null,mode:[{name:"clsn",value:!1},{name:"box",value:!1},{name:"only",value:!1}]}},computed:{activeClsn:{get(){return this.mode.find(e=>"clsn"==e.name).value},set(e){this.mode=this.mode.map(t=>("clsn"==t.name&&(t.value=e),t))}},activeBox:{get(){return this.mode.find(e=>"box"==e.name).value},set(e){this.mode=this.mode.map(t=>("box"==t.name&&(t.value=e),t))}},activeOnly:{get(){return this.mode.find(e=>"only"==e.name).value},set(e){this.mode=this.mode.map(t=>("only"==t.name&&(t.value=e),t))}},getReports(){let e=this.$store.state.common.meta.collisions,t=e&&e.groups||[];if(t.length){let s=e.version||null;null!=this.model.version&&s!=this.model.version&&(t=[])}let s=[];return t.map((e,t)=>{if(0==e.status){let a={id:"g"+t,name:"Ошибка: "+e.name,type:"group",children:[]};e.children.filter(e=>0==e.status).map((e,t,s)=>{e.reports.map((s,i)=>{"geom"==e.part&&a.children.push({id:"r_geom"+t+i,name:"Ошибка: "+e.name,type:"rules",part:"geom",collisionId:s.collisionId,children:[{id:"f_g_"+i,name:"ID "+s.first.id+" | "+s.first.name,type:"cube"},{id:"s_g_"+i,name:"ID "+s.second.id+" | "+s.second.name,type:"cube"}]}),"params"==e.part&&a.children.push({id:"r_params"+t+i,name:"Ошибка: "+e.name,type:"rules",part:"params",elemId:s.id,children:[{id:"f_p_"+i,name:"ID "+s.id+" | "+s.name,type:"cube"},{id:"s_p_"+i,name:s.property+" "+s.value+" | ",valueRule:s.valueRule,type:""}]}),"repeat"==e.part&&a.children.push({id:"r_repeat"+t+i,name:"Ошибка: "+e.name,type:"rules",part:"repeat",collisionId:s.collisionId,children:[{id:"f_g_"+i,name:"ID "+s.first.id+" | "+s.first.name,type:"cube"},{id:"s_g_"+i,name:"ID "+s.second.id+" | "+s.second.name,type:"cube"}]})})}),a.children=a.children.map((e,t,s)=>({...e,pairs:s.length,pair:t+1})),s.push(a)}}),s}},watch:{menuItem:{handler(e){e.active||(this.activeClsn&&this.turnActiveClsn(),this.activeOnly&&this.turnActiveOnly())},deep:!0}},methods:{jsonToXlsx(){let e=this.$store.state.common.meta.collisions,t=e&&e.groups||[],s=[];t.map((e,t)=>{0==e.status&&e.children.filter(e=>0==e.status).map((e,t,a)=>{e.reports.map((t,a)=>{"geom"==e.part&&s.push({part:"geom",report:{elem:{elemid:t.first.id,name:t.first.name},param:{elemid:t.second.id,name:t.second.name}}}),"params"==e.part&&s.push({part:"params",report:{elem:{elemid:t.id,name:t.name},param:{name:t.property,value:t.value,valueRule:t.valueRule}}}),"repeat"==e.part&&s.push({part:"repeat",report:{elem:{elemid:t.first.id,name:t.first.name},param:{elemid:t.second.id,name:t.second.name}}})})})}),this.$store.dispatch("workflow/jsonToXlsx",s).then(e=>{if(e.error)console.log("jsonToXlsx error ",e.error);else{let t=document.createElement("a"),s=URL.createObjectURL(e.file);t.href=s,t.download=this.model.name_short+".xlsx",document.body.appendChild(t),t.click(),URL.revokeObjectURL(s),t.remove()}}).catch(e=>{console.log("jsonToXlsx error ",e.error)})},cancel(){this.activeClsn&&this.turnActiveClsn(),this.activeOnly&&this.turnActiveOnly(),this.$emit("setOption",this.menuItem)},checkSelected(){this.selected.some(e=>"cube"==e.type)||(this.selected.length?(this.activeClsn&&this.onActive("clsn",!1),this.activated=this.selected[0],this.mode.map(e=>{e.value&&this.onActive(e.name,!0)})):this.activated&&(this.mode.map(e=>{this.onActive(e.name,!1)}),this.activated=null))},onOptions(e,t){this.$emit("setOption",{name:e,active:t})},turnActiveClsn(){this.activeClsn=!this.activeClsn,this.activeOnly&&(this.onActive("only",!1),this.activeOnly=!1),this.activeClsn||this.activeBox&&this.turnActiveBox(),this.onActive("clsn",this.activeClsn)},turnActiveBox(){this.activeBox=!this.activeBox,this.activeOnly&&(this.onActive("only",!1),this.activeOnly=!1),this.onActive("box",this.activeBox)},turnActiveOnly(){this.activeOnly=!this.activeOnly,this.activeBox&&(this.onActive("box",!1),this.activeBox=!1),this.activeClsn&&(this.onActive("clsn",!1),this.activeClsn=!1),this.onActive("only",this.activeOnly)},onActive(e,t){let s=this.activated;if(!s)return;let a=[],i=[];switch("group"==s.type?s.children.map(e=>{"geom"==e.part&&(i.some(t=>t==e.collisionId)||i.push(e.collisionId)),"params"==e.part&&(a.some(t=>t==e.elemId)||a.push(e.elemId)),"repeat"==e.part&&(i.some(t=>t==e.collisionId)||i.push(e.collisionId))}):("geom"==s.part&&i.push(s.collisionId),"params"==s.part&&a.push(s.elemId),"repeat"==s.part&&i.push(s.collisionId)),e){case"clsn":i.length&&this.$emit("onCollisionsActive",{list:i,active:t}),a.length&&this.$emit("onObjectsHighlight",{list:a,active:t});break;case"box":i.length&&this.$emit("onCreateSectionBoxForCollisions",{list:i,active:t}),a.length&&this.$emit("onCreateSectionBoxForObjects",{list:a,active:t});break;case"only":i.length&&this.$emit("onShowCollisionsOnly",{list:i,active:t}),a.length&&this.$emit("onShowObjectsOnly",{list:a,active:t});break;default:}}}},wp=Cp,kp=(s("a44e"),Object(m["a"])(wp,yp,_p,!1,null,null,null)),xp=kp.exports,Sp=s("0798"),Ap=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-card-scrollable m-work-list",class:{"m-panel__hidden":e.minimize},style:e.styleP},[t(zt["d"],{staticClass:"pr-0 pl-4 py-1 m-modal--title-size14 m-card-scrollable__title"},[e._v("Список работ\n        "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:function(t){e.minimize=!e.minimize}}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["d"],{staticClass:"py-1 px-0"},[t("div",{staticClass:"pr-0 pl-3 py-1 m-panel__collision--options"},[t("icon-botton",{staticClass:"mr-2",attrs:{color:e.selectMode&&!e.checkSelected.auto?"primary":"default",disabled:!e.checkSelected.work||e.checkSelected.auto},on:{onClick:e.onSetSelectionMode}},[e._v("mdi-plus-circle-outline\n            ")]),t("icon-botton",{staticClass:"mr-3",attrs:{color:"default",disabled:!e.checkSelected.elem},on:{onClick:e.removeElement}},[e._v("mdi-trash-can-outline\n            ")]),t("icon-botton",{staticClass:"mr-4",attrs:{color:"showOnly"==e.showMode?"primary":"default",disabled:e.checkSelected.auto},on:{onClick:function(t){return e.turnShowMode("showOnly")}}},[e._v("trd-cube_hide\n            ")]),t("icon-botton",{staticClass:"mr-4",attrs:{color:"showColor"==e.showMode?"primary":"default",disabled:e.checkSelected.auto},on:{onClick:function(t){return e.turnShowMode("showColor")}}},[e._v("trd-cube_show\n            ")]),t("icon-botton",{staticClass:"mr-4",attrs:{color:"showAuto"==e.showMode?"primary":"default",disabled:!e.checkSelected.some},on:{onClick:function(t){return e.turnShowMode("showAuto")}}},[e._v("trd-calendar-range\n            ")]),t(Rt["a"])],1)]),t(nt["a"],{staticClass:"pb-2"}),t(zt["c"],{staticClass:"pa-0 pb-5 m-card-scrollable__text"},[t(em["a"],{directives:[{name:"show",rawName:"v-show",value:!e.load,expression:"!load"}],attrs:{type:"list-item-three-line, list-item-three-line"}}),t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.error,expression:"!!error"}],staticClass:"pl-4"},[e._v("\n            "+e._s(e.error)+"\n        ")]),t(Sp["a"],{directives:[{name:"show",rawName:"v-show",value:e.load,expression:"load"}],staticClass:"m-alert mx-3 m-text--size12 py-1",attrs:{outlined:"",type:"warning",prominent:"",border:"left"}},[e._v("Для того, чтобы выбрать несколько объектов, зажмите Ctrl + левую кнопку мыши или OPTION + левую кнопку мыши\n        ")]),t(Cr["a"],{staticClass:"m-worllist m-panel__collision--tree m-text--size12",attrs:{active:e.selected,items:e.getItems,dense:"",activatable:"","return-object":"","expand-icon":"mdi-chevron-down",transition:"","item-key":"id"},on:{"update:active":[function(t){e.selected=t},e.onSelect]},scopedSlots:e._u([{key:"label",fn:function({item:s,index:a}){return["work"==s.type?t("div",{staticClass:"pl-1 mb-1",style:s.border},[t("div",[t("span",{staticClass:"code-job"},[e._v("\n                            "+e._s(s.parent_id+" "+s.schedule_id)+"\n                        ")]),e._v("\n                        "+e._s(s.name+(s.children.length?" ("+(s.children.length-1)+")":""))+"\n                    ")]),t(xs["a"],{staticClass:"m-date ma-0"},[t(ws["a"],[t(o["a"],{attrs:{size:"14"}},[e._v("\n                                trd-play\n                            ")]),e._v("\n                            "+e._s(e.transDate(s.cdate)))],1),t(ws["a"],[t(o["a"],{attrs:{size:"14"}},[e._v("\n                                trd-play-track-next\n                            ")]),e._v("\n                            "+e._s(e.transDate(s.edate)))],1),t(ws["a"],[t(o["a"],{attrs:{size:"20"}},[e._v("\n                                mdi-clock-outline\n                            ")]),e._v("\n                            "+e._s(s.days)+"\n                        ")],1),t(ws["a"],{staticClass:"mr-3"},[t(o["a"],{attrs:{size:"14"}},[e._v("\n                                trd-construct\n                            ")]),e._v("\n                            "+e._s(s.volume_actual+" "+e.job_unit[s.job_unit])+"\n                        ")],1)],1)],1):"remove"==s.type?t("div",[t("span",{staticClass:"m-link",on:{click:function(t){return t.stopPropagation(),e.removeAll(s)}}},[e._v("\n                        Удалить все\n                    ")])]):"elem"==s.type?t("div",[t(_r["a"],{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:a,attrs:i}){return[t("span",e._g(e._b({attrs:{role:"empty"}},"span",i,!1),a),[e._v("\n                                "+e._s(s.name+" | "+s.elemid)+"\n                            ")])]}}],null,!0)},[e._v("\n                        "+e._s(s.name+" | "+s.elemid)+"\n                    ")])],1):t("div",[e._v("\n                    "+e._s(s.name)+"\n                ")])]}}])})],1)],1)},Ip=[],Op={name:"WorkList",props:["menuItem","styleP","model","selectedObjID","selectedObjIDList","propertyJson","source"],components:{IconBotton:lm},data(){return{minimize:!1,items:[],opened:[],selected:[],selectedItem:null,colorStatus:["0","#ff5338","#ffbf00","#2ac279","#8c95a9"],works:null,type_id:{IFC:"Guid",Revit:"Id"},job_unit:{cubic_meter:"м.куб.",ton:"т",square_meter:"м.кв.",piece:"ед",linear_meter:"п.м",meter:"м",percent:"%",centimeter:"см",millimeter:"мм",square_centimeter:"см2",cubic_centimeter:"см3",liter:"л",milliliter:"мл",gram:"г",kilogram_per_cubic_meter:"кг/м3",gram_per_cubic_centimeter:"г/см3",megapascal:"МПа",pascal:"Па",kilometer:"км",hectare:"га",ar:"а",kilogram:"кг",kit:"компл"},selectMode:!1,showMode:!1,load:!1,error:!1}},computed:{checkSelected(){let e=!1,t=!1,s=!1,a="showAuto"==this.showMode,i=!0;return this.selected.length&&(e=this.selected.some(e=>"group"==e.type),t=this.selected.some(e=>"work"==e.type),s=this.selected.some(e=>"elem"==e.type)),{group:e,work:t,elem:s,auto:a,some:i}},getItems(){let e=[];return null!==this.works&&(e=this.works),e}},watch:{menuItem:{handler(e){e.active?(this.load=!1,this.$store.dispatch("workflow/getWorkList_",{file:this.model.id,bearer:this.bearer}).then(e=>{this.items=e.result.schedule,this.works=this.buildTree(this.items,0),this.load=!0}).catch(e=>{this.works=null,this.load=!0})):(this.turnShowMode(!1),this.selectMode&&(this.selectMode=!1,this.$emit("onSetSelectionMode",!1)))},deep:!0},showMode(e,t){e?(this.onAction(t,!1),this.onAction(e,!0)):this.onAction(t,!1)},selectedObjID(e){e&&(this.selectedItem=[e])},selectedObjIDList(e){null!=e&&(this.selectedItem=e)},selectedItem(e){this.getElement(e)}},methods:{buildTree(e,t){let s=e.filter(e=>e.parent_id==t).map(s=>{if(s.job){if(s.id="w"+s.schedule_id,s.task_id=s.schedule_id,s.name=s.name||"...",s.type="work",s.groupid=t,s.cdate=s.date_start,s.edate=s.date_finish,s.days=s.date_interval_day,s.border={"border-left":"4px solid "+this.colorStatus[s.status]},s.color=this.colorStatus[s.status],s.children=[],null!=s.external_data&&s.external_data.elemsid){let e=JSON.parse(s.external_data.elemsid);"string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)||(e=[]),e.length&&(s.children=[{id:"remove"+s.id,workid:s.id,workname:s.name,task_id:s.task_id,groupid:t,type:"remove"}]),s.children=[...s.children,...e.map(e=>{let a=this.propertyJson.find(t=>t[this.type_id[this.source]]==e);return{id:s.task_id+"_"+e,elemid:e,type:"elem",name:a?a.Name:"----",parent:"w"+s.task_id,task_id:s.task_id,groupid:t,color:this.colorStatus[s.status]}})]}}else s.id="g"+s.schedule_id,s.type="group",s.groupid=t,s.children=this.buildTree(e,s.schedule_id);return s});return s},onSelect(){this.checkSelected.auto||this.onAction()},onAction(e=null,t=!0){switch(e=null===e?this.showMode:e,e){case"showOnly":this.onShowObjectsOnly(t);break;case"showColor":t?this.onSetColorForObjects():this.onUnsetColorsForObjects();break;case"showAuto":t?this.onSetColorAuto():this.onUnsetColorsForObjects();break;default:}},turnShowMode(e){this.showMode==e?this.showMode=!1:this.showMode=e},cancel(){this.selectMode=!1,this.works=null,this.items=[],this.selected=[],this.$emit("onSetSelectionMode",!1),this.$emit("setOption",this.menuItem)},getElement(e){if(this.selected.length&&e.length&&!this.checkSelected.auto&&this.selectMode){let t=this.selected[0];if("work"==t.type){let s=[];e.map(e=>{let a=this.propertyJson.find(t=>t[this.type_id[this.source]]==e);if(a){let e=t.children.find(e=>e.elemid==a[this.type_id[this.source]]);e||(this.items=JSON.parse(JSON.stringify(this.items)).map(e=>(e.schedule_id==t.task_id&&(s=[a[this.type_id[this.source]]],null==e.external_data?(s=JSON.stringify(s),e.external_data={elemsid:s}):(s=JSON.stringify([...JSON.parse(e.external_data.elemsid),a[this.type_id[this.source]]]),e.external_data.elemsid=s)),e)))}}),this.works=this.buildTree(this.items,0),this.onAction(),this.$emit("onClearSelection"),"string"!=typeof s&&(s=JSON.stringify(s));let a={schedule:[{schedule_id:t.task_id,external_data:{elemsid:s}}]};this.$store.dispatch("workflow/setWorkList_",{body:a}).then(a=>{let i=JSON.parse(s).filter(t=>e.some(e=>e==t)).join(", "),o=e.length>1?"Элементы "+i+" добавлены в работу "+t.name:"Элемент "+i+" добавлен в работу "+t.name;this.$notify({group:"note",type:"success",text:o})}).catch(e=>{this.$notify({group:"note",type:"error",text:"Ошибка сервера. Элемент не добавлен."})})}}},onSetSelectionMode(){this.selectMode=!this.selectMode,this.$emit("onSetSelectionMode",this.selectMode)},removeAll(e){let t=[],s={schedule:[{schedule_id:e.task_id,external_data:{elemsid:JSON.stringify(t)}}]};this.$store.dispatch("workflow/setWorkList_",{body:s}).then(t=>{this.$notify({group:"note",type:"success",text:"Из работы "+e.workname+" удалены все элементы "})}).catch(e=>{this.$notify({group:"note",type:"error",text:"Ошибка сервера. Элементы не удалены."})}),this.items=this.items.map(s=>{if(s.id==e.workid){let e=JSON.parse(JSON.stringify(s));e.external_data={...e.external_data,elemsid:JSON.stringify(t)},e.children=[],s=e}return s}),this.works=JSON.parse(JSON.stringify(this.buildTree(this.items,0))),this.onAction()},removeElement(e=null){if(e=null===e?this.selected[0]:e,e){let t=[],s="";this.items=this.items.map(a=>(a.schedule_id==e.task_id&&(s=a.name,t=JSON.parse(a.external_data.elemsid),t=t.filter(t=>t!=e.elemid),a.external_data.elemsid=JSON.stringify(t)),a));let a={schedule:[{schedule_id:e.task_id,external_data:{elemsid:JSON.stringify(t)}}]};this.$store.dispatch("workflow/setWorkList_",{body:a}).then(t=>{this.$notify({group:"note",type:"success",text:"Элемент "+e.elemid+" удален из работы "+s})}).catch(e=>{this.$notify({group:"note",type:"error",text:"Ошибка сервера. Элемент не удален."})}),this.works=JSON.parse(JSON.stringify(this.buildTree(this.items,0))),this.onAction()}},onShowObjectsOnly(e){let t=[];this.selected.length?t="group"==this.selected[0].type?this.getElemsId(this.selected[0]).map(e=>e.elemid):"work"==this.selected[0].type?this.selected[0].children.filter(e=>"elem"==e.type).map(e=>e.elemid):[this.selected[0].elemid]:(t=[],e=!1),this.$emit("onShowObjectsOnly",{list:t,active:e})},onOptions(e,t){this.$emit("setOption",{name:e,active:t})},getElemsId(e){let t=[];return"work"==e.type?t=e.children.filter(e=>"elem"==e.type).map(t=>({...t,status:e.status})):e.children.map(e=>{t=[...t,...this.getElemsId(e)]}),t},onSetColorForObjects(){let e=this.selected[0];if(e)if("group"==e.type){let t={id2color:[]},s={},a=this.getElemsId(e);a.map(e=>{s[e.elemid]?e.status<s[e.elemid].sts&&(s[e.elemid]={id:e.elemid,color:e.color,sts:e.status}):s[e.elemid]={id:e.elemid,color:e.color,sts:e.status}}),s=Object.values(s).reduce((e,t)=>(e[t.color]=e[t.color]||[],e[t.color].push(t.id),e),{}),Object.entries(s).map(([e,s])=>{t.id2color.push({ids:s,color:e})}),this.$emit("onSetColorsForObjects",t)}else"work"==this.selected[0].type?this.$emit("onSetColorForObjects",{list:e.children.filter(e=>"elem"==e.type).map(e=>e.elemid),color:e.color}):this.$emit("onSetColorForObjects",{list:[e.elemid],color:e.color});else this.$emit("onSetColorForObjects",{list:[],color:"#000000"})},onSetColorAuto(){let e={id2color:[]},t={},s=[];this.getItems.map(e=>{s=[...s,...this.getElemsId(e)]}),s.map(e=>{t[e.elemid]?e.status<t[e.elemid].sts&&(t[e.elemid]={id:e.elemid,color:e.color,sts:e.status}):t[e.elemid]={id:e.elemid,color:e.color,sts:e.status}}),t=Object.values(t).reduce((e,t)=>(e[t.color]=e[t.color]||[],e[t.color].push(t.id),e),{}),Object.entries(t).map(([t,s])=>{e.id2color.push({ids:s,color:t})}),this.$emit("onSetColorsForObjects",e)},onUnsetColorsForObjects(){this.$emit("onUnsetColorsForObjects")},transDate(e){let t={year:"2-digit",month:"2-digit",day:"2-digit"},s=new Date(e);return s.toLocaleDateString("ru-RU",t)}}},jp=Op,Fp=(s("3edb"),Object(m["a"])(jp,Ap,Ip,!1,null,"3de18cf2",null)),Pp=Fp.exports,Ep=s("71a3"),Up=s("fe57"),Bp=s("9a96"),Tp=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-panel__property m-card-scrollable",staticStyle:{width:"auto !important"}},[t(zt["d"],{staticClass:"pr-18 pl-0 py-0 m-modal--title-size14 m-card-scrollable__title"},[t(Up["a"],{ref:"tabs",attrs:{color:"primary",height:"45"},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[t(Bp["a"],{attrs:{color:"primary"}}),e._l(e.items,(function(s){return t(Ep["a"],{key:s.name},[e._v(e._s(s.title)+"\n            ")])}))],2),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn--close-top m-btn--close-top__right2",attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.minimizeTabs}},[t(o["a"],{attrs:{size:"20"}},[e._v("\n                "+e._s(e.minimize?"mdi-window-maximize":"mdi-window-minimize")+"\n            ")])],1),t(Xe["a"],{staticClass:"m-btn--close-top",attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t("div",{staticClass:"panel-tabs--wrap d-flex"},[t("components",{attrs:{elems:e.getItems,part:e.part,level:e.level,cname:e.cname}}),t(We["a"],{staticClass:"panel-tabs--options pa-3",attrs:{flat:"",tile:""}},[t("div",{staticClass:"m-text--size12 m-text--color-2c2c2c"},[e._v("Фильтры")]),t(zt["a"],{staticClass:"pa-5 px-0 d-block"},[t(Xe["a"],{staticClass:"m-btn m-btn--float",class:{"m-btn-normal":!e.part},attrs:{outlined:"",color:e.part?"primary":"normal"},on:{click:function(t){return e.setFilter("part")}}},[e._v("Раздел П87")]),t(Xe["a"],{staticClass:"m-btn m-btn--float",class:{"m-btn-normal":!e.level},attrs:{outlined:"",color:e.level?"primary":"normal"},on:{click:function(t){return e.setFilter("level")}}},[e._v("Местоположение")]),t(Xe["a"],{staticClass:"m-btn m-btn--float",class:{"m-btn-normal":!e.cname},attrs:{outlined:"",color:e.cname?"primary":"normal"},on:{click:function(t){return e.setFilter("cname")}}},[e._v("Компоненты")])],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-0"},[t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(e){e.stopPropagation()}}},[e._v("Показать")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:e.getXLSX}},[e._v("Выгрузить XLSX\n                ")])],1)],1)],1)],1)},Lp=[],Np={name:"PanelTabs",components:{Components:od},props:["menuItem","model","active","minimize"],data:()=>({items:[{name:"components",title:"Компоненты",component:"Components",propName:"Elements"},{name:"rooms",title:"Зоны и помещения",component:"Rooms",propName:"Zones"}],tab:null,part:!1,level:!1,cname:!1,params:null}),computed:{getItems(){return this.params?this.params[this.items[this.tab]["propName"]]:null}},watch:{active(e){if(e&&!this.params){this.tab||(this.tab=0);let e=[];if("consolidations"==this.model.type)this.$store.state.workflow.listDocs.filter(e=>this.model.consolidations.some(t=>t==e.id)).map(t=>{if(null==t.version)e.push(t.files[0].url);else{let s=t.files.find(e=>e.id==t.version);e.push(s?s.url:t.files[0].url)}});else if(null==this.model.version)e.push(this.model.files[0].url);else{let t=this.model.files.find(e=>e.id==this.model.version);e.push(t?t.url:this.model.files[0].url)}let t=[];e.map(e=>{t.push(this.$store.dispatch("common/getFileInfo",{id:e+"/group.json"}))}),Promise.all(t).then(e=>{console.log("ssssss",e);let t={};e.map(e=>{t.Elements=t.Elements?{...t.Elements,...e.Elements}:e.Elements,t.Zones=t.Zones?{...t.Zones,...e.Zones}:e.Zones}),this.params=t}).catch(e=>{console.log(e)})}e&&this.$refs.tabs.callSlider()}},methods:{cancel(){this.$emit("setOption",this.menuItem)},minimizeTabs(){this.$emit("updateOption",{item:this.menuItem,prop:"minimize",value:!this.minimize})},setFilter(e){switch(e){case"part":this.part=!this.part;break;case"level":this.level=!this.level;break;case"cname":this.cname=!this.cname;break;default:}},getXLSX(){let e="";null==this.model.version?e=this.model.files[0]:(e=this.model.files.find(e=>e.version==this.model.version),e=e||this.model.files[0]);let t=Object(Ut["a"])();this.$store.dispatch("common/setUploadNote",[{name:this.model.name,uuid:t,action:"download",pushin:!0}]),this.$store.dispatch("common/getFile",{id:e.url+"/group.xlsx",uuid:t,typeBlob:"blob"}).then(e=>{if(this.$store.dispatch("common/setUploadNote",[{uuid:t,action:"download",pushin:!1}]),e.error)console.log("downloadFile error",err);else{let t=document.createElement("a"),s=URL.createObjectURL(e.file);t.href=s,t.download=this.model.name_short+".xlsx",document.body.appendChild(t),t.click(),URL.revokeObjectURL(s),t.remove()}}).catch(e=>{console.log("downloadFile error",e)})}}},Hp=Np,Mp=(s("ecb1"),Object(m["a"])(Hp,Tp,Lp,!1,null,null,null)),zp=Mp.exports,$p={name:"ViewObj",components:{Tools3d:Gc,PanelOptions:$l,PanelProperty:Zc,PanelDispatcher:gm,PanelResurs:Sm,PanelHidden:Pm,PanelFilters:Nm,PanelDelta:Dm,PanelSearch:cd,PanelRooms:Xm,PanelCollisionSettings:gp,PanelCollisionReport:xp,PanelWorkList:Pp,PanelTabs:zp},props:["model","doc"],data:()=>({canvas:null,worker:null,ready:!1,ParamSearch:[],ParamSearchId:[],indexModel:0,listModel:[],viewer:"/ubviewer/",toolsbar:!0,properties:[],propertyJson:[],propertiesObj:{Name:"",Properties:[]},classifierList:null,source:null,classifierJson:[],jsonLoad:{classifier:!1,property:!1},filters:[],delta:[],deltaList:{del:0,mod:0,add:0,list:[]},search:{list:[],colors:[],load:!1},rooms:{list:[],colors:[],load:!1},selectedObjID:null,selectedObjIDList:null,selectionModeCount:0,hiddenList:[],levelsMap:[],collision_settings:!1,collisions_version:null,collisions_compiling:!1,compute_ready:!0,options:{"3d-view":{name:"3d-view",title:"3d виды",active:!1,action:!1,disabled:!1,children:{left:{parent:"3d-view",name:"left",title:"Слева",active:!1,action:"setView",icon:"trd-left"},right:{parent:"3d-view",name:"right",title:"Справа",active:!1,action:"setView",icon:"trd-right"},top:{parent:"3d-view",name:"top",title:"Сверху",active:!1,action:"setView",icon:"trd-top"},front:{parent:"3d-view",name:"front",title:"Спереди",active:!1,action:"setView",icon:"trd-front"},back:{parent:"3d-view",name:"back",title:"Сзади",active:!1,action:"setView",icon:"trd-back"}},icon:"trd-d_view",hidden:!1,divider:!1},grid:{name:"grid",title:"Сетка",active:!1,action:"displayGrid",disabled:!1,children:null,icon:"trd-grid",hidden:!1,divider:!1},axis:{name:"axis",title:"Ось",active:!0,action:"displayAxes",disabled:!1,children:null,icon:"trd-axis",hidden:!1,divider:!1},walkview:{name:"walkview",title:"Вид от первого лица",active:!1,action:"setWalkView",disabled:!1,children:null,icon:"trd-street-view",hidden:!1,divider:!0},hidden:{name:"hidden",title:"Скрытые объекты",active:!1,action:"getHiddenObjects",disabled:!1,children:null,icon:"mdi-eye-off",hidden:!1,divider:!1},property:{name:"property",title:"Свойства объекта",active:!1,action:"setSelectionMode",disabled:!1,children:null,icon:"trd-propriety",hidden:!1,divider:!1},dispatcher:{name:"dispatcher",title:"Диспетчер проекта",active:!1,action:"onDispatcher",disabled:!1,children:null,icon:"trd-tree",hidden:!1,divider:!1},filters:{name:"filters",title:"Постановление 87",active:!1,action:"setFilters",disabled:!1,children:null,icon:"trd-P87",hidden:!1,divider:!1},delta:{name:"delta",title:"Версионность",active:!1,action:"onDelta",disabled:!1,children:null,icon:"trd-version1",hidden:!0,divider:!1},planes:{name:"planes",title:"3d сечение",active:!1,action:"onSection",disabled:!1,children:null,icon:"trd-section",hidden:!1,divider:!1},rooms:{name:"rooms",title:"Комнаты",active:!1,action:"onRooms",disabled:!1,children:null,icon:"trd-zone",hidden:!1,divider:!1},tabs:{name:"tabs",title:"Спецификация",active:!1,action:!1,disabled:!1,children:null,icon:"trd-table",hidden:!1,minimize:!0,divider:!1},search:{name:"search",title:"Поиск",active:!1,action:"onSearch",disabled:!1,children:null,icon:"trd-search",hidden:!1,divider:!0},collisions:{name:"collisions",title:"Геометрические коллизии",active:!1,action:"setCollisions",disabled:!1,children:null,icon:"mdi-alert-outline",hidden:!1,divider:!1},collision_settings:{name:"collision_settings",title:"Правила проверки",active:!1,action:"onCollisionSettings",disabled:!1,children:null,icon:"trd-collision-settings",hidden:!1,divider:!1},collision_reports:{name:"collision_reports",title:"Результаты проверки",active:!1,action:"onCollisionReports",disabled:!1,children:null,icon:"trd-report",hidden:!1,divider:!0},resurs:{name:"resurs",title:"Ресурсы",active:!1,action:"onResurs",disabled:!1,children:null,icon:"trd-source",hidden:!1,divider:!1},work_list:{name:"work_list",title:"Список работ",active:!1,action:"onWorkList",disabled:!1,children:null,icon:"trd-list-work",hidden:!1,divider:!0},download:{name:"download",title:"Скачать",active:!1,action:!1,disabled:!1,children:{original:{parent:"download",name:"original",title:"Скачать файл",active:!1,action:"downloadF",icon:null},ifcxml:{parent:"download",name:"ifcxml",title:"Скачать РСИМ (ifcxmlRUS)",active:!1,action:"downloadI",icon:null}},icon:"trd-download",hidden:!1,divider:!1}},onLoads:{model:0,filters:100,applyFilters:0,worker:!1,property:!1,classifier:!0,options:!0},preloaderTitle:"",preloaderInit:{step:0,amount:1}}),computed:{getPercent(){let e="consolidations"==this.model.type?this.model.consolidations.length:1;return e=2*e+this.preloaderInit.amount,Math.round(100/e*this.preloaderInit.step)},getStylePanelsLeft(){let e=[this.options.property.active,this.options.resurs.active].filter(Boolean).length;return{style:{"margin-bottom":"10px",height:"calc("+100/(e||1)+"% - 10px)"},active:!!e}},getStylePanels(){let e=[this.options.hidden.active,this.options.filters.active,this.options.dispatcher.active,this.options.delta.active,this.options.rooms.active,this.options.search.active,this.options.collision_settings.active,this.options.collision_reports.active,this.options.work_list.active].filter(Boolean).length;return{style:{"margin-bottom":"10px",height:"calc("+100/(e||1)+"% - 10px)"},active:!!e}},multy(){return this.options.tabs.active&&(this.options.property.active||this.getStylePanels.active||this.getStylePanelsLeft.active)},onLoadsCheck(){let e=this.onLoads.model>=100&&this.onLoads.filters>=100&&this.onLoads.applyFilters>=100&&this.onLoads.worker&&this.onLoads.property&&this.onLoads.classifier&&this.onLoads.options;return e}},watch:{selectedObjID(e){e?this.worker.postMessage({action:"getObjectProperties",id:e}):(this.propertiesObj={Name:"",Properties:[]},this.classifierList=null)}},methods:{getObjectProperties(e){this.propertiesObj=e.properties,this.classifierList=e.classifierList},downloadF(){this.downloadFile({file:this.model,type:"origin"})},downloadI(){1==this.model.tags["ifcxml.zip"]&&this.downloadFile({file:this.model,type:"ifcxml"})},downloadFile(e){let t="",s="";"ifcxml"!==e.type?(t=this.getFileByVersion(e.file).url,s=e.file.name):(t=this.getFileByVersion(e.file).url+"/ifcxml.zip",s=e.file.name_short+".ifcxml.zip");let a=Object(Ut["a"])();this.$store.dispatch("common/setUploadNote",[{name:e.file.name,uuid:a,action:"download",pushin:!0}]),this.$store.dispatch("common/getFile",{id:t,uuid:a,typeBlob:"blob"}).then(e=>{if(this.$store.dispatch("common/setUploadNote",[{uuid:a,action:"download",pushin:!1}]),e.error)console.log("downloadFile error",err);else{let t=document.createElement("a"),a=URL.createObjectURL(e.file);t.href=a,t.download=s,document.body.appendChild(t),t.click(),URL.revokeObjectURL(a),t.remove()}}).catch(e=>{console.log("downloadFile error",e)})},initFilters(e){let t=[];return t},setWalkView(e){this.postMessage({action:"setWalkView",value:e})},onSection(e){this.postMessage({action:"onSection",value:e})},onPreloader(){return this.onLoadsCheck?(this.onLoads.applyFilters=0,new Promise(e=>{setTimeout(e,2e3)})):new Promise(e=>{e(!0)})},onComputeRepeat(e){this.compute_ready=!1,this.postMessage({action:"onComputeRepeat",value:{group:e.group,rule:e.rule,part:"repeat"}})},onComputeCollisions(e){this.compute_ready=!1,this.postMessage({action:"onComputeCollisions",value:{list_1:e.list_1,list_2:e.list_2,group:e.group,rule:e.rule,part:"geom"}})},onComputeParameters(e){this.compute_ready=!1,this.worker.postMessage({action:"onComputeParameters",value:{...e,source:this.source}})},onRender(){this.onLoads.options=!0},onCollisionsActive(e){this.onLoads.options=!1,this.postMessage({action:"onCollisionsActive",value:{list:e.list,active:e.active}})},onShowCollisionsOnly(e){this.postMessage({action:"onShowCollisionsOnly",value:{list:e.list,active:e.active}})},onCreateSectionBoxForCollisions(e){this.postMessage({action:"onCreateSectionBoxForCollisions",value:{list:e.list,active:e.active}})},onSetColorForObjects(e){this.postMessage({action:"onSetColorForObjects",value:{list:e.list,color:e.color}})},onSetColorsForObjects(e){this.postMessage({action:"onSetColorsForObjects",value:e})},onUnsetColorsForObjects(){this.postMessage({action:"onUnsetColorsForObjects",value:{}})},onObjectsHighlight(e){this.postMessage({action:"onObjectsHighlight",value:{list:e.list,active:e.active}})},onShowObjectsOnly(e){this.postMessage({action:"onShowObjectsOnly",value:{list:e.list,active:e.active}})},onCreateSectionBoxForObjects(e){this.postMessage({action:"onCreateSectionBoxForObjects",value:{list:e.list,active:e.active}})},onRemoveSectionBox(){this.postMessage({action:"onRemoveSectionBox"})},saveCollisionReports(e){let t=JSON.parse(JSON.stringify(this.$store.state.common.meta));t.collisions.version=this.model.version,t.collisions.groups=t.collisions.groups.map(t=>(t.id==e.value.group&&(t.status=1,t.children=t.children.map(t=>{if(t.id==e.value.rule){let s=[],a=0;"geom"==e.value.part&&(s=e.value.collision_pairs,a=e.value.collision_pairs.length?0:1),"params"==e.value.part&&(s=e.value.parameters,a=e.value.parameters.length?0:1),"repeat"==e.value.part&&(s=e.value.collision_pairs,a=e.value.collision_pairs.length?0:1),t.reports=s,t.status=a,t.part=e.value.part}return t})),t.children.map(e=>{e.status||(t.status=0)}),t)),this.$store.dispatch("common/setFileMeta",{id:this.model.id,body:JSON.stringify(t)}).then(e=>this.$store.dispatch("common/getFileMeta",{id:this.model.id})).then(e=>{this.collisions_compiling=!1,this.compute_ready=!0,e.error?this.$notify({group:"note",type:"error",text:e.data.error}):this.$notify({group:"note",type:"success",text:"Проверка выполнена."})}).catch(e=>{this.collisions_compiling=!1,this.compute_ready=!0})},getRooms(e){this.rooms.list=e.rooms.list,this.rooms.load=!0},getRoomsColors(e){this.rooms.colors=e.value},onRoomVisibilityItem(e){this.postMessage({action:"onRoomVisibilityItem",value:{ids:e.ids,val:e.value}})},onRoomVisibility(e){this.postMessage({action:"onRoomVisibility",value:e.value})},onRooms(e){this.onRoomVisibility({value:e}),e&&this.worker.postMessage({action:"getRooms"})},loadFilters(){return new Promise(e=>{if(this.jsonLoad.property)e(!0);else{this.onLoads.property=!1;let t=[];"consolidations"==this.model.type?this.listModel.map(e=>{1==e.tags["json"]?t.push(this.$store.dispatch("common/getFileInfo",{id:this.getFileByVersion(e).url+"/json"})):1==e.tags["json.zip"]&&t.push(new Promise(t=>{this.$store.dispatch("common/getFile",{id:this.getFileByVersion(e).url+"/json.zip",typeBlob:"blob"}).then(e=>Promise.resolve(e.file)).then(e=>kc["loadAsync"](e)).then(e=>{let t=Object.keys(e.files);return e.file(t[0]).async("string")}).then(e=>{t(JSON.parse(e))})}))}):1==this.model.tags["json"]?t.push(this.$store.dispatch("common/getFileInfo",{id:this.getFileByVersion(this.model).url+"/json"})):1==this.model.tags["json.zip"]&&t.push(new Promise(e=>{this.$store.dispatch("common/getFile",{id:this.getFileByVersion(this.model).url+"/json.zip",typeBlob:"blob"}).then(e=>Promise.resolve(e.file)).then(e=>kc["loadAsync"](e)).then(e=>{let t=Object.keys(e.files);return e.file(t[0]).async("string")}).then(t=>{e(JSON.parse(t))})})),Promise.all(t).then(t=>{t.map(e=>{this.propertyJson=[...this.propertyJson,...this.setProperties(e)];let t=e.GrouppedByCategories||[];this.filters=this.initFilters(t)}),this.jsonLoad.property=!0,this.onLoads.property=!0,e(!0)})}})},onWorkList(e){e?this.worker.postMessage({action:"getParameters",names:["properties"]}):this.properties=[]},setFilters(e){this.filters.length?this.initFilters(e):this.worker.postMessage({action:"getParameters",names:["filters"],callback:{name:"initFilters",arg:e}})},onSearch(e){e&&console.log(" On Search is Run ")},initFilters(e){this.onPreloader(),e?(this.filters.map(e=>{e.items.map(e=>{e.active&&(this.onFilter(e),e.items.length&&e.items.map(t=>{this.onFilter(e)}))})}),this.onFilter({filter:"enable"})):(this.onFilter({filter:"clear"}),this.onFilter({filter:"disable"}))},onFilter(e){this.onPreloader().then(t=>{this.postMessage({action:"onFilter",value:e})})},setOption(e){this.options[e.name].active=!e.active,this.options[e.name].action&&this[this.options[e.name].action](this.options[e.name].active)},setSubOption(e){this.options[e.name].children[e.sub_name].active=!e.sub_active,this.options[e.name].children[e.sub_name].action&&this[this.options[e.name].children[e.sub_name].action](this.options[e.name].children[e.sub_name]),this.setOption(e)},updateOption(e){this.options[e.item.name][e.prop]=e.value},hideOptions(e){e.map(e=>{this.options[e].active&&this.setOption({name:e,active:!0}),this.options[e].disabled=!0})},showOptions(e=null){e?e.map(e=>{this.options[e].disabled=!1}):Object.keys(this.options).map(e=>{this.options[e].disabled=!1})},onCollisionSettings(e){this.postMessage({action:"onLoadCollisions"}),this.collision_settings=e,e&&(this.$store.dispatch("workflow/getCollisionTemplates"),this.$store.dispatch("common/getFileMeta",{id:this.model.id}).then(e=>{let t=JSON.parse(e);if(t&&t.collisions){t.collisions.version;null!=this.model.version&&this.model.version}}))},onCollisionReports(e){this.postMessage({action:"onLoadCollisions"}),e&&(this.$store.dispatch("workflow/getCollisionTemplates"),this.$store.dispatch("common/getFileMeta",{id:this.model.id}).then(e=>{let t=JSON.parse(e);t&&t.collisions&&(this.collisions_version=t.collisions.version||null)}))},setCollisions(e){this.postMessage({action:"setCollisions",value:e})},onResurs(e){},getHiddenObjects(e){e&&this.postMessage({action:"onGetHiddenObjects",value:e})},onGetHiddenObjects(e){console.log("onGetHiddenObjects",e),this.worker.postMessage({action:"onGetHiddenObjects",value:e})},onHideObject(e){this.postMessage({action:"onHideObject",value:e})},onShowObject(e){this.postMessage({action:"onShowObject",value:e}),this.selectedObjID&&this.postMessage({action:"selectObjectById",value:this.selectedObjID})},hiddenOptionsBtn(){this.options.delta.hidden=!(this.model.files.length>1)||!this.model.tags["delta.json"];let e=Object.keys(this.options);e.map(e=>{this.options[e].hidden=!E(e)})},onDelta(e){e?(this.hideOptions(["hidden","property","filters","planes"]),this.$store.dispatch("common/getFileInfo",{id:this.getFileByVersion(this.model).url+"/delta.json"}).then(e=>(this.delta=e.Elements,!!this.propertyJson.length||this.loadFilters())).then(()=>this.$store.dispatch("common/getFileInfo",{id:this.model.files[1].url+"/info"})).then(e=>e.tags["json.zip"]?new Promise(e=>{this.$store.dispatch("common/getFile",{id:this.getFileByVersion(this.model).url+"/json.zip",typeBlob:"blob"}).then(e=>Promise.resolve(e.file)).then(e=>kc["loadAsync"](e)).then(e=>{let t=Object.keys(e.files);return e.file(t[0]).async("string")}).then(t=>{e(JSON.parse(t))})}):this.$store.dispatch("common/getFileInfo",{id:this.model.files[1].url+"/json"})).then(e=>this.setProperties(e)).then(e=>{let t=0,s=0,a=0;this.deltaList.list=this.delta.map(e=>{let t={};return Object.entries(e).map(([e,s])=>{t={...s}}),t}).map(i=>{if("modified"==i.Status){let e=this.propertyJson.find(e=>e.Id==i.Id);t++;let s=[];return i.hasOwnProperty("ParametersStatus")&&i.Parameters.map(t=>{let a=e.Parameters.find(e=>e.PropertyGroupTitle==t.PropertyGroupTitle);t.PropertyList.map(e=>{let t=a.PropertyList.find(t=>t.Title==e.Title);s.push({name:t.Title,value:t.Value||"---",units:t.Units||""})})}),{id:e.Id,name:e.Name,status:i.Status,color:"yellow",parameters:s}}if("deleted"==i.Status){let t=e.find(e=>e.Id==i.Id);return s++,{id:t.Id,name:t.Name,status:i.Status,color:"red"}}{let e=this.propertyJson.find(e=>e.Id==i.Id);return a++,{id:e.Id,name:e.Name,status:i.Status,color:"green"}}}).map(e=>({...e,name:e.id+" | "+e.name,active:!1,quantity:[]})),this.deltaList.mod=t,this.deltaList.del=s,this.deltaList.add=a})):this.showOptions(),this.postMessage({action:"onDelta",token:this.$store.state.auth.access_token,id:this.model.files[1].url,value:e,prop:{type:"rvt"}})},setView(e){let t="";switch(e.name){case"left":t="setLeft";break;case"right":t="setRight";break;case"top":t="setTop";break;case"front":t="setFront";break;case"back":t="setBack";break;default:}this.postMessage({action:"setView",name:t}),e.active=!1},displayAxes(e){this.postMessage({action:"displayAxes",value:e})},displayGrid(e){this.postMessage({action:"displayGrid",value:e})},getJsonFile(){let e="Revit"==this.source?"/json.zip":"/json";this.$store.dispatch("common/getFile",{id:this.getFileByVersion(this.model).url+e,typeBlob:"blob"}).then(e=>{let t=document.createElement("a"),s=URL.createObjectURL(e.file);t.href=s,t.download=name,document.body.appendChild(t),t.click(),URL.revokeObjectURL(s),t.remove()})},buildDispatcher(e){this.levelsMap=e.value},onDispatcher(e){this.worker.postMessage({action:"buildDispatcher",fname:this.model.name})},loadPropertyJson(){return new Promise(e=>{if(this.jsonLoad.property)e(!0);else{this.onLoads.property=!1;let t=[];"consolidations"==this.model.type?this.listModel.map(e=>{1==e.tags["json"]&&t.push(this.$store.dispatch("common/getFileInfo",{id:this.getFileByVersion(e).url+"/json"}))}):1==this.model.tags["json"]?t.push(this.$store.dispatch("common/getFileInfo",{id:this.getFileByVersion(this.model).url+"/json"})):1==this.model.tags["json.zip"]&&t.push(new Promise(e=>{this.$store.dispatch("common/getFile",{id:this.getFileByVersion(this.model).url+"/json.zip",typeBlob:"blob"}).then(e=>Promise.resolve(e.file)).then(e=>kc["loadAsync"](e)).then(e=>{let t=Object.keys(e.files);return e.file(t[0]).async("string")}).then(t=>{e(JSON.parse(t))})})),Promise.all(t).then(t=>{t.map(e=>{this.propertyJson=[...this.propertyJson,...this.setProperties(e)];let t=e.GrouppedByCategories||[];this.filters=this.initFilters(t),this.source=e.Source||null}),this.jsonLoad.property=!0,this.onLoads.property=!0,e(!0)})}})},setSelectionMode(e){e||(this.selectedObjID=null,this.selectedObjIDList=null),this.onSetSelectionMode(e)},onSetSelectionMode(e){this.selectionModeCount<2&&(this.postMessage({action:"setSelectionMode",value:e}),e||this.onClearSelection()),e?this.selectionModeCount++:this.selectionModeCount--},onClearSelection(){this.selectedObjID=null,this.selectedObjIDList=null,this.postMessage({action:"clearSelection",value:!0})},onMouseDown(e){e.preventDefault()},onSelected(e){e.id.length>1?this.selectedObjIDList=e.id:this.selectedObjID=e.id[0]},initModel(){if("consolidations"==this.model.type){if(!this.listModel.length){let e=this.$store.state.workflow.listDocs;this.listModel=e.filter(e=>this.model.consolidations.some(t=>t==e.id))}this.preloaderTitle="Загрузка файлов модели "+this.listModel[this.indexModel].name,this.preloaderInit.step++,this.postMessage({token:this.$store.state.auth.access_token,id:this.getFileByVersion(this.listModel[this.indexModel]).url,action:"loadModel",prop:{json:(()=>this.model.tags["json.zip"]?"json.zip":"json")()}})}else this.preloaderTitle="Загрузка файлов модели "+this.model.name,this.preloaderInit.step++,this.postMessage({token:this.$store.state.auth.access_token,id:this.getFileByVersion(this.model).url,action:"loadModel",prop:{type:this.model.type,json:(()=>this.model.tags["json.zip"]?"json.zip":"json")()}})},onLoadModel(e){100==e.value&&this.preloaderInit.step++},onLoadFilters(e){this.onLoads.filters=e},onLoadApplyFilters(e){this.onLoads.applyFilters!=e.value&&(this.onLoads.applyFilters=e.value)},onReadyModel(e){"consolidations"==this.model.type?this.indexModel+1==this.listModel.length?(this.initWorkerOptions(),this.onLoads.model=100,this.onLoads.applyFilters=100,this.onLoads.property=!0):(this.onLoads.applyFilters=0,this.indexModel+=1,this.initModel()):(this.initWorkerOptions(),this.onLoads.model=100,this.onLoads.applyFilters=100,this.onLoads.property=!0)},setProperties(e){let t=e["Elements"].map(e=>{let t={};return Object.entries(e).map(([e,s])=>{t={...s,object:e}}),t});return t},updateCanvasSize(){this.setCanvasSize()},getFileByVersion(e){if(null==e.version)return e.files[0];{let t=e.files.find(t=>t.id==e.version);return t||e.files[0]}},onWindowResize(){this.updateCanvasSize()},onKeyup(e){let t=this.$refs["viewer"].contentWindow.document.getElementById("canvas"),s=new Event("keyup",{key:e.key,code:e.code,composed:!0,charCode:e.charCode,keyCode:e.keyCode,which:e.which,bubbles:!0,cancelable:!0,which:e.keyCode});s.keyCode=e.keyCode,s.which=e.keyCode,t.dispatchEvent(s)},onKeydown(e){let t=this.$refs["viewer"].contentWindow.document.getElementById("canvas"),s=new Event("keydown",{key:e.key,code:e.code,composed:!0,charCode:e.charCode,keyCode:e.keyCode,which:e.which,bubbles:!0,cancelable:!0,which:e.keyCode});s.keyCode=e.keyCode,s.which=e.keyCode,t.dispatchEvent(s)},postMessage(e){this.$refs["viewer"].contentWindow.postMessage(e,"*")},receiveMessage(e){if(Object.prototype.hasOwnProperty.call(e.data,"action"))switch(e.data.action){case"ready":this.initModel(),document.addEventListener("keyup",this.onKeyup),document.addEventListener("keydown",this.onKeydown);break;case"onStartLoadFilters":this.preloaderTitle="Загрузка свойств модели.",this.preloaderInit.step++;break;case"onSelected":this.onSelected(e.data);break;case"onLoadApplyFilters":this.onLoadApplyFilters(e.data);break;case"onLoadModel":this.onLoadModel(e.data);break;case"onReadyModel":this.onReadyModel(e.data);break;case"getRoomsColors":this.getRoomsColors(e.data);break;case"onGetHiddenObjects":this.onGetHiddenObjects(e.data.value);break;case"saveCollisionReports":this.saveCollisionReports(e.data);break;case"onRender":this.onRender(e.data);break;default:}},setCanvasSize(){this.canvas=this.$refs["canvas"];this.$el;let e=this.$parent.$el;const t=window.devicePixelRatio||1,s=e.offsetWidth,a=e.offsetHeight;return this.CanvasWidth=s*t,this.CanvasHeight=a*t,this.devicePixelRatio=t,this.canvas.width=s,this.canvas.height=a,{widthC:s,heightC:a}},workerMessage(e){if(console.log("workerMessage",e),Object.prototype.hasOwnProperty.call(e.data,"action"))switch(e.data.action){case"ready":this.initModel(),document.addEventListener("keyup",this.onKeyup),document.addEventListener("keydown",this.onKeydown);break;case"onStartLoadFilters":this.preloaderTitle="Загрузка свойств модели.",this.preloaderInit.step++;break;case"onSelected":this.onSelected(e.data);break;case"onLoadApplyFilters":this.onLoadApplyFilters(e.data);break;case"onLoadModel":this.onLoadModel(e.data);break;case"onReadyModel":this.onReadyModel(e.data);break;case"getRoomsColors":this.getRoomsColors(e.data);break;case"onGetHiddenObjects":this.onGetHiddenObjects(e.data.value);break;case"saveCollisionReports":this.saveCollisionReports(e.data);break;case"onRender":this.onRender(e.data);break;default:}},initWorkerOptions(){this.worker.postMessage({action:"init",token:this.$store.state.auth.token,model:this.model,listModel:this.listModel})},getParamSearch(e){console.log("Run is getParamSearch"),this.ParamSearch=e.listSearch,this.ParamSearchId=e.listSearchId},getParameters(e){new Promise(t=>{t(e.props.map(e=>{this[e.name]=e.value}))}).then(t=>{e.callback&&this[e.callback.name](e.callback.arg)})},initWorkerParams(e){this.onLoads.worker=e.value,e.value||console.warn("initWorkerParams error:",e.msg)},wubviewerMessage(e){if(Object.prototype.hasOwnProperty.call(e.data,"action"))switch(e.data.action){case"initWorkerParams":this.initWorkerParams(e.data);break;case"getObjectProperties":this.getObjectProperties(e.data);break;case"getParameters":this.getParameters(e.data);break;case"getParamSearch":this.getParamSearch(e.data);break;case"getPropertyJson":this.getPropertyJson(e.data);break;case"buildDispatcher":this.buildDispatcher(e.data);break;case"saveCollisionReports":this.saveCollisionReports(e.data);break;case"getRooms":this.getRooms(e.data);break;default:}}},mounted(){this.worker=new Worker(window.location.origin+"/js/wubviewer.js"),this.worker.addEventListener("message",this.wubviewerMessage,!1),window.addEventListener("message",this.receiveMessage,!1)},created(){this.preloaderTitle="Загрузка просмотрщика.",this.hiddenOptionsBtn()},beforeDestroy(){this.ready=!1,window.removeEventListener("message",this.receiveMessage,!1),this.worker.terminate(),this.worker=null,this.$el.removeEventListener("mousedown",this.onMouseDown,!1),document.removeEventListener("keyup",this.onKeyup),document.removeEventListener("keydown",this.onKeydown)}},Rp=$p,Dp=(s("7a19"),Object(m["a"])(Rp,Cc,wc,!1,null,null,null)),Jp=Dp.exports,Vp=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container",attrs:{fluid:"","fill-height":"","text-xs-center":"","pa-0":""}},[t(Ee["a"],{staticStyle:{position:"relative"},attrs:{wrap:"","ma-0":"",id:"fullscreen"}},[t("div",{ref:"canvas-wrap",staticClass:"m-3d-wrap",attrs:{id:"canvas-wrap"}},[t("iframe",{ref:"viewer",staticStyle:{height:"100%",width:"100%",border:"0"},attrs:{src:e.viewer,id:"viewer",name:"viewer"}})]),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.onLoadsCheck,expression:"!onLoadsCheck"}],staticClass:"m-back",class:{"m-back--trans":e.onLoads.model}},[t("div",{staticClass:"vm-progress"},[t("div",{staticClass:"loader"},[t("svg",{staticClass:"circular",attrs:{viewBox:"25 25 50 50"}},[t("circle",{staticClass:"path",attrs:{cx:"50",cy:"50",r:"20",fill:"none","stroke-width":"2","stroke-miterlimit":"10"}})])]),t("span",[e._v(e._s(e.preloaderTytle))])])])])],1)},Kp=[],Gp={name:"ViewDwg",components:{},props:["model","doc"],data:()=>({ready:!1,indexModel:0,listModel:[],viewer:"/ubviewer/",toolsbar:!0,propertyJson:[],source:null,classifierJson:[],jsonLoad:{classifier:!1,property:!1},filters:[],delta:[],deltaList:{del:0,mod:0,add:0,list:[]},rooms:{list:[],colors:[],load:!1},selectedObjID:null,hiddenList:[],levelsMap:null,collision_settings:!1,collisions_version:null,collisions_compiling:!1,compute_ready:!0,onLoads:{model:0,filters:100,applyFilters:0,property:!0,classifier:!0,options:!0},preloaderTytle:""}),computed:{onLoadsCheck(){let e=this.onLoads.model>=100&&this.onLoads.filters>=100&&this.onLoads.applyFilters>=100&&this.onLoads.property&&this.onLoads.classifier&&this.onLoads.options;return e}},methods:{onPreloader(){return this.onLoadsCheck?(this.onLoads.applyFilters=0,new Promise(e=>{setTimeout(e,2e3)})):new Promise(e=>{e(!0)})},onMouseDown(e){e.preventDefault()},onSelected(e){this.selectedObjID=e.id},initModel(){this.preloaderTytle="Загрузка файлов модели.",this.postMessage({token:this.$store.state.auth.access_token,id:this.getFileByVersion(this.model).url,action:"loadExt",type:this.model.type})},onLoadModel(e){},onLoadFilters(e){this.onLoads.filters=e},onLoadApplyFilters(e){console.log("onLoadApplyFilters",e),this.onLoads.applyFilters!=e.value&&(this.onLoads.applyFilters=e.value)},onReadyModel(e){"consolidations"==this.model.type?this.indexModel+1==this.listModel.length?(this.onLoads.model=100,this.onLoads.applyFilters=100):(this.onLoads.applyFilters=0,this.indexModel+=1,this.initModel()):(this.onLoads.model=100,this.onLoads.applyFilters=100)},setProperties(e){let t=e["Elements"].map(e=>{let t={};return Object.entries(e).map(([e,s])=>{t={...s,object:e}}),t});return t},updateCanvasSize(){this.setCanvasSize()},getFileByVersion(e){if(null==e.version)return e.files[0];{let t=e.files.find(t=>t.version==e.version);return t||e.files[0]}},onWindowResize(){this.updateCanvasSize()},onKeyup(e){let t=this.$refs["viewer"].contentWindow.document.getElementById("canvas"),s=new Event("keyup",{key:e.key,code:e.code,composed:!0,charCode:e.charCode,keyCode:e.keyCode,which:e.which,bubbles:!0,cancelable:!0,which:e.keyCode});s.keyCode=e.keyCode,s.which=e.keyCode,t.dispatchEvent(s)},onKeydown(e){let t=this.$refs["viewer"].contentWindow.document.getElementById("canvas"),s=new Event("keydown",{key:e.key,code:e.code,composed:!0,charCode:e.charCode,keyCode:e.keyCode,which:e.which,bubbles:!0,cancelable:!0,which:e.keyCode});s.keyCode=e.keyCode,s.which=e.keyCode,t.dispatchEvent(s)},postMessage(e){this.$refs["viewer"].contentWindow.postMessage(e,"*")},receiveMessage(e){if(Object.prototype.hasOwnProperty.call(e.data,"action"))switch(e.data.action){case"ready":this.initModel(),document.addEventListener("keyup",this.onKeyup),document.addEventListener("keydown",this.onKeydown);break;case"onLoadModel":this.onLoadModel(e.data);break;case"onReadyModel":this.onReadyModel(e.data);break;default:}}},mounted(){window.addEventListener("message",this.receiveMessage,!1)},created(){this.preloaderTytle="Загрузка просмотрщика."},beforeDestroy(){this.ready=!1,window.removeEventListener("message",this.receiveMessage,!1),this.$el.removeEventListener("mousedown",this.onMouseDown,!1),window.removeEventListener("keyup",this.onKeyup),window.removeEventListener("keydown",this.onKeydown)}},Qp=Gp,Xp=(s("07c2"),Object(m["a"])(Qp,Vp,Kp,!1,null,null,null)),Wp=Xp.exports,Yp=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container",attrs:{fluid:"","fill-height":"","text-xs-center":"","pa-0":""}},[t(Ee["a"],{staticStyle:{position:"relative"},attrs:{wrap:"","ma-0":"",id:"fullscreen"}},[t("div",{ref:"canvas-wrap",staticClass:"m-3d-wrap",attrs:{id:"canvas-wrap"}},[t("iframe",{ref:"viewer",staticStyle:{height:"100%",width:"100%",border:"0"},attrs:{src:e.viewer,id:"viewer",name:"viewer"}})]),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.onLoadsCheck,expression:"!onLoadsCheck"}],staticClass:"m-back",class:{"m-back--trans":e.onLoads.model}},[t("div",{staticClass:"vm-progress"},[t("div",{staticClass:"loader"},[t("svg",{staticClass:"circular",attrs:{viewBox:"25 25 50 50"}},[t("circle",{staticClass:"path",attrs:{cx:"50",cy:"50",r:"20",fill:"none","stroke-width":"2","stroke-miterlimit":"10"}})])]),t("span",[e._v(e._s(e.preloaderTytle))])])])])],1)},qp=[],Zp={name:"ViewDxf",components:{},props:["model","doc"],data:()=>({ready:!1,indexModel:0,listModel:[],viewer:"/ubviewer/",toolsbar:!0,propertyJson:[],source:null,classifierJson:[],jsonLoad:{classifier:!1,property:!1},filters:[],delta:[],deltaList:{del:0,mod:0,add:0,list:[]},rooms:{list:[],colors:[],load:!1},selectedObjID:null,hiddenList:[],levelsMap:null,collision_settings:!1,collisions_version:null,collisions_compiling:!1,compute_ready:!0,onLoads:{model:0,filters:100,applyFilters:0,property:!0,classifier:!0,options:!0},preloaderTytle:""}),computed:{onLoadsCheck(){let e=this.onLoads.model>=100&&this.onLoads.filters>=100&&this.onLoads.applyFilters>=100&&this.onLoads.property&&this.onLoads.classifier&&this.onLoads.options;return e}},methods:{onPreloader(){return this.onLoadsCheck?(this.onLoads.applyFilters=0,new Promise(e=>{setTimeout(e,2e3)})):new Promise(e=>{e(!0)})},onMouseDown(e){e.preventDefault()},onSelected(e){this.selectedObjID=e.id},initModel(){this.preloaderTytle="Загрузка файлов модели.",this.postMessage({token:this.$store.state.auth.access_token,id:this.getFileByVersion(this.model).url,action:"loadExt",type:this.model.type})},onLoadModel(e){},onLoadFilters(e){this.onLoads.filters=e},onLoadApplyFilters(e){console.log("onLoadApplyFilters",e),this.onLoads.applyFilters!=e.value&&(this.onLoads.applyFilters=e.value)},onReadyModel(e){"consolidations"==this.model.type?this.indexModel+1==this.listModel.length?(this.onLoads.model=100,this.onLoads.applyFilters=100):(this.onLoads.applyFilters=0,this.indexModel+=1,this.initModel()):(this.onLoads.model=100,this.onLoads.applyFilters=100)},setProperties(e){let t=e["Elements"].map(e=>{let t={};return Object.entries(e).map(([e,s])=>{t={...s,object:e}}),t});return t},updateCanvasSize(){this.setCanvasSize()},getFileByVersion(e){if(null==e.version)return e.files[0];{let t=e.files.find(t=>t.version==e.version);return t||e.files[0]}},onWindowResize(){this.updateCanvasSize()},onKeyup(e){let t=this.$refs["viewer"].contentWindow.document.getElementById("canvas"),s=new Event("keyup",{key:e.key,code:e.code,composed:!0,charCode:e.charCode,keyCode:e.keyCode,which:e.which,bubbles:!0,cancelable:!0,which:e.keyCode});s.keyCode=e.keyCode,s.which=e.keyCode,t.dispatchEvent(s)},onKeydown(e){let t=this.$refs["viewer"].contentWindow.document.getElementById("canvas"),s=new Event("keydown",{key:e.key,code:e.code,composed:!0,charCode:e.charCode,keyCode:e.keyCode,which:e.which,bubbles:!0,cancelable:!0,which:e.keyCode});s.keyCode=e.keyCode,s.which=e.keyCode,t.dispatchEvent(s)},postMessage(e){this.$refs["viewer"].contentWindow.postMessage(e,"*")},receiveMessage(e){if(Object.prototype.hasOwnProperty.call(e.data,"action"))switch(e.data.action){case"ready":this.initModel(),document.addEventListener("keyup",this.onKeyup),document.addEventListener("keydown",this.onKeydown);break;case"onLoadModel":this.onLoadModel(e.data);break;case"onReadyModel":this.onReadyModel(e.data);break;default:}}},mounted(){window.addEventListener("message",this.receiveMessage,!1)},created(){this.preloaderTytle="Загрузка просмотрщика."},beforeDestroy(){this.ready=!1,window.removeEventListener("message",this.receiveMessage,!1),this.$el.removeEventListener("mousedown",this.onMouseDown,!1),window.removeEventListener("keyup",this.onKeyup),window.removeEventListener("keydown",this.onKeydown)}},eu=Zp,tu=(s("23a0"),Object(m["a"])(eu,Yp,qp,!1,null,null,null)),su=tu.exports,au={name:"DctView",components:{ViewPdf:_c,ViewObj:Jp,ViewDwg:Wp,ViewDxf:su},props:["id","doc","list"],data(){return{model:{type:""},permittedTypes:["obj","pdf","dwg","dxf"]}},computed:{getViewer(){let e=this.$store.state.workflow,t=e.fileTypeConversion.some(e=>e==this.model.type)||"consolidations"==this.model.type?"obj":this.model.type,s=!!this.permittedTypes.includes(t)&&"view-"+t;return s}},methods:{getModel(){let e=this.$store.state.workflow.listDocs,t=this.doc||"";if(e.length){let s=e.filter(e=>e.id==t);if(s.length){this.model=s[0];let e=this.model.name||"name";this.$store.commit("toolbar/setDctView",{name:e,status:""})}}else this.$store.dispatch("workflow/getFolders").then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>this.$store.dispatch("workflow/createFoldersMap")).then(()=>{e=this.$store.state.workflow.listDocs;let s=e.filter(e=>e.id==t);s.length&&(this.model=s[0]);let a=this.model.name||"name";this.$store.commit("toolbar/setDctView",{name:a,status:""})})},checkInit(){if(this.$store.state.workflow.activeProject)return Promise.resolve(!0);{let e={id:this.$route.params.id};return new Promise(t=>{Promise.all([this.$store.commit("workflow/setActiveProject",e),this.$store.commit("workflow/setExpanded",[]),this.$store.commit("workflow/setCurrentFolder",0),this.$store.dispatch("workflow/getFolders"),this.$store.dispatch("workflow/getGroups"),this.$store.dispatch("administration/getFoldersPermissions"),this.$store.dispatch("administration/getFilesPermissions")]).finally(e=>{t(this.$store.dispatch("workflow/createFoldersMap"))})})}}},created(){this.checkInit().then(()=>{this.getModel()})}},iu=au,ou=Object(m["a"])(iu,Er,Ur,!1,null,null,null),nu=ou.exports,ru=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container pb-10 pt-0",attrs:{fluid:"","fill-height":"","text-xs-center":""}},[t(Ee["a"],{attrs:{row:"",wrap:""}},[t(ia["a"],{attrs:{xs12:""}},[t(aa["a"],{ref:"wrap",staticClass:"m-container",attrs:{fluid:"","px-3":"","pb-10":"","pt-0":""}},[t(ai["a"],{staticClass:"m-table-toolbar",attrs:{flat:"",height:"auto"}},[t(Dt["a"],{staticClass:"m-table-toolbar--search ml-2",attrs:{"prepend-icon":"search",placeholder:"Поиск...","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),t(Rt["a"]),t(Xe["a"],{staticClass:"ma-0 m-btn--text_icon",attrs:{text:""},on:{click:function(t){t.stopPropagation(),e.newFolder=!0}}},[t(o["a"],{attrs:{size:"16",left:""}},[e._v("mdi-plus-circle-outline")]),e._v("Создать папку\n            ")],1),t(Xe["a"],{staticClass:"ma-0 m-btn--text_icon",attrs:{disabled:!e.checkFolder,outlined:"",color:"primary"},on:{click:function(t){return t.stopPropagation(),e.upload.apply(null,arguments)}}},[t(o["a"],{attrs:{size:"18",left:""}},[e._v("icon-upload")]),e._v("Загрузить\n            ")],1)],1),t(ai["a"],{staticClass:"m-table-toolbar pa-3 m-table-toolbar--path",attrs:{flat:"",height:"auto"}},e._l(e.getPath,(function(s,a){return t("span",{key:s.id+a+""},[s.link?t("span",{staticClass:"m-table-toolbar--path_link",on:{click:function(t){return e.openFolder(s)}}},[e._v(e._s(s.name))]):e._e(),s.link?t("span",[e._v("/")]):e._e(),s.link?e._e():t("span",[e._v(e._s(s.name))])])})),0),"list"==e.workflow_project?t(ks["a"],{staticClass:"m-table-custom",attrs:{headers:e.getHeaders,items:e.getDocs,"show-select":"",search:e.search,"disable-pagination":"","hide-default-footer":""},on:{"toggle-select-all":e.selectRow},scopedSlots:e._u([{key:"no-data",fn:function(){return[e._v("\n                "+e._s(e.noData)+"\n            ")]},proxy:!0},{key:"header.collisions",fn:function({item:s}){return[t(o["a"],{attrs:{size:"20",color:"#767676"}},[e._v("table-collision\n                ")])]}},{key:"header.tasks",fn:function({item:s}){return[t(o["a"],{attrs:{size:"20",color:"#767676"}},[e._v("trd-ticket\n                ")])]}},{key:"item.tasks",fn:function({item:s}){return[s.task?t(o["a"],{attrs:{size:"20",color:"#767676"}},[e._v("trd-ticket\n                ")]):e._e()]}},{key:"item.sp333",fn:function({item:s}){return[!0!==s.inwork&&("error"==s.sp333.type&&1==s.sp333.value||"classerror"==s.sp333.type||"class.error"==s.sp333.type||"attribute.error"==s.sp333.type||"classerror.onlyempty"==s.sp333.type)?t(_r["a"],{attrs:{bottom:"",right:"",color:"#fff","max-width":"250px","content-class":"m-tooltip--info"},scopedSlots:e._u([{key:"activator",fn:function({on:a}){return[t(o["a"],e._g({staticStyle:{cursor:"pointer"},attrs:{color:"#fc0000",size:"20"},on:{click:function(t){return e.setSP333Attr(s)}}},a),[e._v("mdi-alert-outline")])]}},{key:"default",fn:function(){return[t("span",{},[t("b",[e._v("Критическая ошибка.")]),t("br"),e._v("\nПроект не прошел проверку на нормативные требования.\n                        ")])]},proxy:!0}],null,!0)}):e._e(),"warning"==s.sp333.type&&!0!==s.inwork?t(_r["a"],{attrs:{bottom:"",right:"",color:"#fff","max-width":"250px","content-class":"m-tooltip--info"},scopedSlots:e._u([{key:"activator",fn:function({on:a}){return[t(o["a"],e._g({staticStyle:{cursor:"pointer"},attrs:{color:"#ff904b",size:"20"},on:{click:function(t){return e.setSP333Attr(s)}}},a),[e._v("mdi-alert-outline")])]}},{key:"default",fn:function(){return[t("span",{},[e._v("Проект не прошел проверку на нормативные коллизии.\n                        ")])]},proxy:!0}],null,!0)}):e._e()]}},{key:"item.collisions",fn:function({item:e}){}},{key:"item.data-table-select",fn:function({item:s,isSelected:a,select:i}){return[!0!==s.inwork&&e.getAccess(s.access,"or",[1,2])?t(Od["a"],{attrs:{value:a&&!0!==s.inwork&&e.getAccess(s.access,"or",[1,2]),disabled:!0===s.inwork&&e.getAccess(s.access,"or",[1,2])},on:{input:function(e){return i(e)}}}):e._e()]}},{key:"item.name",fn:function({item:s,index:a}){return[t("div",{staticClass:"m-table--name"},["folder"==s.type&&e.getAccess(s.access,"and",[0])?t("span",{staticClass:"m-text--hover",class:{"m-item--sub":s.sub},on:{click:function(t){return e.openFolder(s)}}},[e._v(e._s(s.name)+"\n                    ")]):"folder"!=s.type&&!s.inwork&&e.getAccess(s.access,"and",[0])?t("span",{class:{"m-text--hover":3!==s.status_file&&e.checkLicense("editRVT")},on:{click:function(t){3===s.status_file||!e.checkLicense("editRVT")||e.getDct(s)}}},[t(_r["a"],{attrs:{top:"",transition:"100"},scopedSlots:e._u([{key:"activator",fn:function({on:a,attrs:i}){return[t("span",e._g(e._b({class:{"m-item--sub":s.sub},attrs:{role:"empty"}},"span",i,!1),a),[e._v("\n                                    "+e._s(s.name_short)+"\n                                ")])]}}],null,!0)},[e._v("\n                            "+e._s(s.name)+"\n                        ")])],1):"folder"!=s.type&&s.inwork?t("span",{class:{"m-item--sub":s.sub}},[e._v(e._s(s.name_short)+"\n                    ")]):t("span",{class:{"m-item--sub":s.sub}},[e._v(e._s(s.name_short||s.name)+"\n                    ")]),3===s.status_file?t(_r["a"],{attrs:{top:"",right:"",color:"#fff","max-width":"250px","content-class":"m-tooltip--info"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(o["a"],e._g({staticClass:"mr-1 m-info--file",attrs:{size:"20",color:"#ff0000"}},s),[e._v("mdi-alert-outline\n                            ")])]}},{key:"default",fn:function(){return[t("span",{},[e._v("При обработке файла произошла ошибка. Проверьте файл и загрузите его еще раз.")])]},proxy:!0}],null,!0)}):e._e()],1)]}},{key:"item.sub",fn:function({item:s}){return[t("span",{on:{click:function(t){return e.expandSub(s)}}},[t(o["a"],{directives:[{name:"show",rawName:"v-show",value:!!s.group||!!s.consolidations,expression:"!!item.group || !!item.consolidations"}],class:{"m-item--expanded__icon":s.expanded},style:{margin:"0 -4px",cursor:"pointer"},attrs:{size:"20"}},[e._v("mdi-chevron-down")])],1)]}},{key:"item.src",fn:function({item:s}){return[s.group?t(o["a"],{attrs:{size:"30"}},[e._v("icon-group")]):"folder"!=s.type&&!0===s.inwork?t(ze["a"],{staticClass:"mx-auto",class:{"m-item--sub":s.sub},attrs:{width:"35",src:e.inwork}}):"folder"==s.type?t(o["a"],{class:{"m-item--sub":s.sub},attrs:{size:"30"}},[e._v("icon-folder")]):t(o["a"],{class:{"m-item--sub":s.sub},attrs:{size:"30"}},[e._v("ft-"+e._s("type"==s.type?"unknown":s.type))])]}},{key:"item.action",fn:function({item:s}){return[!0!==s.inwork&&!e.checkSelected(s)&&s.access?t("action-menu",{attrs:{access:s.access,item:s},on:{download:e.downloadFile,convertationIFCXML:e.convertationIFCXML,getDct:e.getDct,removeItem:e.removeItem,openFolder:e.openFolder,replaceItems:e.replaceItems,copyItems:e.copyItems,renameitem:e.renameitem,accessRights:e.accessRights,versionJournal:e.versionJournal,errorIFCXML:e.errorIFCXML,onSpecificationXml:e.onSpecificationXml}}):e._e()]}}],null,!1,531754),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}):e._e(),"grid"==e.workflow_project?t("table-grid",{attrs:{list:e.getDocs,headers:e.headers,actions:[e.getDct]},scopedSlots:e._u([{key:"name",fn:function({item:s}){return[t("div",[e._v("\n                "+e._s(s.name)+"\n                ")])]}}],null,!1,4128990872)}):e._e(),t("upload-files",{attrs:{uploadF:e.uploadF,project_id:e.id},on:{"update:uploadF":function(t){e.uploadF=t},"update:upload-f":function(t){e.uploadF=t}}}),t(We["a"],{directives:[{name:"show",rawName:"v-show",value:e.selected.length&&e.getAccessSelected("or",[0,1,2]),expression:"selected.length && getAccessSelected('or', [0, 1, 2])"}],staticClass:"m-table-custom--action",style:e.cardActionStyle},[t(zt["a"],[t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:e.getAccessSelected("and",[2]),expression:"getAccessSelected('and', [2])"}],staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:e.download}},[t(o["a"],{staticClass:"mr-1",attrs:{size:"20",color:"#0070e0"}},[e._v("mdi-download")]),e._v("Скачать")],1),t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:e.getAccessSelected("and",[1]),expression:"getAccessSelected('and', [1])"}],staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:function(t){e.removeSelectedFlag=!0}}},[t(o["a"],{staticClass:"mr-1",attrs:{size:"20",color:"#0070e0"}},[e._v("mdi-trash-can-outline")]),e._v("\n                    Удалить\n                ")],1),t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:e.getAccessSelected("and",[1]),expression:"getAccessSelected('and', [1])"}],staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:function(t){e.copyItem=!0}}},[t(o["a"],{staticClass:"mr-1",attrs:{size:"20",color:"#0070e0"}},[e._v("mdi-content-copy")]),e._v("\n                    Копировать\n                ")],1),t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:e.getAccessSelected("and",[1]),expression:"getAccessSelected('and', [1])"}],staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:function(t){e.replaceItem=!0}}},[t(o["a"],{staticClass:"mr-1",attrs:{size:"20",color:"#0070e0"}},[e._v("mdi-file-replace-outline")]),e._v("\n                    Переместить\n                ")],1),t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:e.getAccessSelected("and",[0])&&e.checkTypeFiles({type:["rvt","ifc"],count:"lot"}),expression:"getAccessSelected('and', [0]) && checkTypeFiles({\n                        type: ['rvt', 'ifc'],\n                        count: 'lot'\n                        })"}],staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:e.setConsolidations}},[t(o["a"],{staticClass:"mr-1",attrs:{size:"20",color:"#0070e0"}},[e._v("trd-conect")]),e._v("\n                    Консолидация\n                ")],1)],1)],1),t("remove-selected",{attrs:{removeSelectedFlag:e.removeSelectedFlag},on:{"update:removeSelectedFlag":function(t){e.removeSelectedFlag=t},"update:remove-selected-flag":function(t){e.removeSelectedFlag=t},removeSelected:e.removeSelected}}),t("replace-item",{attrs:{replaceItem:e.replaceItem,selected:e.getReplaceItems,items:e.getDocs},on:{"update:replaceItem":function(t){e.replaceItem=t},"update:replace-item":function(t){e.replaceItem=t},clearSelected:e.clearSelected}}),t("copy-item",{attrs:{copyItem:e.copyItem,selected:e.getReplaceItems,items:e.getDocs},on:{"update:copyItem":function(t){e.copyItem=t},"update:copy-item":function(t){e.copyItem=t},clearSelected:e.clearSelected}}),t("rename-item",{attrs:{renameItem:e.renameItem,item:e.workItem},on:{"update:renameItem":function(t){e.renameItem=t},"update:rename-item":function(t){e.renameItem=t}}}),t("remove-item",{attrs:{remove_item:e.remove_item,item:e.workItem},on:{removeFolder:e.removeFolder,removeDct:e.removeDct,"update:remove_item":function(t){e.remove_item=t}}}),t("create-folder",{attrs:{newFolder:e.newFolder},on:{"update:newFolder":function(t){e.newFolder=t},"update:new-folder":function(t){e.newFolder=t},createFolder:e.createFolder}}),t("create-xml",{attrs:{createXml:e.createXml},on:{"update:createXml":function(t){e.createXml=t},"update:create-xml":function(t){e.createXml=t},createFolder:e.createFolder}}),t("access-rights",{attrs:{accessrights:e.accessrights,item:e.workItem},on:{"update:accessrights":function(t){e.accessrights=t}}}),t("version-journal",{attrs:{versionjournal:e.versionjournal,item:e.workItem},on:{"update:versionjournal":function(t){e.versionjournal=t}}}),t("error-ifcxml",{attrs:{error_ifcxml:e.error_ifcxml},on:{"update:error_ifcxml":function(t){e.error_ifcxml=t}}}),t("set-sp333-attribute",{attrs:{SP333attr:e.SP333attr,SP333JSON:e.SP333JSON,item:e.workItem},on:{"update:SP333attr":function(t){e.SP333attr=t},"update:s-p333attr":function(t){e.SP333attr=t}}}),t("collisions",{attrs:{collisions:e.collisions,collisionsJSON:e.collisionsJSON},on:{"update:collisions":function(t){e.collisions=t},"update:collisionsJSON":function(t){e.collisionsJSON=t},"update:collisions-j-s-o-n":function(t){e.collisionsJSON=t}}}),t("specification-xml",{attrs:{specification_xml:e.specification_xml,item:e.workItem},on:{"update:specification_xml":function(t){e.specification_xml=t}}})],1)],1)],1)],1)},lu=[],cu=function(){var e=this,t=e._self._c;return t("div",[t(xs["a"],e._l(e.list,(function(s,a){return t(ws["a"],{key:a,attrs:{cols:"12",sm:"6",md:"4",lg:"3"}},[t(We["a"],{staticClass:"m-table-grid",attrs:{outlined:"",flat:"",tile:""},nativeOn:{click:function(t){return e.action(s)}}},[t(zt["d"],{staticClass:"m-table-grid--name"}),t(Ye["a"],{attrs:{dense:""}},e._l(e.getHeaders(e.headers),(function(e,s){return t($e["a"],{key:s,staticClass:"m-table-grid--item"},[t(Re["a"],{staticClass:"m-table-grid--item-cell"}),t(Re["a"],{staticClass:"align-end m-table-grid--item-cell m-table-grid--item-end"})],1)})),1),t(nt["a"]),t(ws["a"],{staticClass:"m-table-grid--item-bottom"},[t("div",[e._v("\n                        "+e._s(s.name)+"\n                    ")]),t("div",[t("span",{staticClass:"m-table-grid--span"},[t("span",[e._v("V"+e._s(s.version))])]),t("span",{staticClass:"m-table-grid--span"},[t(o["a"],{attrs:{color:"1"==s.status?"#c49e00":"#6e6e6e",size:"16"}},[e._v("mdi-alert-outline")]),t("span",[e._v(e._s("0"!=s.status?s.status:""))])],1)])])],1)],1)})),1)],1)},mu=[],du={name:"TableGrid",props:["headers","list","actions"],methods:{getHeaders(e){let t=e.filter(e=>e.grid);return t},action(e){this.actions[0](e)}}},pu=du,uu=Object(m["a"])(pu,cu,mu,!1,null,null,null),hu=uu.exports,fu=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.uploadF,scrollable:"","max-width":"800px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("Загрузить файлы\n            "),t(Rt["a"]),t("div",{staticClass:"m-card-title--desc",class:{limit:e.limit.status}},[e._v(e._s(e.bytesToSize(e.getTotalSize))+" / "+e._s(e.checkSize)+"Mb\n\n                "),2e3!=e.checkSize?t(_r["a"],{attrs:{top:"",right:"",color:"#fff","max-width":"250px","content-class":"m-tooltip--info"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(o["a"],e._g({staticClass:"mr-1 m-info--file",attrs:{size:"20",color:"#0070e0"}},s),[e._v("mdi-information-outline\n                        ")])]}},{key:"default",fn:function(){return[t("span",{},[e._v("Максимальный размер файлов 20 Мб, для того чтобы снять ограничения перейдите на пакет «Профи»")])]},proxy:!0}],null,!1,2925166064)}):e._e()],1),t(nt["a"],{staticClass:"mx-0",attrs:{inset:"",vertical:""}}),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 px-4",staticStyle:{"background-color":"#fbfbfb",height:"650px"}},[t(Ee["a"],{staticClass:"m-drop-area",class:[{"m-dragging":e.dragging},{over:!e.mouseOver}],attrs:{column:"","align-center":"","justify-center":""},on:{drop:function(t){return t.stopPropagation(),t.preventDefault(),e.onChange.apply(null,arguments)},dragenter:function(t){t.stopPropagation(),t.preventDefault(),e.dragging=!0},dragleave:function(t){t.stopPropagation(),t.preventDefault(),e.dragging=!1},dragover:function(e){e.stopPropagation(),e.preventDefault()},mouseenter:function(t){return t.stopPropagation(),t.preventDefault(),e.mouseEnter.apply(null,arguments)},mouseleave:function(t){return t.stopPropagation(),t.preventDefault(),e.mouseLeave.apply(null,arguments)}}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.items.length,expression:"!items.length"}],staticClass:"m-img--file-wrap"},e._l(e.file_format,(function(s){return t("div",{staticClass:"m-img--file"},[e._v(e._s(s))])})),0),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.items.length,expression:"!items.length"}]},[e._v("Перетащите сюда файлы для загрузки")]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.items.length,expression:"items.length"}],staticClass:"list"},e._l(e.items,(function(s,a){return t("div",{key:"file-"+a,staticClass:"item",class:{selected:s.selected}},[t("div",{staticClass:"close",on:{click:function(t){return e.removeFile(s)}}},[t(o["a"],{attrs:{size:"20",left:""}},[e._v("close")])],1),t(o["a"],{attrs:{size:"80",left:""}},[e._v("icon-upload")]),e._v("\n                        "+e._s(s.item.name)+"\n                    ")],1)})),0)])],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"input-files",attrs:{type:"file",id:"items",name:"items[]",required:"",multiple:""},on:{change:e.onChange}}),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.inputFiles}},[e._v("Выбрать файл")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.items.length||e.limit.status},on:{click:e.submit}},[e._v("Подтвердить")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},vu=[],bu={props:["uploadF","project_id"],name:"UploadFiles",data(){return{dragging:!1,mouseOver:!1,items:[],file:!1,fileName:"",itemsNames:[],itemsSizes:[],limit:{value:20,unit:2,status:!1},totalSize:0,maxTotalSize:2e7,formData:"",successMsg:"",errorMsg:"",file_format:[".rvt",".stp",".iges",".stl",".pdf",".ifc",".zip",".ply",".dae",".fbx",".skp",".obj",".nwd",".3ds",".dwg",".dxf",".pln",".bd1",".max",".rfa",".ifcxml"]}},computed:{isSelected(){let e=this.items.filter(e=>e.selected);return e.length},getTotalSize(){let e=0;return this.items.map(t=>{e+=t.item.size}),e},checkSize(){return E("size2000")?2e3:20}},watch:{uploadF(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{removeFile(e){this.items=this.items.filter(t=>t.id!=e.id);let t=0;this.items.map(e=>{t+=e.item.size}),this.totalSize=t},removeFileAll(){this.items=[],this.totalSize=0},fileSelected(e){this.items=this.items.map(t=>t.id==e.id?{...t,selected:!t.selected}:t)},inputFiles(){this.$refs["input-files"].click()},mouseEnter(e){this.mouseOver=!0},mouseLeave(){this.mouseOver=!1},bytesToSize(e){const t=["Bytes","KB","MB","GB","TB"];if(0===e)return this.limit.status=!1,0;let s=parseInt(Math.floor(Math.log(e)/Math.log(1024)));if(0===s)return this.limit.status=!1,e+" "+t[s];let a=(e/Math.pow(1024,s)).toFixed(2),i=this.checkSize;return s>=this.limit.unit&&a>i?this.limit.status=!0:this.limit.status=!1,a+t[s]},onChange(e){this.dragging=!1,this.fileOver=!1,this.successMsg="",this.errorMsg="";let t=e.target.files||e.dataTransfer.files;for(let s in t)if(!isNaN(s)){let e={id:(new Date).getTime(),selected:!1,item:t[s]};this.items.some(e=>e.item.name==t[s].name)||(this.items=[...this.items,e])}},cancel(){this.items=[],this.totalSize=0,this.$refs["input-files"].value="",this.$emit("update:uploadF",!1)},getMetaTag(e){return e=""!=e?JSON.parse(e):{},e},setMetaTag(e,t={}){return t={...t,...e},t=JSON.stringify(t),t},submit(){let e=this.$store.state.workflow,t=e.currentFolder,s=[],a=[],i=[],o=null;t&&(o=e.foldersMap.filter(e=>e.id==t)[0]||null,o&&!o.group&&(a=o.files?o.files.filter(e=>!e.is_deleted):[],a=x(a,"order"),i=this.items.map(e=>{let t=new FormData;return t.append("file",e.item),t.append("name",e.item.name),t.append("project_id",this.project_id),t.append("is_attachment",!0),t.append("uuid",Object(Ut["a"])()),t})));let n=[];this.$store.dispatch("common/setUploadNote",i.map(e=>({name:e.get("name"),uuid:e.get("uuid"),action:"upload",pushin:!0}))).then(()=>(i.map(e=>{s.push(this.$store.dispatch("common/uploadFile",e))}),Promise.all(s))).then(e=>{let t=[];return e.filter(e=>!e.error).map((e,s)=>{n.push({name:e.name,uuid:e.uuid,action:"upload",pushin:!1});let i=a.filter(t=>t.name==e.name);i.length?(a=a.filter(t=>t.name!=e.name),t.push(this.$store.dispatch("workflow/addDoc",{id:i[0].id,name:e.name,order:s,folder:o.id||null,version:null,files:[{url:e.id,size:e.size,created_at:e.created_at,created_by:e.created_by}]}))):t.push(this.$store.dispatch("workflow/addDoc",{id:Object(Ut["a"])(),name:e.name,order:s,folder:o.id||null,files:[{url:e.id,size:e.size,created_at:e.created_at,created_by:e.created_by}]}))}),Promise.all(t)}).then(e=>{let s=[];return e.map(e=>{let a=this.$store.state.administration.folderPermissions;if(a&&a.find(e=>e.id==t))a=a.find(e=>e.id==t);else{let e=this.$store.state.administration.user;a={users:[{id:e.id+"",email:e.email,full_name:e.first_name+" "+e.last_name,can_open:!0,can_edit:!0,can_download:!0,can_comment:!0}]}}s.push(this.$store.dispatch("administration/setFilesPermissions",{id:e.id,body:{id:e.id,users:a.users,groups:this.$store.state.administration.groupPermissions.map(e=>({id:e.id,name:e.name,can_open:!0,can_edit:!0,can_download:!0,can_comment:!0}))}}))}),Promise.all(s)}).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(()=>this.$store.dispatch("administration/getFilesPermissions")).then(()=>{this.$store.dispatch("workflow/createFoldersMap"),this.$store.dispatch("common/setUploadNote",n)}),this.cancel()},enter(e){if(13===e.keyCode){if(e.preventDefault(),!this.items.length||this.limit.status)return;this.submit()}}}},gu=bu,yu=Object(m["a"])(gu,fu,vu,!1,null,null,null),_u=yu.exports,Cu=function(){var e=this,t=e._self._c;return t(qe["a"],{attrs:{top:"",right:"","offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(o["a"],e._g({staticClass:"m-icon-border",attrs:{text:"",icon:"",size:"20"},on:{mousedown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"pevent",void 0,t.key,void 0))return null;t.stopPropagation()}}},s),[e._v("\n            mdi-dots-horizontal\n        ")])]}}])},[t(We["a"],[t(Ye["a"],{attrs:{dense:""}},e._l(e.createMenu(),(function(s,a){return t($e["a"],{key:a,staticClass:"pr-10",on:{click:function(t){return e.action(s)}}},[t(Re["c"],{class:["m-menu-title",{"m-text--color-red":"red"==s.color}],domProps:{textContent:e._s(s.title)}})],1)})),1)],1)],1)},wu=[],ku={props:["item","access"],data:()=>({doc:[{title:"Скачать файл",value:"original",action:"download",access:2},{title:"",value:"ifcxml",action:"",access:2},{id:3,title:"Открыть",value:"edit",action:"edit",access:0},{id:4,title:"Описание XML",value:"specificationxml",action:"specificationxml",access:0},{title:"Копировать",value:"copy",action:"copy",access:1},{title:"Переместить",value:"replace",action:"replace",access:1},{id:6,title:"Переименовать",value:"rename",action:"rename",access:1},{id:7,title:"Удалить",value:"remove",action:"remove",access:1},{title:"Права доступа",value:"accessright",action:"accessright",access:1},{title:"Журнал версий",value:"versionjournal",action:"versionjournal",access:1}],folder:[{title:"Открыть",value:"open",action:"open",access:0},{title:"Копировать",value:"copy",action:"copy",access:1},{title:"Переместить",value:"replace",action:"replace",access:1},{title:"Переименовать",value:"rename",action:"rename",access:1},{title:"Удалить",value:"remove",action:"remove",access:1},{title:"Права доступа",value:"accessright",action:"accessright",access:1}]}),methods:{getAccess(e){return this.access>>e&1},getIFCXMLforMenu(e){return-1==e?{title:"Конвертировать в РСИМ",value:"ifcxml",action:"convertation",access:1}:1==e?{title:"Скачать РСИМ (ifcxmlRUS)",value:"ifcxml",action:"download",access:2}:3==e?{title:"Ошибка при конвертации РСИМ",value:"ifcxml",color:"red",action:"",access:1}:11==e?{title:"Конвертировать в РСИМ",value:"ifcxml",action:"errorIFCXML",access:1}:{title:"",value:"ifcxml",action:"",access:5,remove:1}},createMenu(){const e=this.item.type;let t=[];if("folder"==e)t=this[e].filter(e=>this.getAccess(e.access)&&("accessright"!=e.value||!this.item.group));else{if(t=this["doc"],this.$store.state.workflow.fileTypeConversion.some(t=>t==e)){let e=this.item.tags["ifcxml.zip"]||101;if(-1==e){let t=1==this.item.tags["error.json"]||1==this.item.tags["warning.json"]||1==this.item.tags["classerror.json"]||1==this.item.tags["class.error.json"]||1==this.item.tags["classerror.onlyempty.json"];e=t?11:e}t=t.filter(e=>this.getAccess(e.access)).map(t=>"ifcxml"==t.value?E("convertRSIM")?this.getIFCXMLforMenu(e):(t.remove=1,t):"specificationxml"==t.value?(E("specificationxml")||(t.remove=1),t):t).filter(e=>!e.remove)}else t="consolidations"==e?t.filter(e=>"ifcxml"!=e.value&&(3==e.id||6==e.id||7==e.id)).filter(e=>this.getAccess(e.access)):t.filter(e=>this.getAccess(e.access)&&"ifcxml"!=e.value);"pdf"!=e&&(t=t.filter(e=>4!=e.id)),3==this.item.status_file&&(t=t.filter(e=>3!=e.id))}return t},action(e){this.item.type;switch(e.action){case"remove":this.$emit("removeItem",this.item);break;case"edit":this.$emit("getDct",this.item);break;case"open":this.$emit("openFolder",this.item);break;case"replace":this.$emit("replaceItems",[this.item]);break;case"copy":this.$emit("copyItems",[this.item]);break;case"rename":this.$emit("renameitem",this.item);break;case"accessright":this.$emit("accessRights",this.item);break;case"versionjournal":this.$emit("versionJournal",this.item);break;case"errorIFCXML":this.$emit("errorIFCXML");break;case"specificationxml":this.$emit("onSpecificationXml",this.item);break;case"download":this.$emit("download",{file:this.item,type:e.value});break;case"convertation":this.$emit("convertationIFCXML",this.item);break;default:return}}}},xu=ku,Su=Object(m["a"])(xu,Cu,wu,!1,null,null,null),Au=Su.exports,Iu=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.removeSelectedFlag,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v("Удалить выбранные элементы?\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 pl-4",staticStyle:{"background-color":"#fbfbfb",color:"#000"}},[e._v("\n            После удаления файлы в течение 30 дней будут находится в корзине, по истечению срока они будут удалены окончательно, без возможности восстановления.\n        ")]),t(nt["a"]),t(zt["a"],{staticClass:"pa-5"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.removeSelected}},[e._v("Да")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Нет")])],1)],1)],1)},Ou=[],ju={props:["removeSelectedFlag"],name:"RemoveSelected",watch:{removeSelectedFlag(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{cancel(){this.$emit("update:removeSelectedFlag",!1)},removeSelected(){this.$emit("removeSelected"),this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.removeSelected())}}},Fu=ju,Pu=Object(m["a"])(Fu,Iu,Ou,!1,null,null,null),Eu=Pu.exports,Uu=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.replaceItem,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v("Переместить\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-4",staticStyle:{height:"200px"}},[t("sl-vue-tree",{ref:"tree",on:{select:e.selectNode},scopedSlots:e._u([{key:"title",fn:function({node:s}){return[e._l(s.level-1,(function(a){return s.level>1?t("span",{staticClass:"level-gap"}):e._e()})),s.data.group?e._e():t("span",{staticClass:"leaf-icon pl-1",class:"level-"+s.level},[t(o["a"],{attrs:{size:"18"}},[e._v("icon-folder")])],1),t("span",{staticClass:"sl-vue-tree-title--name",class:[{"sl-group":s.data.group},"level-"+s.level]},[e._v("\n                        "+e._s(s.title)+"\n                    ")])]}},{key:"toggle",fn:function({node:s}){return[s.data.group||3!=s.level&&s.children.length?t("span",{class:[{expanded:s.isExpanded},"level-"+s.level]},[t(o["a"],{attrs:{size:"18"}},[e._v("mdi-chevron-down")])],1):e._e(),2!=s.level||s.children.length?e._e():t("span")]}}]),model:{value:e.folderslist,callback:function(t){e.folderslist=t},expression:"folderslist"}})],1),t(nt["a"]),t("div",{staticClass:"py-1 px-4 m-card--subtitle"},[e._v("Выбранные папки или файлы:")]),t(zt["c"],{staticClass:"pa-4 pt-1"},e._l(e.getSelected(),(function(s){return t("div",{staticClass:"mb-1"},["folder"==s.type?t(o["a"],{attrs:{size:"18"}},[e._v("icon-folder")]):t(o["a"],{attrs:{size:"18"}},[e._v("ft-"+e._s("type"==s.type?"unknown":s.type))]),t("span",{staticClass:"m-card--filename"},[e._v(e._s(s.name))])],1)})),0),t(nt["a"]),t("div",{staticClass:"py-2 px-4 m-card--subtitle"},[e._v("Текущая папка")]),t("div",{staticClass:"py-0 px-4 m-card--subtitle m-card--text-blue"},[e._v(e._s(e.currentPath()))]),t("div",{staticClass:"py-2 px-4 m-card--subtitle"},[e._v("Переместить в")]),t("div",{staticClass:"py-0 px-4 m-card--subtitle m-card--text-blue"},[e._v(e._s(e.pathName))]),t(zt["a"],{staticClass:"pa-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.checkFolder},on:{click:e.replace}},[e._v("Переместить")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},Bu=[],Tu={props:["replaceItem","items","selected"],name:"ReplaceItem",components:{SlVueTree:Et.a},data(){return{folder:0,path:"",pathName:"/",selectedNode:0,done:!1}},computed:{folderslist:{get(){let e=this.$store.state.workflow.foldersMap.filter(e=>e.access>>1&1),t=w.createTreeForSidebar(e,0,2,{isDraggable:!1,isExpanded:!1,isSelected:!1});return t},set(e){}},checkFolder(){let e=this.$store.state.workflow,t=e.currentFolder,s=!1;return s=this.selectedNode?t!==this.selectedNode.id:t!==this.selectedNode,s}},watch:{replaceItem(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{selectNode(e){this.selectedNode=e[0].data;let t="/";this.pathName=t+this.searchPath(e[0].data.id).reverse().join("/")},currentPath(){let e=this.$store.state.workflow,t=e.currentFolder;return"/"+this.searchPath(t).reverse().join("/")},searchPath(e){let t=this.$store.state.workflow.foldersMap,s=t.filter(t=>t.id==e)[0];if(s=s||!1,!s)return[];let a=[s.name];return s.parent&&a.push(...this.searchPath(s.parent)),a},getSelected(){let e=this.selected.items;return e},cancel(){this.path="",this.folder=0,this.pathName="/",this.selectedNode=0,this.$emit("clearSelected",!!this.done&&this.selected.type),this.done=!1,this.$emit("update:replaceItem",!1)},enter(e){13===e.keyCode&&(e.preventDefault(),this.replace())},replace(){let e=this.$store.state.workflow,t=(e.currentFolder,this.selectedNode?this.selectedNode.id:0),s=e.foldersMap.filter(e=>"folder"===e.type&&!1===e.group&&e.parent===t).length,a=e.foldersMap.filter(e=>e.id===t);a.length&&(a=a[0].files?a[0].files.length:0);let i={in:{name:"",order:0,list:this.selectedNode.group&&this.selectedNode.list?this.selectedNode.list:[],length:this.selectedNode.group&&this.selectedNode.list?this.selectedNode.list.length:0},out:{id:0,name:"",order:0,list:[]}},o=[];if(this.selected.items.map(n=>{if("folder"==n.type){if(!n.group){let a=e.foldersMap.filter(e=>e.id==n.id)[0],r={id:n.id,name:n.name,parent:t?this.selectedNode.group?n.id:t:n.id,order:s++};if(o.push(this.$store.dispatch("workflow/addFolder",r)),this.selectedNode.group){let e=i.in.length;i.in.list.push({folder:n.id,order:e}),i.in.length++}if(a.toGroup){let t=e.foldersMap.filter(e=>e.id==a.toGroup);i.out.id=t[0].id,i.out.name=t[0].name,i.out.order=t[0].order,i.out.list.push({folder:n.id})}}}else!this.selectedNode.group&&this.selectedNode&&o.push(this.$store.dispatch("workflow/addDoc",{id:n.id,name:n.name,order:a++,folder:t}))}),i.out.list.length){let t=e.foldersMap.filter(e=>e.id==i.out.id),s=t[0].folders;i.out.list.map(e=>{s=s.filter(t=>t.folder!=e.folder)}),s=s.length?s:null,o.push(this.$store.dispatch("workflow/addGroup",{name:i.out.name,order:i.out.order,folders:s}))}if(this.selectedNode.group){let t=e.foldersMap.filter(e=>e.id==this.selectedNode.id);o.push(this.$store.dispatch("workflow/addGroup",{name:t[0].name,order:t[0].order,folders:i.in.list.length?i.in.list:null}))}Promise.all(o).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>{this.$store.dispatch("workflow/createFoldersMap")}).then(()=>{this.done=!0,this.cancel()})}}},Lu=Tu,Nu=Object(m["a"])(Lu,Uu,Bu,!1,null,null,null),Hu=Nu.exports,Mu=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.copyItem,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v("Копировать\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-4",staticStyle:{height:"200px"}},[t("sl-vue-tree",{ref:"tree",on:{select:e.selectNode},scopedSlots:e._u([{key:"title",fn:function({node:s}){return[e._l(s.level-1,(function(a){return s.level>1?t("span",{staticClass:"level-gap"}):e._e()})),s.data.group?e._e():t("span",{staticClass:"leaf-icon pl-1",class:"level-"+s.level},[t(o["a"],{attrs:{size:"18"}},[e._v("icon-folder")])],1),t("span",{staticClass:"sl-vue-tree-title--name",class:[{"sl-group":s.data.group},"level-"+s.level]},[e._v("\n                        "+e._s(s.title)+"\n                    ")])]}},{key:"toggle",fn:function({node:s}){return[s.data.group||3!=s.level&&s.children.length?t("span",{class:[{expanded:s.isExpanded},"level-"+s.level]},[t(o["a"],{attrs:{size:"18"}},[e._v("mdi-chevron-down")])],1):e._e(),2!=s.level||s.children.length?e._e():t("span")]}}]),model:{value:e.folderslist,callback:function(t){e.folderslist=t},expression:"folderslist"}})],1),t(nt["a"]),t("div",{staticClass:"py-1 px-4 m-card--subtitle"},[e._v("Выбранные папки или файлы:")]),t(zt["c"],{staticClass:"pa-4 pt-1"},e._l(e.getSelected(),(function(s){return t("div",{staticClass:"mb-1"},["folder"==s.type?t(o["a"],{attrs:{size:"18"}},[e._v("icon-folder")]):t(o["a"],{attrs:{size:"18"}},[e._v("ft-"+e._s("type"==s.type?"unknown":s.type))]),t("span",{staticClass:"m-card--filename"},[e._v(e._s(s.name))])],1)})),0),t(nt["a"]),t("div",{staticClass:"py-2 px-4 m-card--subtitle"},[e._v("Текущая папка")]),t("div",{staticClass:"py-0 px-4 m-card--subtitle m-card--text-blue"},[e._v(e._s(e.currentPath()))]),t("div",{staticClass:"py-2 px-4 m-card--subtitle"},[e._v("Копировать в")]),t("div",{staticClass:"py-0 px-4 m-card--subtitle m-card--text-blue"},[e._v(e._s(e.pathName))]),t(zt["a"],{staticClass:"pa-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.checkFolder},on:{click:e.copy}},[e._v("Копировать")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},zu=[],$u={props:["copyItem","items","selected"],name:"CopyItem",components:{SlVueTree:Et.a},data(){return{folder:0,path:"",pathName:"/",selectedNode:0,done:!1}},computed:{folderslist:{get(){let e=this.$store.state.workflow.foldersMap.filter(e=>e.access>>1&1),t=w.createTreeForSidebar(e,0,2,{isDraggable:!1,isExpanded:!1,isSelected:!1});return t},set(e){}},checkFolder(){let e=this.$store.state.workflow,t=(e.currentFolder,!0);return t}},watch:{copyItem(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{selectNode(e){this.selectedNode=e[0].data;let t="/";this.pathName=t+this.searchPath(e[0].data.id).reverse().join("/")},currentPath(){let e=this.$store.state.workflow,t=e.currentFolder;return"/"+this.searchPath(t).reverse().join("/")},searchPath(e){let t=this.$store.state.workflow.foldersMap,s=t.filter(t=>t.id==e)[0];if(s=s||!1,!s)return[];let a=[s.name];return s.parent&&a.push(...this.searchPath(s.parent)),a},getSelected(){let e=this.selected.items;return e},cancel(){this.path="",this.folder=0,this.pathName="/",this.selectedNode=0,this.$emit("clearSelected",!!this.done&&this.selected.type),this.done=!1,this.$emit("update:copyItem",!1)},newDoc(e,t,s,a){let i=t.listDocs.find(t=>t.id==e.id),o=e.name;if(i.folder==s.id){let s=t.listDocs.filter(t=>t.folder==e.folder),a=this.createShortName(e.name);o=this.createCopyNameFile(a.name,s)+"."+a.type}return{id:Object(Ut["a"])(),name:o,order:!1===a?i.order:a++,folder:s.id,files:i.files}},newFolder(e,t,s,a){let i=t.foldersMap.find(t=>t.id==e.id),o=[],n=[],r=t.foldersMap.filter(e=>e.parent==(s.parent||0)),l=Object(Ut["a"])(),c={id:l,parent:s?s.group?l:s.id:l,name:this.createCopyName(i.name,r),order:!1===a?i.order:a++},m=[];return s&&s.group&&(m=[{folder:l,order:c.order}]),n.push(c),i.files&&i.files.map(e=>{o.push(this.newDoc(e,t,c,!1))}),i.folders&&i.folders.map(e=>{let s=this.newFolder(e,t,c,!1);o=[...o,...s.listFiles],n=[...n,...s.listFolders]}),{listFiles:o,listFolders:n,toGroup:m}},createShortName(e){e=e.split(".");let t=e.splice(-1,1)[0];return{name:e.join("."),type:t}},createCopyNameFile(e,t,s=1){let a=" копия "+s,i=e;return i=t.some(t=>this.createShortName(t.name).name==e+a)?this.createCopyName(e,t,s+1):e+a,i},createCopyName(e,t,s=1){let a=" копия "+s,i=e;return i=t.some(t=>t.name==e+a)?this.createCopyName(e,t,s+1):e+a,i},enter(e){13===e.keyCode&&(e.preventDefault(),this.copy())},copy(){let e=[],t=[],s=[],a=this.$store.state.workflow,i=a.foldersMap.find(e=>e.id==this.selectedNode.id),o=i&&i.files?i.files.length:0,n=i?i.folders?i.folders.length:0:a.foldersMap.filter(e=>e.id==e.parent&&!e.toGroup).length,r=a.foldersMap.filter(e=>!1!==e.group).length,l=[];if(this.selected.items.map(i=>{if("folder"!==i.type)this.selectedNode&&!this.selectedNode.group&&(t=[...t,this.newDoc(i,a,this.selectedNode,o)]);else if("folder"!==i.type||i.group){if(!this.selectedNode){let o=a.foldersMap.filter(e=>!1!==e.group),n=a.foldersMap.find(e=>e.id===i.id),l=this.createCopyName(i.name,o),c=[];n.folders&&n.folders.map(s=>{let i=a.foldersMap.find(e=>e.id===s.folder),o=this.newFolder(i,a,0,!1);o.listFiles.map(e=>{t=[...t,e]}),o.listFolders.map(t=>{t.id==t.parent&&(c=[...c,{folder:t.id,order:t.order}]),e=[...e,t]})}),s=[...s,{name:l,order:r++,folders:c.length?c:null}]}}else{let s=this.newFolder(i,a,this.selectedNode||0,n);s.listFiles.map(e=>{t=[...t,e]}),s.listFolders.map(t=>{e=[...e,t]}),l=[...l,...s.toGroup]}}),this.selectedNode&&this.selectedNode.group){let e=this.selectedNode.folders||[];s=[...s,{name:this.selectedNode.name,order:this.selectedNode.order,folders:[...e,...l]}]}e=e.map(e=>this.$store.dispatch("workflow/addFolder",e)),Promise.all(e).then(()=>(t=t.map(e=>this.$store.dispatch("workflow/addDoc",e)),Promise.all(t))).then(()=>(s=s.map(e=>this.$store.dispatch("workflow/addGroup",e)),Promise.all(s))).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>{this.$store.dispatch("workflow/createFoldersMap")}).then(()=>{this.done=!0,this.cancel()})}}},Ru=$u,Du=Object(m["a"])(Ru,Mu,zu,!1,null,null,null),Ju=Du.exports,Vu=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.renameItem,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v(e._s(e.getTitle)+"\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5",staticStyle:{"background-color":"#fbfbfb","min-height":"120px"}},[t(Dt["a"],{attrs:{label:e.getTitle,value:e.item?e.createShortName(e.item.name):"",autocomplete:"off"},on:{input:e.editName}})],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:e.checkChange()},on:{click:e.rename}},[e._v("Переименовать")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},Ku=[],Gu={props:{renameItem:{type:Boolean,default:!1},item:{type:Object,default:null}},name:"RenameItem",data(){return{name:"",type:""}},computed:{getTitle(){let e=this.item?"Имя "+("folder"==this.item.type?"папки":"файла"):"Имя";return e}},watch:{renameItem(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{checkChange(){if(!this.item)return!0;let e=!this.name||this.name==this.item.name;this.$store.state.workflow.foldersMap.filter(e=>e.parent==this.item.parent).map(t=>{t.name==this.name&&(e=!0)});return e},cancel(){this.name="",this.type="",this.$emit("update:renameItem",!1)},editName(e){this.name=e},createShortName(e){if("folder"==this.item.type)return e;{e=e.split(".");let t=e.splice(-1,1)[0];return this.type||(this.type=t),e.join(".")}},rename(){if("folder"==this.item.type)if(this.item.group){let e=this.$store.state.workflow.foldersMap.find(e=>e.id==this.item.id),t={name:e.name,order:e.order,created_at:e.created_at,created_by:e.created_by,updated_at:e.updated_at,updated_by:e.updated_by,folders:e.folders||null};this.$store.dispatch("workflow/removeGroup",t),t={name:this.name,order:e.order,folders:e.folders||null},this.$store.dispatch("workflow/addGroup",t).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>new Promise(e=>{e(this.$store.dispatch("workflow/createFoldersMap"))}))}else{let e=this.$store.state.workflow.foldersMap,t=e.find(e=>e.id==this.item.id);this.$store.dispatch("workflow/addFolder",{id:this.item.id,parent:t.parent||this.item.id,name:this.name,order:t.order}).then(t=>{e=e.map(e=>e.id==this.item.id?{...e,name:t.name}:e),this.$store.commit("workflow/setFoldersMap",e)})}else{let e=this.$store.state.workflow.listDocs.find(e=>e.id==this.item.id);this.$store.dispatch("workflow/addDoc",{id:this.item.id,name:this.name+"."+this.type,order:e.order,folder:e.folder}).then(e=>{this.$store.dispatch("workflow/updateDocInState",{...e,name_short:this.createShortName(e.name)})})}this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.rename())}}},Qu=Gu,Xu=Object(m["a"])(Qu,Vu,Ku,!1,null,null,null),Wu=Xu.exports,Yu=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.remove_item,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v("Вы действительно хотите удалить "+e._s("folder"==e.getItem.type?" папку":" файл")+"?\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 pl-4",staticStyle:{"background-color":"#fbfbfb",color:"#000"}},["folder"==e.getItem.type?t("span",[e._v("После удаления папки вложенные файлы в течение 30 дней будут находится в корзине, по истечению срока они будут удалены окончательно, без возможности восстановления. "),t("br"),e._v("Удаленные папки восстановлению не подлежат.\n            ")]):t("span",[e._v("После удаления файл в течение 30 дней будет находится в корзине, по истечению срока он будет удален окончательно, без возможности восстановления.\n            ")])]),t(nt["a"]),t(zt["a"],{staticClass:"pa-5"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.remove}},[e._v("Да")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Нет")])],1)],1)],1)},qu=[],Zu={props:["remove_item","item"],name:"RemoveItem",computed:{getItem(){return this.item?{type:this.item.type,name:this.item.name}:{type:"",name:""}}},watch:{remove_item(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{cancel(){this.$emit("update:remove_item",!1)},remove(){"folder"==this.item.type?this.$emit("removeFolder",this.item):this.$emit("removeDct",this.item),this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.remove())}}},eh=Zu,th=Object(m["a"])(eh,Yu,qu,!1,null,null,null),sh=th.exports,ah=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.createXml,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v("Документ XML\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 px-4",staticStyle:{"background-color":"#fbfbfb","min-height":"120px"}},[t(We["a"],{attrs:{outlined:"",tile:""}},[t(Ye["a"],{attrs:{dense:""}},e._l(e.items,(function(s){return t($e["a"],[e._v("\n                        "+e._s(s)+"\n                    ")])})),1)],1)],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5"},[t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:function(e){}}},[e._v("Загрузить")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:function(e){}}},[e._v("Создать")])],1)],1)],1)},ih=[],oh={props:["createXml"],name:"CreateXml",data(){return{folder_name:"",items:["First","Second","Thrrrr"]}},watch:{createXml(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{checkChange(){return!this.folder_name},cancel(){this.folder_name="",this.$emit("update:createXml",!1)},createFolder(){this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.createFolder())}}},nh=oh,rh=Object(m["a"])(nh,ah,ih,!1,null,null,null),lh=rh.exports,ch=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.versionjournal,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("Журнал версий\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 px-4"},[t(ks["a"],{staticClass:"m-table-custom",attrs:{headers:e.headers,items:e.versions.list,"disable-pagination":"","hide-default-footer":"","calculate-widths":""},scopedSlots:e._u([{key:"no-data",fn:function(){return[e._v("\n                    "+e._s(e.noData)+"\n                ")]},proxy:!0},{key:"item.action",fn:function({item:s}){return[e.checkVersion(s)?t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",disabled:"",color:"normal"}},[e._v("\n                        Текущая версия\n                    ")]):t(Xe["a"],{staticClass:"m-btn m-btn-hidden",attrs:{outlined:"",color:"primary"},on:{click:function(t){return e.setVersion(s)}}},[e._v("\n                        Сделать текущей\n                    ")])]}}])})],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.save}},[e._v("Подтвердить")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"normal"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},mh=[],dh={name:"VersionJournal",props:["versionjournal","item"],data(){return{version:0,versionID:null,headers:[{text:"Имя файла",value:"name",sortable:!1},{text:"Дата загрузки",value:"date",sortable:!1,align:"center"},{text:"Версия",value:"version",sortable:!1,align:"center"},{text:"",value:"action",sortable:!1,align:"right"}],noData:"Нет данных"}},computed:{versions(){let e={year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},t=this.item?this.item.name:"",s=this.item&&"folder"!=this.item.type?this.item.version?this.item.version:this.item.files[0].id:0,a=this.item&&"folder"!=this.item.type?this.item.files.map((t,s)=>({id:t.url,name:this.item.name,date:new Date(t.created_at).toLocaleDateString("ru-RU",e),version:t.version,versionID:t.id})):[];return{version:s,name:t,list:a}}},watch:{versionjournal(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{checkVersion(e){if(this.version){if(e.version==this.version)return!0}else if(e.version==this.versions.version)return!0;return!1},setVersion(e){this.version=e.version,this.versionID=e.versionID},cancel(){this.version=0,this.$emit("update:versionjournal",!1)},save(){this.version&&this.version!=this.versions.version&&this.$store.dispatch("workflow/addDoc",{id:this.item.id,name:this.versions.name,version:this.versionID,order:this.item.order,folder:this.item.folder}).then(e=>{this.$store.dispatch("workflow/updateDocInState",e),this.cancel()})},enter(e){13===e.keyCode&&(e.preventDefault(),this.save())}}},ph=dh,uh=Object(m["a"])(ph,ch,mh,!1,null,null,null),hh=uh.exports,fh=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.error_ifcxml,scrollable:"","max-width":"600px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-4"},[e._v("\n            Ошибка конвертации\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 pl-4",staticStyle:{"background-color":"#fbfbfb",color:"#000"}},[e._v("\n            Информационная модель не соответствует нормативным требованиям и не может быть конвертирована в РСИМ. Исправьте все ошибки, которые указал наш ИИ.\n        ")]),t(nt["a"]),t(zt["a"],{staticClass:"pa-5"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Закрыть")])],1)],1)],1)},vh=[],bh={props:["error_ifcxml"],name:"ErrorIfcxml",methods:{cancel(){this.$emit("update:error_ifcxml",!1)}}},gh=bh,yh=Object(m["a"])(gh,fh,vh,!1,null,null,null),_h=yh.exports,Ch=s("7e85"),wh=s("e516"),kh=s("9c54"),xh=s("56a4"),Sh=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{"content-class":e.clueBox?"m-transparent":"",value:e.SP333attr,scrollable:"","max-width":"700px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-12 pl-4 m-modal--title"},[t("span",[e._v("Нормативные коллизии: Классификатор Строительной Информации")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn--close",attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(Ch["a"],{staticClass:"m-stepper",model:{value:e.step,callback:function(t){e.step=t},expression:"step"}},[t(kh["a"],[t(xh["a"],{attrs:{complete:e.step>1,step:"1"}},[e._v("\n                    Наименование компонентов\n                ")]),t(nt["a"]),t(xh["a"],{attrs:{step:"2"}},[e._v("\n                    Атрибутивная информация\n                ")])],1),t(zt["c"],{staticClass:"pa-0",style:{"overflow-y":"scroll","max-height":"calc(100% - 72px)"}},[t(kh["b"],[t(wh["a"],{attrs:{step:"1"}},e._l(e.classerrorList,(function(s){return t("div",[s.error_class?[t("div",{staticClass:"m-card-list__title"},[e._v(e._s(s.title+s.name))]),t("div",{staticClass:"m-card-list__row"},[t("span",{staticClass:"m-card-list__cell"},[e._v(e._s(s.error_class.key))]),t("span",{staticClass:"m-card-list__cell"},[t(_s["a"],{staticClass:"pa-0 ma-0",attrs:{items:s.error_class.item_value.items,"return-object":"","item-text":"name","item-value":"name","persistent-hint":"",placeholder:" ","hide-details":"",dense:""},on:{change:e.onChange},model:{value:s.error_class.item_value.value,callback:function(t){e.$set(s.error_class.item_value,"value",t)},expression:"elem.error_class.item_value.value"}})],1),t("span",{staticClass:"m-card-list__cell m-card-list__cell--no-width px-1"},[s.error_class?t(o["a"],{attrs:{color:"#4e93e9",size:"20"},on:{click:function(t){return e.showClue({name:s.error_class.key,value:s.key})}}},[e._v("\n                                    >\n                                    mdi-help-circle-outline\n                                ")]):e._e()],1)])]:e._e()],2)})),0),t(wh["a"],{attrs:{step:"2"}},e._l(e.classerrorList,(function(s){return t("div",[s.error_attr.length?[t("div",{staticClass:"m-card-list__title"},[e._v(e._s(s.name))]),e._l(s.error_attr,(function(a){return t("div",{staticClass:"m-card-list__row"},[t("span",{staticClass:"m-card-list__cell"},[e._v(e._s(a.key))]),t("span",{staticClass:"m-card-list__cell py-0"},["string"==a.type?t(Dt["a"],{staticClass:"ma-0 pa-0",attrs:{placeholder:" ","hide-details":""},model:{value:a.item_value.value,callback:function(t){e.$set(a.item_value,"value",t)},expression:"prop.item_value.value"}}):"integer"==a.type?t("input",{directives:[{name:"model",rawName:"v-model",value:a.item_value.value,expression:"prop.item_value.value"}],staticClass:"ma-0 pa-0 m-input--noattr",domProps:{value:a.item_value.value},on:{input:[function(t){t.target.composing||e.$set(a.item_value,"value",t.target.value)},function(t){return e.onlyInteger(t,a)}]}}):"float"==a.type?t("input",{directives:[{name:"model",rawName:"v-model",value:a.item_value.value,expression:"prop.item_value.value"}],staticClass:"ma-0 pa-0 m-input--noattr",domProps:{value:a.item_value.value},on:{input:[function(t){t.target.composing||e.$set(a.item_value,"value",t.target.value)},function(t){return e.onlyFloat(t,a)}]}}):"boolean"==a.type?t(Od["a"],{staticClass:"ma-0",attrs:{dense:"",placeholder:" ","hide-details":"",color:"primary"},model:{value:a.item_value.value,callback:function(t){e.$set(a.item_value,"value",t)},expression:"prop.item_value.value"}}):"text"==a.type?t(bi["a"],{staticClass:"ma-0",attrs:{placeholder:" ","multi-line":"","hide-details":"",rows:"2"},model:{value:a.item_value.value,callback:function(t){e.$set(a.item_value,"value",t)},expression:"prop.item_value.value"}}):"list"==a.type?t(_s["a"],{staticClass:"pa-0 ma-0",attrs:{items:a.item_value.items,"item-text":"name","item-value":"name","persistent-hint":"",placeholder:" ","hide-details":"",dense:""},model:{value:a.item_value.value,callback:function(t){e.$set(a.item_value,"value",t)},expression:"prop.item_value.value"}}):e._e()],1),t("span",{staticClass:"m-card-list__cell m-card-list__cell--no-width px-1"},[t(o["a"],{attrs:{color:"#4e93e9",size:"20"},on:{click:function(t){return e.showClue({name:a.key,value:"наименование системы"==a.key?s.key:a.key})}}},[e._v("\n                                    >\n                                    mdi-help-circle-outline\n                                ")])],1)])}))]:e._e()],2)})),0)],1)],1)],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"default"},on:{click:e.save}},[e._v("Сохранить")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"default",disabled:!e.getTagError},on:{click:e.getReport}},[e._v("Отчет\n            ")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.checkErrorReady},on:{click:e.next}},[e._v("Продолжить")]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"default"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1),t("clue-sp333-attribute",{attrs:{clueBox:e.clueBox,SP333JSON:e.SP333JSON,clueInfo:e.clueInfo,step:e.step},on:{"update:clueBox":function(t){e.clueBox=t},"update:clue-box":function(t){e.clueBox=t}}})],1)},Ah=[],Ih=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{"overlay-opacity":"0",value:e.clueBox,scrollable:"","max-width":1==e.step?"":"700px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-12 pl-4 m-modal--title"},[t("span",[e._v("Подсказка Классификатор Строительной Информации: "+e._s(e.getElem.name))]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn--close",attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 px-4 pb-0"},[t(ks["a"],{staticClass:"m-table--simple",attrs:{headers:e.headers,items:e.getItems,"disable-pagination":"","hide-default-footer":""}})],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"grey"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},Oh=[],jh={name:"ClueSp333Attribute",props:{clueBox:{type:Boolean,default:!1},SP333JSON:{type:Object,default:{list:[],clue:[]}},clueInfo:{type:Object,default:null},step:{type:Number,default:1}},data(){return{headersCom:[{text:"Наименование компонента",align:"center",sortable:!1,value:"name"},{text:"Определение компонента",value:"definition",align:"center",sortable:!1},{text:"Источник",value:"source",align:"center",sortable:!1},{text:"Примеры компонентов по ISO 81346-2:2019",value:"examples_ISO",align:"center",sortable:!1},{text:"Примеры компонентов (НТД РФ)",value:"examples_NTD",align:"center",sortable:!1}],headersTeS:[{text:"Наименование характеристики",align:"center",sortable:!1,value:"name"},{text:"Определение",value:"definition",align:"center",sortable:!1},{text:"Источник",value:"source",align:"center",sortable:!1}]}},computed:{headers(){return 1==this.step?this.headersCom:this.headersTeS},getElem(){return this.clueInfo?this.clueInfo:{name:""}},getItems(){if(this.clueInfo){let e=this.clueInfo.info.map(e=>({...e,type:e.datatype?e.datatype.type:null}));return e}return[]}},methods:{cancel(){this.$emit("update:clueBox",!1)}}},Fh=jh,Ph=Object(m["a"])(Fh,Ih,Oh,!1,null,null,null),Eh=Ph.exports,Uh={name:"SetSp333Attribute",components:{ClueSp333Attribute:Eh},props:{SP333attr:{type:Boolean,default:!1},SP333JSON:{type:Object,default:{list:[],clue:[]}},item:{type:Object,default:null}},data(){return{clueBox:!1,clueInfo:null,step:1,meta:null,errorJson:null,propertyJson:null,classerrorList:[],source:null}},computed:{getItem(){return this.item?this.item:{sp333:{value:""},tags:{}}},checkErrorReady(){return!0},getTagError(){let e=this.item;return!!e&&(this.item.tags["class.error.xlsx"]&&1==this.item.tags["class.error.xlsx"]?"class.error.xlsx":!(!this.item.tags["attribute.error.xlsx"]||1!=this.item.tags["attribute.error.xlsx"])&&"attribute.error.xlsx")}},watch:{clueBox(e){e||(this.clueInfo=null)},SP333attr(e){e?this.getErrorJson():this.classerrorList=[]}},methods:{cancel(){this.step=1,this.$emit("update:SP333attr",!1)},onChange(e){},getFileByVersion(e){if(null==e.version)return e.files[0];{let t=e.files.find(t=>t.id==e.version);return t||e.files[0]}},getReport(){let e=this.getTagError;if(e){let t=Object(Ut["a"])();this.$store.dispatch("common/setUploadNote",[{name:this.item.name,uuid:t,action:"download",pushin:!0}]),this.$store.dispatch("common/getFile",{id:this.getFileByVersion(this.item).url+"/"+e,uuid:t,typeBlob:"blob"}).then(s=>{if(this.$store.dispatch("common/setUploadNote",[{uuid:t,action:"download",pushin:!1}]),s.error)console.log("downloadFile error",err);else{let t=document.createElement("a"),a=URL.createObjectURL(s.file);t.href=a,t.download=this.item.name+"."+e,document.body.appendChild(t),t.click(),URL.revokeObjectURL(a),t.remove()}}).catch(e=>{console.log("downloadFile error",e)})}},onlyInteger(e,t){t.item_value.value=e.target.value.replace(/[^0-9]/g,"")},onlyFloat(e,t){t.item_value.value=e.target.value.replace(/[^0-9.]/g,"")},next(){if(1==this.step)this.step=2,this.getUpdateAttributes();else{let e={Elements:this.classerrorList.map(e=>({[e.obj||e.key]:{...(e=>e.obj?{Category:e.key}:{})(e),[e.obj?"Id":"Guid"]:e.id,Name:e.name,attrerr:{...(e=>e?{[e.key]:{val:e.item_value&&e.item_value.value?e.item_value.value.name:"",code:e.code,type:e.btype}}:{})(e.error_class),...(e=>e?Object.fromEntries(e.map(e=>[e.key,{code:e.code,type:e.btype,val:(null==e.item_value.value?"":e.item_value.value).toString()}])):{})(e.error_attr)}}}))};this.$store.dispatch("workflow/convertationTag",{uuid:this.getFileByVersion(this.item).url,tag:"attribute.add.json",body:e,force:!0}).then(e=>{Promise.all([this.$store.dispatch("workflow/getFolders"),this.$store.dispatch("workflow/getGroups")]).finally(e=>{this.$store.dispatch("workflow/createFoldersMap")})},e=>{console.log(e)}),this.cancel()}},getUpdateAttributes(){let e=[];this.classerrorList.map(t=>{t.error_class&&e.push(this.getAttributes(t))}),Promise.all(e).then(e=>{this.classerrorList=this.classerrorList.map(t=>{let s=e.find(e=>e.id==t.id),a={...Object.fromEntries(Object.entries(t.attrerr).map(([e,t])=>[e.toLowerCase(),t]))};return s&&s.response.then(e=>{if(e){a={...a,...Object.fromEntries(Object.entries(e).map(([e,t])=>[e.toLowerCase(),t]))},t.error_attr=Object.entries(a).map(([e,t])=>({key:e,item_value:t.list?{value:null,items:t.list.map((e,t)=>({id:t,name:e}))}:{init_value:"boolean"==t.ftype?"boolean":t.val||"",value:"boolean"==t.ftype?!!t.val:t.val||""},type:t.list?"list":t.ftype,btype:t.type,code:t.code})).filter(e=>"наименование компонента"!=e.key&&"тип помещения или зоны"!=e.key);let s=null;if(this.meta){let e=JSON.parse(this.decodeHtmlCharCodes(this.meta));s=e.files?e.files.find(e=>(e.versionID||e.i)==this.item.versionID):null}if(s){let e=(s.classerrorList||s.l).find(e=>(e.id||e.i)==t.id);e&&(e.error_attr||e.a).length&&(t.error_attr=t.error_attr.map(t=>{let s=(e.error_attr||e.a).find(e=>(e.key||e.k)==t.key);return s&&(t.item_value.value=s.value||s.v),t}))}}}),t})})},showClue(e){let t="";switch(e.name){case"наименование компонента":t="Com";break;case"наименование системы":t="TeS";break;default:t="Prp"}this.$store.dispatch("workflow/getClue",{req:[{rcls:t,name:e.value}]}).then(e=>{this.clueInfo=e.resp[0]},e=>{console.log(e)}),this.clueBox=!0},getAttributes(e){return new Promise(t=>{t({id:e.id,response:this.$store.dispatch("workflow/getAttributes",{class:e.key,name:e.error_class&&e.error_class.item_value.value?e.error_class.item_value.value.name:"",source:this.source})})})},save(){let e={i:this.item.versionID,l:this.classerrorList.map(({id:e,error_attr:t,error_class:s})=>(t=t.map(e=>({k:e.key,v:e.item_value.value})),s=s?{k:s.key,v:s.item_value.value}:null,{i:e,a:t,c:s}))},t=this.meta?JSON.parse(this.decodeHtmlCharCodes(this.meta)):{};if(t.files){let s=t.files.find(e=>(e.versionID||e.i)==this.item.versionID);t.files=s?t.files.map(t=>(t.versionID||t.i)==this.item.versionID?e:t):[...t.files,e]}else t.files=[e];this.item.files.filter(e=>e.id==this.item.versionID)[0].url;this.$store.dispatch("common/setFileMeta",{id:this.item.id,body:JSON.stringify(t)}).then(e=>{e.error?this.$notify({group:"note",type:"error",text:e.data.error}):this.$notify({group:"note",type:"success",text:"Изменения сохранены."})})},createShortName(e){e=e.split(".");e.splice(-1,1)[0];return e.join(".")},getErrorJson(){this.$store.dispatch("common/getFileMeta",{id:this.item.id}).then(e=>(this.meta=e,this.$store.dispatch("common/getFileInfo",{id:this.getFileByVersion(this.item).url+"/"+this.item.sp333.type+".json"}))).then(e=>{this.errorJson=e.Elements,this.source=e.Source||null,this.getError_(e.Elements),"attribute.error"==this.item.sp333.type&&this.next()},e=>{this.errorJson=[]})},decodeHtmlCharCodes(e){return e.replace(/(&#(\d+);)/g,(e,t,s)=>String.fromCharCode(s))},getError_(e){let t=null;if(this.meta){let e=JSON.parse(this.decodeHtmlCharCodes(this.meta));t=e.files?e.files.find(e=>(e.versionID||e.i)==this.item.versionID):null}let s=e.map(e=>{let s={};return Object.entries(e).map(([e,a])=>{let i=0;s={obj:a.Category?e:null,key:a.Category||e,title:a.Id||a.Guid?"ID: "+(a.Id||a.Guid)+" | ":"",id:a.Id||a.Guid,name:a.Name,attrerr:a.attrerr,error_class:null,error_attr:[]},a.attrerr["наименование компонента"]||a.attrerr["тип помещения или зоны"]||(i=1);let o=Object.entries(a.attrerr).map(([e,t])=>({key:e,item_value:"наименование компонента"==e||t.list?{value:null,items:t.list.map(e=>({id:a.Id||a.Guid,name:e}))}:{init_value:"boolean"==t.ftype?"boolean":t.val||"",value:"boolean"==t.ftype?!!t.val:t.val||""},type:t.list?"list":t.ftype,btype:t.type,code:t.code}));if(s.error_class=o.find(e=>"наименование компонента"==e.key||"тип помещения или зоны"==e.key)||null,s.error_attr=o.filter(e=>"наименование компонента"!=e.key&&"тип помещения или зоны"!=e.key),t){let e=(t.classerrorList||t.l).find(e=>(e.id||e.i)==s.id);e&&(e.error_class||e.c)&&(s.error_class.item_value.value=(e.error_class||e.c).value||(e.error_class||e.c).v),e&&(e.error_attr||e.a).length&&(s.error_attr=s.error_attr.map(t=>{let s=(e.error_attr||e.a).find(e=>(e.key||e.k)==t.key);return s&&(t.item_value.value=s.value||s.v),t}))}}),s});this.classerrorList=s}}},Bh=Uh,Th=Object(m["a"])(Bh,Sh,Ah,!1,null,null,null),Lh=Th.exports,Nh=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.collisions,scrollable:"","max-width":"700px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[t("span",[e._v("Геометрические коллизии: ")]),t("span",{staticClass:"m-text--color-red"},[e._v(" (бета версия)")]),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 px-4 pb-0"},[t("span",{staticClass:"m-text--size14 m-text--color-black"},[e._v("В проекте были обнаружены геометрические коллизии между объектами:\n            ")]),t("div",{staticClass:"pt-5"},e._l(e.getCollisions,(function(s){return t("div",{staticClass:"m-card-list__row"},[t("span",{staticClass:"m-card-list__cell"},[e._v(e._s(s.first.name))]),t("span",{staticClass:"m-card-list__cell"},[e._v(e._s(s.second.name))])])})),0)]),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"grey"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},Hh=[],Mh={name:"Collisions",props:{collisions:{type:Boolean,default:!1},collisionsJSON:{type:Object,default:null},item:{type:Object,default:null}},data(){return{}},computed:{getCollisions(){let e=[];return this.collisionsJSON&&(e=this.collisionsJSON.collision_pairs),e}},methods:{cancel(){this.$emit("update:collisions",!1),this.$emit("update:this.collisionsJSON",null)},saveChange(){this.cancel()}}},zh=Mh,$h=Object(m["a"])(zh,Nh,Hh,!1,null,null,null),Rh=$h.exports,Dh=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.specification_xml,scrollable:"","max-width":"700px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n            Описание документа\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{ref:"body",staticClass:"px-4"},[t("div",{staticClass:"py-4 m-text--color-black"},[e._v("Для правильной работы XML схемы вся сопроводительная документация должна быть представлена в цифровом виде, для этого заполните нижеуказанные поля.")]),t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"12",md:"12"}},[t(_s["a"],{staticClass:"m-select",attrs:{items:e.items,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Выберите тип, к которому относится документ",placeholder:" ","hide-details":""},on:{change:e.checkType},scopedSlots:e._u([{key:"item",fn:function({active:s,item:a,attrs:i,on:o}){return[t($e["a"],e._g(e._b({scopedSlots:e._u([{key:"default",fn:function({active:s}){return[t(Re["a"],[t(Re["c"],{staticClass:"m-list-item__title"},[e._v("\n                                        "+e._s(a.name)+"\n                                    ")])],1)]}}],null,!0)},"v-list-item",i,!1),o))]}}]),model:{value:e.metaType,callback:function(t){e.metaType=t},expression:"metaType"}})],1)],1),e.sections.length?t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"12",md:"12"}},[t(_s["a"],{staticClass:"m-select",attrs:{items:e.sections,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Выберите подгруппу, к которой относится документ",placeholder:" ","hide-details":""},on:{change:function(e){}},scopedSlots:e._u([{key:"item",fn:function({active:s,item:a,attrs:i,on:o}){return[t($e["a"],e._g(e._b({scopedSlots:e._u([{key:"default",fn:function({active:s}){return[t(Re["a"],[t(Re["c"],{staticClass:"m-list-item__title"},[e._v("\n                                        "+e._s(a.name)+"\n                                    ")])],1)]}}],null,!0)},"v-list-item",i,!1),o))]}}],null,!1,274345183),model:{value:e.selecttype,callback:function(t){e.selecttype=t},expression:"selecttype"}})],1)],1):e._e(),e._l(e.selecttype.items,(function(s){return t(xs["a"],[t(ws["a"],{staticClass:"m-label",attrs:{cols:"12",sm:"12",md:"12"}},["Text"==s.Type||"String"==s.Type?t(Dt["a"],{staticClass:"m-select pt-0",attrs:{label:s.Name,placeholder:" ","hide-details":""},scopedSlots:e._u([{key:"label",fn:function(){return[t("div",[e._v(e._s(s.Name))])]},proxy:!0}],null,!0),model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"item.value"}}):"Integer"==s.Type?t(Dt["a"],{staticClass:"m-select pt-0",attrs:{type:"number",label:s.Name,placeholder:" ","hide-details":""},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"item.value"}}):"Boolean"==s.Type?t(Ss["a"],{staticClass:"pt-0",attrs:{label:s.Name,inset:"",color:"success"},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"item.value"}}):"Date"==s.Type?t("date-xml",{attrs:{item:s},on:{setValue:e.setValue}}):"TextArea"==s.Type?t(bi["a"],{staticClass:"pt-0",attrs:{placeholder:" ",label:s.Name,"multi-line":"","hide-details":"",rows:"2"},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"item.value"}}):e._e()],1)],1)}))],2),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.saveChange}},[e._v("Сохранить\n            ")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.cancel.apply(null,arguments)}}},[e._v("Отмена")])],1)],1)],1)},Jh=[],Vh=function(){var e=this,t=e._self._c;return t(qe["a"],{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(Dt["a"],e._g({staticClass:"pt-0",attrs:{label:e.item.Name,readonly:"","hide-details":"",placeholder:" "},model:{value:e.computedDateFormatted,callback:function(t){e.computedDateFormatted=t},expression:"computedDateFormatted"}},s))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[t(Cl["a"],{ref:"picker",attrs:{landscape:!0,locale:"ru",max:(new Date).toISOString().substr(0,10),min:"1950-01-01"},on:{change:e.save},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1)},Kh=[],Gh={name:"DateXml",props:["item"],data(){return{date:null,menu:!1}},computed:{computedDateFormatted(){let e=this.formatDate(this.item.value);return e}},watch:{menu(e){e&&setTimeout(()=>this.$refs.picker.activePicker="YEAR")}},methods:{save(e){this.$emit("setValue",{item:this.item,value:e}),this.$refs.menu.save(e)},formatDate(e){if(!e)return null;const[t,s,a]=e.split("-");return`${a}/${s}/${t}`}},created(){}},Qh=Gh,Xh=Object(m["a"])(Qh,Vh,Kh,!1,null,null,null),Wh=Xh.exports,Yh={name:"SpecificationXml",components:{DateXml:Wh},props:["specification_xml","item"],data(){return{selecttype:{items:[]},date:null,menu:!1,items:[],metaType:"",sections:[]}},watch:{specification_xml(e){e?(document.addEventListener("keyup",this.enter,!1),this.$store.dispatch("common/getJsonXml").then(e=>{this.setItems(e)},e=>{this.items=[]})):(document.removeEventListener("keyup",this.enter,!1),this.items=[])}},methods:{cancel(){this.metaType="",this.selecttype={items:[]},this.$emit("update:specification_xml",!1)},setValue(e){e.item.value=e.value},checkType(e){e.items.some(e=>e.Name)?(this.selecttype.items=[],this.sections=e.items.map((e,t)=>({id:"sec"+t,name:e.Name,items:e.Fields.map(e=>({...e,value:(e=>"Boolean"==e.Type?e.value||!1:"Date"==e.Type?e.value?new Date(e.value).toISOString().substr(0,10):null:e.value||"")(e)}))}))):(this.sections=[],this.selecttype.items=e.items[0].Fields.map(e=>({...e,value:(e=>"Boolean"==e.Type?e.value||!1:"Date"==e.Type?e.value?new Date(e.value).toISOString().substr(0,10):null:e.value||"")(e)})),this.selecttype.id="",this.selecttype.name="")},setItems(e){let t=Object.entries(e).map(([e,t],s)=>({id:s,name:e,items:t}));if(this.item.meta){let e=JSON.parse(this.decodeHtmlCharCodes(this.item.meta))||!1;if(e&&e.f){let s=e.n;t=t.map(t=>{if(t.name==s){this.metaType=t;let s=null;t.items=t.items.map((t,a)=>{let i=!1,o=t.Fields.map(a=>(t.Name&&(s=t.Name),i=e.f[t.Name||""],i&&(i=i.find(e=>e.n==a.Name)),{...a,value:i?"Date"==a.Type?new Date(JSON.parse(i.v)).toISOString().substr(0,10):"Boolean"==a.Type?JSON.parse(i.v):i.v:""}));return i&&(this.selecttype={id:"sec"+a,name:t.Name,items:o}),{...t,Fields:o}}),s&&(this.sections=t.items.map((e,t)=>({items:e.Fields,id:"sec"+t,name:e.Name})))}return t})}}this.items=t},transDate(e){const[t,s,a]=e.split("-");let i=(new Date).getTimezoneOffset(),o=new Date(parseInt(t),parseInt(s)-1,parseInt(a),Math.abs(i)/60),n=o.getTime(o);return n},getMeta(){let e={n:this.metaType.name,f:{[this.selecttype.name]:[...this.selecttype.items.map(e=>({n:e.Name,v:"String"==e.Type||"Text"==e.Type||"Integer"==e.Type||"TextArea"==e.Type||"Boolean"==e.Type?e.value.toString():"Date"==e.Type?this.transDate(e.value).toString():e.value.toString(),t:"String"==e.Type||"Text"==e.Type||"TextArea"==e.Type?"S":"Boolean"==e.Type||"Integer"==e.Type||"Date"==e.Type?"I":"F"}))]}};return JSON.stringify(e)},decodeHtmlCharCodes(e){return e.replace(/(&#(\d+);)/g,(e,t,s)=>String.fromCharCode(s))},saveChange(){let e=this.$store.state.workflow.listDocs.find(e=>e.id==this.item.id);this.$store.dispatch("workflow/addDoc",{id:this.item.id,name:e.name,order:e.order,folder:e.folder,meta:this.getMeta()}).then(e=>{this.$store.dispatch("workflow/updateDocInState",{...e,name_short:this.createShortName(e.name)})}),this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.saveChange())},createShortName(e){return e=e.split("."),e.splice(-1,1)[0],e.join(".")}}},qh=Yh,Zh=Object(m["a"])(qh,Dh,Jh,!1,null,null,null),ef=Zh.exports,tf={name:"WorkflowProject",components:{TableGrid:hu,UploadFiles:_u,ActionMenu:Au,RemoveSelected:Eu,ReplaceItem:Hu,CopyItem:Ju,RenameItem:Wu,RemoveItem:sh,CreateFolder:ts,AccessRights:Ps,VersionJournal:hh,ErrorIfcxml:_h,SetSp333Attribute:Lh,Collisions:Rh,SpecificationXml:ef,CreateXml:lh},props:["id"],data(){return{newFolder:!1,createXml:!1,accessrights:!1,folderTree:[],search:"",inwork:s("210c"),table_type_list:[{name:"list",icon:"mdi-format-list-bulleted"},{name:"grid",icon:"mdi-view-grid"}],headers:[{text:"",value:"sub",grid:!1,sortable:!1},{text:"",align:"left",sortable:!1,value:"src",grid:!1},{text:"Название",value:"name",grid:!0},{text:"Дата создания",value:"date",grid:!1},{text:"Изменено",value:"updated",grid:!1},{text:"Создал",value:"creator",grid:!1},{text:"Версия",value:"version",grid:!0,align:"center",sortable:!1},{text:"tasks",value:"tasks",grid:!0,align:"center",sortable:!1},{text:"КСИ/СП",value:"sp333",grid:!0,align:"center",sortable:!1},{text:"",value:"action",sortable:!1,grid:!1}],status:{0:"На рассмотрении",1:"На исправлении",2:"Принят",3:"Отказ"},noData:"Нет данных",uploadF:!1,selected:[],sublist:[],expandedlist:[],removeSelectedFlag:!1,replaceItem:!1,remove_item:!1,replace_items:[],copyItem:!1,renameItem:!1,workItem:null,versionjournal:!1,error_ifcxml:!1,SP333JSON:{list:[],clue:[]},SP333attr:!1,collisions:!1,collisionsJSON:null,fileTypeList:["ifc","rvt","zip","ifcxml","consolidations","pdf","dwg","dxf"],specification_xml:!1}},computed:{getHeaders(){let e=[];return this.headers.map(t=>{switch(t.value){case"sp333":E("errorKSI")&&e.push(t);break;case"tasks":E("tasksList")&&e.push(t);break;default:e.push(t)}}),e},workflow_project(){let e=this.$store.state,t=e.workflow.workflow_project;return t=t||"list",t},checkFolder(){let e=this.$store.state,t=e.workflow.currentFolder,s=!1,a=e.workflow.foldersMap.filter(e=>e.id==t);return a.length&&!a[0].group&&(s=!0),s},getPath(){let e=this.$store.state,t=e.workflow.currentFolder,s=e.workflow.activeProject.info.name,a=[{id:0,name:s,link:!1}];return t&&(a[0].link=!0,a.push(...this.searchPath(t).reverse())),this.selected=[],a},getDocs(){let e=this.$store.state,t=e.workflow.activeProject,s=e.administration.company.users;e=e.workflow;let a=e.currentFolder,i=e.foldersMap,o=i.filter(e=>e.parent==a).map(e=>{let a="";s.map(t=>{t.id==e.created_by&&(a=t.first_name+" "+t.last_name)});let i={year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},o=new Date(e.created_at),n=new Date(e.updated_at);return{access:e.access,id:e.id,name:e.name,type:"folder",group:e.group,sublist:e.group&&e.folders?e.folders.map(e=>e.folder):[],inwork:!1,user:t.info.in_charge_name,date:o.toLocaleDateString("ru-RU",i),updated:n.toLocaleDateString("ru-RU",i),creator:a,sp333:{type:"",value:""}}}),n=JSON.parse(JSON.stringify(o));o.map(e=>(e.group&&e.sublist.map(e=>{let a=i.find(t=>t.id==e);if(a){let e="";s.map(t=>{t.id==a.created_by&&(e=t.first_name+" "+t.last_name)});let i={year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},o=new Date(a.created_at),r=new Date(a.updated_at),l={access:a.access,id:a.id,name:a.name,type:"folder",group:a.group,sublist:a.group?a.folders.map(e=>e.folder):[],inwork:!1,user:t.info.in_charge_name,date:o.toLocaleDateString("ru-RU",i),updated:r.toLocaleDateString("ru-RU",i),creator:e,sp333:{type:"",value:""}};n.push(l)}}),e)).map(e=>{if(e.group){let t=e.sublist.reverse();n=n.map(t=>t.id==e.id?{...t,expanded:this.expandedlist.some(t=>t==e.id)}:t),t.map(t=>{let s=n.map(e=>e.id).indexOf(t),a=n.splice(s,1)[0];a.sub=!0,this.sublist.some(e=>e==t)&&(s=n.map(e=>e.id).indexOf(e.id),n.splice(s+1,0,a))})}});let r=e.listDocs.filter(e=>e.folder==a&&!e.is_deleted);r=x(r,"created_at");let l=e.taskList;r=r.map((e,a)=>{let i=l.find(t=>t.docid==e.id);e.task=!!i;let o="";s.map(t=>{t.id==e.created_by&&(o=t.first_name+" "+t.last_name)});let n={year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},r=new Date(e.created_at),c=new Date(e.updated_at);return{...e,creator:o,version:e.version?(()=>{let t=e.files.filter(t=>t.id==e.version);return t?t[0].version:e.files[0].version})():e.files&&e.files.length?e.files[0].version:1,versionID:e.version||e.files&&e.files.length?e.files[0].id:1,date:r.toLocaleDateString("ru-RU",n),updated:c.toLocaleDateString("ru-RU",n),user:t.info.in_charge_name,sp333:function(){return e.tags?e.tags.hasOwnProperty("class.error.json")?{type:"class.error",value:e.tags["class.error.json"],title:"Классификатор Строительной Информации"}:e.tags.hasOwnProperty("attribute.error.json")?{type:"attribute.error",value:e.tags["attribute.error.json"],title:"Классификатор Строительной Информации"}:e.tags.hasOwnProperty("classerror.json")?{type:"classerror",value:e.tags["classerror.json"],title:"Классификатор Строительной Информации"}:e.tags.hasOwnProperty("classerror.onlyempty.json")?{type:"classerror.onlyempty",value:e.tags["classerror.onlyempty.json"],title:"Классификатор Строительной Информации"}:e.tags.hasOwnProperty("warning.json")?{type:"warning",value:e.tags["warning.json"],title:"СП333"}:e.tags.hasOwnProperty("error.json")?{type:"error",value:e.tags["error.json"],title:"СП333"}:{type:"",value:""}:{type:"",value:""}}(),collisions:(()=>e.tags&&e.tags.hasOwnProperty("collisions.json")?e.tags["collisions.json"]:0)()}});let c=JSON.parse(JSON.stringify(r));r.map(e=>{if(e.consolidations){let t=e.consolidations.reverse();c=c.map(t=>t.id==e.id?{...t,sublist:e.consolidations,expanded:this.expandedlist.some(t=>t==e.id)}:t),t.map(t=>{let s=c.map(e=>e.id).indexOf(t),a=c.splice(s,1)[0];a.sub=!0,this.sublist.some(e=>e==t)&&(s=c.map(e=>e.id).indexOf(e.id),c.splice(s+1,0,a))})}});let m=[...n,...c];return m},cardActionStyle(){let e=0,t=0;if(this.selected.length){let s=this.$refs["wrap"].getBoundingClientRect();e=s.width,t=s.x}return{width:e+"px",left:t+"px"}},getReplaceItems(){let e={type:"",items:[]};return this.replace_items.length?(e.items=this.replace_items,e.type="pointer"):(e.items=this.selected,e.type="selected"),e}},methods:{checkLicense(e){return E(e)},expandSub(e){if(e.sublist)if(e.expanded){this.expandedlist=this.expandedlist.filter(t=>t!=e.id);let t=this.sublist;e.sublist.map(e=>{t=t.filter(t=>t!=e)}),this.sublist=t}else this.expandedlist.push(e.id),this.sublist=[...this.sublist,...e.sublist]},decodeHtmlCharCodes(e){return e.replace(/(&#(\d+);)/g,(e,t,s)=>String.fromCharCode(s))},checkTypeFiles(e){this.$store.state.workflow.fileTypeConversion;let t=!1;switch(e.count){case"one":t=1==this.selected.length;break;case"lot":t=this.selected.length>1;break;default:t=!0}return!(this.selected.some(e=>"folder"==e.type)||!this.selected.some(t=>e.type.some(e=>t.type==e))||!this.selected.every((e,t,s)=>e.type==s[0].type)||!t)},onSpecificationXml(e){this.workItem=e,this.specification_xml=!0},getAccess(e,t,s){return U(e,t,s)},getAccessSelected(e,t){if(this.selected.length){let s=!0,a=15,i=this.selected.reduce((e,t)=>e&t.access,a);return s=s&&U(i,e,t),!!s}return!0},convertationIFCXML(e){let t=e.version?e.files.find(t=>t.version==e.version):e.files[0];this.$store.dispatch("workflow/convertationTag",{uuid:t.url,tag:"ifcxml.zip"}).then(t=>{let s=this.$store.state.workflow.listSocket;s=s.map(t=>(t.inworkId==e.id&&(t.url=e.files.find(t=>t.version==e.version).url),t)),Promise.all([this.$store.commit("workflow/setListSocket",s)]).then(()=>{this.$store.dispatch("workflow/onSocket")})})},setCollisions(e){this.workItem=e,this.collisionsJSON=null,this.collisions=!0;let t=e.files.filter(t=>t.id==e.versionID)[0].url;this.$store.dispatch("common/getFileInfo",{id:t+"/collisions.json"}).then(e=>{this.collisionsJSON=e})},setSP333Attr(e){this.workItem=e,this.SP333JSON={list:[],clue:[]},this.SP333attr=!0},replaceItems(e=[]){this.replace_items=e,this.replaceItem=!0},copyItems(e=[]){this.replace_items=e,this.copyItem=!0},renameitem(e){this.workItem=e,this.renameItem=!0},checkSelected(e){return this.selected.some(t=>t.id==e.id)},selectRow(e){let t=e.items;t=t.filter(e=>!0!==e.inwork&&U(e.access,"or",[1,2])),this.selected.length!=t.length?this.selected=t:this.selected=[]},searchPath(e,t=!1){let s=this.$store.state.workflow.foldersMap,a=s.filter(t=>t.id==e)[0];if(a=a||!1,!a)return[];let i=[{id:a.id,name:a.name,link:t}];return a.parent&&i.push(...this.searchPath(a.parent,!0)),i},getDct(e){this.fileTypeList.some(t=>t==e.type)&&this.$router.push({name:"workflow-view",params:{id:this.$route.params.id,doc:e.id,list:null}})},setConsolidations(e){let t=this.$store.state.workflow,s=t.currentFolder,a=t.foldersMap.filter(e=>e.parent==s).length,i=t.foldersMap.find(e=>e.id==s).files;i=i?i.length:0,a+=i;let o=this.selected.map((e,t)=>e.name).join(", "),n=this.selected.map((e,t)=>e.id),r={id:Object(Ut["a"])(),name:o,order:a,folder:s,files:null,consolidations:n};this.$store.dispatch("workflow/addDoc",r).then(e=>this.$store.dispatch("administration/setFilesPermissions",{id:e.id,body:{id:e.id,users:[{id:this.$store.state.administration.user.id+"",email:this.$store.state.administration.user.email,full_name:this.$store.state.administration.user.first_name+" "+this.$store.state.administration.user.last_name,can_open:!0,can_edit:!0,can_download:!0,can_comment:!0}],groups:this.$store.state.administration.groupPermissions.map(e=>({id:e.id,name:e.name,can_open:!0,can_edit:!0,can_download:!0,can_comment:!0}))}})).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(()=>this.$store.dispatch("administration/getFilesPermissions")).then(()=>{this.$store.dispatch("workflow/createFoldersMap"),this.selected=[]})},removeDct(e){let t=[];t.push(this.$store.dispatch("workflow/removeDoc",e)),Promise.all(t).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>{this.$store.dispatch("workflow/createFoldersMap")})},removeFolder(e){this.$store.dispatch("workflow/removeFolder",{uuid:e.id}).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>{this.$store.dispatch("workflow/createFoldersMap")})},removeItem(e){this.remove_item=!0,this.workItem=e},removeSelected(){let e=this.selected,t=[],s=this.$store.state.workflow,a=s.currentFolder;a=s.foldersMap.filter(e=>e.id==a)[0];let i=a&&a.files?JSON.parse(JSON.stringify(a.files)):[];e.map(e=>{if("folder"==e.type)if(e.group){let e=s.foldersMap.filter(e=>e.id==e.id)[0],a=e.folders||[];a.map((e,s)=>{t.push(this.$store.dispatch("workflow/removeFolder",{uuid:e.folder}))});let i={name:e.name,order:e.order,created_at:e.created_at,created_by:e.created_by,updated_at:e.updated_at,updated_by:e.updated_by,folders:e.folders};e=i,t.push(this.$store.dispatch("workflow/removeGroup",e))}else t.push(this.$store.dispatch("workflow/removeFolder",{uuid:e.id}));else t.push(this.$store.dispatch("workflow/removeDoc",e)),a&&!a.group&&(i=i.filter(t=>t.id!=e.id))}),Promise.all(t).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>this.$store.dispatch("workflow/createFoldersMap")).then(e=>{this.selected=[]})},openFolder(e){this.$store.commit("workflow/setCurrentFolder",e.id)},accessRights(e){this.accessrights=!0,this.workItem=e},versionJournal(e){this.versionjournal=!0,this.workItem=e},errorIFCXML(){this.error_ifcxml=!0},setTableType(e){this.$store.commit("workflow/setTableType",{name:"workflow_project",value:e})},clearSelected(e){"selected"==e?this.selected=[]:this.replace_items=[]},upload(){this.uploadF=!0},downloadFile(e){let t="",s="";"ifcxml"!==e.type?(t=e.file.files[0].url,s=e.file.name):(t=e.file.files[0].url+"/ifcxml.zip",s=e.file.name_short+".ifcxml.zip");let a=Object(Ut["a"])();this.$store.dispatch("common/setUploadNote",[{name:e.file.name,uuid:a,action:"download",pushin:!0}]),this.$store.dispatch("common/getFile",{id:t,uuid:a,typeBlob:"blob"}).then(e=>{if(this.$store.dispatch("common/setUploadNote",[{uuid:a,action:"download",pushin:!1}]),e.error)console.log("downloadFile error",err);else{let t=document.createElement("a"),a=URL.createObjectURL(e.file);t.href=a,t.download=s,document.body.appendChild(t),t.click(),URL.revokeObjectURL(a),t.remove()}}).catch(e=>{console.log("downloadFile error",e)})},download(){let e=this.selected,t=[],s=[];e.map(e=>{if("folder"!==e.type){let a=e.files[0],i=Object(Ut["a"])();this.$store.dispatch("common/setUploadNote",[{name:e.name,uuid:i,action:"download",pushin:!0}]),s.push({id:a.url,uuid:i,name:e.name}),t.push(this.$store.dispatch("common/getFile",{id:a.url,name:e.name,uuid:i}))}}),s.length&&Promise.all(t).then(e=>{let t=new kc,a=e.filter(e=>!e.error).map((e,a)=>{let i=s.find(t=>t.id==e.id);return this.$store.dispatch("common/setUploadNote",[{uuid:e.uuid,action:"download",pushin:!1}]),t.file(i.name,e.file),URL.revokeObjectURL(e.file),a});return a.length?t.generateAsync({type:"base64"}):null}).then(e=>{if(e){let t=document.createElement("a");t.href="data:application/zip;base64,"+e,t.download="unitbimprojectfiles.zip",document.body.appendChild(t),t.click(),t.remove()}})},searchFolder(e,t,s=[]){for(let a=0,i=e.length;a<i;a++){if(e[a].data.path==t)return s=e[a].children,s;if(s=this.searchFolder(e[a].children,t,s),s.length)return s}return s},createTree(e){let t=[],s={result:t};return e.map(e=>{let t=e.split("/").slice(1);t.reduce((t,s,a,i)=>(t[s]||(t[s]={result:[]},t.result.push({title:s,data:{path:e},isExpanded:!1,children:t[s].result})),t[s]),s)}),t=[{title:"",data:{path:"/"},children:t}],t},createFolder(e){let t=this.$store.state.workflow,s=t.currentFolder;s&&(s=t.foldersMap.filter(e=>e.id==s)[0]);let a=s?s.id:0,i=t.foldersMap.filter(e=>e.parent==a&&!e.group),o=Object(Ut["a"])(),n={id:o,parent:s?s.group?o:s.id:o,name:this.checkTween(i,e.name),order:i.length},r=!1;if(s&&s.group){r=t.foldersMap.filter(e=>e.id==s.id)[0];let e={name:r.name,order:r.order,created_at:r.created_at,created_by:r.created_by,updated_at:r.updated_at,updated_by:r.updated_by,folders:r.folders||[]};r=e}this.$store.dispatch("workflow/addFolder",n).then(e=>{if(this.$notify({group:"note",type:e.notify?"success":"error",text:e.notify?"Создана папка "+e.name:"Ошибка: "+e.data.error}),e.notify){let t=[];r&&(r.folders.push({folder:e.id,order:0}),t.push(this.$store.dispatch("workflow/addGroup",r)));let a=this.$store.state.administration.folderPermissions;if(a&&a.find(e=>e.id==s.id))a=a.find(e=>e.id==s.id);else{let e=this.$store.state.administration.user;a={users:[{id:e.id+"",email:e.email,full_name:e.first_name+" "+e.last_name,can_open:!0,can_edit:!0,can_download:!0,can_comment:!0}]}}return t.push(this.$store.dispatch("administration/setFolderPermissions",{id:e.id,body:{id:e.id,users:a.users,groups:this.$store.state.administration.groupPermissions.map(e=>({id:e.id,name:e.name,can_open:!0,can_edit:!0,can_download:!0,can_comment:!0}))}})),Promise.all(t)}return Promise.reject("Ошибка: "+e.data.error)}).then(()=>this.$store.dispatch("workflow/getFolders")).then(()=>this.$store.dispatch("workflow/getGroups")).then(e=>this.$store.dispatch("workflow/createFoldersMap")).then(()=>this.$store.dispatch("administration/getFoldersPermissions")).catch(e=>{console.log(e)})},checkTween(e,t){let s=t;return e.map(e=>{e.name==s&&(s+="0")}),s}},created(){let e=this.$store.state.workflow,t=e.projects.filter(e=>e.id==this.$route.params.id);t=JSON.parse(JSON.stringify(t[0]))||null;let s=t?t.info.name:"",a=[{title:"Документооборот",path:"/workflow"},{title:s,path:""}],i=[];e.activeProject&&this.id==e.activeProject.id||(i=[this.$store.commit("workflow/setExpanded",[]),this.$store.commit("workflow/setCurrentFolder",0)]),this.$store.commit("toolbar/setTitle",a),Promise.all([this.$store.commit("workflow/setActiveProject",t),...i,this.$store.dispatch("workflow/getFolders"),this.$store.dispatch("workflow/getGroups"),this.$store.dispatch("administration/getFoldersPermissions"),this.$store.dispatch("administration/getFilesPermissions"),this.$store.dispatch("workflow/getTaskProject",{type_id:"c",id:this.$store.state.administration.company.id,project_uuid:t.id,filter:{}})]).finally(e=>{this.$store.dispatch("workflow/createFoldersMap")})},mounted(){},beforeCreate(){this.$store.commit("workflow/setFoldersMap",[]),this.$store.commit("workflow/setListDocs",[])},beforeDestroy(){this.$store.commit("workflow/setTaskList",[])}},sf=tf,af=Object(m["a"])(sf,ru,lu,!1,null,null,null),of=af.exports,nf=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container pb-10 pt-0",attrs:{fluid:"","fill-height":"","text-xs-center":""}},[t(Ee["a"],{attrs:{row:"",wrap:""}},[t(ia["a"],{attrs:{xs12:""}},[t(aa["a"],{staticClass:"m-container--height work-place",attrs:{fluid:"","px-3":"","pt-0":""}},[t("div",{ref:"header",staticClass:"w-3 task-header",style:e.header_style},[t("div",{staticClass:"m-flex pt-6 pb-3 pselect"},[t("span",{staticClass:"m-flex--item__auto pr-3 m-text--size13"},[e._v("Выберите проект:")]),t("div",{staticClass:"m-flex--item"},[t(_s["a"],{staticClass:"pa-0 ma-0 m-text--size16",attrs:{items:e.projects,"item-text":"name","item-value":"id","persistent-hint":"",placeholder:" ",dense:""},on:{change:e.getTasks},model:{value:e.project,callback:function(t){e.project=t},expression:"project"}})],1)]),t("div",{staticClass:"task-wrap"},e._l(e.statusList,(function(s){return t("div",{staticClass:"task"},[t("p",{staticClass:"m-text--size16 ma-0 px-4 py-3"},[e._v(e._s(s.name))])])})),0)]),t("div",{staticClass:"task-wrap task-wrap--body"},e._l(e.tasks111,(function(s){return t("Container",{key:s.name,staticClass:"task",attrs:{"group-name":"1"},on:{drop:function(t){return e.onDrop(s.group,t)},"drop-ready":function(t){return e.onEnter(t)}}},e._l(s.items,(function(s){return t("Draggable",{key:s.task_id},[t("div",{staticClass:"draggable-item"},[t("task",{attrs:{item:s,editItem:e.editItem},on:{"update:editItem":function(t){e.editItem=t},"update:edit-item":function(t){e.editItem=t}}})],1)])})),1)})),1),e.editItem?t("tools",{attrs:{editItem:e.editItem,h_style:e.header_style},on:{"update:editItem":function(t){e.editItem=t},"update:edit-item":function(t){e.editItem=t}}}):e._e(),e.editItem?t("div",{staticClass:"overlay"}):e._e()],1)],1)],1)],1)},rf=[],lf=s("43d0"),cf=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"cursor-move",attrs:{color:"#fff"}},[t("div",{staticClass:"d-flex"},[t(zt["d"],{staticClass:"m-text--size16 m-text--color-4a5568 pb-0"},[e._v("\n            "+e._s(e.item.name)+"\n        ")]),t(Rt["a"]),t(ot["a"],{staticClass:"ma-4 mb-0",attrs:{size:"30"}},[t("img",{attrs:{src:e.item.avatar}})])],1),t(zt["b"],{staticClass:"pt-1"},[e._v(e._s(e.item.dname))]),t(nt["a"]),t("div",{staticClass:"py-0 px-4"},[t(ze["a"],{attrs:{src:e.item.src,height:"200px"}})],1),t(nt["a"]),t(zt["a"],{staticClass:"py-3 pr-2 pl-0 pb-0"},[t("div",[t(zt["b"],{staticClass:"py-0"},[e._v("Создан "+e._s(e.getDate(e.item.create))+"\n            ")]),t(zt["b"],{staticClass:"py-0"},[e._v("До\n                "+e._s(e.getDate(e.item.deadline))+"\n            ")])],1),t(Rt["a"])],1),t(zt["a"],{staticClass:"py-3 pr-2 pl-0 pt-0"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:function(t){return e.editTask(e.item)}}},[e._v("\n        "+e._s(e.checkOwner(e.item.owner)?"Редактировать":"Подробнее")+"\n        ")])],1)],1)},mf=[],df={name:"Task",props:["item","editItem"],data(){return{}},computed:{getOwner(){return this.$store.state.administration.user.id}},methods:{checkOwner(e){return this.getOwner==e},editTask(e){this.$emit("update:editItem",e)},getDate(e){let t={year:"2-digit",month:"short",day:"2-digit"};return new Date(e).toLocaleDateString("ru-RU",t)}}},pf=df,uf=(s("d8b3"),Object(m["a"])(pf,cf,mf,!1,null,"9f8fc122",null)),hf=uf.exports,ff=function(){var e=this,t=e._self._c;return t(St["a"],{staticClass:"m-navigator-tools m-navigator-no-scroll px-2 pr-0",style:e.h_style,attrs:{permanent:"",fixed:"",floating:"",width:e.tools_width,right:"",clipped:"",color:"transparent"}},[t(Ee["a"],{staticClass:"ma-0",attrs:{"fill-height":""}},[t("div",{staticClass:"m-overflow-hidden m-tools-content"},[t(Ee["a"],{staticClass:"ma-0",attrs:{"fill-height":""}},[t("task-create",{attrs:{item:e.editItem},on:{cancel:e.cancel}})],1)],1)])],1)},vf=[],bf=function(){var e=this,t=e._self._c;return t(We["a"],{staticClass:"m-overhead m-overhead--white d-block pa-4 overflow-auto"},[t(xs["a"],{staticClass:"d-block"},[t("div",{staticClass:"d-flex"},[t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1)]),t(Dt["a"],{attrs:{disabled:!e.checkOwner(),label:"Название задачи",placeholder:" "},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),t(ci["a"],{attrs:{items:e.statusList,"item-text":"name","item-value":"value","persistent-hint":"",label:"Статус",placeholder:" "},model:{value:e.selectStatus,callback:function(t){e.selectStatus=t},expression:"selectStatus"}}),t(_s["a"],{attrs:{disabled:!e.checkOwner(),label:"Ответственный за проект",placeholder:" ",items:e.managers,chips:"","item-text":"name","item-value":"id"},scopedSlots:e._u([{key:"selection",fn:function(s){return[t(Cs["a"],e._b({attrs:{dark:"","input-value":s.selected,close:""},on:{"click:close":function(t){return e.removeChips()}}},"v-chip",s.attrs,!1),[t(ot["a"],{attrs:{left:""}},[t(ze["a"],{attrs:{src:s.item.avatar}})],1),e._v("\n                "+e._s(s.item.name)+"\n            ")],1)]}},{key:"item",fn:function(s){return[t(rt["a"],{attrs:{size:"30"}},[t("img",{attrs:{src:s.item.avatar}})]),t(Re["a"],[t(Re["c"],{domProps:{innerHTML:e._s(s.item.name)}}),t(Re["b"],{domProps:{innerHTML:e._s(s.item.role)}})],1)]}}]),model:{value:e.manager,callback:function(t){e.manager=t},expression:"manager"}}),t(qe["a"],{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(Dt["a"],e._g({staticClass:"mb-4",attrs:{disabled:!e.checkOwner(),label:"Дата выполнения",readonly:"",placeholder:" "},model:{value:e.computedDateFormatted,callback:function(t){e.computedDateFormatted=t},expression:"computedDateFormatted"}},s))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[t(Cl["a"],{ref:"picker",attrs:{landscape:!0,locale:"ru",max:"2050-01-01",min:"1950-01-01"},on:{change:e.save},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1),t("div",{staticClass:"py-4",staticStyle:{position:"relative"}},[t("label",{staticClass:"v-label v-label--active theme--light",staticStyle:{left:"0px",right:"auto",position:"absolute","max-width":"133%","-webkit-transform":"translateY(-18px) scale(0.75)",transform:"translateY(-18px) scale(0.75)","-webkit-transform-origin":"top left","transform-origin":"top left"},attrs:{for:"input-477"}},[e._v("Картинка ошибки")]),t(ze["a"],{attrs:{src:this.item.src}})],1),t(bi["a"],{attrs:{disabled:!e.checkOwner(),label:"Описание",placeholder:" ","multi-line":"",rows:"3"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),t(zt["a"],{staticClass:"pa-0"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.sendTask}},[e._v("\n        Применить\n        ")])],1)],1)},gf=[],yf={name:"TaskCreate",props:["item"],data(){return{name:this.item.name||"",selectStatus:this.item.status||null,statusList:[{name:"Новая",value:0},{name:"В работе",value:1},{name:"На рассмотрение",value:2},{name:"Выполненное",value:3}],taskDay:"",date:this.item.deadline.substr(0,10)||null,menu:!1,manager:this.item.user||null,no_image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAEMCAYAAADqG+D0AAAAAXNSR0IArs4c6QAAIABJREFUeF7tnXt8Vdd159c+V+hlQBIg9AYBAkmApHuuoKZOnI/juHl8OpmZ+JXUebiO3WnjJJNMbefhTBNPJ5lkXDfOq03itE3SpjPx4GkeM8007jQlTmrjDvfuKxASBglLSAiEQIqQAD2uzp7PZi5TSkC69+g89j77d/6xP2Lvtdf+/tbd66zz2IcRDhAAARAAARBwQYC56IMuIAACIAACIEBIIAgCEAABEAABVwSQQFxhQycQAAEQAAEkEMQACIAACICAKwJIIK6woRMIgAAIgAASCGIABEAABEDAFQEkEFfY0AkEQAAEQAAJBDEAAiAAAiDgigASiCts6AQCIAACIIAEghgAARAAARBwRQAJxBU2dAIBEAABEEACQQyAAAiAAAi4IoAE4gobOoEACIAACCCBIAZAAARAAARcEUACcYUNnUAABEAABJBAEAMgAAIgAAKuCCCBuMKGTiAAAiAAAkggiAEQAAEQAAFXBJBAXGFDJxAAARAAASQQxAAIgAAIgIArAkggrrChEwiAAAiAABIIYgAEQAAEQMAVASQQV9jQCQRAAARAAAkEMQACIAACIOCKABKIK2zoBAIgAAIggASCGAABEAABEHBFAAnEFTZ0AgEQAAEQQAJBDIAACIAACLgigATiChs6gQAIgAAIIIEgBkAABEAABFwRQAJxhQ2dQAAEQAAEopJAmG3bc0KIBcZYoeM4s5ZlFUh5HcfJWJYl/zaHv4EB4gC/hRDXgyIhxBxjLMY5LyQioXsKikoCsWzbniciS3dB4D8IgEDkCTic8xXy/Fb3mSKB6K4g/AcBENCNABKIYoqhAlFMELgDAiBwQwJIIIoFBxKIYoLAHRAAASQQXWIACUQXpeAnCIAAKhDFYgAJRDFB4A4IgAAqEF1iAAlEF6XgJwiAACoQxWIACUQxQeAOCIAAKhBdYgAJRBel4CcIgAAqEMViINcEIsrKykr37dsnX+KZJqLVRDSbnUsREU0R0Sr8DQwQB/gt5LEenCeilbfddtv85OTkRSJa6v06JBBNE0hkhFOMP9wBARAgyvVENjLr0FKZUpegME44XYSBnyBgEAHj1iEkEIOiG1MFARDwlQASiK94/TNunHD+oYRlEAABlwSMW4dQgbiMFHQDARAAgWsIIIFoGhLGCaepTnAbBKJMwLh1CBVIlMMZcwMBEAiSABJIkLQ9HMs44TxkB1MgAALeEDBuHUIF4k3gwAoIgAAIIIFoGgPGCaepTnAbBKJMwLh1CBVIlMMZcwMBEAiSABJIkLQ9HMs44TxkB1MgAALeEDBuHUIF4k3gwAoIgAAIIIFoGgPGCaepTnAbBKJMwLh1CBVIlMMZcwMBEAiSABJIkLQ9HMs44TxkB1MgAALeEDBuHUIF4k3gwAoI+EXA6uzsLE4mkzNE5FwZpKmpqaisrMxJJpPzfg0Mu3kTQALJG5kaHYwTTg3s8MJHApdP7pqamjYvLCzUEVEzEZU5juMwxjJCiCHLsvpjsdhAX1/fBSJa8NEXmM6NgHHrECqQ3AIDrUAgKALyN1mSSCTeJoR4mIgSRCQ/t3ztb1Vk/zYohPjeuXPn/mBoaGiCiC4F5SjG+SUCSCCaBoVxwmmqE9xehEAikbhTCPEFIqolIitbVRQQ0ZVkcXXvK3+T/80QkWw3MT8//3XLsj5z8OBBWZXIQyYe2QaH/wSMW4dQgfgfVBgBBBYlUF5eXt7Y2Ph5xth7iCjmAa6jg4ODD4yPj++/+r6JB3ZhYnECSCCaRohxwmmqE9y+hsDWrVvvWrly5XezFYSnfBhjX0+lUr/jqVEYW4yAcesQKhD8IEAgJAL19fUfqKysfDpbdfj1W3yJc/5mIjof0jRNGhYJRFO1jRNOU53gdpZAVVXVfbW1tX8ZEJBnOefvyt4rCWhII4cxbh3y66wn6OgxTrigAWM8zwgUtLa2vr+4uPgPiGiFZ1aXNnSYc96WbYab6kvzctPCuHUICcRNmKAPCLgjECsvL1+1adOm8es8luvOYu69FmKx2F0HDhz4Qe5d0DJPAkggeQJTpblxwqkCHn7kRyCRSDwnhLgrv17etT59+vTuU6dOHfDOIixdRcC4dQgVCOIfBIIhwHbs2PFYYWHhfw5muOuP4jjO97u6ut4Wpg8RHhsJRFNxjRNOU51MdlvGaDcRtYYM4YJlWduTyeSJkP2I4vDGrUOoQKIYxpiTagRYa2vrjuLi4oNZx8L83ckb6D/jnN+O/bM8DxMkEM+RBmPQOOGCwYpRPCJQkEgk/oMQ4lEiKvTIplszctNFi3O+urOzcxa7+brFeN1+xq1DYZ4JeamcccJ5CQ+2/CXQ2NhYXlFRcS67v5W/g+VmXczOzu7p6en5x9yao1WOBIxbh5BAcowMNAMBtwSqq6t319TUqLRYy8tY93DO/7vbOaEfKhBJAAkEvwQQ8JlATU3NO6urq7/j8zD5mv9TzvlD+XZC+0UJoALRNECME05TnYx0u6qq6vHa2trPqDR5IcTL6XR6j0o+RcAX49YhVCARiFpMQW0CbW1tny0oKPiYYl72cc63KuaT7u4ggWiqoHHCaaqTkW7btv0UET2i2OQnOOdrFPNJd3eMW4dQgegesvBfeQLxePwzjLHHFXMUFYj3giCBeM80EIvGCRcIVQziCYGqqqqP1dbWftYTY94Z2c85/1XvzMGSfEzbtu35HB7XdjjncidmR3dqqEB0VxD+K0+gurr67pqamr2KOfo5zvnHFfNJd3eQQDRV0DjhNNXJSLfr6uri69ev5wpN3onFYvceOHAA74F4K4px6xAqEG8DCNZA4JcI1NbWllZVVb1CRPUK4JEvEYr+/v7m8+fP9yngT5RcQALRVE3jhNNUJ1PdthKJxKNCiE8H/BXC6/GW190XOOflRDSHz9x6GpLGrUOoQDyNHxgDgesTaGtrqygoKBgmotKQGS04jrO3oKDgPdhI0XMlkEA8RxqMQeOECwYrRvGIgDxRE7Ztv0REN4e8hdC5vr6+lqmpqbMezQ1m/omAcesQKhCEPwgERGDz5s33lZWVfZuICgIa8peGcRznW11dXQ+ENX7Ex0UC0VRg44TTVCfj3bZtW76RLt9MD+UYHR2tHBkZQfXhD33j1iFUIP4EEqyCwI0IrLRtu5+I1uXwwplXFOWN88zo6OjtIyMj8jKa9i+weQXGYztIIB4DDcqcccIFBRbjeE9g586drStWrJDvhRR5b/36Fhljz6ZSqXcENZ6h4xi3DqECMTTSMe1wCTQ0NNy6bt26F4LwgjH2wVQq9Uz2sd0ghjR1DCQQTZU3TjhNdYLbVxFobW1NFBcXy0tKfn0n3RFCvJBOp99IRHKPJhz+EjBuHUIF4m9AwToILEqgqalp9apVq/6KiN7gNapTp07ddvr0aVnlyLfPcfhPAAnEf8a+jGCccL5QhNGwCBS3t7d/NhaL/QYRVWUXfLcndzOO4+yfnJx8YGBgYCCsCRk6rnHrkNsgVS0+jBNONQHgz/IJVFVVra+trf0IEX2YiGIuLA5alvXWZDJ5yEVfdFk+AePWISSQ5QcNLICAFwQu/xZvu+22WDKZLC8pKamrra19m2VZrxNCtBHRyuy9EtlunjE2K4SQFcaL/f39P8hkMl0XL148nXXk8oaJXjgFG3kRQALJC5c6jY0TTh308CQIAtu3b98Ri8XWzc3NWSUlJdNEdCydTv8iiLExRs4EjFuHUIHkHBtoCAJKELi8r5YSnsCJawkggWgaE8YJp6lOcBsEokzAuHUIFUiUwxlzAwEQCJIAEkiQtD0cyzjhPGQHUyAAAt4QMG4dQgXiTeDACgiAAAgggWgaA8YJp6lOcBsEokzAuHUIFUiUwxlzAwEQCJIAEkiQtD0cyzjhPGQHUyAAAt4QMG4dQgXiTeDACgiAAAgggWgaA8YJp6lOcBsEokzAuHUIFUiUwznkuXV0dNRZlvUlzvld2c+34lOqIWuC4X0lgATiK17/jBsnnH8oPbNcaNv2IBFVM8aeTKVSH8e3uD1jC0NqEjBuHUIFomYgau+VbdvPE9GvZScihBC3ptPpf9B+YpgACNyYABKIptFhnHCK6nR5o7/29vYXY7HYHiK6+gTlzNjY2PuGh4fl1/dwgEAUCRi3DqECiWIYhzcnFo/H38cY+8o1yUN6JHeQHeacb81+nxv3Q8LTCSP7QwAJxB+uvls1TjjfiboYoKOj4w8ty/rdJbq+eubMmd0nT54852IIdAEBlQkYtw6hAlE5HDXyLZFIvF0I8S0iKl7KbcuyPp9MJh9Zqh3+HQQ0I4AEoplgV9w1TjiVdNq5c2f7ihUrePZR3VxcEwsLC19sbm5+dO/evQu5dEAbENCAgHHrECoQDaJSZRerq6vfUlNT81Ui2piHn/J+CBsfH3/D4ODg3+MLe3mQQ1OVCSCBqKzOIr4ZJ5wCOllEJN/1OEpE9de5aZ6Li/Pz8/Md3d3dvbk0RhsQUJyAcesQKhDFI1JV96qqqjbX1tbK9zqql+GjfBLrPOd8LV4yXAZFdFWFABKIKkrk6YdxwuXJx+vmJfF4/FuMsXs9MLwghPhf6XT6N4ho2gN7MAECYREwbh1CBRJWqOk7bsy27QNEFPd4Cs9yzt/hsU2YA4EgCSCBBEnbw7GME85DdnmZ6uzs/JDjOF/Iq1NujWUl8nQ6nf4IbqrnBgytlCNg3DqECkS5GFTXoebm5sdKS0uf9NFD59ixY+3T09OHfRwDpkHALwJIIH6R9dmuccL5zPNa89b27dvfWlRU9D2XT1vl7C5jbGpycvL+/v5+ORYOENCJgHHrECoQncIzJF/r6+tvrqys3B/g8CdHRkaaR0dHL+JyVoDUMdRyCSCBLJdgSP2NEy4ozrt3727IZDLyPY2bghpTjsMYOzI+Pm4PDAzMBDkuxgKBZRAwbh1CBbKMaIl61/r6+jWVlZXHiGhNGHO9cOHCM0ePHv3tMMbGmCDgggASiAtoKnQxTrgAoEumPyaiOwIY60ZDyC1PPlxWVvbH+/bty4ToB4YGgVwIGLcOoQLJJSzManM5JhKJRK8QQn67Q25ZEupx6dKlNx85ckQmMxwgoDIBJBCV1VnEN+OE80un7du3FxYVFf0eET2uQvLIzvP07OzsHT09PXi81y/hYdcLAsatQ6hAvAibCNmIx+PPMMZ+S7EpyT2zxjjnctNGuf27vLSFAwRUI4AEopoiOfpjnHA5csmnGbNt+xNE9EkiWpFPx4DaCsbY8+fPn393X1/fWEBjYhgQyIeAcesQKpB8wiPCbROJRLsQIp+PQoVCw7KsLyeTyX8byuAYFAQWJ4AEommEGCeclzo1Njb+ZkVFhdzfqsxLuz7ZkpewnuGcP+yTfZgFAbcEjFuHUIG4DZVo9GMrV65ct3Xr1m4iqvR7mxKPkMn7IezYsWM7p6en5QuOuB/iEViYWTYBJJBlIwzHgHHCeYG5rq5u2/r162XyUPGex1JTdKanp19/7NixF5ZqiH8HgYAIGLcOoQIJKLJUG6aioqKssbHxh0T0OtV8y8Of0bGxsU3Dw8OX8uiDpiDgFwEkEL/I+mzXOOGWyVN+FCpFRO3LtBN2d/lk1k9SqdQb8UncsKXA+PK9Kdu253N4f8rhnMuqX16O1fpABaK1fO6cj8fj32CMPeSut3q95ufnv9vd3S0/iYsDBMIkgAQSJv1ljG2ccG5Ztba2PllcXPyY2/4K93uYc/413FRXWKHou2bcOoQKJPpBfWWGrL29/d2xWOxbmjxtla8yzvz8/K3d3d0v5tsR7UHAIwJIIB6BDNqMccLlC3jz5s13lZWVPZdvP53aCyGOnzhx4l3j4+Mv6eQ3fI0MAePWIVQgkYndG0+ks7Nzi+M4h4ioJOLTle+EnOCcN2VvUGp/kzLiekVtekggmipqnHC56tTe3r4pFovJdz1Kc+0TgXYvjo2NvXV4eHg8AnPRZQryZNT0lzqNW4dQgejy83TnZ5lt239NRK9x113fXo7jfLKrq+s/6jsDbTyPyRdRb7755oaXX365z/AkggSiTdj+c0eNE24JneRHoOTuuv1EtCGiN82XClV5U/3pu++++yNPPPEELmUtRcvlv69Zs2b1xo0bjxLRuunp6fcfO3bs6y5NRaGbcesQKpAohO01c2hsbCxfs2bN00KI+w1NHpKIvJzCTp48GT9z5oy8/4Mk4kOsd3R0fM2yrCvfrT8/MDDwmomJiR5DeSOB+BBjQZg0TrjFoCYSiT8TQjwQBHgNxpifmppq7evrk9UYDu8IsI6Ojm9YlvXea09SRkdHEyMjI/LTAKYdxq1DqECiFeKxeDz+bcaYfCs79G+ZK4JWViLjnPN1ivgTBTdYc3PzfaWlpd+5wWTGpqam3tTX15c27J4IEoim0W2ccNfTafv27b9SVFS03+DLVjcKX/kNkec45+/MfhJX0zBXw+2WlpY3lZSU/M0S3lwYHBysHR8fP6+G14F4Ydw6hAokkLjyf5AtW7Z8YPXq1U8TUYH/o2k7wrOc83do670Cjre2ttYUFxe/SkRFObhzcmpqak9fX99wDm2j0AQJRFMVjRPuKp3Y2rVrmzds2PAyEa3EpatFIzhjWdajyWTyS4ZdWvHkZ71mzZqGjRs3/h0Rbc3DYA/nPEFEs3n00bWpcesQKhBdQzXrd21tbUtVVZX8Mh+O3Ag4ZWVlHfv27ZMvV+LIg4Bt2/LjXbfm0eVK0wOWZd2STCblVudRPpBANFXXOOGkTps2baoqLy//ByLaoqluYbk9fPbs2QeHhoaeD8sBjcZltbW1JVVVVT8lok6399dmZmae7+3tfZNG83bjqnHrECoQN2GiRp8C27bl+w0tarijlxdy48V0Ot1KRPKs2PQtOBYTz0okEg8KIZ5ZpsLyPZy/5pz/qwjzRgJZZpCE1d044Wzb/hERvSUs4BEZNzk2NnYrPol7YzXb29v/JBaLyXeKPHksfGFh4S8OHjz4nojEz7XTMG4dQgWiYSTv2LHjLwsLC+W7HlHRLzQVJiYmPjUwMPD7oTmg7sCsrKysc/PmzfLSVbFXCUROd25u7k8OHz78W+pO3bVnSCCu0YXb0RThWCKReFgIIZ8i8uSMMFzZlBhdOI7z6LZt2764d+9e+b4IDiKqra19bVVV1c98giEvGT7GOf9Dn+yHZdaUdej/843KGawRwrW0tDxSUlLyVFi/jiiPOzk5+SvHjx8/EOHr8znL19jY2FJRUfG3RFSfcycXDWdnZ/9TT0/PJ1x0VbWLEevQ1fCRQFQNxWv8isfjuxlj8jFKeTkBh/cERmZnZzt7enpOe29aK4vFtm0PEFFVAF4LIcTb0+m0/FJmFB5kQAIJIGj8GCLSwu3atWvnwsJCSn53wQ94sHmZgHxKaIxzXpf9/ygsaHlLm0gkfiyEeGPeHd13EJlM5s5Dhw59370JZXpGeh26HmVUIMrE3vUdWbVqVUtTU9OzRNSuuKtRcM8RQnwnnU4/TEQXojChfOawY8eOPy8sLHxX0A9nMMam5ubmHuru7v5v+firYFskEAVFycWlKAp35aNQ8nKCPCuOSrLPRc9Q2wghvppNIqH6EeDg8l2Ph+S8Q3w4Y0a+EMs5Hwlw3l4PFcV1aFFGUVmUIifc2rVr6xoaGr7LGHut11EOe0sSmLMs69PJZNKIT+I2Nzf/TmlpqUweYR/js7Oz9/b09Mj9tnQ8IrcOLSUCEshShML591gikfgGPgoVDvwrX9Pr7+9vPn/+/PEof12vvb19UywWkx9/KguN9lUDZ3cIiBPRlAr+5OkDEkiewFRpHiXh5BYlP3G5aZ0qekTFj+nJycm3HD9+/OdRmdDV8yguLm5sbW2VG3HKrdlVOZmUDy9c6O3t3TkzMzOoGfcorUM5oVclaHJydpFGkRHulltu+fVLly79z+UCQX9vCFy1Z9acNxbVsFJaWlqzbdu2P2WMKbkdDmPs7/v7+x+cnJyU3x7R5YjMOpQrcCSQXEkF0K65ufmjpaWlnwtgKAyRH4GfcM5/LSKXsuRvntm2LSuPbflhCLS1rEROcs4bNXqsGgkk0BDxbjDdhbM2bNhwy9q1a+XNQ/muR1QSu3cKh2zp4sWLX3zllVc+HLIbXgxfkkgkviiE0GUvqp8NDg6+c3x8fMiLyftsQ/d1KG88UVmotBaupqamtbq6uidv9dAhaAL3cc7lOznypUMtj127dn1gYWHhyzo5zxjbm0ql7iOijOJ+a70OuWGLBOKGmod9WlpaGktKSrqIaLWHZmHKHwLyRcM96XT6//hj3lerVmtr6yeKi4s/SUQFvo7kj/E+znkHEV1SeNsTJBB/tPfdqq7CFdq2LR8TlS8K4tCDQG9vb++vz8zMaHVzd/Xq1Vu2bNnyShaxlieOjLGPplIpWT3JJKLioes65JqlloF0ndlqKdwyvjHtWnB0XDYBeflqmHO+OXsmrPzlrKamJnvVqlVyLzXtD8bYT1Kp1B2KViFarkPLCQokkOXQc9dXMhfxePyn2bfM8V0PdxzD7vXc1NTUg319fefDdmSx8SsrK1fW19fL7XDWquxnHr4Jxtjvp1KpTyt4TwQJJA8hVWqqk3DyEcrfJaInQ9x3SCXttPXFsqzHk8nkZxWegIy1/01Er4/gk33v45x/TTH2Oq1DnqBDBeIJxtyNtLe3/1EsFpO7veLQn0Dm0qVLnzly5Ij8JK5yl7Li8fiPVH1R0APpF4qKir66f//+D3pgyysTSCBekQzYjhbCxePxexhj3yGiwoD5YDh/CFz+Zsjx48e3TE5OystESnxD5J577on19fXJjSA/FsHK44qSl1mfOHHi5nPnzqnyVJwW65CXPwVUIF7SXMTWnj17ErOzszLQcc8jIOYBDiMrkR1Hjhw5GuCYNxzKtu27iWivCr4E4cOFCxfef/To0T8OYqwlxkACUUAENy4oLdz69evfWFdXJ6/XbnIzOfRRnoA8Gx7KbrsRahWyY8eOhwoLC59SZXfdgJS7NDo6esfIyMhLIVeBSq9DfmiBCsQPqv9kU/K98q5HNaoPf2GHbH2BiP4L5/z+EBexEtu2h4mo3MRYO3369K5Tp04lQ4wDJJAQ4S9naCWFW7duXXNDQ8PfElHDciaHvvoQcBznm11dXe8N2uPKykq7vr7+b4ioMsL3PZbCevHChQtvPnr0qNx+P4xKUMl1aCloy/l3VCDLobd43+J4PP5txti9/g0BywoSmGeMvSuVSgX2fW/5rkddXd1/ZYz9CwV5BO2S09fXt35qamoihCfjkECCVtuj8VQTboVt27KUbvNofjCjF4GFWCwWP3DgQHcAbhcmEomDQojmAMbSZYiLk5OT8ePHjx8L2GHV1iHfp48KxAfEu3fv/lAmk/mCD6ZhUh8Ch06cOPGg34+YtrW1/buCgoLP64MlME9PDw0NbTt79myQn8ZFAglMXm8HUka4lpaWJ0pKSj7l7fRgTVMCxzjnrX59EAkfIFsyKnonJiYSAwMDM0u29KaBMuuQN9NZ2goqkKUZ5dqCbd269c6VK1fKa9941yNXatFv96OJiYm7PF7ErG3btr3+pptueh6xtngAMcaSqVRqd0A31ZFANP09hy5cQ0PDrnXr1qnyRqymMkbT7dHR0Q+OjIx8xavZVVdXb6+pqTnslb2I25FPY/2Ucy73A/P7CH0d8nuC19pHBeIB8dbW1q3FxcUHiajYA3MwET0CIpPJPNLS0vKlvXv3yvdFXB/xeLycMdZPRGtcGzGwoxBibzqd9vuJSCQQTWMrNOE2bNhQsXbtWvlxoTJN2cHtgAiMjY1tHR4elou/23cUim3blh+Fku8VReXkLyD65GQymR8cOnToziw7txos5m9o61BQEFGBcL7Cy+fDbdt+kYh+NSwBMa5WBM5kMpmWQ4cOyXcU8j7i8fifMcYeyLsjOlwhkBFCfCqdTn/OyzXgKrxIIJrGWtDCyZvkIpFI9AohtuFsUNOoCd5tueX7ac55fXbonM+CbduWb1e/JniXozfi3NzcM4cPH/5tH2YW9DrkwxTyMxmVMjhQ4To7O1c4jvN7RPTvkTzyCzi0pgXG2FcYY48lk8n5HHiweDz+Lxljf4UnrnKglWMTIcQH0um03ME35ySeg+lA16Ec/PG9CRKIC8QdHR1/blnWu110RRcQuExACPFMOp1e8iz49ttvf2hiYuIZnKh4HziO47y3q6vrmx5aRgLxEGaQpoISjiUSiceFEE8QUUGQE8RYkSMw4zjOw4ssYKyysvI19fX18r2imsjNXo0JzSwsLHz84MGDXu0aEdQ6pAa9CJ3VBCKcbdu7iOgfI8RNmUA00BF5P0T09vZum5mZkV8zvPqTuFZpaWlVc3PzCSKKId58jY7ZhYWF1oMHD8onKZd7BLIOLddJL/vjElaONBsbG++vqKiQew7h+fscmaFZTgQGJyYm3j4wMPDyldb19fVNlZWVPyQiuQ0KDv8JTM/Pz9/f3d0t7zMt50ACWQ69EPv6KZxMshW2bfcS0drsGWGIU8XQUSPAGOtOpVJxIpIvGcrLpC8JIW6O2jwVn8/gkSNHXnvp0iX5QS63h5/rkFuffO2HCmQJvPX19e2VlZX7iajEVyVg3GgClmU9l0wm72lra/uLgoKCd+KyVeDhIJ/Gmu/p6dk+OzsrX/Z0cyCBuKGmQB9fhCsrK6vYvHnz94nodQrMES5El8DlR0kZY38nhHhDdppRObnTSjUhxIGBgYF/84tf/IK7cNyXdciFH4F1iUqQ+iHcing8fogxhg/1BBaOxg8kb6RjJ+dww+DKy54bs5cU83lPxI91KFwaS4yOBHIDQIlE4o+EEA8rrR6cAwEQ8IOATBq9g4OD946Pj+ez6zESiB9qBGDTU+G2bdv21E033fRIAH5jCBAAAXUJ/JBz/g4iupSji56uQzmOGWozVCD/HD9ra2t7uKCg4Eu4lBDrOo0PAAAEzElEQVRqXGJwEFCFwNmhoaHNZ8+enc5h2xMkEFVUy9MPT4RrbGz81xUVFd/Lc2w0BwEQiDABxthTr7766qcnJiYml5imJ+uQTihRgWTVSiQS7UII+UXBQp0EhK8gAAL+ExBCvJBOp29bogpBAvFfCl9GWJZwmzZt2lheXt5DRKW+eAejIAACuhOQN9a/zjn/EBHN3WAyy1qHdASECoSo1LbtF4ioU0cB4TMIgECgBD7EOf/yDSoRJJBApfBuMDfCyeTJbNuWG9nJD/xEJZl6RxWWQAAEriXgOI7zXFdX19uvg8bNOqQ14agsmvkIJ7dhl+Xoqng8/mXG2HuQPLSOYTgPAoETOHny5JvPnDnz42sGzmcd8vTT2oEDyA5oWgIRnPPLb/rG4/FvMsZ+MyzwGBcEQEBvAhcvXvzoK6+88uRVs0AC0VTSXIWb55wX27YtP2X5EHbW1VRtuA0CahDInDt37s4TJ078j6w7ua5DDuccFYgaGl72Ihfh5GWr2YKCgjdkMpmfZy9jYd8hhUSEKyCgI4GRkZE9o6Ojl7/nYtu23JJ/qXUFCUQxoXNJINLly1s2410PxdSDOyCgN4H5mZmZO3p7e39u2/YFIipeYjpIIIrpnWsCUcxtuAMCIBABApevbgwNDW1paGgYzOEzxEggiomOBKKYIHAHBAwjILeBl5suyg/P4RKWZuIjgWgmGNwFAYMJoAJRTHwkEMUEgTsgAAI3JIAEolhwIIEoJgjcAQEQQALRJQaQQHRRCn6CAAigAlEsBpBAFBME7oAACKAC0SUGkEB0UQp+ggAIoAJRLAaQQBQTBO6AAAigAtElBpBAdFEKfoIACKACUSwGkEAUEwTugAAIoALRJQaQQHRRCn6CAAigAlEsBpBAFBME7oAACKAC0SUGkEB0UQp+ggAIoAJRLAaQQBQTBO6AAAigAtElBpBAdFEKfoIACKACUSwGkEAUEwTugAAIoALRJQaQQHRRCn6CAAigAlEsBpht23NCiAXGWKHjOLOWZRVIHx3HyViWJf82h7+BAeIAv4UQ14MiIcQcYyzGOS/MfmJbsaU0P3dYfs3RGgRAAARAAAT+HwEkEEQCCIAACICAKwJIIK6woRMIgAAIgAASCGIABEAABEDAFQEkEFfY0AkEQAAEQAAJBDEAAiAAAiDgigASiCts6AQCIAACIIAEghgAARAAARBwRQAJxBU2dAIBEAABEEACQQyAAAiAAAi4IoAE4gobOoEACIAACCCBIAZAAARAAARcEUACcYUNnUAABEAABJBAEAMgAAIgAAKuCCCBuMKGTiAAAiAAAkggiAEQAAEQAAFXBJBAXGFDJxAAARAAASQQxAAIgAAIgIArAkggrrChEwiAAAiAABIIYgAEQAAEQMAVASQQV9jQCQRAAARAAAkEMQACIAACIOCKABKIK2zoBAIgAAIggASCGAABEAABEHBFAAnEFTZ0AgEQAAEQQAJBDIAACIAACLgigATiChs6gQAIgAAIIIEgBkAABEAABFwRQAJxhQ2dQAAEQAAEkEAQAyAAAiAAAq4IIIG4woZOIAACIAACSCCIARAAARAAAVcEkEBcYUMnEAABEAABJBDEAAiAAAiAgCsCSCCusKETCIAACIDA/wWpWNQqGFIUyQAAAABJRU5ErkJggg==",description:this.item.dscr||""}},computed:{getOwner(){return this.$store.state.administration.user.id},computedDateFormatted(){let e=this.formatDate(this.date);return e},managers(){let e=this.$store.state.administration.company.users||[],t=e.map(e=>({id:e.id,avatar:e.avatarSrc,name:e.first_name+" "+e.last_name,role:""}));return t}},watch:{menu(e){e&&setTimeout(()=>this.$refs.picker.activePicker="YEAR")}},methods:{cancel(){this.$emit("cancel")},checkOwner(){return this.getOwner==this.item.owner},save(e){this.$refs.menu.save(e)},formatDate(e){if(!e)return null;const[t,s,a]=e.split("-");let i=(new Date).getTimezoneOffset(),o=new Date(parseInt(t),parseInt(s)-1,parseInt(a),Math.abs(i)/60),n=o.getTime(o);return this.taskDay=n,`${a}/${s}/${t}`},removeChips(){this.manager=null},sendTask(){let e=new FormData,t={};this.name!=this.item.name&&(t.name=this.name),new Date(this.date).toISOString()!=this.item.deadline&&(t.deadline=new Date(this.date).toISOString()),this.manager!=this.item.user&&(t.user=this.manager),this.selectStatus!=this.item.status&&(t.status=this.selectStatus),this.description!=this.item.dscr&&(t.dscr=this.description),this.name!=this.item.name&&(t.name=this.name),e.append("JSON",JSON.stringify(t)),this.cancel(),this.$store.dispatch("workflow/updateTask",{type_id:"c",id:this.item.company_id,project_uuid:this.item.project,body:e,task_id:this.item.task_id.toString(),filter:{}})}}},_f=yf,Cf=(s("3acd"),Object(m["a"])(_f,bf,gf,!1,null,null,null)),wf=Cf.exports,kf={name:"Tools",components:{TaskCreate:wf},props:["editItem","h_style"],data(){return{tools_width:440}},methods:{cancel(){this.$emit("update:editItem",null)}}},xf=kf,Sf=Object(m["a"])(xf,ff,vf,!1,null,null,null),Af=Sf.exports,If={name:"ManageTasks",components:{Container:lf["a"],Draggable:lf["b"],Task:hf,Tools:Af},data(){return{project:"",header_style:{},statusList:[{name:"Новая",value:0},{name:"В работе",value:1},{name:"На рассмотрение",value:2},{name:"Выполненное",value:3}],removedIndex:null,addedIndex:null,editItem:null}},watch:{removedIndex(e){null!=e&&null!=this.addedIndex&&this.setTasks()},addedIndex(e){null!=e&&null!=this.removedIndex&&this.setTasks()}},computed:{projects(){return this.$store.state.workflow.projects.map(e=>({id:e.id,name:e.info.name}))},getOwner(){return this.$store.state.administration.user.id},tasks111(){let e=this.$store.state.workflow.taskList,t=[{group:0,name:"Новая",items:[]},{group:1,name:"В работе",items:[]},{group:2,name:"На рассмотрении",items:[]},{group:3,name:"Выполненное",items:[]}];return e.map((e,s)=>{let a=this.$store.state.administration.company.users.find(t=>t.id==e.owner);e.avatar=a?a.avatarSrc:"",t[e.status].items.push(e)}),t}},methods:{checkOwner(e){return this.getOwner==e},setTasks(){let e=this.tasks111[this.removedIndex.grp].items[this.removedIndex.ind],t=this.$store.state.workflow.taskList;t=t.map(t=>(e.task_id==t.task_id&&(e.status=this.addedIndex.grp,t.status=this.addedIndex.grp),t)),this.$store.commit("workflow/setTaskList",t),this.removedIndex=null,this.addedIndex=null;let s=new FormData,a={status:e.status};s.append("JSON",JSON.stringify(a)),this.$store.dispatch("workflow/updateTask",{type_id:"c",id:e.company_id,project_uuid:e.project,body:s,task_id:e.task_id.toString(),filter:{}})},onDrop(e,t){const{removedIndex:s,addedIndex:a}=t;null===s&&null===a||null!=s&&null!=a||(null!==s&&(this.removedIndex={grp:e,ind:s}),null!==a&&(this.addedIndex={grp:e,ind:a}))},onEnter(e,t,s){},getTasks(e){this.editItem=null,this.$store.dispatch("workflow/getTaskList",{type_id:"c",id:this.$store.state.administration.company.id,project_uuid:e,filter:{}})}},mounted(){this.$nextTick(()=>{let e=this.$refs["header"];this.header_style={top:e.getBoundingClientRect().top+"px"}})},beforeDestroy(){this.$store.commit("workflow/setTaskList",[])}},Of=If,jf=(s("ae2f"),Object(m["a"])(Of,nf,rf,!1,null,"07848b67",null)),Ff=jf.exports,Pf=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container pb-10 pt-0",attrs:{fluid:"","fill-height":"","text-xs-center":""}},[t(Ee["a"],{attrs:{row:"",wrap:""}},[t(ia["a"],{attrs:{xs12:""}},[t(aa["a"],{ref:"wrap",staticClass:"m-container",attrs:{fluid:"","px-3":"","pb-10":"","pt-0":""}},[t(ai["a"],{staticClass:"m-table-toolbar",attrs:{flat:"",height:"auto"}},[t(Dt["a"],{staticClass:"m-table-toolbar--search ml-2",attrs:{"prepend-icon":"search",placeholder:"Поиск...","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),t(Rt["a"]),t(Xe["a"],{staticClass:"ma-0 m-btn--text_icon",attrs:{text:""},on:{click:function(t){return t.stopPropagation(),e.onRemove(null,"trash")}}},[t(o["a"],{attrs:{size:"16",left:""}},[e._v("mdi-trash-can-outline")]),e._v("Очистить корзину\n            ")],1)],1),t(ks["a"],{staticClass:"m-table-custom",attrs:{headers:e.headers,items:e.getRemoved,"show-select":"",search:e.search,"disable-pagination":"","hide-default-footer":""},on:{"toggle-select-all":e.selectRow},scopedSlots:e._u([{key:"no-data",fn:function(){return[e._v("\n                "+e._s(e.noData)+"\n            ")]},proxy:!0},{key:"item.data-table-select",fn:function({item:e,isSelected:s,select:a}){return[t(Od["a"],{attrs:{value:s},on:{input:function(e){return a(e)}}})]}},{key:"item.src",fn:function({item:s}){return[t(o["a"],{attrs:{size:"30"}},[e._v(e._s("folder"==s.type?"icon-folder":"type"==s.type?"ft-unknown":"ft-"+s.type)+"\n                ")])]}},{key:"item.name",fn:function({item:s}){return[t("span",{staticClass:"m-table--name"},[t("span",[t(_r["a"],{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:a,attrs:i}){return[t("span",e._g(e._b({},"span",i,!1),a),[e._v("\n                                    "+e._s(s.name)+"\n                                ")])]}}],null,!0)},[e._v("\n                            "+e._s(s.name)+"\n                        ")])],1)])]}},{key:"item.status",fn:function({item:s}){return[t("span",[e._v("\n                    "+e._s(e.status[s.status])+"\n                ")])]}},{key:"item.action",fn:function({item:s}){return[e.checkSelected(s)?e._e():t("action-menu",{attrs:{item:s},on:{onRemove:e.onRemove,onRestore:e.onRestore}})]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}),t(We["a"],{directives:[{name:"show",rawName:"v-show",value:e.selected.length,expression:"selected.length"}],staticClass:"m-table-custom--action",style:e.cardActionStyle},[t(zt["a"],[t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:e.onRestoreSelected}},[t(o["a"],{staticClass:"mr-1",attrs:{size:"20",color:"#0070e0"}},[e._v("mdi-trash-can-outline")]),e._v("\n                    Восстановить\n                ")],1),t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:e.onRemoveSelected}},[t(o["a"],{staticClass:"mr-1",attrs:{size:"20",color:"#0070e0"}},[e._v("mdi-trash-can-outline")]),e._v("\n                    Удалить\n                ")],1)],1)],1)],1)],1)],1)],1)},Ef=[],Uf=function(){var e=this,t=e._self._c;return t(qe["a"],{attrs:{top:"",right:"","offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(o["a"],e._g({staticClass:"m-icon-border",attrs:{text:"",icon:"",size:"20"},on:{mousedown:function(e){e.stopPropagation()}}},s),[e._v("\n            mdi-dots-horizontal\n        ")])]}}])},[t(We["a"],[t(Ye["a"],{attrs:{dense:""}},e._l(e.notes,(function(s,a){return t($e["a"],{key:a,on:{click:function(t){return e.action(s)}}},[t(Re["c"],{staticClass:"m-menu-title",domProps:{textContent:e._s(s.title)}})],1)})),1)],1)],1)},Bf=[],Tf={props:["item"],data:()=>({notes:[{title:"Восстановить",value:"restore",action:"restore"},{title:"Удалить",value:"remove",action:"remove"}]}),methods:{action(e){switch(e.action){case"restore":this.$emit("onRestore",this.item);break;case"remove":this.$emit("onRemove",this.item,this.item.type);break;default:}}}},Lf=Tf,Nf=Object(m["a"])(Lf,Uf,Bf,!1,null,null,null),Hf=Nf.exports,Mf={name:"RemovedFiles",components:{ActionMenu:Hf},props:["id"],data(){return{search:"",headers:[{text:"",align:"center",sortable:!1,value:"src",grid:!1},{text:"Имя файла",value:"name",grid:!0},{text:"Проект",value:"projectName",grid:!1},{text:"Дата удаления",value:"trash_time",grid:!1},{text:"Удалил",value:"deleted_by",grid:!1},{text:"Дата загрузки",value:"upload_date",grid:!1},{text:"Статус",value:"status",grid:!0},{text:"",value:"action",sortable:!1,grid:!1}],status:{0:"На рассмотрении",1:"На исправлении",2:"Принят",3:"Отказ"},noData:"Нет данных",selected:[],items:[],status:{"-1":"",0:"На рассмотрении",1:"На исправлении",2:"Принят",3:"Отказ"},actionList:["trash","project","folder","file"]}},computed:{getRemoved(){let e=[],t=this.$store.state,s=t.workflow.projects,a=t.administration.company.users;return this.items.map(t=>{s.map(s=>{if(s.id==t.project){let i={projectId:s.id,projectName:s.info.name};t.TrashFolder.folders&&t.TrashFolder.folders.map(t=>{let s={year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},o=new Date(t.created_at),n=new Date(t.trash_time),r=a.find(e=>e.id==t.deleted_by+"");r=r?r.first_name+" "+r.last_name:"";let l={...i,...t,type:"folder",trash_time:n.toLocaleDateString("ru-RU",s),upload_date:o.toLocaleDateString("ru-RU",s),deleted_by:r};e.push(l)}),t.TrashFolder.files&&t.TrashFolder.files.map(t=>{let s={year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},o=new Date(t.created_at),n=new Date(t.trash_time),r=a.find(e=>e.id==t.deleted_by+"");r=r?r.first_name+" "+r.last_name:"";let l=t.name.split("."),c=l.splice(-1,1)[0]||"type";t.consolidations&&(c="consolidations");let m={...i,...t,type:c,trash_time:n.toLocaleDateString("ru-RU",s),upload_date:o.toLocaleDateString("ru-RU",s),deleted_by:r};e.push(m)})}})}),e},cardActionStyle(){let e=0,t=0;if(this.selected.length){let s=this.$refs["wrap"].getBoundingClientRect();e=s.width,t=s.x}return{width:e+"px",left:t+"px"}}},methods:{checkSelected(e){return this.selected.some(t=>t.id==e.id)},selectRow(e){let t=e.items;t=t.filter(e=>!0!==e.inwork),this.selected.length!=t.length?this.selected=t:this.selected=[]},onRestore(e){let t="folder"==e.type?"folder":"file";this.$store.dispatch("workflow/restoreFiles",{fileName:e.name,fileId:e.id,uuid:e.projectId,fileType:t}).then(e=>{this.$notify({group:"note",type:e.status?"success":"error",text:e.status?"folder"==e.fileType?"Папка "+e.name+"<br/>восстановлена.":"Файл "+e.name+"<br/>восстановлен.":e.name+"<br/>"+e.text})}).then(e=>this.$store.dispatch("workflow/getRemovedFiles")).then(e=>{this.items=e})},onRestoreSelected(){let e=[];this.selected.map(t=>{let s="folder"==t.type?"folder":"file";e.push(this.$store.dispatch("workflow/restoreFiles",{fileName:t.name,fileId:t.id,uuid:t.projectId,fileType:s}))}),Promise.all(e).then(e=>(e.map(t=>{this.selected=[],this.$notify({group:"note",type:t.status?"success":"error",text:t.status?"folder"==e.fileType?"Папка "+e.name+"<br/>восстановлена.":"Файл "+e.name+"<br/>восстановлен.":t.name+"<br/>"+t.text})}),!0)).then(e=>this.$store.dispatch("workflow/getRemovedFiles")).then(e=>{this.items=e})},onRemove(e,t){if("trash"==t&&!this.items.length)return!0;this.removeItem(e,t).then(e=>this.$store.dispatch("workflow/getRemovedFiles")).then(e=>{this.items=e})},removeItem(e,t){return t=this.actionList.some(e=>e==t)?t:"file",new Promise(s=>{this.$store.dispatch("workflow/removeRemovedFiles",{fileName:e?e.name:null,fileId:e?e.id:null,uuid:e?e.projectId:null,fileType:e?"folder"==e.type?e.type:"file":null,action:t}).then(e=>{this.selected=[],this.$notify({group:"note",type:e.status?"success":"error",text:e.status?"trash"==t?"Все папки и файлы удалены":"file"==t?"Файл "+e.name+"<br/>удален.":"Папка "+e.name+"<br/>удалена.":e.name+"<br/>"+e.text}),s(!0)})})},onRemoveSelected(){let e=this.selected,t=[];e.map(e=>{t.push(this.removeItem(e,e.type))}),Promise.all(t).then(e=>(this.selected=[],this.$store.dispatch("workflow/getRemovedFiles"))).then(e=>{this.items=e})}},created(){this.$store.dispatch("workflow/getRemovedFiles").then(e=>{this.items=e})}},zf=Mf,$f=Object(m["a"])(zf,Pf,Ef,!1,null,null,null),Rf=$f.exports,Df=function(){var e=this,t=e._self._c;return t(Ee["a"],{attrs:{fluid:"","fill-height":""}},[t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"12",md:"12"}},[t(vi["a"],{ref:"form_user"},[t(We["a"],{staticClass:"m-card pa-3 pt-0",attrs:{outlined:"","max-width":"1200"}},[t(zt["c"],{staticClass:"m-text--2c"},[e._v("Информация о пользователе")]),t(nt["a"]),t(xs["a"],{staticClass:"ma-0 mt-3"},[t(ws["a"],{staticClass:"justify-center m-border--inner-right pr-0",attrs:{cols:"4"}},[t(We["a"],{staticClass:"m-card m-card--center m-card--avatar mb-3",attrs:{outlined:"",width:"150",height:"150"}},[t("div",{staticClass:"m-card--avatar-wrap"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"file"==e.avatar.type,expression:"avatar.type == 'file'"}],staticClass:"m-card--avatar-delete",on:{click:e.removeAvatar}},[t(o["a"],{attrs:{size:"55",color:"#fff"}},[e._v("mdi-trash-can-outline\n                                        ")])],1),t("img",{staticClass:"m-card--avatar-wrap_img",attrs:{src:e.avatar.src}})])]),t("div",{staticClass:"m-link m-link--text m-text--center",on:{click:e.upload}},[e._v("редактировать")])],1),t(ws["a"],{staticClass:"pl-7",attrs:{cols:"8"}},[t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Имя",placeholder:" ","hide-details":"",required:"",rules:e.checkInput},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Имя\n                                            "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}]),model:{value:e.user.first_name,callback:function(t){e.$set(e.user,"first_name",t)},expression:"user.first_name"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Фамилия",placeholder:" ","hide-details":"",required:"",rules:e.checkInput},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Фамилия\n                                            "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}]),model:{value:e.user.last_name,callback:function(t){e.$set(e.user,"last_name",t)},expression:"user.last_name"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Отчество",placeholder:" ","hide-details":""},model:{value:e.user.middle_name,callback:function(t){e.$set(e.user,"middle_name",t)},expression:"user.middle_name"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{staticClass:"m-input--no-events",attrs:{label:"Адрес электронной почты",placeholder:" ","hide-details":""},model:{value:e.user.email,callback:function(t){e.$set(e.user,"email",t)},expression:"user.email"}})],1)],1)],1)],1),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(_s["a"],{attrs:{items:e.countries,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Страна",placeholder:" ","hide-details":"",filter:e.filter,clearable:""},on:{"click:clear":function(t){e.$nextTick(()=>e.selectCountry=null)},change:e.getCountry},model:{value:e.selectCountry,callback:function(t){e.selectCountry=t},expression:"selectCountry"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(_s["a"],{attrs:{disabled:!e.regions.length,items:e.regions,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Регион",placeholder:" ","hide-details":""},on:{change:e.getRegion},model:{value:e.selectRegion,callback:function(t){e.selectRegion=t},expression:"selectRegion"}})],1)],1),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Город",placeholder:" ","hide-details":""},model:{value:e.user.city,callback:function(t){e.$set(e.user,"city",t)},expression:"user.city"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Адрес",placeholder:" ","hide-details":""},model:{value:e.user.address,callback:function(t){e.$set(e.user,"address",t)},expression:"user.address"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Почтовый индекс",placeholder:" ","hide-details":""},model:{value:e.user.post_code,callback:function(t){e.$set(e.user,"post_code",t)},expression:"user.post_code"}})],1)],1),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Должность",placeholder:" ","hide-details":"",required:"",rules:e.checkInput},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Профессия\n                                    "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}]),model:{value:e.user.profession,callback:function(t){e.$set(e.user,"profession",t)},expression:"user.profession"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(ci["a"],{attrs:{items:e.genderList,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Пол",placeholder:" ","hide-details":"",required:"",rules:e.checkSelect},on:{change:e.getGender},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Пол\n                                    "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}]),model:{value:e.gender,callback:function(t){e.gender=t},expression:"gender"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(qe["a"],{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(Dt["a"],e._g({attrs:{label:"Число/месяц/год рождения",readonly:"","hide-details":"",placeholder:" ",required:"",rules:e.checkInput},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Число/месяц/год рождения\n                                            "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}],null,!0),model:{value:e.computedDateFormatted,callback:function(t){e.computedDateFormatted=t},expression:"computedDateFormatted"}},s))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[t(Cl["a"],{ref:"picker",attrs:{landscape:!0,locale:"ru",max:(new Date).toISOString().substr(0,10),min:"1950-01-01"},on:{change:e.save},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1)],1)],1),t(zt["a"],{staticClass:"pt-5 px-3"},[t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"normal"},on:{click:function(t){e.newpassword=!0}}},[e._v("Сменить пароль")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.changeUser},on:{click:e.saveChange}},[e._v("Сохранить")])],1)],1)],1)],1)],1),t("upload-files",{attrs:{uploadF:e.uploadF},on:{"update:uploadF":function(t){e.uploadF=t},"update:upload-f":function(t){e.uploadF=t},setAvatar:e.setAvatar}}),t("new-password",{attrs:{newpassword:e.newpassword},on:{"update:newpassword":function(t){e.newpassword=t}}})],1)},Jf=[],Vf=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.uploadF,scrollable:"","max-width":"800px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("Загрузить файл\n            "),t(Rt["a"]),t("div",{staticClass:"m-card-title--desc",class:{limit:e.limit.status}},[e._v(e._s(e.bytesToSize(e.totalSize))+" / 2Mb\n\n                "),t(_r["a"],{attrs:{top:"",right:"",color:"#fff","max-width":"250px","content-class":"m-tooltip--info"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(o["a"],e._g({staticClass:"mr-1 m-info--file",attrs:{size:"20",color:"#0070e0"}},s),[e._v("mdi-information-outline\n                        ")])]}},{key:"default",fn:function(){return[t("span",{},[e._v("Максимальный размер файла 2 Мб")])]},proxy:!0}])})],1),t(nt["a"],{staticClass:"mx-0",attrs:{inset:"",vertical:""}}),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5 px-4",staticStyle:{"background-color":"#fbfbfb",height:"650px"}},[t(Ee["a"],{staticClass:"m-drop-area",class:[{"m-dragging":e.dragging},{over:!e.mouseOver}],attrs:{column:"","align-center":"","justify-center":""},on:{drop:function(t){return t.stopPropagation(),t.preventDefault(),e.onChange.apply(null,arguments)},dragenter:function(t){t.stopPropagation(),t.preventDefault(),e.dragging=!0},dragleave:function(t){t.stopPropagation(),t.preventDefault(),e.dragging=!1},dragover:function(e){e.stopPropagation(),e.preventDefault()},mouseenter:function(t){return t.stopPropagation(),t.preventDefault(),e.mouseEnter.apply(null,arguments)},mouseleave:function(t){return t.stopPropagation(),t.preventDefault(),e.mouseLeave.apply(null,arguments)}}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.file,expression:"!file"}]},[e._v("Перетащите сюда файл для загрузки")]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.file,expression:"file"}],staticClass:"list"},[t("div",{staticClass:"item"},[t(o["a"],{attrs:{size:"80",left:""}},[e._v("icon-upload")]),e._v("\n                        "+e._s(e.fileName)+"\n                    ")],1)])])],1),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"input-files",attrs:{type:"file",id:"items",name:"items[]",required:""},on:{change:e.onChange}}),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.inputFiles}},[e._v("Выбрать файл")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.file},on:{click:e.submit}},[e._v("Подтвердить")]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"#2c2c2c"},on:{click:e.cancel}},[e._v("Отмена")])],1)],1)],1)},Kf=[],Gf={props:["uploadF"],name:"UploadFiles",data(){return{dragging:!1,mouseOver:!1,items:[],file:!1,fileName:"",itemsNames:[],itemsSizes:[],limit:{value:20,unit:2,status:!1},totalSize:0,formData:"",successMsg:"",errorMsg:""}},watch:{uploadF(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{removeFile(){this.file=!1,this.totalSize=0},removeFileAll(){this.items=[],this.totalSize=0},inputFiles(){this.$refs["input-files"].click()},mouseEnter(e){this.mouseOver=!0},mouseLeave(){this.mouseOver=!1},bytesToSize(e){const t=["Bytes","KB","MB","GB","TB"];if(0===e)return this.limit.status=!1,0;let s=parseInt(Math.floor(Math.log(e)/Math.log(1024)));if(0===s)return this.limit.status=!1,e+" "+t[s];let a=(e/Math.pow(1024,s)).toFixed(2);return s>=this.limit.unit&&a>this.limit.value?this.limit.status=!0:this.limit.status=!1,a+t[s]},onChange(e){this.dragging=!1,this.fileOver=!1,this.successMsg="",this.errorMsg="",this.formData=new FormData;let t=e.target.files||e.dataTransfer.files;for(let s in t)if(!isNaN(s)){(new Date).getTime(),t[s];this.file=t[s],this.fileName=t[s].name,this.totalSize=t[s].size,this.formData.append("name",this.fileName),this.formData.append("file",this.file)}},cancel(){this.items=[],this.totalSize=0,this.$emit("update:uploadF",!1)},submit(){this.formData.append("project_id",null),this.formData.append("is_attachment",!0),this.formData.append("uuid",Object(Ut["a"])()),this.$store.dispatch("common/setUploadNote",[{name:this.formData.get("name"),uuid:this.formData.get("uuid"),action:"upload",pushin:!0}]).then(e=>this.$store.dispatch("common/uploadFile",this.formData)).then(e=>this.$store.dispatch("common/getFile",e)).then(e=>{this.$emit("setAvatar",e),this.$store.dispatch("common/setUploadNote",[{name:this.formData.get("name"),uuid:this.formData.get("uuid"),action:"upload",pushin:!1}])}),this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.submit())}}},Qf=Gf,Xf=Object(m["a"])(Qf,Vf,Kf,!1,null,null,null),Wf=Xf.exports,Yf=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.newpassword,scrollable:"","max-width":"630px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-1 pl-5"},[e._v("Сменить пароль\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(zt["c"],{staticClass:"pt-5",staticStyle:{"background-color":"#fbfbfb",color:"#333333"}},[t(vi["a"],{ref:"form"},[t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Старый пароль",placeholder:" ",type:"password",required:"",rules:e.passRules},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Старый пароль\n                                "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}]),model:{value:e.old_password,callback:function(t){e.old_password=t},expression:"old_password"}})],1)],1),t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Новый пароль",placeholder:" ",type:"password",required:"",rules:e.passRules2},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Новый пароль\n                                "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}]),model:{value:e.new_password,callback:function(t){e.new_password=t},expression:"new_password"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Повторите пароль",placeholder:" ",type:"password",required:"",rules:e.passRules3},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Повторите пароль\n                                "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}]),model:{value:e.repeate_password,callback:function(t){e.repeate_password=t},expression:"repeate_password"}})],1)],1)],1)],1),t(zt["a"],{staticClass:"pa-5"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.validate}},[e._v("Сменить пароль")])],1)],1)],1)},qf=[],Zf={props:["newpassword"],name:"NewPassword",data(){return{siteKey:"6Lfm0uMUAAAAAHUoxb0b6Ao81lmjLazVTcr7kKaW",old_password:"",new_password:"",repeate_password:"",passRules:[e=>!!e||"Введите пароль",e=>e&&e.length>=6||"Пароль должен состоять из 6 символов или больше"],passRules2:[e=>!!e||"Введите новый пароль",e=>e&&e.length>=6||"Пароль должен состоять из 6 символов или больше",e=>e!=this.old_password||"Новый пароль должен отличаться от старого"],passRules3:[e=>!!e||"Повторите пароль",e=>e&&e.length>=6||"Пароль должен состоять из 6 символов или больше",e=>e==this.new_password||"Неверно введен пароль"]}},watch:{newpassword(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{cancel(){this.old_password="",this.new_password="",this.$emit("update:newpassword",!1)},newPassword(e){this.$store.dispatch("administration/newpass",{old_password:e.old_password,new_password:e.new_password}).then(e=>{this.alert(e),"success"==e.status&&this.cancel()})},alert(e){this.$notify({group:"note",text:e.text,type:e.status})},validate(){this.$refs.form.validate()&&this.newPassword({old_password:this.old_password,new_password:this.new_password})},enter(e){13===e.keyCode&&(e.preventDefault(),this.validate())}}},ev=Zf,tv=Object(m["a"])(ev,Yf,qf,!1,null,null,null),sv=tv.exports,av={name:"Account",components:{UploadFiles:Wf,NewPassword:sv},data(){return{avatar:{type:"default",src:""},selectCountry:null,selectRegion:{},genderList:[{id:"male",name:"мужской"},{id:"female",name:"женский"}],gender:{},date:null,menu:!1,checkInput:[e=>!!e||"Необходимое поле"],checkSelect:[e=>!!e.name||"Необходимое поле"],user:{birth_day:""},requiredList:["first_name","last_name","profession","gender","birth_day"],uploadF:!1,newpassword:!1}},computed:{computedDateFormatted(){let e=this.formatDate(this.date);return e},countries(){return this.$store.state.common.countries},regions(){return this.$store.state.common.regions},changeUser(){let e=Object.keys(this.user),t=this.$store.state.administration.user,s=!1;return e.map(e=>{this.user[e]!=t[e]&&(s=!0)}),this.requiredList.map(e=>{this.user[e]&&""!=this.user[e]||(s=!1)}),s}},watch:{menu(e){e&&setTimeout(()=>this.$refs.picker.activePicker="YEAR")}},methods:{save(e){this.$refs.menu.save(e)},formatDate(e){if(!e)return null;const[t,s,a]=e.split("-");let i=(new Date).getTimezoneOffset(),o=new Date(parseInt(t),parseInt(s)-1,parseInt(a),Math.abs(i)/60),n=o.getTime(o);return this.user.birth_day=n,`${a}/${s}/${t}`},parseDate(e){if(!e)return null;const[t,s,a]=e.split("/");return`${a}-${s.padStart(2,"0")}-${t.padStart(2,"0")}`},getCountry(e){void 0===e||null===e?(this.user.country_id=null,this.user.country="",this.getRegion(null),this.selectRegion=null,this.$store.dispatch("common/getRegions",null)):(this.user.country_id=e.id,this.user.country=e.name,this.$store.dispatch("common/getRegions",{id:e.id}))},getRegion(e){e?(this.user.region_id=e.id,this.user.region=e.name):(this.user.region_id=null,this.user.region="")},getGender(e){this.user.gender=e.id},init(e,t,s,a){this.selectCountry={id:e.id,name:e.name},e.id&&this.$store.dispatch("common/getRegions",{id:e.id}),this.selectRegion=t.id?{id:t.id,name:t.name}:null,this.gender={},this.genderList.map(e=>{e.id==s.id&&(this.gender={id:s.id,name:e.name})}),this.avatar=a.value},setAvatar(e){this.avatar.src=e.file,this.avatar.type="file",this.user.avatar=e.id},removeAvatar(){let e=this.user.first_name.charAt(0);e=e?e.toUpperCase():"U";let t=document.createElement("canvas"),s=150,a=90;t.width=s,t.height=s;let i=t.getContext("2d");i.beginPath(),i.fillStyle="#e55d4a",i.fillRect(0,0,s,s),i.fillStyle="#ffffff",i.font="bold "+a+"px Arial",i.textAlign="center",i.fillText(e,s/2,s/2+.7*a/2);let o=t.toDataURL();t=null,this.avatar.src=o,this.avatar.type="default",this.user.avatar=""},updateUser(e){this.user[e.name]=e.value},filter(e,t,s){return!s.toLowerCase().search(t.toLowerCase())},upload(){this.uploadF=!0},alert(e){this.$notify({group:"note",text:e.text,type:e.status})},saveChange(){this.$store.dispatch("administration/updateUser",this.user).then(e=>{this.alert(e),this.$store.dispatch("administration/getUser")})}},created(){this.$store.state.common.countries.length||this.$store.dispatch("common/getCountries");let e=this.$store.state.administration.user;e=JSON.parse(JSON.stringify(e)),this.user=e,this.init({id:this.user.country_id,name:this.user.country},{id:this.user.region_id,name:this.user.region},{id:this.user.gender},{id:this.user.avatar,value:this.$store.state.administration.userAvatar}),e.birth_day&&(this.date=new Date(e.birth_day).toISOString().substr(0,10))}},iv=av,ov=Object(m["a"])(iv,Df,Jf,!1,null,null,null),nv=ov.exports,rv=function(){var e=this,t=e._self._c;return t(aa["a"],{ref:"wrap",staticClass:"m-container",attrs:{fluid:"","px-3":"","pb-10":"","pt-0":""}},[t(We["a"],{staticClass:"m-card pa-3 pt-0 mb-6",attrs:{outlined:""}},[t(zt["c"],{staticClass:"m-text--2c m-text--size22"},[e._v("Обзор рабочей группы")]),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{staticClass:"justify-center pt-0 pl-4",attrs:{cols:"3"}},[t("div",{staticClass:"m-text--size13 mb-2"},[e._v("Участники")]),t("div",{staticClass:"m-text--size22 mb-2"},[t("span",[e._v(e._s(e.currentLicense.users))])]),t("router-link",{staticClass:"m-text--size13 m-text--color-blue",attrs:{to:"/administration/settings/employees/"}},[e._v("Подробнее")])],1),t(ws["a"],{staticClass:"justify-center pt-0 px-0",attrs:{cols:"3"}},[t("div",{staticClass:"m-text--size13 mb-2"},[e._v("Занятое место")]),t("div",{staticClass:"m-text--size22 mb-2"},[t("span",{staticClass:"m-text--color-blue"},[e._v(e._s(e.project_size))]),t("span",[e._v(" / "+e._s(e.currentLicense.space))])]),t("router-link",{staticClass:"m-text--size13 m-text--color-blue",attrs:{to:"/administration/payment/control"}},[e._v("Увеличить место")])],1),t(ws["a"],{staticClass:"justify-center pt-0 px-0",attrs:{cols:"3"}},[t("div",{staticClass:"m-text--size13 mb-2"},[e._v("Количество файлов")]),t("div",{staticClass:"m-text--size22 mb-2"},[t("span",[e._v(e._s(e.projects.num_files))])])]),t(ws["a"],{staticClass:"justify-center pt-0 px-0",attrs:{cols:"3"}},[t("div",{staticClass:"m-text--size13 mb-2"},[e._v("Дата завершения лицензии")]),t("div",{staticClass:"m-text--size22 mb-2"},[t("span",[e._v(e._s(e.license.date))])]),t("router-link",{staticClass:"m-text--size13 m-text--color-blue",attrs:{to:"/administration/payment/control"}},[e._v("Продлить")])],1)],1)],1),t(ai["a"],{staticClass:"m-table-toolbar",attrs:{flat:"",height:"auto"}},[t(Dt["a"],{staticClass:"m-table-toolbar--search ml-2",attrs:{"prepend-icon":"search",placeholder:"Поиск...","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),t(Rt["a"])],1),t(ks["a"],{staticClass:"m-table-custom",attrs:{headers:e.headers,items:e.projects.list,"show-select":"",search:e.search,"disable-pagination":"","hide-default-footer":""},scopedSlots:e._u([{key:"no-data",fn:function(){return[e._v("\n            "+e._s(e.noData)+"\n        ")]},proxy:!0},{key:"item.data-table-select",fn:function({item:e,isSelected:s,select:a}){return[t(Od["a"],{attrs:{value:s},on:{input:function(e){return a(e)}}})]}},{key:"item.name",fn:function({item:s}){return[t("span",[e._v(e._s(s.info.name)+"\n            ")])]}},{key:"item.manager",fn:function({item:t}){return[e._v("\n            "+e._s(t.info.in_charge_name)+"\n        ")]}},{key:"item.file_size",fn:function({item:t}){return[e._v("\n            "+e._s(t.info.file_size)+"\n        ")]}},{key:"item.date",fn:function({item:t}){return[e._v("\n            "+e._s(e.getDate(t.info.created_at))+"\n        ")]}},{key:"item.number_of_files",fn:function({item:t}){return[e._v("\n            "+e._s(t.info.number_of_files)+"\n        ")]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}),t(We["a"],{directives:[{name:"show",rawName:"v-show",value:e.selected.length,expression:"selected.length"}],staticClass:"m-table-custom--action",style:e.cardActionStyle},[t(zt["a"])],1)],1)},lv=[],cv={name:"Statistics",data(){return{headers:[{text:"НАЗАВАНИЕ проекта",value:"name"},{text:"Ответственный за проект",value:"manager"},{text:"Занятое место",value:"file_size"},{text:"Дата создания",value:"date"},{text:"Кол. Файлов",value:"number_of_files"}],search:"",selected:[],noData:"Нет данных",project_size:0,project_size_list:[]}},computed:{currentLicense(){let e=this.$store.state.administration.currentLicense;return{...e,space:this.bytesToSize(e.space)}},projects(){let e=this.$store.state.workflow.projects;return e=e.map(e=>{let t=this.project_size_list.find(t=>t.id==e.id);return e.info.file_size=t?t.size:0,e}),{list:e,num_files:e.reduce((e,t)=>e+parseInt(t.info.number_of_files),0)}},cardActionStyle(){let e=0,t=0;if(this.selected.length){let s=this.$refs["wrap"].getBoundingClientRect();e=s.width,t=s.x}return{width:e+"px",left:t+"px"}},users(){return this.$store.state.administration.company.users.length},license(){let e=0,t="";return this.$store.state.administration.licenseList.map(s=>{10==s.rte&&(e=s.data.idata/1048576),20!=s.rte&&21!=s.rte&&22!=s.rte&&23!=s.rte||(t=this.getDate(s.edate))}),{size:e,date:t}}},methods:{getDate(e){let t={year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return new Date(1e3*parseInt(e)).toLocaleDateString("ru-RU",t)},bytesToSize(e){const t=["байт","Кб","Мб","Гб","Тб"];if(0===e)return"0 "+t[0];let s=parseInt(Math.floor(Math.log(e)/Math.log(1024)));if(0===s)return e+" "+t[s];let a=(e/Math.pow(1024,s)).toFixed(2);return a+t[s]}},created(){let e=this.$store.state.workflow.projects.map(e=>this.$store.dispatch("workflow/getProjectSize",{id:e.id}));Promise.all(e).then(e=>{let t=[];e.map(e=>{t.push({id:e.prj,size:this.bytesToSize(e.size)})}),this.project_size_list=t;let s=e.reduce((e,t)=>e+parseInt(t.size),0);this.project_size=this.bytesToSize(s)})}},mv=cv,dv=Object(m["a"])(mv,rv,lv,!1,null,null,null),pv=dv.exports,uv=function(){var e=this,t=e._self._c;return t("router-view")},hv=[],fv={name:"Settings"},vv=fv,bv=Object(m["a"])(vv,uv,hv,!1,null,null,null),gv=bv.exports,yv=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container",attrs:{fluid:"","px-4":"","pa-0":"","pb-10":""}},[t("div",{staticClass:"m-nav-tabs"},[t("router-link",{staticClass:"m-nav-tabs--item",attrs:{to:"/administration/payment/control"}},[t("span",[e._v("Управление тарифным планом")])])],1),t("router-view")],1)},_v=[],Cv={name:"Payment"},wv=Cv,kv=Object(m["a"])(wv,yv,_v,!1,null,null,null),xv=kv.exports,Sv=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"m-control--item"},[t("div",[t("div",{staticClass:"m-control--item__title"},[e._v(e._s(e.parameters.Name))]),t("div",{staticClass:"m-control--item__desc"},[e._v("Ваш текущий пакет. Выберите, на какой период вы хотите купить лицензию.")])]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:function(t){return e.onComponent("Plan")}}},[e._v("Изменить план")])],1),t("div",{staticClass:"m-control--item"},[t("div",[t("div",{staticClass:"m-control--item__title"},[e._v("Количество лицензий: "+e._s(-1==e.checkLic(e.parameters.License)?"неограничено":e.checkLic(e.parameters.License)))]),t("div",{staticClass:"m-control--item__desc"},[e._v("Количество лицензий, которые используют сотрудники вашей компании.")])]),t(Rt["a"]),-1!=e.checkLic(e.parameters.License)?t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return e.onComponent("License")}}},[e._v("Управление лицензиями")]):e._e()],1),t("div",{staticClass:"m-control--item"},[t("div",[t("div",{staticClass:"m-control--item__title"},[e._v("Использованное место")]),t("div",{staticClass:"m-control--item__desc"},[e._v("Ваш текущий пакет предоставляет "+e._s(e.parameters.Size)+" Мб места в облачном хранилище.")])]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return e.onComponent("Size")}}},[e._v("Получить больше места")])],1),t("control-dialog",{attrs:{component:e.component,parameters:e.parameters},on:{"update:component":function(t){e.component=t}}})],1)},Av=[],Iv=function(){var e=this,t=e._self._c;return t($t["a"],{attrs:{value:e.component,scrollable:"","max-width":"700px"},on:{input:t=>t||e.cancel()}},[t(We["a"],[t(zt["d"],{staticClass:"pr-0 pl-4 m-modal--title"},[e._v("\n            "+e._s(e.title[e.component])+"\n            "),t(Rt["a"]),t(Xe["a"],{attrs:{text:"",icon:"",color:"#7f7f7f"},on:{click:e.cancel}},[t(o["a"],{attrs:{size:"20"}},[e._v("close")])],1)],1),t(nt["a"]),t(e.component,{tag:"component",attrs:{parameters:e.parameters,values:e.values},on:{"update:values":function(t){e.values=t}}}),t(nt["a"]),t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:"Confirm"!=e.component,expression:"component != 'Confirm'"}],staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.onConfirm}},[e._v("Купить\n            ")]),t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:"Confirm"==e.component,expression:"component == 'Confirm'"}],staticClass:"m-btn",attrs:{outlined:"",color:"primary"},on:{click:e.setLicense}},[e._v("Да\n            ")]),t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:"Confirm"!=e.component,expression:"component != 'Confirm'"}],staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.cancel.apply(null,arguments)}}},[e._v("Отмена")]),t(Xe["a"],{directives:[{name:"show",rawName:"v-show",value:"Confirm"==e.component,expression:"component == 'Confirm'"}],staticClass:"m-btn m-btn-normal",attrs:{outlined:"",color:"normal"},on:{click:function(t){return t.stopPropagation(),e.cancel.apply(null,arguments)}}},[e._v("Нет")])],1)],1)],1)},Ov=[],jv=function(){var e=this,t=e._self._c;return t(zt["c"],{staticClass:"px-4",staticStyle:{"background-color":"#fbfbfb"}},[t("div",{staticClass:"m-flex pt-6 pb-3"},[t("span",{staticClass:"m-flex--item__auto pr-3 m-text--size13"},[e._v("Укажите количество пользователей:")]),t("div",{staticClass:"m-flex--item"},[t(Dt["a"],{staticClass:"m-text--size12",on:{input:e.onlyInteger},model:{value:e.num,callback:function(t){e.num=t},expression:"num"}})],1)])])},Fv=[],Pv={name:"Plan",props:["parameters","values"],data(){return{num:this.parameters.License}},watch:{num(e){this.setNum()}},methods:{onlyInteger(e){this.$nextTick(()=>{this.num=this.num.replace(/[^0-9]/g,"")})},setNum(){this.num!=this.parameters.License&&this.$emit("update:values",{route:"lic",body:{rte:this.parameters.Plan,data:{idata:this.num}}})}}},Ev=Pv,Uv=Object(m["a"])(Ev,jv,Fv,!1,null,null,null),Bv=Uv.exports,Tv=function(){var e=this,t=e._self._c;return t(zt["c"],{staticClass:"px-4",staticStyle:{"background-color":"#fbfbfb"}},[t("div",{staticClass:"m-flex pt-6 pb-3"},[t("span",{staticClass:"m-flex--item__auto pr-3 m-text--size13"},[e._v("Выберите пакет:")]),t("div",{staticClass:"m-flex--item"},[t(_s["a"],{staticClass:"pa-0 ma-0 m-text--size12",attrs:{items:e.parameters.List,"item-text":"name","item-value":"code","persistent-hint":"",placeholder:" ","hide-details":"",dense:""},model:{value:e.plan,callback:function(t){e.plan=t},expression:"plan"}})],1)])])},Lv=[],Nv={name:"Plan",props:["parameters","values"],data(){return{plan:this.parameters.Plan}},watch:{plan(e){this.setPlan()}},methods:{setPlan(){this.plan!=this.parameters.Plan&&this.$emit("update:values",{route:"plan",body:{rte:this.plan,data:{idata:this.parameters.License}}})}}},Hv=Nv,Mv=Object(m["a"])(Hv,Tv,Lv,!1,null,null,null),zv=Mv.exports,$v=function(){var e=this,t=e._self._c;return t(zt["c"],{staticClass:"px-4",staticStyle:{"background-color":"#fbfbfb"}},[t("div",{staticClass:"m-flex pt-6 pb-3"},[t("span",{staticClass:"m-flex--item__auto pr-3 m-text--size13"},[e._v("Укажите объем необходимого пространства:")]),t("div",{staticClass:"m-flex--item"},[t(Dt["a"],{staticClass:"m-text--size12",on:{input:e.onlyInteger},model:{value:e.size,callback:function(t){e.size=t},expression:"size"}})],1),t("span",{staticClass:"m-flex--item__auto m-text--size13"},[e._v("Мегабайт")])])])},Rv=[],Dv={name:"Plan",props:["parameters","values"],data(){return{size:this.parameters.Size,maxC:5,maxN:51200}},watch:{size(e){this.setSize()}},methods:{onlyInteger(e){this.$nextTick(()=>{let e=this.size.replace(/[^0-9]/g,"").slice(0,this.maxC);this.size=parseInt(e)>this.maxN?this.maxN:e})},setSize(){this.size!=this.parameters.Size&&this.$emit("update:values",{route:"size",body:{rte:this.parameters.Plan,data:{idata:parseInt(this.size)}}})}}},Jv=Dv,Vv=Object(m["a"])(Jv,$v,Rv,!1,null,null,null),Kv=Vv.exports,Gv=function(){var e=this,t=e._self._c;return t(zt["c"],{staticClass:"px-4",staticStyle:{"background-color":"#fbfbfb"}},[t("div",{staticClass:"pt-6 pb-3"},[t("span",{staticClass:"m-flex--item__auto pr-3 m-text--size16 m-text--color-black"},[e._v("Вы действительно хотите купить данную лицензию? Если вы нажмете «Да», Ваш запрос будет отправлен, в ближайшее время он будет принят в работу. Для отмены нажмите «Нет».")])])])},Qv=[],Xv={name:"Confirm"},Wv=Xv,Yv=Object(m["a"])(Wv,Gv,Qv,!1,null,null,null),qv=Yv.exports,Zv={name:"ControlDialog",components:{License:Bv,Plan:zv,Size:Kv,Confirm:qv},props:["component","parameters"],data(){return{title:{Plan:"Тип лицензий",License:"Количество лицензий",Size:"Количество места",Confirm:""},values:null,confirm:!1,minLic:3,maxLic:9223372036854775807n,place:{p20:200,p21:5120,p22:10240,p23:51200}}},watch:{component(e){e?document.addEventListener("keyup",this.enter,!1):document.removeEventListener("keyup",this.enter,!1)}},methods:{cancel(){this.$emit("update:component",!1),this.values=null},onConfirm(){this.$emit("update:component","Confirm")},setLicense(){if(this.values){if("plan"==this.values.route){let e=this.maxLic.toString();this.values.body.rte>20&&(e=BigInt(this.values.body.data.idata)==this.maxLic?this.$store.state.administration.company.users.length>=this.minLic?this.$store.state.administration.company.users.length.toString():this.minLic.toString():parseInt(this.values.body.data.idata)<this.minLic?this.minLic.toString():this.values.body.data.idata),this.$store.dispatch("administration/setLicense",{uid:this.$store.state.administration.user.id,cid:this.$store.state.administration.company.id,int:1,rte:this.values.body.rte,data:{idata:e}}),this.$store.dispatch("administration/setLicense",{uid:this.$store.state.administration.user.id,cid:this.$store.state.administration.company.id,int:1,rte:10,data:{idata:(1024*this.place["p"+this.values.body.rte]*1024).toString()}}),this.$store.dispatch("administration/setLicense",{uid:this.$store.state.administration.user.id,cid:this.$store.state.administration.company.id,int:1,rte:30+this.values.body.rte%10})}"size"==this.values.route&&this.$store.dispatch("administration/setLicense",{uid:this.$store.state.administration.user.id,cid:this.$store.state.administration.company.id,int:1,rte:10,data:{idata:this.place["p"+this.values.body.rte]>this.values.body.data.idata?(1024*this.place["p"+this.values.body.rte]*1024).toString():(1024*this.values.body.data.idata*1024).toString()}}),"lic"==this.values.route&&this.$store.dispatch("administration/setLicense",{uid:this.$store.state.administration.user.id,cid:this.$store.state.administration.company.id,int:1,rte:this.values.body.rte,data:{idata:BigInt(this.values.body.data.idata)>=this.maxLic?this.maxLic.toString():parseInt(this.values.body.data.idata)<this.minLic?this.minLic.toString():this.values.body.data.idata}}),this.cancel()}else this.cancel()},enter(e){13===e.keyCode&&(e.preventDefault(),this.cancel())}}},eb=Zv,tb=Object(m["a"])(eb,Iv,Ov,!1,null,null,null),sb=tb.exports,ab={name:"Control",components:{ControlDialog:sb},data(){return{list:[{name:"Старт",code:20},{name:"Базовый",code:21},{name:"Профессионал",code:22},{name:"Интеллектуальный эксперт",code:23}],component:!1}},computed:{parameters(){let e=this.$store.state.administration.currentLicense;return{Plan:e?e.pcode:0,Name:e?this.list.find(t=>t.code==e.pcode).name:"",List:this.list,License:e?e.users:0,Size:e?parseInt(e.space)/1048576:0}}},methods:{onComponent(e){this.component=e},checkLic(e){return"9223372036854775807"==e&&20==this.parameters.Plan?-1:e}}},ib=ab,ob=Object(m["a"])(ib,Sv,Av,!1,null,null,null),nb=ob.exports,rb=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container",attrs:{fluid:"","px-3":"","pa-0":"","pb-10":""}},e._l(e.list,(function(s){return t("div",{staticClass:"m-list--group"},[t("div",{staticClass:"m-list--group-title"},[e._v(e._s(s.group)+"\n        ")]),e._l(s.items,(function(s){return t("div",{staticClass:"m-list--item",on:{click:function(t){return e.action(s.action)}}},[t("div",{staticClass:"m-list--item-title"},[e._v(e._s(s.title))]),t("div",{staticClass:"m-list--item-desc"},[e._v(e._s(s.desc))])])}))],2)})),0)},lb=[],cb={name:"SettingsList",data(){return{list:[{group:"Аккаунт",items:[{title:"Профиль компании",desc:"Укажите данные вашей компанией, чтобы иметь возможность покупать услуги, продукты UnitBIM и пользоваться всеми возможностями платформы.",action:"company",permissions:["1","2","3","4","5","6"]},{title:"Сотрудники",desc:"Список сотрудников вашей компании использующие платформу UnitBIM.",action:"employees",permissions:["1","2","3","4","5","6"]}]},{group:"Докуметооборот",items:[{title:"Права доступа",desc:"Укажите, кто из пользователей может совершать оплату при покупке лицензии и других сервисов.",action:"accessrights",permissions:["1","2"]},{title:"Контент",desc:"Список всех проектов и файлов загруженных или созданных вашими сотрудниками.",action:"kontent",permissions:["1","2","3","4","5","6"]},{title:"Контрагенты",desc:"Укажите свой контрагентов для возможности выстраивание совместной работы.",action:"contragents",permissions:["1","2"]},{title:"Версионность",desc:"Укажите максимальное количество версий файла, которые будут храниться на облаке.",action:"version",permissions:["1","2","3","4","5","6"]},{title:"Активность",desc:"Следите за действиями и активностью ваших сотрудников.",action:"activity",permissions:["1","2"]}]}]}},methods:{action(e){this.$router.push({name:e})},getList(){let e=this.$store.state.administration.user.role,t=this.list.map(t=>({...t,items:t.items.filter(t=>t.permissions.some(t=>t==e))})).filter(e=>e.items.length);return t}}},mb=cb,db=Object(m["a"])(mb,rb,lb,!1,null,null,null),pb=db.exports,ub=function(){var e=this,t=e._self._c;return t(Ee["a"],{attrs:{fluid:"","fill-height":""}},[t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"12",md:"12"}},[t(We["a"],{staticClass:"m-card pa-3 pt-0",attrs:{outlined:"","max-width":"1200"}},[t(zt["c"],{staticClass:"m-text--2c"},[e._v("Информация о компании")]),t(nt["a"]),t(xs["a"],{staticClass:"ma-0 mt-3"},[t(ws["a"],{staticClass:"justify-center m-border--inner-right pr-0",attrs:{cols:"4"}},[t(We["a"],{staticClass:"m-card m-card--center m-card--avatar mb-3",attrs:{outlined:"",width:"150",height:"150"}},[t("div",{staticClass:"m-card--avatar-wrap"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"file"==e.logo.type,expression:"logo.type == 'file'"}],staticClass:"m-card--avatar-delete",on:{click:e.removeLogo}},[t(o["a"],{attrs:{size:"55",color:"#fff"}},[e._v("mdi-trash-can-outline\n                                    ")])],1),t("img",{staticClass:"m-card--avatar-wrap_img",attrs:{src:e.logo.src}})])]),t("div",{staticClass:"m-link m-link--text m-text--center",on:{click:e.upload}},[e._v("редактировать")])],1),t(ws["a"],{attrs:{cols:"8"}},[t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Название компании",placeholder:" ","hide-details":"",required:"",rules:e.checkInput},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Название компании\n                                        "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}]),model:{value:e.company.name,callback:function(t){e.$set(e.company,"name",t)},expression:"company.name"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Юридическое лицо",placeholder:" ","hide-details":""},model:{value:e.company.official_name,callback:function(t){e.$set(e.company,"official_name",t)},expression:"company.official_name"}})],1)],1)],1)],1),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"ИНН",placeholder:" ",required:"",rules:e.innRules,"hide-details":""},model:{value:e.company.inn,callback:function(t){e.$set(e.company,"inn",t)},expression:"company.inn"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"КПП",placeholder:" ",required:"",rules:e.kppRules,"hide-details":""},model:{value:e.company.kpp,callback:function(t){e.$set(e.company,"kpp",t)},expression:"company.kpp"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"ОГРН",placeholder:" ",required:"",rules:e.ogrnRules,"hide-details":""},model:{value:e.company.ogrn,callback:function(t){e.$set(e.company,"ogrn",t)},expression:"company.ogrn"}})],1)],1),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(_s["a"],{attrs:{items:e.countries,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Страна",placeholder:" ","hide-details":"",clearable:""},on:{"click:clear":function(t){e.$nextTick(()=>e.selectCountry=null)},change:e.getCountry},model:{value:e.selectCountry,callback:function(t){e.selectCountry=t},expression:"selectCountry"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(_s["a"],{attrs:{disabled:!e.regions.length,items:e.regions,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Регион",placeholder:" ","hide-details":""},on:{change:e.getRegion},model:{value:e.selectRegion,callback:function(t){e.selectRegion=t},expression:"selectRegion"}})],1)],1),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Город",placeholder:" ","hide-details":""},model:{value:e.company.city,callback:function(t){e.$set(e.company,"city",t)},expression:"company.city"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Адрес",placeholder:" ","hide-details":""},model:{value:e.company.address,callback:function(t){e.$set(e.company,"address",t)},expression:"company.address"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Почтовый индекс",placeholder:" ","hide-details":""},model:{value:e.company.post_code,callback:function(t){e.$set(e.company,"post_code",t)},expression:"company.post_code"}})],1)],1),t(zt["a"],[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.changeUser},on:{click:e.saveChange}},[e._v("Сохранить")])],1)],1)],1)],1),t("upload-files",{attrs:{uploadF:e.uploadF},on:{"update:uploadF":function(t){e.uploadF=t},"update:upload-f":function(t){e.uploadF=t},setAvatar:e.setLogo}})],1)},hb=[],fb={name:"Company",components:{UploadFiles:Wf},data(){return{logo:{type:"default",src:""},selectCountry:null,selectRegion:{},date:null,menu:!1,checkInput:[e=>!!e||"Необходимое поле"],checkSelect:[e=>!!e.name||"Необходимое поле"],innRules:[e=>e&&10==e.length||"ИНН должен состоять из 10 символов"],kppRules:[e=>e&&9==e.length||"КПП должен состоять из 9 символов"],ogrnRules:[e=>e&&(13==e.length||e&&15==e.length)||"ОГРН должен состоять из 13 или 15 символов"],company:{name:""},requiredList:["name"],uploadF:!1}},computed:{computedDateFormatted(){return this.formatDate(this.date)},countries(){return this.$store.state.common.countries},regions(){return this.$store.state.common.regions},changeUser(){let e=Object.keys(this.company),t=this.$store.state.administration.company,s=!1;return e.map(e=>{this.company[e]!=t[e]&&(s=!0)}),this.requiredList.map(e=>{this.company[e]&&""!=this.company[e]||(s=!1)}),s}},watch:{menu(e){e&&setTimeout(()=>this.$refs.picker.activePicker="YEAR")}},methods:{save(e){this.$refs.menu.save(e)},formatDate(e){if(!e)return null;const[t,s,a]=e.split("-");return`${a}/${s}/${t}`},parseDate(e){if(!e)return null;const[t,s,a]=e.split("/");return`${a}-${s.padStart(2,"0")}-${t.padStart(2,"0")}`},upload(){this.uploadF=!0},setLogo(e){this.logo.src=e.file,this.logo.type="file",this.company.logo=e.id},removeLogo(){let e=this.company.name.charAt(0);e=e?e.toUpperCase():"U";let t=document.createElement("canvas"),s=150,a=90;t.width=s,t.height=s;let i=t.getContext("2d");i.beginPath(),i.fillStyle="#e55d4a",i.fillRect(0,0,s,s),i.fillStyle="#ffffff",i.font="bold "+a+"px Arial",i.textAlign="center",i.fillText(e,s/2,s/2+.7*a/2);let o=t.toDataURL();t=null,this.logo.src=o,this.logo.type="default",this.company.logo=""},getCountry(e){void 0===e||null===e?(this.company.country_id=null,this.company.country="",this.getRegion(null),this.selectRegion=null,this.$store.dispatch("common/getRegions",null)):(this.company.country_id=e.id,this.company.country=e.name,this.$store.dispatch("common/getRegions",{id:e.id}))},getRegion(e){e?(this.company.region_id=e.id,this.company.region=e.name):(this.company.region_id=null,this.company.region="")},updateCompany(e){this.company[e.name]=e.value},init(e,t,s){this.selectCountry={id:e.id,name:e.name},e.id&&this.$store.dispatch("common/getRegions",{id:e.id}),this.selectRegion=t.id?{id:t.id,name:t.name}:null,this.logo=s.value},filter(e,t,s){return!s.toLowerCase().search(t.toLowerCase())},alert(e){this.$notify({group:"note",text:e.text,type:e.status})},saveChange(){this.$store.dispatch("administration/updateCompany",this.company).then(e=>{this.alert(e)})}},created(){this.$store.state.common.countries.length||this.$store.dispatch("common/getCountries");let e=this.$store.state.administration.company;e=JSON.parse(JSON.stringify(e)),this.company={...this.company,...e},this.init({id:this.company.country_id,name:this.company.country},{id:this.company.region_id,name:this.company.region},{id:this.company.avatar,value:this.$store.state.administration.companyLogo})}},vb=fb,bb=Object(m["a"])(vb,ub,hb,!1,null,null,null),gb=bb.exports,yb=function(){var e=this,t=e._self._c;return t("router-view")},_b=[],Cb={name:"Employees"},wb=Cb,kb=Object(m["a"])(wb,yb,_b,!1,null,null,null),xb=kb.exports,Sb=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container",attrs:{fluid:"","px-3":"","pb-10":"","pt-0":""}},[t(ai["a"],{staticClass:"m-table-toolbar pl-2",attrs:{flat:"",height:"auto"}},[t("span",{staticClass:"pa-2 m-text--size13"},[e._v("Глобальные настройки")])]),t(ks["a"],{staticClass:"m-table-custom",attrs:{headers:e.headers,items:e.list_,"disable-pagination":"","hide-default-footer":""},scopedSlots:e._u([{key:"no-data",fn:function(){return[e._v("\n            "+e._s(e.noData)+"\n        ")]},proxy:!0},{key:"item.owner",fn:function({item:s}){return[t("span",[e._v("Да")])]}},{key:"item.admin",fn:function({item:s}){return[t("span",[e._v("Да")])]}},{key:"item.client",fn:function({item:s}){return[t(Ss["a"],{attrs:{value:s.client.value,color:"success",inset:""},on:{change:function(t){return e.setPermission(s.client)}}})]}},{key:"item.suborder",fn:function({item:s}){return[t(Ss["a"],{attrs:{value:s.suborder.value,color:"success",inset:""},on:{change:function(t){return e.setPermission(s.suborder)}}})]}},{key:"item.manager",fn:function({item:s}){return[t(Ss["a"],{attrs:{value:s.manager.value,color:"success",inset:""},on:{change:function(t){return e.setPermission(s.manager)}}})]}},{key:"item.employee",fn:function({item:s}){return[t(Ss["a"],{attrs:{value:s.employee.value,color:"success",inset:""},on:{change:function(t){return e.setPermission(s.employee)}}})]}},{key:"footer",fn:function(){return[t(zt["a"],{staticClass:"pa-5 px-4"},[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.checkChange},on:{click:e.savePremissions}},[e._v("Сохранить")])],1)]},proxy:!0}])},[e._v("\n    --\x3e\n    ")])],1)},Ab=[],Ib={name:"Rights",data(){return{slot:!0,items:[{name:"owner",id:"1"},{name:"admin",id:"2"},{name:"client",id:"3"},{name:"suborder",id:"4"},{name:"manager",id:"5"},{name:"employee",id:"6"}],headers:[{text:"",align:"left",sortable:!1,value:"name"},{text:"владелец",value:"owner",sortable:!1},{text:"админ",value:"admin",sortable:!1},{text:"клиент",value:"client",sortable:!1},{text:"Субподрядчик",value:"suborder",sortable:!1},{text:"Менеджер",value:"manager",sortable:!1},{text:"сотрудник",value:"employee",sortable:!1}],noData:"Нет данных",listPermission:[{name:"can_create_project",title:"Создать проект",permissions:[]},{name:"can_delete_project",title:"Удалить проект",permissions:[]},{name:"can_add_client",title:"Добавить клиента",permissions:[]},{name:"can_add_subcontractor",title:"Добавить субподрядчика",permissions:[]},{name:"can_send_project",title:"Передать проект",permissions:[]},{name:"can_manage_company",title:"Редактировать компанию",permissions:[]},{name:"can_manage_projects",title:"Редактировать проект",permissions:[]},{name:"can_manage_users",title:"Редактировать пользователя",permissions:[]}],groupPermissions:[],listIDChange:[]}},computed:{list_(){let e=this.listPermission.map(e=>({name:e.title,id:e.name,...Object.fromEntries(this.items.map(t=>{let s=this.groupPermissions.find(e=>e.id==t.id)||"";return[[t.name],{itemID:s.id,type:"permission",name:e.name,value:s[e.name]}]}))}));return e},checkChange(){let e=!1;return this.groupPermissions.map(t=>{let s=this.$store.state.administration.groupPermissions.find(e=>e.id==t.id);Object.entries(t).map(([a,i])=>{"users"!==a&&i!=s[a]&&(this.listIDChange.push(t.id),e=!0)})}),e}},methods:{setPermission(e){this.groupPermissions=this.groupPermissions.map(t=>t.id==e.itemID?{...t,[e.name]:!e.value}:t)},savePremissions(){let e=[];this.groupPermissions.map(t=>{if(this.listIDChange.some(e=>e==t.id)){let s={body:t.users.length?{...t,users:t.users}:t,id:t.id};e.push(this.$store.dispatch("administration/setGroupPermissions",s))}}),Promise.all(e).then(e=>{this.listIDChange=[],this.$store.dispatch("administration/getGroupPermissions")})}},created(){this.$store.dispatch("administration/getGroupPermissions").then(e=>{e&&(this.groupPermissions=e)})}},Ob=Ib,jb=Object(m["a"])(Ob,Sb,Ab,!1,null,null,null),Fb=jb.exports,Pb=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container",attrs:{fluid:"","px-3":"","pa-0":"","pb-10":""}},[t(nt["a"]),t("div",[t("div",{staticClass:"m-list--item m-no-hover"},[t("div",{staticClass:"m-list--item-title"},[e._v(e._s(e.title))]),t("div",{staticClass:"m-list--item-desc"},[t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"10",md:"10"}},[e._v("\n                        "+e._s(e.desc)+"\n                    ")]),t(ws["a"],{attrs:{cols:"12",sm:"2",md:"2"}},[t(ci["a"],{staticClass:"m-autocomplete",attrs:{items:e.items,outlined:"","item-text":"title","item-value":"value"},on:{change:e.onChange},scopedSlots:e._u([{key:"item",fn:function(s){return[t("div",{staticClass:"v-list-item__content"},[t("div",{staticClass:"v-list-item__title",class:{"m-text--size22":1e3==s.item.id}},[e._v("\n                                        "+e._s(s.item.title)+"\n                                    ")])])]}}]),model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)],1)],1)])])],1)},Eb=[],Ub={name:"Version",data(){return{title:"Количество версий",desc:"Укажите, какое количество версий файла будут храниться на облаке. В случае, если вы уменьшаете текущее количество версий, версии, которые будут удалены, нельзя будет восстановить.",value:0,items:[{title:"Нет",value:0,id:0},{title:"3",value:3,id:1},{title:"4",value:4,id:2},{title:"5",value:5,id:3},{title:"6",value:6,id:4},{title:"7",value:7,id:5},{title:"8",value:8,id:6},{title:"9",value:9,id:7},{title:"10",value:10,id:8},{title:"15",value:9,id:9},{title:"20",value:20,id:10},{title:P("&#8734;"),value:-1,id:1e3}]}},methods:{onChange(e){this.$store.dispatch("administration/setHistoryLimit",e)}},beforeCreate(){this.$store.dispatch("administration/getHistoryLimit").then(e=>{this.value=e})}},Bb=Ub,Tb=Object(m["a"])(Bb,Pb,Eb,!1,null,null,null),Lb=Tb.exports,Nb=function(){var e=this,t=e._self._c;return t(aa["a"],{staticClass:"m-container",attrs:{fluid:"","px-3":"","pb-10":"","pt-0":""}},[t(ai["a"],{staticClass:"m-table-toolbar",attrs:{flat:"",height:"auto"}},[t(Dt["a"],{staticClass:"m-table-toolbar--search ml-4",attrs:{"prepend-icon":"search",placeholder:"Поиск...","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),t(Rt["a"]),t(Xe["a"],{staticClass:"ma-0 m-btn--text_icon",attrs:{text:""},on:{click:function(t){return t.stopPropagation(),e.addUser.apply(null,arguments)}}},[t(o["a"],{attrs:{size:"18",left:""}},[e._v("mdi-account-plus")]),e._v("Пригласить пользователя\n        ")],1)],1),t(ks["a"],{staticClass:"m-table-custom",attrs:{headers:e.headers,items:e.employees,"show-select":"1"==e.getRole||"2"==e.getRole,search:e.search,"disable-pagination":"","hide-default-footer":""},on:{"toggle-select-all":e.selectRow},scopedSlots:e._u([{key:"no-data",fn:function(){return[e._v("\n            "+e._s(e.noData)+"\n        ")]},proxy:!0},{key:"item.data-table-select",fn:function({item:e,isSelected:s,select:a}){return[t(Od["a"],{attrs:{value:s},on:{input:function(e){return a(e)}}})]}},{key:"item.src",fn:function({item:s}){return[t(ot["a"],{attrs:{size:"30"}},[t("img",{staticClass:"m-card--avatar-wrap_img",attrs:{src:e.getAvatar(s),alt:"avatar"}})])]}},{key:"item.action",fn:function({item:s}){return[s.status&&("1"==e.getRole||"2"==e.getRole)||!s.status?t("action-menu",{attrs:{item:s},on:{editUser:e.editUser,reconfirm:e.reconfirm,removeUser:e.removeUser}}):e._e()]}},{key:"item.status",fn:function({item:s}){return[t("span",{class:s.status?"green--text":"red--text"},[e._v("\n                "+e._s(e.getStatus(s.status))+"\n            ")])]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}),t(We["a"],{directives:[{name:"show",rawName:"v-show",value:e.selected.length,expression:"selected.length"}],staticClass:"m-table-custom--action",style:e.cardActionStyle},[t(zt["a"],[t(Xe["a"],{staticClass:"m-btn",attrs:{text:"",color:"primary"},on:{click:function(t){return e.removeUser()}}},[t(o["a"],{staticClass:"mr-1",attrs:{size:"20",color:"#0070e0"}},[e._v("mdi-trash-can-outline")]),e._v("\n                Удалить\n            ")],1)],1)],1)],1)},Hb=[],Mb=function(){var e=this,t=e._self._c;return t(qe["a"],{attrs:{top:"",right:"","offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(o["a"],e._g({staticClass:"m-icon-border",attrs:{text:"",icon:"",size:"20"},on:{mousedown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"pevent",void 0,t.key,void 0))return null;t.stopPropagation()}}},s),[e._v("\n            mdi-dots-horizontal\n        ")])]}}])},[t(We["a"],[t(Ye["a"],{attrs:{dense:""}},e._l(e.getItems,(function(s,a){return t($e["a"],{key:a,on:{click:function(t){return e.action(s)}}},[t(Re["c"],{staticClass:"m-menu-title",domProps:{textContent:e._s(s.title)}})],1)})),1)],1)],1)},zb=[],$b={props:["item"],data:()=>({items:[{title:"Редактировать",value:"edit",action:"editUser"},{title:"Отправить приглашение",value:"reconfirm",action:"reconfirm"},{title:"Удалить",value:"remove",action:"removeUser"}]}),computed:{getItems(){let e=this.items;return e=this.item.status?e.filter(e=>"reconfirm"!=e.value):e.filter(e=>"edit"!=e.value),e}},methods:{action(e){switch(e.action){case"removeUser":this.$emit("removeUser",[this.item]);break;case"editUser":this.$emit("editUser",this.item);break;case"reconfirm":this.$emit("reconfirm",this.item);break;default:return}}}},Rb=$b,Db=Object(m["a"])(Rb,Mb,zb,!1,null,null,null),Jb=Db.exports,Vb={name:"EmployeesList",components:{ActionMenu:Jb},data(){return{selected:[],headers:[{text:"",align:"center",sortable:!1,value:"src"},{text:"ЕМАЙЛ",value:"email"},{text:"ФИО",value:"name"},{text:"ДОЛЖНОСТЬ",value:"position"},{text:"СТАТУС",value:"status"},{text:"",value:"action",sortable:!1}],search:"",noData:"Нет данных"}},computed:{employees:function(){let e=this.$store.state.administration,t=e.invited;t=t||[];let s=e.company.users||[];return s=s.map(e=>({...e,src:e.avatarSrc,name:e.first_name+" "+e.last_name,status:e.status,position:Object.prototype.hasOwnProperty.call(e,"profession")?e.profession:""})),t=t.filter(e=>!e.status).map((e,t)=>({...e,id:"id-"+t,src:e.email.slice(0,1),position:""})),t=[...s,...t],t},getRole(){return this.$store.state.administration.user.role},avatar(){return this.$store.state.administration.userAvatar},cardActionStyle(){return this.selected.length&&(this.widthEl=this.$el.clientWidth),{width:this.widthEl+"px"}}},methods:{selectRow(e){let t=e.items;this.selected.length!=t.length?this.selected=t:this.selected=[]},getStatus(e){let t="";switch(e){case 0:t="Создан";break;case 1:case 200:t="Активен";break;default:t="Создан"}return t},getAvatar(e){if(e.src&&1!=e.src.length)return e.src;{let t=e.name?e.name:e.email;return k(t)}},addUser(){this.$router.push({name:"employees_invite"})},editUser(e){this.$router.push({name:"employee_account",params:{id:e.id,role:this.getRole}}).catch(e=>{console.log("failure")})},reconfirm(e){this.$router.push({name:"employees_invite",query:{email:e.email}})},removeUser(e=[]){let t=[],s=[...this.selected,...e];s.map(e=>{e.status?t.push(this.$store.dispatch("administration/invitedRemove",e.id)):t.push(this.$store.dispatch("administration/noregistredRemove",e.email))}),Promise.all(t).then(e=>{s.map(e=>{this.$notify({group:"note",type:"success",text:"Удален "+e.email})}),this.selected=[],this.$store.dispatch("administration/invitedList"),this.$store.dispatch("administration/getCompany")})}},created(){this.$store.dispatch("administration/invitedList")}},Kb=Vb,Gb=Object(m["a"])(Kb,Nb,Hb,!1,null,null,null),Qb=Gb.exports,Xb=function(){var e=this,t=e._self._c;return t(Ee["a"],{attrs:{fluid:"","fill-height":""}},[t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"12",md:"12"}},[e.sended?t("div",[e._v("\n                Приглашение отправлено на почту "+e._s(e.email)+".\n            ")]):t(vi["a"],{ref:"form_user"},[t(We["a"],{staticClass:"m-card pa-3 pt-0",attrs:{outlined:"","max-width":"1200"}},[t(zt["c"],{staticClass:"m-text--2c"},[e._v("Информация о пользователе")]),t(nt["a"]),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Электронная почта",placeholder:" ",required:"",rules:e.emailRules},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("Электронная почта\n                                    "),t("span",{staticClass:"red--text"},[t("strong",[e._v("* ")])])]},proxy:!0}],null,!1,4262767742),model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}})],1),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t("vue-recaptcha",{attrs:{sitekey:e.siteKey,loadRecaptchaScript:!0},on:{verify:e.captchaVerify,expired:e.captchaExpired,error:e.captchaError}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}})],1),t(zt["a"],[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.checkReady},on:{click:e.invite}},[e._v("Пригласить")])],1)],1)],1)],1)],1)],1)},Wb=[],Yb=s("e096"),qb={name:"EmployeesInvite",components:{VueRecaptcha:Yb["a"]},data(){return{email:"",emailRules:[e=>!!e||"Необходимое поле",e=>/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(e)||"Неверный email"],checkSelect:[e=>!!e.name||"Необходимое поле"],siteKey:"6Lfm0uMUAAAAAHUoxb0b6Ao81lmjLazVTcr7kKaW",recaptcha:!1,sended:!1}},computed:{checkReady(){let e=this.recaptcha&&this.email;return e}},methods:{invite(){this.$store.dispatch("administration/inviteUser",{email:this.email,code:this.recaptcha}).then(e=>{this.sended=!0})},captchaVerify(e){this.recaptcha=e},captchaError(e){console.log("error",e),this.recaptcha=!1},captchaExpired(e){console.log("expired",e),this.recaptcha=!1}},mounted(){let e=this.$route.query,t=Object.prototype.hasOwnProperty.call(e,"email");t&&(this.email=e.email)}},Zb=qb,eg=Object(m["a"])(Zb,Xb,Wb,!1,null,null,null),tg=eg.exports,sg=function(){var e=this,t=e._self._c;return t(Ee["a"],{attrs:{fluid:"","fill-height":""}},[t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"12",md:"12"}},[t(vi["a"],{ref:"form_user"},[t(We["a"],{staticClass:"m-card pa-3 pt-0",attrs:{outlined:"","max-width":"1200"}},[t(zt["c"],{staticClass:"m-text--2c"},[e._v("Информация о пользователе")]),t(nt["a"]),t(xs["a"],{staticClass:"ma-0 mt-3"},[t(ws["a"],{staticClass:"justify-center m-border--inner-right pr-0",attrs:{cols:"4"}},[t(We["a"],{staticClass:"m-card m-card--center m-card--avatar mb-3",attrs:{outlined:"",width:"150",height:"150"}},[t("div",{staticClass:"m-card--avatar-wrap"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"file"==e.avatar.type,expression:"avatar.type == 'file'"}],staticClass:"m-card--avatar-delete",on:{click:e.removeAvatar}},[t(o["a"],{attrs:{size:"55",color:"#fff"}},[e._v("mdi-trash-can-outline\n                                        ")])],1),t("img",{staticClass:"m-card--avatar-wrap_img",attrs:{src:e.avatar.src}})])]),t("div",{staticClass:"m-link m-link--text m-text--center",on:{click:e.upload}},[e._v("редактировать")])],1),t(ws["a"],{staticClass:"pl-7",attrs:{cols:"8"}},[t(xs["a"],[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Имя",placeholder:" ","hide-details":"",readonly:""},model:{value:e.user.first_name,callback:function(t){e.$set(e.user,"first_name",t)},expression:"user.first_name"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Фамилия",placeholder:" ","hide-details":"",readonly:""},model:{value:e.user.last_name,callback:function(t){e.$set(e.user,"last_name",t)},expression:"user.last_name"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{attrs:{label:"Отчество",placeholder:" ","hide-details":"",readonly:""},model:{value:e.user.middle_name,callback:function(t){e.$set(e.user,"middle_name",t)},expression:"user.middle_name"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(Dt["a"],{staticClass:"m-input--no-events",attrs:{label:"Адрес электронной почты",placeholder:" ","hide-details":"",readonly:""},model:{value:e.user.email,callback:function(t){e.$set(e.user,"email",t)},expression:"user.email"}})],1)],1)],1)],1),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(_s["a"],{attrs:{items:e.countries,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Страна",placeholder:" ","hide-details":"",filter:e.filter,clearable:"",readonly:""},on:{"click:clear":function(t){e.$nextTick(()=>e.selectCountry=null)},change:e.getCountry},model:{value:e.selectCountry,callback:function(t){e.selectCountry=t},expression:"selectCountry"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"6",md:"6"}},[t(_s["a"],{attrs:{disabled:!e.regions.length,items:e.regions,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Регион",placeholder:" ","hide-details":"",readonly:""},on:{change:e.getRegion},model:{value:e.selectRegion,callback:function(t){e.selectRegion=t},expression:"selectRegion"}})],1)],1),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Город",placeholder:" ","hide-details":"",readonly:""},model:{value:e.user.city,callback:function(t){e.$set(e.user,"city",t)},expression:"user.city"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Адрес",placeholder:" ","hide-details":"",readonly:""},model:{value:e.user.address,callback:function(t){e.$set(e.user,"address",t)},expression:"user.address"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Почтовый индекс",placeholder:" ","hide-details":"",readonly:""},model:{value:e.user.post_code,callback:function(t){e.$set(e.user,"post_code",t)},expression:"user.post_code"}})],1)],1),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Должность",placeholder:" ","hide-details":"",readonly:""},model:{value:e.user.profession,callback:function(t){e.$set(e.user,"profession",t)},expression:"user.profession"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(ci["a"],{attrs:{items:e.genderList,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Пол",placeholder:" ","hide-details":"",readonly:""},on:{change:e.getGender},model:{value:e.gender,callback:function(t){e.gender=t},expression:"gender"}})],1),t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(Dt["a"],{attrs:{label:"Число/месяц/год рождения",readonly:"","hide-details":"",placeholder:" "},model:{value:e.computedDateFormatted,callback:function(t){e.computedDateFormatted=t},expression:"computedDateFormatted"}})],1)],1),t(zt["a"],{staticClass:"pt-5 px-3"},[t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"normal"},on:{click:function(t){e.newpassword=!0}}},[e._v("Сменить пароль")]),t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.changeUser},on:{click:e.saveChange}},[e._v("Сохранить")])],1)],1)],1)],1),t(ws["a"],{attrs:{cols:"12",sm:"12",md:"12"}},[t(We["a"],{staticClass:"m-card pa-3",attrs:{outlined:"","max-width":"1200"}},[t(zt["c"],{staticClass:"m-text--2c"},[e._v("Права пользователя")]),t(nt["a"]),t(xs["a"],{staticClass:"ma-0"},[t(ws["a"],{attrs:{cols:"12",sm:"4",md:"4"}},[t(ci["a"],{attrs:{items:e.permissionList,"item-text":"name","item-value":"id","persistent-hint":"","return-object":"",label:"Роль пользователя",placeholder:" ","hide-details":"",required:"",rules:e.checkSelect},model:{value:e.group_permissions.turn,callback:function(t){e.$set(e.group_permissions,"turn",t)},expression:"group_permissions.turn"}})],1)],1),t(zt["a"],[t(Rt["a"]),t(Xe["a"],{staticClass:"m-btn",attrs:{outlined:"",color:"primary",disabled:!e.checkRole},on:{click:e.saveRole}},[e._v("Сохранить")])],1)],1)],1)],1),t("upload-files",{attrs:{uploadF:e.uploadF},on:{"update:uploadF":function(t){e.uploadF=t},"update:upload-f":function(t){e.uploadF=t},setAvatar:e.setAvatar}}),t("new-password",{attrs:{newpassword:e.newpassword},on:{"update:newpassword":function(t){e.newpassword=t}}})],1)},ag=[],ig={name:"Account",components:{UploadFiles:Wf,NewPassword:sv},props:["id","role"],beforeRouteEnter(e,t,s){s("1"==e.params.role||"2"==e.params.role)},data(){return{avatar:{type:"default",src:""},selectCountry:null,selectRegion:{},genderList:[{id:"male",name:"мужской"},{id:"female",name:"женский"}],gender:{},date:null,menu:!1,checkInput:[e=>!!e||"Необходимое поле"],checkSelect:[e=>!!e.name||"Необходимое поле"],user:{birth_day:""},group_permissions:{stand:{},turn:{}},permissionList:[],requiredList:["first_name","last_name","profession","gender","birth_day"],uploadF:!1,newpassword:!1}},computed:{computedDateFormatted(){let e=this.formatDate(this.date);return e},countries(){return this.$store.state.common.countries},regions(){return this.$store.state.common.regions},changeUser(){let e=Object.keys(this.user),t=this.$store.state.administration.company.users.find(e=>e.id==this.id),s=!1;return e.map(e=>{this.user[e]!=t[e]&&(s=!0)}),this.requiredList.map(e=>{this.user[e]&&""!=this.user[e]||(s=!1)}),s},checkRole(){let e=!1;return this.group_permissions.stand.id&&(e=this.group_permissions.stand.id!=this.group_permissions.turn.id),e}},watch:{menu(e){e&&setTimeout(()=>this.$refs.picker.activePicker="YEAR")}},methods:{save(e){this.$refs.menu.save(e)},formatDate(e){if(!e)return null;const[t,s,a]=e.split("-");let i=(new Date).getTimezoneOffset(),o=new Date(parseInt(t),parseInt(s)-1,parseInt(a),Math.abs(i)/60),n=o.getTime(o);return this.user.birth_day=n,`${a}/${s}/${t}`},parseDate(e){if(!e)return null;const[t,s,a]=e.split("/");return`${a}-${s.padStart(2,"0")}-${t.padStart(2,"0")}`},getCountry(e){void 0===e||null===e?(this.user.country_id=null,this.user.country="",this.getRegion(null),this.selectRegion=null,this.$store.dispatch("common/getRegions",null)):(this.user.country_id=e.id,this.user.country=e.name,this.$store.dispatch("common/getRegions",{id:e.id}))},getRegion(e){e?(this.user.region_id=e.id,this.user.region=e.name):(this.user.region_id=null,this.user.region="")},getGender(e){this.user.gender=e.id},init(e,t,s,a){this.selectCountry={id:e.id,name:e.name},e.id&&this.$store.dispatch("common/getRegions",{id:e.id}),this.selectRegion=t.id?{id:t.id,name:t.name}:null,this.gender={},this.genderList.map(e=>{e.id==s.id&&(this.gender={id:s.id,name:e.name})}),this.avatar.src=a.value},setAvatar(e){this.avatar.src=e.file,this.avatar.type="file",this.user.avatar=e.id},removeAvatar(){let e=this.user.first_name.charAt(0);e=e?e.toUpperCase():"U";let t=document.createElement("canvas"),s=150,a=90;t.width=s,t.height=s;let i=t.getContext("2d");i.beginPath(),i.fillStyle="#e55d4a",i.fillRect(0,0,s,s),i.fillStyle="#ffffff",i.font="bold "+a+"px Arial",i.textAlign="center",i.fillText(e,s/2,s/2+.7*a/2);let o=t.toDataURL();t=null,this.avatar.src=o,this.avatar.type="default",this.user.avatar=""},updateUser(e){this.user[e.name]=e.value},filter(e,t,s){return!s.toLowerCase().search(t.toLowerCase())},upload(){this.uploadF=!0},alert(e){this.$notify({group:"note",text:e.text,type:e.status})},saveChange(){this.$store.dispatch("administration/updateEmployee",this.user).then(e=>{this.alert(e),this.$store.dispatch("administration/getUser")})},saveRole(){let e={body:{id:this.id+""},id:this.group_permissions.turn.id};this.$store.dispatch("administration/setUserPermissions",e).then(e=>{this.$store.dispatch("administration/getGroupPermissions")})}},created(){this.$store.state.common.countries.length||this.$store.dispatch("common/getCountries");let e=this.$store.state.administration.company.users.find(e=>e.id==this.id)||{};this.user=JSON.parse(JSON.stringify(e)),this.init({id:this.user.country_id,name:this.user.country},{id:this.user.region_id,name:this.user.region},{id:this.user.gender},{id:this.user.avatar,value:this.user.avatarFull?this.user.avatarFull:this.user.name?k(this.user.name,150,90):k(this.user.email,150,90)}),e.birth_day&&(this.date=new Date(e.birth_day).toISOString().substr(0,10)),this.$store.dispatch("administration/getGroupPermissions").then(e=>{e&&(this.permissionList=e.map(e=>{let t=e.users?e.users:[];return this.id&&t.some(e=>e.id==this.id)&&(this.group_permissions={stand:e,turn:e}),{...e,users:t}}))})}},og=ig,ng=Object(m["a"])(og,sg,ag,!1,null,null,null),rg=ng.exports;a["default"].use(u["a"]);const lg=new u["a"]({mode:"history",base:"/",scrollBehavior(){return{x:0,y:0}},routes:[{path:"*",redirect:{name:"main-page"}},{path:"",component:sa,children:[{path:"",redirect:{name:"main-page"}},{path:"callback",component:wa,meta:{part:"main"}},{name:"main-page",path:"main",component:va,meta:{part:"main",crumbs:"Главная страница"}},{path:"engineering",component:Ha,meta:{part:"main"},children:[{path:"",redirect:"moduls"},{path:"moduls",component:va,meta:{part:"engineering",crumbs:"Модули"}},{path:"teamwork",component:va,meta:{part:"engineering",crumbs:"Совместная работа"}},{path:"callback",component:va,meta:{part:"engineering",crumbs:"Обратная связь"}},{path:"reference",component:va,meta:{part:"engineering",crumbs:"Справка"}}]},{path:"workflow",component:si,children:[{path:"",redirect:{name:"projects"}},{name:"projects",path:"projects",component:Pr,meta:{part:"workflow",crumbs:"Проекты"}},{name:"workflow-view",path:":id/view/:doc",components:{default:nu},meta:{part:"workflow-view"},props:{default:!0}},{name:"workflow-project",path:":id/list",component:of,meta:{part:"workflow-project",crumbs:"Документооборот"},props:!0},{name:"managetasks",path:"managetasks",component:Ff,meta:{part:"workflow",crumbs:"Управление задачами"}},{path:"deleted",component:Rf,meta:{part:"workflow",crumbs:"Удаленные файлы"}},{path:"sharing",component:va,meta:{part:"workflow",crumbs:"Общий доступ"}},{path:"archive",component:va,meta:{part:"workflow",crumbs:"Архив"}},{path:"callback",component:va,meta:{part:"workflow",crumbs:"Обратная связь"}},{path:"reference",component:va,beforeEnter:(e,t,s)=>{window.open("https://doc.unitbim.ru/")},meta:{part:"workflow",crumbs:"Справка"}}]},{name:"invite",path:"invite",component:Ja,meta:{part:"main",crumbs:"Приглашение"}},{path:"administration",component:Wa,children:[{path:"",redirect:{name:"account"}},{name:"statistics",path:"statistics",component:pv,meta:{part:"administration",crumbs:"Статистика"}},{name:"account",path:"account",component:nv,meta:{part:"administration",crumbs:"Учетная запись"}},{path:"payment",component:xv,beforeEnter:(e,t,s)=>{let a=Ae.state.administration.user.role;s("1"==a||"2"==a)},meta:{part:"administration",crumbs:"Оплата"},children:[{path:"",redirect:{name:"control"}},{name:"control",path:"control",component:nb,meta:{part:"administration"}}]},{path:"settings",component:gv,beforeEnter:(e,t,s)=>{let a=Ae.state.administration.user.role;s("1"==a||"2"==a)},meta:{part:"administration",crumbs:"Настройки"},children:[{name:"settings",path:"",component:pb,meta:{part:"administration"}},{name:"company",path:"company",component:gb,meta:{part:"administration",crumbs:"Профиль компании"}},{path:"employees",component:xb,meta:{part:"administration",crumbs:"Сотрудники"},children:[{name:"employees",path:"",component:Qb,meta:{part:"administration"}},{name:"employees_invite",path:"invite",component:tg,meta:{part:"administration",crumbs:"Пригласить пользователя"}},{name:"employee_account",path:"account/:id",component:rg,meta:{part:"administration",crumbs:"Учетная запись"},props:!0}]},{name:"accessrights",path:"accessrights",component:Fb,meta:{part:"administration",crumbs:"Права доступа"}},{name:"content",path:"content",component:va,meta:{part:"administration",crumbs:"Контент"}},{name:"contragents",path:"contragents",component:va,meta:{part:"administration",crumbs:"Контрагенты"}},{name:"version",path:"version",component:Lb,meta:{part:"administration",crumbs:"Версионность"}},{name:"activity",path:"activity",component:va,meta:{part:"administration",crumbs:"Активность"}}]}]}]}]});lg.beforeEach((e,t,s)=>{document.title=e.meta.title?e.meta.title:"UnitBim",s()});var cg=lg,mg=s("f309"),dg=s("5607");a["default"].use(mg["a"],{directives:{Ripple:dg["a"]}});var pg=new mg["a"]({icons:{iconfont:"mdi"}}),ug=s("ee98"),hg=s.n(ug),fg=s("d8c5"),vg=s.n(fg);s("d1e7"),s("6562");a["default"].config.productionTip=!1,a["default"].prototype.$url=f.server,a["default"].prototype.$urllocal=f.local,a["default"].use(hg.a),a["default"].use(vg.a),new a["default"]({router:cg,store:Ae,vuetify:pg,render:e=>e(p)}).$mount("#app")},"64f8":function(e,t,s){},6562:function(e,t,s){},"6e0e":function(e,t,s){e.exports=s.p+"img/Logo_text.923c16b8.svg"},7720:function(e,t,s){},"7a19":function(e,t,s){"use strict";s("30a9")},"7a9b":function(e,t,s){},"8ec5":function(e,t,s){"use strict";s("7a9b")},"93db":function(e,t,s){},a44e:function(e,t,s){"use strict";s("e417")},a62e:function(e,t,s){var a={"./78-EUC-H.bcmap":["0e59","noprefetch-78-EUC-H-bcmap"],"./78-EUC-V.bcmap":["23b5","noprefetch-78-EUC-V-bcmap"],"./78-H.bcmap":["b22a","noprefetch-78-H-bcmap"],"./78-RKSJ-H.bcmap":["5c50","noprefetch-78-RKSJ-H-bcmap"],"./78-RKSJ-V.bcmap":["e49a","noprefetch-78-RKSJ-V-bcmap"],"./78-V.bcmap":["b904","noprefetch-78-V-bcmap"],"./78ms-RKSJ-H.bcmap":["20a0","noprefetch-78ms-RKSJ-H-bcmap"],"./78ms-RKSJ-V.bcmap":["15ed","noprefetch-78ms-RKSJ-V-bcmap"],"./83pv-RKSJ-H.bcmap":["5314","noprefetch-83pv-RKSJ-H-bcmap"],"./90ms-RKSJ-H.bcmap":["23a02","noprefetch-90ms-RKSJ-H-bcmap"],"./90ms-RKSJ-V.bcmap":["adb9","noprefetch-90ms-RKSJ-V-bcmap"],"./90msp-RKSJ-H.bcmap":["f5c5","noprefetch-90msp-RKSJ-H-bcmap"],"./90msp-RKSJ-V.bcmap":["58c0","noprefetch-90msp-RKSJ-V-bcmap"],"./90pv-RKSJ-H.bcmap":["49c6","noprefetch-90pv-RKSJ-H-bcmap"],"./90pv-RKSJ-V.bcmap":["ea11","noprefetch-90pv-RKSJ-V-bcmap"],"./Add-H.bcmap":["9fe8","noprefetch-Add-H-bcmap"],"./Add-RKSJ-H.bcmap":["8300","noprefetch-Add-RKSJ-H-bcmap"],"./Add-RKSJ-V.bcmap":["4c1f","noprefetch-Add-RKSJ-V-bcmap"],"./Add-V.bcmap":["c975","noprefetch-Add-V-bcmap"],"./Adobe-CNS1-0.bcmap":["96ac","noprefetch-Adobe-CNS1-0-bcmap"],"./Adobe-CNS1-1.bcmap":["4c01","noprefetch-Adobe-CNS1-1-bcmap"],"./Adobe-CNS1-2.bcmap":["7276","noprefetch-Adobe-CNS1-2-bcmap"],"./Adobe-CNS1-3.bcmap":["12f3","noprefetch-Adobe-CNS1-3-bcmap"],"./Adobe-CNS1-4.bcmap":["bc1b","noprefetch-Adobe-CNS1-4-bcmap"],"./Adobe-CNS1-5.bcmap":["af89","noprefetch-Adobe-CNS1-5-bcmap"],"./Adobe-CNS1-6.bcmap":["23d0","noprefetch-Adobe-CNS1-6-bcmap"],"./Adobe-CNS1-UCS2.bcmap":["bb19","noprefetch-Adobe-CNS1-UCS2-bcmap"],"./Adobe-GB1-0.bcmap":["b48b","noprefetch-Adobe-GB1-0-bcmap"],"./Adobe-GB1-1.bcmap":["ecc7","noprefetch-Adobe-GB1-1-bcmap"],"./Adobe-GB1-2.bcmap":["b086","noprefetch-Adobe-GB1-2-bcmap"],"./Adobe-GB1-3.bcmap":["ddae","noprefetch-Adobe-GB1-3-bcmap"],"./Adobe-GB1-4.bcmap":["f610","noprefetch-Adobe-GB1-4-bcmap"],"./Adobe-GB1-5.bcmap":["27f1","noprefetch-Adobe-GB1-5-bcmap"],"./Adobe-GB1-UCS2.bcmap":["4573","noprefetch-Adobe-GB1-UCS2-bcmap"],"./Adobe-Japan1-0.bcmap":["ed5d","noprefetch-Adobe-Japan1-0-bcmap"],"./Adobe-Japan1-1.bcmap":["4b3a","noprefetch-Adobe-Japan1-1-bcmap"],"./Adobe-Japan1-2.bcmap":["4908","noprefetch-Adobe-Japan1-2-bcmap"],"./Adobe-Japan1-3.bcmap":["eb19","noprefetch-Adobe-Japan1-3-bcmap"],"./Adobe-Japan1-4.bcmap":["9488","noprefetch-Adobe-Japan1-4-bcmap"],"./Adobe-Japan1-5.bcmap":["c24d","noprefetch-Adobe-Japan1-5-bcmap"],"./Adobe-Japan1-6.bcmap":["98df","noprefetch-Adobe-Japan1-6-bcmap"],"./Adobe-Japan1-UCS2.bcmap":["24d3","noprefetch-Adobe-Japan1-UCS2-bcmap"],"./Adobe-Korea1-0.bcmap":["5941","noprefetch-Adobe-Korea1-0-bcmap"],"./Adobe-Korea1-1.bcmap":["ac9a","noprefetch-Adobe-Korea1-1-bcmap"],"./Adobe-Korea1-2.bcmap":["0e77","noprefetch-Adobe-Korea1-2-bcmap"],"./Adobe-Korea1-UCS2.bcmap":["0ab5","noprefetch-Adobe-Korea1-UCS2-bcmap"],"./B5-H.bcmap":["b601","noprefetch-B5-H-bcmap"],"./B5-V.bcmap":["8c39","noprefetch-B5-V-bcmap"],"./B5pc-H.bcmap":["c121","noprefetch-B5pc-H-bcmap"],"./B5pc-V.bcmap":["aeab","noprefetch-B5pc-V-bcmap"],"./CNS-EUC-H.bcmap":["8927","noprefetch-CNS-EUC-H-bcmap"],"./CNS-EUC-V.bcmap":["f124","noprefetch-CNS-EUC-V-bcmap"],"./CNS1-H.bcmap":["36c9","noprefetch-CNS1-H-bcmap"],"./CNS1-V.bcmap":["2f59","noprefetch-CNS1-V-bcmap"],"./CNS2-H.bcmap":["1f9e","noprefetch-CNS2-H-bcmap"],"./CNS2-V.bcmap":["8154","noprefetch-CNS2-V-bcmap"],"./ETHK-B5-H.bcmap":["fefc","noprefetch-ETHK-B5-H-bcmap"],"./ETHK-B5-V.bcmap":["5ad1","noprefetch-ETHK-B5-V-bcmap"],"./ETen-B5-H.bcmap":["500e","noprefetch-ETen-B5-H-bcmap"],"./ETen-B5-V.bcmap":["6e3c","noprefetch-ETen-B5-V-bcmap"],"./ETenms-B5-H.bcmap":["6a25","noprefetch-ETenms-B5-H-bcmap"],"./ETenms-B5-V.bcmap":["f079","noprefetch-ETenms-B5-V-bcmap"],"./EUC-H.bcmap":["6946","noprefetch-EUC-H-bcmap"],"./EUC-V.bcmap":["1e29","noprefetch-EUC-V-bcmap"],"./Ext-H.bcmap":["9741","noprefetch-Ext-H-bcmap"],"./Ext-RKSJ-H.bcmap":["68df","noprefetch-Ext-RKSJ-H-bcmap"],"./Ext-RKSJ-V.bcmap":["2bc0","noprefetch-Ext-RKSJ-V-bcmap"],"./Ext-V.bcmap":["e7de","noprefetch-Ext-V-bcmap"],"./GB-EUC-H.bcmap":["c012","noprefetch-GB-EUC-H-bcmap"],"./GB-EUC-V.bcmap":["d62e","noprefetch-GB-EUC-V-bcmap"],"./GB-H.bcmap":["3a6f","noprefetch-GB-H-bcmap"],"./GB-V.bcmap":["f7b6","noprefetch-GB-V-bcmap"],"./GBK-EUC-H.bcmap":["1415","noprefetch-GBK-EUC-H-bcmap"],"./GBK-EUC-V.bcmap":["7bbc","noprefetch-GBK-EUC-V-bcmap"],"./GBK2K-H.bcmap":["0591","noprefetch-GBK2K-H-bcmap"],"./GBK2K-V.bcmap":["ab5b","noprefetch-GBK2K-V-bcmap"],"./GBKp-EUC-H.bcmap":["18c7","noprefetch-GBKp-EUC-H-bcmap"],"./GBKp-EUC-V.bcmap":["5b1b","noprefetch-GBKp-EUC-V-bcmap"],"./GBT-EUC-H.bcmap":["253c","noprefetch-GBT-EUC-H-bcmap"],"./GBT-EUC-V.bcmap":["8523","noprefetch-GBT-EUC-V-bcmap"],"./GBT-H.bcmap":["3c26","noprefetch-GBT-H-bcmap"],"./GBT-V.bcmap":["176a","noprefetch-GBT-V-bcmap"],"./GBTpc-EUC-H.bcmap":["0152","noprefetch-GBTpc-EUC-H-bcmap"],"./GBTpc-EUC-V.bcmap":["a711","noprefetch-GBTpc-EUC-V-bcmap"],"./GBpc-EUC-H.bcmap":["30fd","noprefetch-GBpc-EUC-H-bcmap"],"./GBpc-EUC-V.bcmap":["06f5","noprefetch-GBpc-EUC-V-bcmap"],"./H.bcmap":["8db7","noprefetch-H-bcmap"],"./HKdla-B5-H.bcmap":["c0fc","noprefetch-HKdla-B5-H-bcmap"],"./HKdla-B5-V.bcmap":["4d8a","noprefetch-HKdla-B5-V-bcmap"],"./HKdlb-B5-H.bcmap":["17d8","noprefetch-HKdlb-B5-H-bcmap"],"./HKdlb-B5-V.bcmap":["a893","noprefetch-HKdlb-B5-V-bcmap"],"./HKgccs-B5-H.bcmap":["9abe","noprefetch-HKgccs-B5-H-bcmap"],"./HKgccs-B5-V.bcmap":["e8bf","noprefetch-HKgccs-B5-V-bcmap"],"./HKm314-B5-H.bcmap":["f431","noprefetch-HKm314-B5-H-bcmap"],"./HKm314-B5-V.bcmap":["b859","noprefetch-HKm314-B5-V-bcmap"],"./HKm471-B5-H.bcmap":["ab23","noprefetch-HKm471-B5-H-bcmap"],"./HKm471-B5-V.bcmap":["74b0","noprefetch-HKm471-B5-V-bcmap"],"./HKscs-B5-H.bcmap":["1602","noprefetch-HKscs-B5-H-bcmap"],"./HKscs-B5-V.bcmap":["7342","noprefetch-HKscs-B5-V-bcmap"],"./Hankaku.bcmap":["bcb6","noprefetch-Hankaku-bcmap"],"./Hiragana.bcmap":["3dcb","noprefetch-Hiragana-bcmap"],"./KSC-EUC-H.bcmap":["dc61","noprefetch-KSC-EUC-H-bcmap"],"./KSC-EUC-V.bcmap":["949c","noprefetch-KSC-EUC-V-bcmap"],"./KSC-H.bcmap":["b67b","noprefetch-KSC-H-bcmap"],"./KSC-Johab-H.bcmap":["3f40","noprefetch-KSC-Johab-H-bcmap"],"./KSC-Johab-V.bcmap":["3a3b","noprefetch-KSC-Johab-V-bcmap"],"./KSC-V.bcmap":["b5c9","noprefetch-KSC-V-bcmap"],"./KSCms-UHC-H.bcmap":["25ca","noprefetch-KSCms-UHC-H-bcmap"],"./KSCms-UHC-HW-H.bcmap":["9c89","noprefetch-KSCms-UHC-HW-H-bcmap"],"./KSCms-UHC-HW-V.bcmap":["9149","noprefetch-KSCms-UHC-HW-V-bcmap"],"./KSCms-UHC-V.bcmap":["25d1","noprefetch-KSCms-UHC-V-bcmap"],"./KSCpc-EUC-H.bcmap":["1f5f","noprefetch-KSCpc-EUC-H-bcmap"],"./KSCpc-EUC-V.bcmap":["95d1","noprefetch-KSCpc-EUC-V-bcmap"],"./Katakana.bcmap":["9d22","noprefetch-Katakana-bcmap"],"./NWP-H.bcmap":["65c0","noprefetch-NWP-H-bcmap"],"./NWP-V.bcmap":["e679","noprefetch-NWP-V-bcmap"],"./RKSJ-H.bcmap":["dda4","noprefetch-RKSJ-H-bcmap"],"./RKSJ-V.bcmap":["3e4a","noprefetch-RKSJ-V-bcmap"],"./Roman.bcmap":["7526","noprefetch-Roman-bcmap"],"./UniCNS-UCS2-H.bcmap":["8ba4","noprefetch-UniCNS-UCS2-H-bcmap"],"./UniCNS-UCS2-V.bcmap":["af85","noprefetch-UniCNS-UCS2-V-bcmap"],"./UniCNS-UTF16-H.bcmap":["1f79","noprefetch-UniCNS-UTF16-H-bcmap"],"./UniCNS-UTF16-V.bcmap":["727b","noprefetch-UniCNS-UTF16-V-bcmap"],"./UniCNS-UTF32-H.bcmap":["51bf","noprefetch-UniCNS-UTF32-H-bcmap"],"./UniCNS-UTF32-V.bcmap":["6785","noprefetch-UniCNS-UTF32-V-bcmap"],"./UniCNS-UTF8-H.bcmap":["55d9","noprefetch-UniCNS-UTF8-H-bcmap"],"./UniCNS-UTF8-V.bcmap":["2a4e","noprefetch-UniCNS-UTF8-V-bcmap"],"./UniGB-UCS2-H.bcmap":["6f3e","noprefetch-UniGB-UCS2-H-bcmap"],"./UniGB-UCS2-V.bcmap":["b445","noprefetch-UniGB-UCS2-V-bcmap"],"./UniGB-UTF16-H.bcmap":["6d06","noprefetch-UniGB-UTF16-H-bcmap"],"./UniGB-UTF16-V.bcmap":["1d84","noprefetch-UniGB-UTF16-V-bcmap"],"./UniGB-UTF32-H.bcmap":["a43e","noprefetch-UniGB-UTF32-H-bcmap"],"./UniGB-UTF32-V.bcmap":["841f","noprefetch-UniGB-UTF32-V-bcmap"],"./UniGB-UTF8-H.bcmap":["4343","noprefetch-UniGB-UTF8-H-bcmap"],"./UniGB-UTF8-V.bcmap":["f7ab","noprefetch-UniGB-UTF8-V-bcmap"],"./UniJIS-UCS2-H.bcmap":["909a","noprefetch-UniJIS-UCS2-H-bcmap"],"./UniJIS-UCS2-HW-H.bcmap":["da0a","noprefetch-UniJIS-UCS2-HW-H-bcmap"],"./UniJIS-UCS2-HW-V.bcmap":["92f3","noprefetch-UniJIS-UCS2-HW-V-bcmap"],"./UniJIS-UCS2-V.bcmap":["1122","noprefetch-UniJIS-UCS2-V-bcmap"],"./UniJIS-UTF16-H.bcmap":["efa2","noprefetch-UniJIS-UTF16-H-bcmap"],"./UniJIS-UTF16-V.bcmap":["6a8f","noprefetch-UniJIS-UTF16-V-bcmap"],"./UniJIS-UTF32-H.bcmap":["1418","noprefetch-UniJIS-UTF32-H-bcmap"],"./UniJIS-UTF32-V.bcmap":["4c57","noprefetch-UniJIS-UTF32-V-bcmap"],"./UniJIS-UTF8-H.bcmap":["d02d","noprefetch-UniJIS-UTF8-H-bcmap"],"./UniJIS-UTF8-V.bcmap":["b2ed","noprefetch-UniJIS-UTF8-V-bcmap"],"./UniJIS2004-UTF16-H.bcmap":["1e4a","noprefetch-UniJIS2004-UTF16-H-bcmap"],"./UniJIS2004-UTF16-V.bcmap":["f840","noprefetch-UniJIS2004-UTF16-V-bcmap"],"./UniJIS2004-UTF32-H.bcmap":["0839","noprefetch-UniJIS2004-UTF32-H-bcmap"],"./UniJIS2004-UTF32-V.bcmap":["b2d7","noprefetch-UniJIS2004-UTF32-V-bcmap"],"./UniJIS2004-UTF8-H.bcmap":["4b82","noprefetch-UniJIS2004-UTF8-H-bcmap"],"./UniJIS2004-UTF8-V.bcmap":["34c5","noprefetch-UniJIS2004-UTF8-V-bcmap"],"./UniJISPro-UCS2-HW-V.bcmap":["e2f5","noprefetch-UniJISPro-UCS2-HW-V-bcmap"],"./UniJISPro-UCS2-V.bcmap":["7454","noprefetch-UniJISPro-UCS2-V-bcmap"],"./UniJISPro-UTF8-V.bcmap":["b6a2","noprefetch-UniJISPro-UTF8-V-bcmap"],"./UniJISX0213-UTF32-H.bcmap":["17c1","noprefetch-UniJISX0213-UTF32-H-bcmap"],"./UniJISX0213-UTF32-V.bcmap":["8d60","noprefetch-UniJISX0213-UTF32-V-bcmap"],"./UniJISX02132004-UTF32-H.bcmap":["5776","noprefetch-UniJISX02132004-UTF32-H-bcmap"],"./UniJISX02132004-UTF32-V.bcmap":["cf96","noprefetch-UniJISX02132004-UTF32-V-bcmap"],"./UniKS-UCS2-H.bcmap":["adc9","noprefetch-UniKS-UCS2-H-bcmap"],"./UniKS-UCS2-V.bcmap":["5f76","noprefetch-UniKS-UCS2-V-bcmap"],"./UniKS-UTF16-H.bcmap":["e1a2","noprefetch-UniKS-UTF16-H-bcmap"],"./UniKS-UTF16-V.bcmap":["24eb","noprefetch-UniKS-UTF16-V-bcmap"],"./UniKS-UTF32-H.bcmap":["331c","noprefetch-UniKS-UTF32-H-bcmap"],"./UniKS-UTF32-V.bcmap":["8f6e","noprefetch-UniKS-UTF32-V-bcmap"],"./UniKS-UTF8-H.bcmap":["b9e9","noprefetch-UniKS-UTF8-H-bcmap"],"./UniKS-UTF8-V.bcmap":["648b","noprefetch-UniKS-UTF8-V-bcmap"],"./V.bcmap":["171f","noprefetch-V-bcmap"],"./WP-Symbol.bcmap":["fa3a","noprefetch-WP-Symbol-bcmap"]};function i(e){if(!s.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],i=t[0];return s.e(t[1]).then((function(){return s(i)}))}i.keys=function(){return Object.keys(a)},i.id="a62e",e.exports=i},aabd:function(e,t,s){},ae2f:function(e,t,s){"use strict";s("0576")},b202:function(e,t,s){},b3d2:function(e,t,s){},b7c6:function(e,t,s){"use strict";s("4d2b")},cb89:function(e,t,s){"use strict";s("aabd")},d3f9:function(e,t,s){},d8b3:function(e,t,s){"use strict";s("e6f0")},e09d:function(e,t,s){"use strict";s("d3f9")},e417:function(e,t,s){},e6e9:function(e,t,s){"use strict";s("b3d2")},e6f0:function(e,t,s){},ecb1:function(e,t,s){"use strict";s("93db")},f158:function(e,t,s){e.exports=s.p+"img/in_work.03cd711a.svg"},f276:function(e,t,s){}});
//# sourceMappingURL=app.28e5f6da.js.map